(function(e){function t(t){for(var o,r,l=t[0],n=t[1],c=t[2],m=0,u=[];m<l.length;m++)r=l[m],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&u.push(s[r][0]),s[r]=0;for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);d&&d(t);while(u.length)u.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],o=!0,l=1;l<a.length;l++){var n=a[l];0!==s[n]&&(o=!1)}o&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var o={},s={index:0},i=[];function r(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=o,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(a,o,function(t){return e[t]}.bind(null,o));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],n=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=n;i.push([0,"chunk-vendors","chunk-common"]),a()})({0:function(e,t,a){e.exports=a("b635")},"0523":function(e,t,a){"use strict";a("e4a0")},"10a2":function(e,t,a){"use strict";a("2f08")},"21c0":function(e,t,a){"use strict";a("ebcc")},2448:function(e,t,a){},"2f08":function(e,t,a){},3578:function(e,t,a){"use strict";a("467f")},"3db7":function(e,t,a){"use strict";a("da6c")},"3e32":function(e,t,a){"use strict";a("a276")},"40ce":function(e,t,a){"use strict";a("5b47")},4427:function(e,t,a){},"467f":function(e,t,a){},"4c4f":function(e,t,a){"use strict";a("2448")},5894:function(e,t,a){},"5b47":function(e,t,a){},"5e93":function(e,t,a){"use strict";a("4427")},"606f":function(e,t,a){},"6dd0":function(e,t,a){},7587:function(e,t,a){"use strict";a("8589")},"77b8":function(e,t,a){"use strict";a("8e9e")},"7b8d":function(e,t,a){"use strict";a("a00d")},8589:function(e,t,a){},"8e9e":function(e,t,a){},"90e5":function(e,t,a){},"9d68":function(e,t,a){},"9d9a":function(e,t,a){"use strict";a("a109")},a00d:function(e,t,a){},a059:function(e,t,a){"use strict";a("90e5")},a109:function(e,t,a){},a276:function(e,t,a){},a302:function(e,t,a){"use strict";a("5894")},a7420:function(e,t,a){},b635:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("a026"),s=a("42a2a"),i=a("77a0"),r=a.n(i),l=(a("aaf0"),a("5c96")),n=a.n(l),c=(a("a082"),a("42a1"),a("b3f5"),a("f77c"),a("e7c1"),function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("app-header"),e.market?e._e():t("div",[t("keep-alive",[t("router-view",{staticClass:"main-width",attrs:{id:"m1"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.market,expression:"market"}]},[t("router-view",{staticClass:"main-width",attrs:{id:"m2",name:"market"}})],1)],1)}),d=[],m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app_index__header"},[t("div",{staticClass:"main-width"},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"logo-wrap"},["true"===e.enable&&"true"===e.show?t("a",{class:{active:!0},attrs:{href:"/tars.html"}},[t("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]):e._e(),"true"===e.k8s?t("a",{attrs:{href:"/k8s.html"}},[t("img",{staticClass:"logo",attrs:{src:"/static/img/K8S.png"}})]):e._e()])]),t("el-col",{attrs:{span:9}},[t("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0].path},on:{click:e.clickTab}},[t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab2"),tabkey:"/operation",icon:e.opaIcon}}),t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab9"),tabkey:"/market",icon:e.packageIcon}})],1)],1),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"plugin-wrap"},[t("extentionSelect")],1)]),t("el-col",{attrs:{span:2}},[t("span",{staticClass:"version-wrap"},[t("div",[e._v("web:"+e._s(e.web_version))]),t("div",[e._v("framework:"+e._s(e.framework_version))]),t("el-link",{staticStyle:{"font-size":"9px"},attrs:{href:"https://doc.tarsyun.com",target:"_blank"}},[e._v(e._s("cn"==e.locale?"在线文档":"Online Manual"))])],1)]),t("el-col",{attrs:{span:2}},[t("span",{staticClass:"language-wrap"},[t("localeSelect")],1)]),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"user-wrap"},[t("el-dropdown",{staticStyle:{display:"block !important"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.uid)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{command:"center"}},[e._v(e._s(e.$t("header.userCenter")))]),e.enableLdap?e._e():t("el-dropdown-item",{attrs:{command:"modifyPass"}},[e._v(e._s(e.$t("header.modifyPass")))]),e.enableLdap?e._e():t("el-dropdown-item",{attrs:{command:"quit"}},[e._v(e._s(e.$t("header.logout")))])],1)],1)],1)])],1)],1)])},u=[],p=(a("ac1f"),a("5319"),a("1817")),h=a.n(p),f=a("1ca6"),_=a.n(f),v=a("cc08"),g=a.n(v),b=a("4d18"),$=a.n(b),w=a("00b0"),y=a("3841"),M=a("bc3a"),k=a.n(M),S={components:{localeSelect:w["a"],extentionSelect:y["a"]},data:function(){return{serverIcon:h.a,opaIcon:_.a,cacheIcon:g.a,packageIcon:$.a,locale:this.$cookie.get("locale")||"cn",uid:"--",enableLogin:!1,isAdmin:!1,k8s:this.$cookie.get("k8s")||"false",enable:this.$cookie.get("enable")||"false",show:this.$cookie.get("show")||"false",enableLdap:!1,web_version:"loading··",framework_version:"loading··"}},computed:{marketUid:function(){return this.$store.state.marketUid}},methods:{clickTab:function(e){this.$router.replace(e)},userCenter:function(){window.open("/pages/server/api/userCenter")},handleCommand:function(e){"center"==e?location.href="/auth.html":"modifyPass"==e&&(location.href="/pass.html"),"quit"==e&&(location.href="/pages/server/api/logout")},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?(e.uid=t.uid,window.localStorage.localUid=e.uid):(e.uid="***",window.localStorage.localUid=e.uid)})).catch((function(t){e.$tip.error("get user login info error: ".concat(t.err_msg||t.message))}))},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))},checkEnableLdap:function(){var e=this;this.$ajax.getJSON("/server/api/isEnableLdap").then((function(t){e.enableLdap=t.enableLdap||!1})).catch((function(e){}))},checkAdmin:function(){var e=this;this.isAdmin=!1,this.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){}))}},mounted:function(){var e=this;this.getLoginUid(),this.checkEnableLogin(),this.checkAdmin(),this.checkEnableLdap(),k.a.create({baseURL:"/"})({method:"get",url:"/web/web_version"}).then((function(t){e.web_version=t.data.webVersion,e.framework_version=t.data.frameworkVersion,e.$store.commit({type:"version",version:e.web_version,framework_version:e.frameworkVersion})})),k.a.create({baseURL:"/"})({method:"get",url:"/web/title"}).then((function(e){document.title=e.data.title||""})),document.body.style.overflow="auto",window.header=this}},L=S,x=(a("7b8d"),a("2877")),C=Object(x["a"])(L,m,u,!1,null,null,null),N=C.exports,E=a("559f"),D={name:"App",components:{AppHeader:N,AppFooter:E["a"]},watch:{$route:function(e,t){"/market"==e.path?this.market=!0:this.market=!1}},data:function(){return{market:!1}},mounted:function(){"/market"==this.$route.path?this.market=!0:this.market=!1}},I=D,T=(a("5e93"),Object(x["a"])(I,c,d,!1,null,null,null)),O=T.exports,q=a("8c4f"),j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server"},[t("div",{staticClass:"left-view"},[t("div",{staticClass:"tree_search"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.treeSearchKey,expression:"treeSearchKey"}],staticClass:"tree_search_key",attrs:{type:"text",placeholder:e.$t("home.placeholder")},domProps:{value:e.treeSearchKey},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.treeSearch(0)},input:function(t){t.target.composing||(e.treeSearchKey=t.target.value)}}}),t("i",{staticClass:"el-icon-refresh-right",class:{active:e.isIconPlay},attrs:{id:"img"},on:{click:function(t){return e.treeSearch(1)}}})]),t("div",{staticClass:"tree_wrap"},[e.treeData&&e.treeData.length?t("let-tree",{staticClass:"left-tree",attrs:{data:e.treeData,activeKey:e.treeid},on:{"on-select":e.selectTree}}):e._e(),e.treeData&&!e.treeData.length?t("div",{staticClass:"left-tree"},[t("p",{staticClass:"loading"},[e._v(e._s(e.$t("common.noService")))])]):e._e(),e.treeData?e._e():t("div",{ref:"treeLoading",staticClass:"left-tree"},[!1===e.treeData?t("div",{staticClass:"loading"},[t("p",[e._v(e._s(e.treeErrMsg))]),t("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.getTreeData()}}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()])],1)]),t("div",{staticClass:"right-view"},[t("div",{staticClass:"btabs_wrap"},[t("ul",{directives:[{name:"vscroll",rawName:"v-vscroll"}],ref:"btabs",staticClass:"btabs"},[t("li",{key:e.homeTab,staticClass:"btabs_item",class:{active:e.homeTab===e.treeid}},[t("a",{staticClass:"btabs_link",staticStyle:{"padding-right":"20px"},attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,e.homeTab)}}},[e._v(" "+e._s(e.$t("home.homeTab"))+" ")])]),e._l(e.BTabs,(function(a){return t("li",{key:a.id,staticClass:"btabs_item",class:{active:a.id===e.treeid}},[t("a",{staticClass:"btabs_link",attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,a.id)}}},[e._v(e._s(e.getNewServerName(a.id)))]),t("a",{staticClass:"btabs_close",attrs:{href:"javascript:;"},on:{click:function(t){return e.closeBTabs(a.id)}}},[e._v(" "+e._s(e.$t("home.close")))])])}))],2),t("a",{staticClass:"btabs_all",attrs:{href:"javascript:;",title:e.$t("home.closeAll")},on:{click:e.closeAllBTabs}},[e._v(" "+e._s(e.$t("home.closeAll")))])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.treeid===e.homeTab,expression:"treeid === homeTab"}],staticClass:"btabs_con_home",staticStyle:{height:"800px"}},[t("serverHistory")],1),t("div",{staticClass:"btabs_con"},e._l(e.BTabs,(function(a){return t("div",{directives:[{name:"show",rawName:"v-show",value:a.id===e.treeid,expression:"item.id === treeid"}],key:a.id,staticClass:"btabs_con_item"},[t("el-tabs",{on:{"tab-click":e.clickTab},model:{value:a.path,callback:function(t){e.$set(a,"path",t)},expression:"item.path"}},[t("el-tab-pane",{attrs:{name:e.base+"/manage",label:e.$t("header.tab.tab1")}}),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/publish",label:e.$t("index.rightView.tab.patch")}}):e._e(),5===e.serverData.level||4===e.serverData.level||1===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/config",label:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):4===e.serverData.level?e.$t("index.rightView.tab.setConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/server-monitor",label:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/property-monitor",label:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/user-manage",label:e.$t("index.rightView.tab.privileage")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/callChain",label:e.$t("index.rightView.tab.treeConfig")}}):e._e(),e._l(e.plugins,(function(a){return 5===e.serverData.level?t("el-tab-pane",{key:a.f_id,attrs:{name:e.base+a.f_path+"/plugins",label:a.f_name}}):e._e()}))],2),t(e.getName(a.path),{ref:"childView",refInFor:!0,tag:"router-view",staticClass:"page_server_child",attrs:{treeid:a.id,path:a.pluginPath,k8s:!1}})],1)})),0)])])},R=[],z=(a("1276"),a("99af"),a("d3b7"),a("159b"),a("b0c0"),a("e9c4"),a("a434"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_manage"},[t("div",{staticClass:"table_head"},[t("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerList(e.serverPageNum)}}})])]),e.serverList?t("let-table",{ref:"serverListLoading",staticClass:"dcache",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata"),stripe:""}},[t("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(a){return[t("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(a){return[t("let-checkbox",{attrs:{value:a.row.id},model:{value:a.row.isChecked,callback:function(t){e.$set(a.row,"isChecked",t)},expression:"scope.row.isChecked"}})]}}],null,!1,1091570282)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app="+[a.row.application]+"&server_name="+[a.row.server_name]+"&node_name="+[a.row.node_name],title:e.$t("serverList.link.remoteLog"),target:"_blank"}},[e._v(" "+e._s(a.row.server_name)+" ")]),a.row.source["tars.io/CloudInstall"]?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.source["tars.io/CloudInstall"].group+"/"+a.row.source["tars.io/CloudInstall"].name+":"+a.row.source["tars.io/CloudInstall"].version,placement:"top-start"}},[t("i",{staticClass:"el-icon-cloudy",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.goMarket(a.row)}}})]):e._e()]}}],null,!1,3602200053)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.is_node_ok?t("span",[t("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app="+[a.row.application]+"&server_name="+[a.row.server_name]+"&node_name="+[a.row.node_name],title:e.$t("serverList.link.nodeLog"),target:"_blank"}},[e._v(" "+e._s(a.row.node_name)+" ")])]):t("span",{staticStyle:{color:"#FF0000"}},[e._v(" "+e._s(a.row.node_name)+e._s(e.$t("serverList.link.invalidNode"))+" ")])]}}],null,!1,4273515738)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.enable_set?t("p",{staticStyle:{"max-width":"200px"}},[e._v(" "+e._s(e.$t("common.set.setName"))+"："+e._s(a.row.set_name)),t("br"),e._v(" "+e._s(e.$t("common.set.setArea"))+"："+e._s(a.row.set_area)),t("br"),e._v(" "+e._s(e.$t("common.set.setGroup"))+"："+e._s(a.row.set_group)+" ")]):t("span",[e._v(e._s(e.$t("common.disable")))])]}}],null,!1,1083854891)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return["Inactive"===a.row.setting_state?t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.setting_state))]):t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.setting_state))])]}}],null,!1,1039889159)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return["0"!=a.row.query_ret_code?t("span",{staticStyle:{color:"#FF0000"}},[e._v("Inactive")]):"Active"===a.row.present_state_in_node?t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.present_state_in_node))]):t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.present_state_in_node))])]}}],null,!1,350457171)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.reportedStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return["Active"!==a.row.present_state?t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.present_state))]):t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.present_state))])]}}],null,!1,3786652737)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.flowStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("span",{class:"inactive"===e.row.flow_state?"status-off":"status-flowactive"})]}}],null,!1,943999759)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID")},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v(" "+e._s(a.row.process_id)+" "),"container"==a.row.run_type?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Run In Container",placement:"top-start"}},[t("i",{staticClass:"el-icon-files"})]):e._e()]}}],null,!1,2224831648)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.operator"),prop:"patch_user"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(a.row.patch_time)))])]}}],null,!1,3144837894)}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"300px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.configServer(a.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.restartServer(a.row.id)}}},[e._v(e._s(e.$t("operate.restart")))]),t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.stopServer(a.row.id)}}},[e._v(e._s(e.$t("operate.stop")))]),"active"===a.row.flow_state?t("let-table-operation",{on:{click:function(t){return e.updateFlowStatus(a.row.id,!1,a.row.node_name)}}},[e._v(e._s(e.$t("operate.pause")))]):e._e(),"inactive"===a.row.flow_state?t("let-table-operation",{on:{click:function(t){return e.updateFlowStatus(a.row.id,!0,a.row.node_name)}}},[e._v(e._s(e.$t("operate.resume")))]):e._e(),t("let-table-operation",{on:{click:function(t){return e.manageServant(a.row)}}},[e._v(e._s(e.$t("operate.servant")))]),t("let-table-operation",{on:{click:function(t){return e.showStatusModal(a.row)}}},[e._v(e._s(e.$t("operate.statusView")))]),t("let-table-operation",{on:{click:function(t){return e.showTemplateView(a.row)}}},[e._v(e._s(e.$t("operate.templateView")))]),t("let-table-operation",{on:{click:function(t){return e.showMoreCmd(a.row)}}},[e._v(e._s(e.$t("operate.more")))])]}}],null,!1,2009490847)}),t("template",{slot:"operations"},[t("let-button",{attrs:{theme:"primary",size:"small",disabled:!e.hasCheckedServer},on:{click:e.batchshowStatusModal}},[e._v(e._s(e.$t("operate.statusView")))]),t("let-button",{attrs:{theme:"primary",size:"small",disabled:!e.hasCheckedServer},on:{click:e.batchShowMoreCmd}},[e._v(e._s(e.$t("operate.more")))]),t("let-button",{attrs:{theme:"primary",size:"small",disabled:!e.hasCheckedServer},on:{click:e.batchConfigServer}},[e._v(e._s(e.$t("serverList.batch.edit")))]),t("batch-operation",{attrs:{size:"small",disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"restart"},on:{"success-fn":e.getServerList}}),t("batch-operation",{attrs:{size:"small",disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"stop"},on:{"success-fn":e.getServerList}})],1)],2):e._e(),e.serverNotifyList&&e.showOthers?e._e():t("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.serverPageNum,total:e.serverTotal},on:{change:e.gotoServerPage}}),t("div",{staticClass:"table_head"},[e.serverNotifyList&&e.showOthers?t("h4",[e._v(" "+e._s(this.$t("serverList.title.serverStatus"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerNotifyList()}}},[e._v("")])]):e._e()]),e.serverNotifyList&&e.showOthers?t("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,stripe:"","empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"20%",title:e.$t("common.time"),prop:"notifytime"}}),t("let-table-column",{attrs:{width:"20%",title:e.$t("serverList.table.th.serviceID"),prop:"server_id"}}),t("let-table-column",{attrs:{width:"15%",title:e.$t("serverList.table.th.threadID"),prop:"thread_id"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.statusStyle(a.row.result)},[e._v(e._s(a.row.result))])]}}],null,!1,3563771650)})],1):e._e(),e.serverNotifyList&&e.showOthers?t("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}}):e._e(),t("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"60%",footShow:!(!e.configModal.model||!e.configModal.model.server_name)},on:{"on-confirm":function(t){return e.saveConfig(e.batchEditConf.show)},close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.server_name?t("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"50%",columns:2}},[e.batchEditConf.show?t("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.configModal.model.server_name))]):e._e(),e.batchEditConf.show?t("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.configModal.model.node_name))]):e._e(),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.useIdc"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.enable_group,callback:function(t){e.$set(e.batchEditConf.itemEnable,"enable_group",t)},expression:"batchEditConf.itemEnable.enable_group"}}),t("let-radio-group",{attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.enable_group,data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.enable_group,callback:function(t){e.$set(e.configModal.model,"enable_group",t)},expression:"configModal.model.enable_group"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.groupName")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.enable_group,callback:function(t){e.$set(e.batchEditConf.itemEnable,"enable_group",t)},expression:"batchEditConf.itemEnable.enable_group"}}),t("let-select",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.configModal.model.enable_group},model:{value:e.configModal.model.ip_group_name,callback:function(t){e.$set(e.configModal.model,"ip_group_name",t)},expression:"configModal.model.ip_group_name"}},e._l(e.configModal.model.groupList,(function(a){return t("let-option",{key:a.value,attrs:{value:a.key}},[e._v(e._s(a.value))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.isBackup"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.bak_flag,callback:function(t){e.$set(e.batchEditConf.itemEnable,"bak_flag",t)},expression:"batchEditConf.itemEnable.bak_flag"}}),t("let-radio-group",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.bak_flag,data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.bak_flag,callback:function(t){e.$set(e.configModal.model,"bak_flag",t)},expression:"configModal.model.bak_flag"}})],1),t("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.template_name,callback:function(t){e.$set(e.batchEditConf.itemEnable,"template_name",t)},expression:"batchEditConf.itemEnable.template_name"}}),e.configModal.model.templates&&e.configModal.model.templates.length?t("let-select",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.template_name,required:""},model:{value:e.configModal.model.template_name,callback:function(t){e.$set(e.configModal.model,"template_name",t)},expression:"configModal.model.template_name"}},e._l(e.configModal.model.templates,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1):t("span",[e._v(e._s(e.configModal.model.template_name))])],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.serviceType"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.server_type,callback:function(t){e.$set(e.batchEditConf.itemEnable,"server_type",t)},expression:"batchEditConf.itemEnable.server_type"}}),t("let-select",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.server_type,required:""},model:{value:e.configModal.model.server_type,callback:function(t){e.$set(e.configModal.model,"server_type",t)},expression:"configModal.model.server_type"}},e._l(e.serverTypes,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.enable_set,callback:function(t){e.$set(e.batchEditConf.itemEnable,"enable_set",t)},expression:"batchEditConf.itemEnable.enable_set"}}),t("let-radio-group",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.enable_set,data:[{value:!0,text:e.$t("common.enable")},{value:!1,text:e.$t("common.disable")}]},model:{value:e.configModal.model.enable_set,callback:function(t){e.$set(e.configModal.model,"enable_set",t)},expression:"configModal.model.enable_set"}})],1),e.configModal.model.enable_set?t("let-form-item",{attrs:{label:e.$t("common.set.setName"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.set_name,callback:function(t){e.$set(e.batchEditConf.itemEnable,"set_name",t)},expression:"batchEditConf.itemEnable.set_name"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.set_name,placeholder:e.$t("serverList.dlg.errMsg.setName"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setName")},model:{value:e.configModal.model.set_name,callback:function(t){e.$set(e.configModal.model,"set_name",t)},expression:"configModal.model.set_name"}})],1):e._e(),e.configModal.model.enable_set?t("let-form-item",{attrs:{label:e.$t("common.set.setArea"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.set_area,callback:function(t){e.$set(e.batchEditConf.itemEnable,"set_area",t)},expression:"batchEditConf.itemEnable.set_area"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.set_area,placeholder:e.$t("serverList.dlg.errMsg.setArea"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setArea")},model:{value:e.configModal.model.set_area,callback:function(t){e.$set(e.configModal.model,"set_area",t)},expression:"configModal.model.set_area"}})],1):e._e(),e.configModal.model.enable_set?t("let-form-item",{attrs:{label:e.$t("common.set.setGroup"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.set_group,callback:function(t){e.$set(e.batchEditConf.itemEnable,"set_group",t)},expression:"batchEditConf.itemEnable.set_group"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.set_group,placeholder:e.$t("serverList.dlg.errMsg.setGroup"),required:"",pattern:"^[0-9\\*]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setGroup")},model:{value:e.configModal.model.set_group,callback:function(t){e.$set(e.configModal.model,"set_group",t)},expression:"configModal.model.set_group"}})],1):e._e(),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.run_type"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.run_type_bool,callback:function(t){e.$set(e.batchEditConf.itemEnable,"run_type_bool",t)},expression:"batchEditConf.itemEnable.run_type_bool"}}),t("let-radio-group",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.run_type_bool,data:[{value:!0,text:e.$t("pub.dlg.tgzRun")},{value:!1,text:e.$t("pub.dlg.containerRun")}]},on:{change:e.changeRunType},model:{value:e.configModal.model.run_type_bool,callback:function(t){e.$set(e.configModal.model,"run_type_bool",t)},expression:"configModal.model.run_type_bool"}})],1),e.configModal.model.run_type_bool?e._e():t("let-form-item",{attrs:{label:e.$t("deployService.form.baseImageId")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.run_type_bool,callback:function(t){e.$set(e.batchEditConf.itemEnable,"run_type_bool",t)},expression:"batchEditConf.itemEnable.run_type_bool"}}),t("let-select",{attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.run_type_bool},model:{value:e.configModal.model.base_image_id,callback:function(t){e.$set(e.configModal.model,"base_image_id",t)},expression:"configModal.model.base_image_id"}},e._l(e.baseImageList,(function(a){return t("let-option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.registry+"("+a.image+")"))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.async_thread_num,callback:function(t){e.$set(e.batchEditConf.itemEnable,"async_thread_num",t)},expression:"batchEditConf.itemEnable.async_thread_num"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.async_thread_num,placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars_nodejs"===e.configModal.model.server_type?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":e.$t("serverList.dlg.placeholder.thread")},model:{value:e.configModal.model.async_thread_num,callback:function(t){e.$set(e.configModal.model,"async_thread_num",t)},expression:"configModal.model.async_thread_num"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.defaultPath")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.base_path,callback:function(t){e.$set(e.batchEditConf.itemEnable,"base_path",t)},expression:"batchEditConf.itemEnable.base_path"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.base_path||!e.configModal.model.run_type_bool},model:{value:e.configModal.model.base_path,callback:function(t){e.$set(e.configModal.model,"base_path",t)},expression:"configModal.model.base_path"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.exePath")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.exe_path,callback:function(t){e.$set(e.batchEditConf.itemEnable,"exe_path",t)},expression:"batchEditConf.itemEnable.exe_path"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.exe_path||!e.configModal.model.run_type_bool},model:{value:e.configModal.model.exe_path,callback:function(t){e.$set(e.configModal.model,"exe_path",t)},expression:"configModal.model.exe_path"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.startScript")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.start_script_path,callback:function(t){e.$set(e.batchEditConf.itemEnable,"start_script_path",t)},expression:"batchEditConf.itemEnable.start_script_path"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.start_script_path||!e.configModal.model.run_type_bool},model:{value:e.configModal.model.start_script_path,callback:function(t){e.$set(e.configModal.model,"start_script_path",t)},expression:"configModal.model.start_script_path"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.stopScript")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.stop_script_path,callback:function(t){e.$set(e.batchEditConf.itemEnable,"stop_script_path",t)},expression:"batchEditConf.itemEnable.stop_script_path"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.stop_script_path||!e.configModal.model.run_type_bool},model:{value:e.configModal.model.stop_script_path,callback:function(t){e.$set(e.configModal.model,"stop_script_path",t)},expression:"configModal.model.stop_script_path"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.monitorScript")}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.monitor_script_path,callback:function(t){e.$set(e.batchEditConf.itemEnable,"monitor_script_path",t)},expression:"batchEditConf.itemEnable.monitor_script_path"}}),t("let-input",{staticClass:"form_item_style",attrs:{size:"small",disabled:!e.batchEditConf.itemEnable.monitor_script_path||!e.configModal.model.run_type_bool},model:{value:e.configModal.model.monitor_script_path,callback:function(t){e.$set(e.configModal.model,"monitor_script_path",t)},expression:"configModal.model.monitor_script_path"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"100%"}},[t("let-checkbox",{directives:[{name:"show",rawName:"v-show",value:!e.batchEditConf.show,expression:"!batchEditConf.show"}],staticClass:"form_item_disabled",model:{value:e.batchEditConf.itemEnable.profile,callback:function(t){e.$set(e.batchEditConf.itemEnable,"profile",t)},expression:"batchEditConf.itemEnable.profile"}}),t("let-input",{attrs:{size:"large",type:"textarea",rows:5,disabled:!e.batchEditConf.itemEnable.profile},model:{value:e.configModal.model.profile,callback:function(t){e.$set(e.configModal.model,"profile",t)},expression:"configModal.model.profile"}})],1)],1):t("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),t("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[t("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant")]),e.servantModal.model?t("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("operate.servant"),prop:"servant"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.adress"),prop:"endpoint"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.thread"),prop:"thread_num"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),prop:"max_connections"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),prop:"queuecap"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),prop:"queuetimeout"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:a.row.servant+"@"+a.row.endpoint,expression:"scope.row.servant + '@' + scope.row.endpoint",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopy,expression:"onCopy",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onError,expression:"onError",arg:"error"}]},[e._v(e._s(e.$t("operate.copy")))]),t("let-table-operation",{on:{click:function(t){return e.configServant(a.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteServant(a.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,3233567993)})],1):t("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),t("let-modal",{attrs:{title:e.servantDetailModal.isNew?"".concat(e.$t("operate.title.add")," Servant"):"".concat(e.$t("operate.title.update")," Servant"),width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model?t("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[t("let-form-item",{attrs:{label:e.$t("serverList.servant.appService"),itemWidth:"724px"}},[t("span",[e._v(e._s(e.servantDetailModal.model.application)+"·"+e._s(e.servantDetailModal.model.server_name))])]),t("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.obj_name,callback:function(t){e.$set(e.servantDetailModal.model,"obj_name",t)},expression:"servantDetailModal.model.obj_name"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.thread_num,callback:function(t){e.$set(e.servantDetailModal.model,"thread_num",t)},expression:"servantDetailModal.model.thread_num"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.servant.adress"),required:""}},[t("let-input",{ref:"endpoint",attrs:{size:"small",placeholder:"tcp -h 127.0.0.1 -t 60000 -p 12000",required:"",extraTip:e.isEndpointValid?"":e.$t("serverList.servant.error")},model:{value:e.servantDetailModal.model.endpoint,callback:function(t){e.$set(e.servantDetailModal.model,"endpoint",t)},expression:"servantDetailModal.model.endpoint"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.servant.nodeName"),required:""}},[t("let-input",{ref:"node_name",attrs:{size:"small",placeholder:"127.0.0.1",required:"",disabled:!e.servantDetailModal.isNew},model:{value:e.servantDetailModal.model.node_name,callback:function(t){e.$set(e.servantDetailModal.model,"node_name",t)},expression:"servantDetailModal.model.node_name"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.max_connections,callback:function(t){e.$set(e.servantDetailModal.model,"max_connections",t)},expression:"servantDetailModal.model.max_connections"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuecap,callback:function(t){e.$set(e.servantDetailModal.model,"queuecap",t)},expression:"servantDetailModal.model.queuecap"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuetimeout,callback:function(t){e.$set(e.servantDetailModal.model,"queuetimeout",t)},expression:"servantDetailModal.model.queuetimeout"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.allowIP")}},[t("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.allow_ip,callback:function(t){e.$set(e.servantDetailModal.model,"allow_ip",t)},expression:"servantDetailModal.model.allow_ip"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[t("let-radio-group",{attrs:{size:"small",data:[{value:"tars",text:"TARS"},{value:"not_tars",text:e.$t("serverList.servant.notTARS")}]},model:{value:e.servantDetailModal.model.protocol,callback:function(t){e.$set(e.servantDetailModal.model,"protocol",t)},expression:"servantDetailModal.model.protocol"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.treatmentGroup"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.handlegroup,callback:function(t){e.$set(e.servantDetailModal.model,"handlegroup",t)},expression:"servantDetailModal.model.handlegroup"}})],1)],1):e._e()],1),t("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?t("let-form",{ref:"moreCmdForm"},[t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.logLevel")))]),t("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),e.isBatchShowCmd?e._e():t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.pushFile")))]),t("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(a){return t("let-option",{key:a.filename,attrs:{value:a.filename}},[e._v(e._s(a.filename))])})),1)],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.sendCommand")))]),t("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.serviceLink")))])],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{staticClass:"danger",attrs:{label:"undeploy_tars"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("operate.undeploy"))+" "+e._s(e.$t("common.service")))])],1)],1):e._e()],1),t("let-modal",{attrs:{width:"700px",title:e.$t("operate.templateView")},on:{close:e.closeTemplateMoadal},model:{value:e.templateMoadal.show,callback:function(t){e.$set(e.templateMoadal,"show",t)},expression:"templateMoadal.show"}},[t("div",{staticClass:"pre_con"},[e.templateMoadal.show?t("pre",[e._v("            "+e._s(e.templateMoadal.model.template)+"\n        ")]):e._e()]),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{width:"55%",footShow:!1,title:e.$t("operate.templateView")},on:{close:e.closeStatusModal},model:{value:e.serverStatusModal.show,callback:function(t){e.$set(e.serverStatusModal,"show",t)},expression:"serverStatusModal.show"}},[e.serverStatusModal.show?t("let-table",{ref:"serverStatusListLoading",attrs:{data:e.serverStatusModal.model.statusList,stripe:"","empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"20%",title:e.$t("serverList.table.th.serviceID")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s("".concat(a.row.application,".").concat(a.row.server_name)))]),t("br"),t("span",[e._v(e._s(a.row.node_name))])]}}],null,!1,3206327300)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(a){return t("div",{staticClass:"pre_con"},[t("pre",{style:e.serverStatusStyle(a.row.ret_code)},[e._v(e._s(a.row.err_msg))])])}}],null,!1,1143027368)})],1):e._e()],1),t("el-dialog",{attrs:{visible:e.dialogCommandVisible,width:"80%"},on:{"update:visible":function(t){e.dialogCommandVisible=t}}},[t("span",{domProps:{innerHTML:e._s(e.commandHTML)}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogCommandVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))])],1)])],1)}),F=[],P=a("5530"),A=a("c7eb"),J=a("1da1"),V=(a("4de4"),a("fb6a"),a("d81d"),a("d9e2"),a("7db0"),a("00b4"),a("a15b"),function(){var e=this,t=e._self._c;return t("section",{staticClass:"batch-publish",staticStyle:{display:"inline"}},[t("let-button",{attrs:{size:e.size,theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("serverList.batch.".concat(e.type))))]),t("let-modal",{attrs:{closeOnClickBackdrop:!0,width:"1000px",title:e.$t("serverList.batch.".concat(e.type))},on:{"on-confirm":e.confirm},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("let-form",[t("let-form-item",{attrs:{label:e.$t("serverList.title.serverList")}},e._l(e.checkedServers,(function(a){return t("p",[e._v(" "+e._s(a.application+"."+a.server_name+"_"+a.node_name)+" ")])})),0)],1),t("let-form",{staticClass:"elegant-form"},[t("div",{staticClass:"elegant-switch"},[t("let-switch",{attrs:{size:"large"},on:{change:e.changeElegantStatus},model:{value:e.elegantChecked,callback:function(t){e.elegantChecked=t},expression:"elegantChecked"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e.$t("serverList.batch.elegantTask")))]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e.$t("serverList.batch.commonTask")))])]),e._v("     "),e.elegantChecked?t("div",{staticClass:"elegant-num"},[t("span",{staticClass:"elegant-label"},[e._v(e._s(e.$t("serverList.batch.elegantEachNum")))]),t("let-input-number",{staticClass:"elegant-box",attrs:{max:20,min:1,step:1,size:"small"},model:{value:e.eachNum,callback:function(t){e.eachNum=t},expression:"eachNum"}})],1):e._e()],1)])],1),t("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("serverList.batch.".concat(e.type))},model:{value:e.releaseIng,callback:function(t){e.releaseIng=t},expression:"releaseIng"}},[e.releaseId&&e.releaseIng?t("tars-release-progress",{attrs:{"release-id":e.releaseId},on:{"close-fn":this.getServerList}}):e._e()],1)],1)}),W=[],H=(a("25f0"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"progressTable"},[t("let-table",{ref:"ProgressTable",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("serverList.title.serverList"),prop:"server_name",width:"30%"}}),t("let-table-column",{attrs:{title:e.$t("serverList.title.serverIp"),prop:"node_name",width:"30%"}}),t("let-table-column",{attrs:{title:e.$t("common.status")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-tag",{attrs:{theme:3==a.row.status?"success":4==a.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[a.row.status]+(2!=a.row.status&&3!=a.row.status&&4!=a.row.status?"...":""))+" ")])]}}])})],1),t("p",{ref:"progressTip"},[e._v(" "+e._s(e.$t(e.success?"serverList.title.executeSuccess":"serverList.title.execute"))+" ")])],1)}),U=[],B=(a("a9e3"),a("caad"),{props:{releaseId:{type:[Number,String],required:!0}},data:function(){return{items:[],timer:"",progressTip:"",success:!1,statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.preparing"),2:this.$t("serverList.restart.running"),3:this.$t("serverList.restart.success"),4:this.$t("serverList.restart.failed"),5:this.$t("serverList.restart.cancel"),6:this.$t("serverList.restart.pauseFlow")}}},methods:{getTarsReleaseProgress:function(e){var t=this;return Object(J["a"])(Object(A["a"])().mark((function a(){return Object(A["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/server/api/task",{task_no:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()},getProgress:function(){var e=this;return Object(J["a"])(Object(A["a"])().mark((function t(){var a,o,s;return Object(A["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getTarsReleaseProgress(e.releaseId);case 3:a=t.sent,o=a.items,a.serial,a.status,a.task_no,e.items=o,s=!0,o.forEach((function(e){return[3,4].includes(e.status)?"":s=!1})),s?(e.timer&&window.clearTimeout(e.timer),e.success=!0,e.$emit("done-fn")):e.timer=window.setTimeout(e.getProgress,1e3),t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),e.success=!0,console.error(t.t0),e.$tip.error(t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[0,14]])})))()}},created:function(){this.getProgress()},destroyed:function(){this.timer&&window.clearTimeout(this.timer),this.$emit("close-fn")}}),Y=B,K=(a("ecd7"),Object(x["a"])(Y,H,U,!1,null,"e000586c",null)),G=K.exports,Z={components:{tarsReleaseProgress:G},props:{size:String,disabled:Boolean,expandServers:{required:!1,type:Array},checkedServers:{required:!1,type:Array},type:String},data:function(){return{versionList:[],releaseId:null,show:!1,publishModal:{moduleName:"",application:"DCache",totalPatchPage:0,pageSize:5,currPage:1},releaseIng:!1,elegantChecked:!1,eachNum:0}},methods:{init:function(){this.show=!0,this.releaseId=null,this.releaseIng=!1},addTask:function(e,t,a,o){var s=this;return Object(J["a"])(Object(A["a"])().mark((function i(){var r;return Object(A["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,s.$ajax.postJSON("/server/api/add_task",{serial:e,elegant:t,eachnum:a||1,items:o});case 2:return r=i.sent,i.abrupt("return",r);case 4:case"end":return i.stop()}}),i)})))()},confirm:function(){var e=this;return Object(J["a"])(Object(A["a"])().mark((function t(){var a,o,s,i,r,l;return Object(A["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],o=e.checkedServers,o.forEach((function(t){a.push({server_id:t.id.toString(),command:e.type})})),t.prev=3,s=e.elegantChecked,i=e.eachNum,r=!1,t.next=9,e.addTask(r,s,i,a);case 9:l=t.sent,e.releaseIng=!0,e.releaseId=l,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](3),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[3,14]])})))()},getServerList:function(){this.show=!1,this.$emit("success-fn")},changeElegantStatus:function(e){this.checked=e,e&&(this.eachNum=1)}}},Q=Z,X=(a("eb07"),Object(x["a"])(Q,V,W,!1,null,null,null)),ee=X.exports,te=a("4eb5"),ae=a.n(te);o["default"].use(ae.a);var oe={id:[],server_name:"batchedit",node_name:"batchedit",server_type:"tars_cpp",enable_set:!1,set_name:"",set_area:"",set_group:"",bak_flag:!0,templates:[],template_name:"tars.default",profile:"",async_thread_num:3,base_path:"",exe_path:"",start_script_path:"",stop_script_path:"",monitor_script_path:"",enable_group:!1,ip_group_name:"",run_type:"",run_type_bool:!0,base_image_id:""},se={components:{batchOperation:ee},name:"ServerManage",data:function(){return{dialogCommandVisible:!1,commandHTML:"",isCheckedAll:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[],groupList:[],baseImageList:[],serverNotifyList:[],getServerNotifyListTimer:0,pageNum:1,pageSize:20,total:1,serverPageNum:1,serverPageSize:16,serverTotal:1,serverTypes:["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],configModal:{show:!1,model:null,batch:!1},batchEditConf:{show:!0,itemEnable:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},logLevels:["NONE","TARS","DEBUG","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},templateMoadal:{show:!1,model:null},serverStatusModal:{show:!1,model:null},failCount:0,isBatchShowCmd:!1}},props:["treeid"],computed:{showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},hasCheckedServer:function(){return 0!==this.serverList.filter((function(e){return!0===e.isChecked})).length},checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))}},methods:{changeRunType:function(){this.configModal.model.run_type_bool||0!=this.baseImageList.length||(this.configModal.model.run_type_bool=!0,this.$Notice({message:this.$t("deployService.form.containRunInfo"),type:"warning"}))},getServerList:function(e){var t=this;e||(e=this.serverPageNum||1);var a=this.$refs.serverListLoading.$loading.show();this.$ajax.getJSON("/server/api/server_list",{tree_node_id:this.treeid,page_size:this.serverPageSize,cur_page:e,is_page:!(this.serverNotifyList&&this.showOthers)}).then((function(o){a.hide(),o.rows?(o.rows.forEach((function(e){e.isChecked=!1,e.present_state_in_node="",e.is_node_ok=!0,e.query_ret_code=0,e.source=e.source||"{}",e.source=JSON.parse(e.source),e.setting_state=e.setting_state.charAt(0).toUpperCase()+e.setting_state.slice(1),e.present_state=e.present_state.charAt(0).toUpperCase()+e.present_state.slice(1)})),t.serverPageNum=e,t.serverTotal=Math.ceil(o.count/t.serverPageSize),t.serverList=o.rows):(o.forEach((function(e){e.isChecked=!1,e.present_state_in_node="",e.is_node_ok=!0,e.query_ret_code=0,e.source=e.source||"{}",e.source=JSON.parse(e.source),e.setting_state=e.setting_state.charAt(0).toUpperCase()+e.setting_state.slice(1),e.present_state=e.present_state.charAt(0).toUpperCase()+e.present_state.slice(1)})),t.serverList=o),t.updateServerState()})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("serverList.msg.fail"),t.$t("common.alert")).then((function(){t.getServerList()})).catch((function(){}))})),this.isCheckedAll=!1},updateServerState:function(){var e=this;if(0!=this.serverList.length){var t=this.serverList.map((function(e){return{application:e.application,server_name:e.server_name,node_name:e.node_name}}));this.$ajax.postJSON("/server/api/server_state",{queryState:t}).then((function(t){e.serverList.forEach((function(e){var a=t.filter((function(t){return t.application==e.application&&t.server_name==e.server_name&t.node_name==e.node_name}));e.present_state_in_node=a[0].present_state_in_node,e.is_node_ok=a[0].is_node_ok,e.query_ret_code=a[0].query_ret_code}))}))}},getServerNotifyList:function(e){var t=this;this.showOthers&&(e||(e=this.pageNum||1),this.$ajax.getJSON("/server/api/server_notify_list",{tree_node_id:this.treeid,page_size:this.pageSize,curr_page:e}).then((function(a){t.pageNum=e,t.total=Math.ceil(a.count/t.pageSize),t.serverNotifyList=a.rows})).catch((function(e){t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))})))},statusStyle:function(e){return e=e||"","restart"==e||-1!=e.indexOf("[succ]")?"color: green":"stop"==e||-1!=e.indexOf("[alarm]")||-1!=e.indexOf("error")||-1!=e.indexOf("ERROR")?"color: red":""},gotoPage:function(e){this.getServerNotifyList(e)},gotoServerPage:function(e){this.getServerList(e)},getTemplateList:function(){var e=this;this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.configModal.model?e.configModal.model.templates=t:e.configModal.model={templates:t}})).catch((function(t){e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getGroupList:function(){var e=this;this.$ajax.getJSON("/server/api/dict_idc").then((function(t){var a=[{key:" ",value:"自动"}];t.forEach((function(e){a.push({key:e.group_name,value:e.group_name+"-"+e.group_name_cn})})),e.configModal.model?e.configModal.model.groupList=a:e.configModal.model={groupList:a}})).catch((function(t){e.$tip.error("".concat(e.$t("getGroupList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getServerConfig:function(e){var t=this;return Object(J["a"])(Object(A["a"])().mark((function a(){var o,s;return Object(A["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.$loading.show(),a.next=3,t.$ajax.getJSON("/server/api/base_image_list");case 3:s=a.sent,t.baseImageList=s,t.$ajax.getJSON("/server/api/server",{id:e}).then((function(e){o.hide(),e.run_type_bool="container"!=e.run_type,t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e):(e.templates=[],t.configModal.model=e),!t.configModal.model.base_image_id&&t.baseImageList.length>0&&(t.configModal.model.base_image_id=t.baseImageList[0].id)})).catch((function(e){o.hide(),t.closeConfigModal(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}));case 6:case"end":return a.stop()}}),a)})))()},configServer:function(e){for(var t in this.configModal.show=!0,this.getTemplateList(),this.getGroupList(),this.getServerConfig(e),this.batchEditConf.itemEnable=Object(P["a"])({},oe),this.batchEditConf.itemEnable)this.batchEditConf.itemEnable[t]=!0},batchConfigServer:function(){var e=this.serverList.filter((function(e){return!0===e.isChecked})).map((function(e,t){return e.id}));if(1!=e.length)for(var t in this.configModal.show=!0,this.batchEditConf.show=!1,this.getTemplateList(),this.getGroupList(),this.configModal.model=Object(P["a"])({},oe),this.configModal.model.id=e,this.batchEditConf.itemEnable=Object(P["a"])({},oe),this.batchEditConf.itemEnable)this.batchEditConf.itemEnable[t]=!1;else this.configServer(e[0])},saveConfig:function(e){var t=this;if(this.$refs.configForm.validate()){if(!e)for(var a in this.batchEditConf.itemEnable.id=!0,this.configModal.model.enable_group&&(this.batchEditConf.itemEnable.ip_group_name=!0),this.batchEditConf.itemEnable)this.batchEditConf.itemEnable[a]||delete this.configModal.model[a];this.configModal.model.run_type_bool?this.configModal.model.run_type="":this.configModal.model.run_type="container";var o=e?"/server/api/update_server":"/server/api/batch_update_server",s=this.$Loading.show();this.$ajax.postJSON(o,Object(P["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(e){s.hide(),t.getServerList(),t.closeConfigModal(),t.$tip.success(t.$t("serverList.restart.success"))})).catch((function(e){s.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.message||e.err_msg))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.batchEditConf.show=!0,this.configModal.model=null},checkTaskStatus:function(e,t){var a=this;return new Promise((function(o,s){a.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(t){1===t.status||0===t.status?setTimeout((function(){o(a.checkTaskStatus(e))}),3e3):2===t.status?o("taskid: ".concat(t.task_no)):s(new Error("taskid: ".concat(t.task_no)))})).catch((function(i){t?s(new Error(i.err_msg||i.message||a.$t("common.networkErr"))):setTimeout((function(){o(a.checkTaskStatus(e,!0))}),3e3)}))}))},updateFlowStatus:function(e,t,a){var o=this,s=this.$Loading.show();this.$ajax.postJSON("/server/api/update_flowstatus",{server_id:e,status:t,node_list:[a]}).then((function(e){s.hide(),o.getServerList(),o.$t("common.success")})).catch((function(e){s.hide(),o.getServerList(),o.$tip.error({title:"update flow status fail.",message:e.err_msg||e.message||o.$t("common.networkErr")})}))},addTask:function(e,t,a){var o=this,s=this.$Loading.show();this.$ajax.postJSON("/server/api/add_task",{serial:!0,items:[{server_id:e,command:t}]}).then((function(e){return o.checkTaskStatus(e).then((function(e){s.hide(),o.getServerList(),o.$tip.success({title:a.success,message:e})})).catch((function(e){throw e}))})).catch((function(e){s.hide(),o.getServerList(),o.$tip.error({title:a.error,message:e.err_msg||e.message||o.$t("common.networkErr")})}))},restartServer:function(e){this.addTask(e,"restart",{success:this.$t("serverList.restart.success"),error:this.$t("serverList.restart.failed")})},stopServer:function(e){var t=this;this.$confirm(this.$t("serverList.stopService.msg.stopService"),this.$t("common.alert")).then((function(){t.addTask(e,"stop",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")})}))},undeployServer:function(e){var t=this;"active"===e.present_state?this.$tip.error("".concat(this.$t("serverList.tips.undeploy"))):this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){t.addTask(e.id,"undeploy_tars",{success:t.$t("serverList.undeploy.success"),error:t.$t("serverList.undeploy.failed")})}))},undeployServers:function(e){var t=this,a=e.filter((function(e){return"active"===e.present_state}));a.length>0?this.$tip.error("".concat(this.$t("serverList.tips.undeploy"))):this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){e.forEach((function(e){t.addTask(e.id,"undeploy_tars",{success:t.$t("serverList.undeploy.success"),error:t.$t("serverList.undeploy.failed")})}))}))},manageServant:function(e){var t=this;this.servantModal.show=!0;var a=this.$loading.show();this.$ajax.getJSON("/server/api/adapter_conf_list",{id:e.id}).then((function(o){a.hide(),t.servantModal.model=o,t.servantModal.currentServer=e})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null},configServant:function(e){if(this.servantDetailModal.model={application:this.servantModal.currentServer.application,server_name:this.servantModal.currentServer.server_name,obj_name:"",node_name:"",endpoint:"",servant:"",thread_num:"",max_connections:"200000",queuecap:"10000",queuetimeout:"60000",allow_ip:"",protocol:"not_tars",handlegroup:""},this.servantDetailModal.isNew=!0,e){var t=this.servantModal.model.find((function(t){return t.id===e}));t.obj_name=t.servant.split(".")[2],this.servantDetailModal.model=Object.assign({},this.servantDetailModal.model,t),this.servantDetailModal.isNew=!1}this.servantDetailModal.show=!0},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp|ssl$/i,o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,s=/^h\s[^\s]+/i,i=/^t\s([1-9]|[1-9]\d+)$/i,r=/^p\s\d{2,5}$/i,l=!0;if(a.test(t[0])){for(var n=0,c=1;c<t.length;c++){if(s&&s.test(t[c])){n++;var d=t[c].split(/\s/)[1];o.test(d)&&(this.servantDetailModal.model.node_name=d),s=null}if(i&&i.test(t[c])&&(n++,i=null),r&&r.test(t[c])){var m=t[c].substring(2);m<0||m>65535||n++,r=null}}l=3===n}else l=!1;return l},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;a.servant=[a.application,a.server_name,a.obj_name].join("."),this.$ajax.postJSON("/server/api/add_adapter_conf",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name,this.$ajax.postJSON("/server/api/update_adapter_conf",this.servantDetailModal.model).then((function(a){t.hide(),e.servantModal.model=e.servantModal.model.map((function(e){return e.id===a.id?a:e})),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_adapter_conf",{id:e}).then((function(o){a.hide(),t.servantModal.model=t.servantModal.model.filter((function(t){return t.id!==e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},showMoreCmd:function(e){var t=this;this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e,this.isBatchShowCmd=!1,this.$ajax.getJSON("/server/api/config_file_list",{level:5,application:e.application,server_name:e.server_name}).then((function(e){t.moreCmdModal.model&&(t.moreCmdModal.model.configs=e)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},batchShowMoreCmd:function(){var e=this,t=this.serverList.filter((function(e){return!0===e.isChecked}));this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){e.$refs.moreCmdForm&&e.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.isBatchShowCmd=!0,1===t.length&&(this.isBatchShowCmd=!1,this.moreCmdModal.currentServer=t[0],this.$ajax.getJSON("/server/api/config_file_list",{level:5,application:t[0].application,server_name:t[0].server_name}).then((function(t){e.moreCmdModal.model&&(e.moreCmdModal.model.configs=t)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))})))},sendCommand:function(e,t,a){var o=this,s=this.$Loading.show();this.$ajax.getJSON("/server/api/send_command",{server_ids:e,command:t}).then((function(e){s.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error("".concat(e[0].application,".").concat(e[0].server_name,"_").concat(e[0].node_name,":<br>").concat(t));o.commandHTML=t,o.dialogCommandVisible=!0})).catch((function(e){s.hide();var t={title:o.$t("common.error"),message:e.err_msg||e.message};a&&(t.duration=0),o.$tip.error(t)}))},invokeMoreCmd:function(){var e=this;if(this.isBatchShowCmd){var t=this.serverList.filter((function(e){return!0===e.isChecked})),a=this.moreCmdModal.model;"undeploy_tars"===a.selected?this.undeployServers(t):"setloglevel"===a.selected?t.forEach((function(t){e.sendCommand(t.id,"tars.setloglevel ".concat(a.setloglevel))})):"command"===a.selected&&this.$refs.moreCmdForm.validate()?t.forEach((function(t){e.sendCommand(t.id,a.command,!0)})):"connection"===a.selected&&t.forEach((function(t){e.sendCommand(t.id,"tars.connection",!0)}))}else{var o=this.moreCmdModal.model,s=this.moreCmdModal.currentServer;"undeploy_tars"===o.selected?this.undeployServer(s):"setloglevel"===o.selected?this.sendCommand(s.id,"tars.setloglevel ".concat(o.setloglevel)):"loadconfig"===o.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(s.id,"tars.loadconfig ".concat(o.loadconfig)):"command"===o.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(s.id,o.command,!0):"connection"===o.selected&&this.sendCommand(s.id,"tars.connection",!0)}this.closeMoreCmdModal()},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.moreCmdModal.show=!1,this.moreCmdModal.model=null,this.isBatchShowCmd=!1},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},onCopy:function(e){this.$tip.success(this.$t("common.success"))},onError:function(e){this.$tip.error(this.$t("serverList.servant.copyErr"))},showTemplateView:function(e){var t=this,a=this.$Loading.show();this.$ajax.getJSON("/server/api/view_server_merge",{application:e.application,serverName:e.server_name,nodeName:e.node_name}).then((function(e){a.hide(),t.templateMoadal.model={template:"\n".concat(e.template)},t.templateMoadal.show=!0})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},closeTemplateMoadal:function(){this.templateMoadal.show=!1,this.templateMoadal.model=null},showStatusModal:function(e){this.getServerStatusDatil(e.id)},batchshowStatusModal:function(){var e=this.checkedServers.map((function(e){return e.id}));this.getServerStatusDatil(e)},getServerStatusDatil:function(e){var t=this,a=this.$Loading.show();this.$ajax.getJSON("/server/api/send_command",{server_ids:e,command:"tars.viewstatus"}).then((function(e){a.hide(),e.forEach((function(e){e.service_id="".concat(e.application,".").concat(e.server_name,"_").concat(e.node_name),0==e.ret_code?e.err_msg="".concat(t.$t("serverList.tips.success"),"\n")+e.err_msg:e.err_msg="".concat(t.$t("serverList.tips.error"),"\n")+e.err_msg})),t.serverStatusModal.model={statusList:e},t.serverStatusModal.show=!0})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},serverStatusStyle:function(e){return-1==e?"color: red":"color : #9096A3 "},closeStatusModal:function(){this.serverStatusModal.model=null,this.serverStatusModal.show=!1},goMarket:function(e){var t;t=e.source["tars.io/CloudProduct"]?"/static/market/index.html#/market/product/".concat(e.source["tars.io/CloudInstall"].group,"/").concat(e.source["tars.io/CloudInstall"].name,"/").concat(e.source["tars.io/CloudInstall"].version):"/static/market/index.html#/market/service/".concat(e.source["tars.io/CloudInstall"].group,"/").concat(e.source["tars.io/CloudInstall"].name,"/").concat(e.source["tars.io/CloudInstall"].version),window.open(t)}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getServerList(),this.getServerNotifyList(1)},beforeRouteEnter:function(e,t,a){a(a((function(e){e.getServerNotifyList(1)})))},beforeRouteUpdate:function(e,t,a){a(a((function(e){e.getServerNotifyList(1)})))},linkDownload:function(e){window.open(e,"_blank")}},ie=se,re=(a("3578"),Object(x["a"])(ie,z,F,!1,null,null,null)),le=re.exports,ne=a("67ac"),ce=(a("2532"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_publish"},[t("div",{staticClass:"table_head"},[t("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerList()}}})])]),t("div",[e.serverList&&e.serverList.length>0?t("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.noService")}},[t("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(a){return[t("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(a){return[t("let-checkbox",{attrs:{value:a.row.id},model:{value:a.row.isChecked,callback:function(t){e.$set(a.row,"isChecked",t)},expression:"scope.row.isChecked"}})]}}],null,!1,1693185143)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.enable_set?t("p",{staticStyle:{"max-width":"200px"}},[e._v(" "+e._s(e.$t("common.set.setName"))+"："+e._s(a.row.set_name)),t("br"),e._v(" "+e._s(e.$t("common.set.setArea"))+"："+e._s(a.row.set_area)),t("br"),e._v(" "+e._s(e.$t("common.set.setGroup"))+"："+e._s(a.row.set_group)+" ")]):t("span",[e._v(e._s(e.$t("common.disable")))])]}}],null,!1,1083854891)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return["Inactive"===a.row.setting_state?t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.setting_state))]):t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.setting_state))])]}}],null,!1,1039889159)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return["0"!=a.row.query_ret_code?t("span",{staticStyle:{color:"#FF0000"}},[e._v("Inactive")]):"Active"===a.row.present_state_in_node?t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.present_state_in_node))]):t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.present_state_in_node))])]}}],null,!1,350457171)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(a.row.patch_time)))])]}}],null,!1,3144837894)}),t("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.totalPage,page:e.page},on:{change:e.changePage},slot:"pagination"}),t("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.uploadPublishModal}},[e._v(e._s(e.$t("pub.dlg.upload")))]),e._v("    "),t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){return e.openPublishModal(!1)}}},[e._v(e._s(e.$t("pub.btn.pub")))]),e._v("    "),e.serverList&&e.serverList.length>0?t("let-button",{attrs:{size:"small"},on:{click:e.gotoHistory}},[e._v(e._s(e.$t("pub.btn.history")))]):e._e(),e._v("    "),t("let-button",{attrs:{size:"small"},on:{click:e.gotoPackage}},[e._v(e._s(e.$t("managePackage.title")))])],1)],1):e._e(),t("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?t("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[t("let-form-item",{attrs:{label:e.$t("serverList.servant.appService")}},[e._v(" "+e._s(e.publishModal.model.application)+"·"+e._s(e.publishModal.model.server_name)+" ")]),t("let-form-item",{attrs:{label:e.$t("pub.dlg.ip")}},e._l(e.publishModal.model.serverList,(function(a){return t("div",{key:a.id},[e._v(" "+e._s(a.node_name)+" ")])})),0),t("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[t("let-input",{model:{value:e.publishModal.model.update_text,callback:function(t){e.$set(e.publishModal.model,"update_text",t)},expression:"publishModal.model.update_text"}})],1),e.patchRadioData.length>1?t("let-form-item",{attrs:{label:e.$t("pub.dlg.patchType")}},[t("let-radio-group",{attrs:{type:"button",size:"small",data:e.patchRadioData},on:{change:e.patchChange},model:{value:e.patchType,callback:function(t){e.patchType=t},expression:"patchType"}})],1):e._e(),e.publishModal.model.show?t("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},[t("div",[t("let-select",{staticStyle:{width:"70%"},attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.patch_id,callback:function(t){e.$set(e.publishModal.model,"patch_id",t)},expression:"publishModal.model.patch_id"}},e._l(e.publishModal.model.patchList,(function(a,o){return t("let-option",{key:a.id,attrs:{value:a.id,title:a.id+"|PubTime:"+a.publish_time+"|UploadTime:"+a.upload_time+"|"+a.upload_user+"|"+a.comment}},[t("div",[0==o?t("span",{domProps:{innerHTML:e._s(e.imgNew)}}):t("span",{domProps:{innerHTML:e._s(e.imgSpace)}},[e._v(" ")]),e.includes(e.nowVersion,a.id)?t("span",{domProps:{innerHTML:e._s(e.imgCur)}}):t("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),e._v(" "+e._s(a.id)+"| "+e._s("PubTime:"+a.publish_time)+" | "+e._s("UploadTime:"+a.upload_time)+" |"+e._s(a.upload_user)+"| "+e._s(a.comment)+" ")])])})),1),e._v("     "),t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(e._s(e.$t("pub.dlg.upload")))])],1)]):e._e(),t("let-form-item",[t("div",{staticClass:"elegant-switch"},[t("let-switch",{attrs:{size:"mini"},on:{change:e.changeElegantStatus},model:{value:e.elegantChecked,callback:function(t){e.elegantChecked=t},expression:"elegantChecked"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e.$t("pub.dlg.elegantPublish")))]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e.$t("pub.dlg.commomPublish")))])]),e._v("     "),e.elegantChecked?t("div",{staticClass:"elegant-num"},[t("span",{staticClass:"elegant-label"},[e._v(e._s(e.$t("pub.dlg.elegantEachNum")))]),t("let-input-number",{staticClass:"elegant-box",attrs:{max:20,min:1,step:1,size:"small"},model:{value:e.eachNum,callback:function(t){e.eachNum=t},expression:"eachNum"}})],1):e._e()],1)]),e._v("    "),t("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch")))]),e._v("       "),t("let-button",{attrs:{size:"small"},on:{click:e.gotoPackage}},[e._v(e._s(e.$t("managePackage.title")))])],1):e._e()],1),t("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?t("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[t("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.choose"))+" ")]),e.uploadModal.model.file?t("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[t("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),t("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),t("PublishStatus",{ref:"publishStatus"})],1),t("let-modal",{attrs:{width:"1000px",footShow:!1,title:e.$t("managePackage.title")},model:{value:e.showPackage,callback:function(t){e.showPackage=t},expression:"showPackage"}},[t("let-table",{ref:"packageTable",attrs:{data:e.packageList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c1"),prop:"id"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c2"),prop:"server"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c7"),prop:"upload_user"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c3"),prop:"upload_time"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c4"),prop:"comment"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c5"),prop:"publish_time"}}),t("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c6")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",[t("a",{staticClass:"let-table__operation",attrs:{target:"_blank",href:"/pages/server/api/download_package?id=".concat(a.row.id,"&name=").concat(a.row.tgz)}},[e._v(e._s(e.$t("operate.download")))])]),t("let-table-operation",{on:{click:function(t){return e.deletePackage(a.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),t("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.packageTotalPage,page:e.packagePage},on:{change:e.changePackagePage},slot:"pagination"}),t("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showPackage=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1)],1),t("let-modal",{attrs:{width:"1200px",footShow:!1,title:e.$t("pub.btn.history")},model:{value:e.showHistory,callback:function(t){e.showHistory=t},expression:"showHistory"}},[t("let-form",{nativeOn:{submit:function(t){return t.preventDefault(),e.getHistoryList.apply(null,arguments)}}},[t("let-form-item",{attrs:{itemWidth:"100%",label:e.$t("pub.date")}},[t("let-date-range-picker",{attrs:{start:e.startTime,end:e.endTime},on:{"update:start":function(t){e.startTime=t},"update:end":function(t){e.endTime=t}}}),t("let-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),t("let-table",{ref:"historyTable",attrs:{data:e.totalHistoryList,title:e.$t("historyList.title"),"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("historyList.table.th.c1"),prop:"create_time"}}),t("let-table-column",{attrs:{title:e.$t("serverList.servant.taskID"),prop:"task_no"}}),t("let-table-column",{attrs:{title:e.$t("historyList.table.th.c2")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.serial?e.$t("common.yes"):e.$t("common.no")))])]}}])}),t("let-table-column",{attrs:{title:e.$t("historyList.table.th.c3"),prop:"userName"}}),t("let-table-column",{attrs:{title:e.$t("serverList.dlg.title.taskStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.statusMap[a.row.status]||"-"))])]}}])}),t("let-table-column",{attrs:{title:e.$t("historyList.table.th.c4")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.viewTask(a.row.task_no)}}},[e._v(e._s(e.$t("operate.view")))]),t("let-table-operation",{on:{click:function(t){return e.deleteTask(a.row.task_no)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),t("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.historyTotalPage,page:e.historyPage},on:{change:e.changeHistoryPage},slot:"pagination"}),t("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showHistory=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1)],1),t("let-modal",{attrs:{title:e.$t("historyList.table.th.c4"),width:"1200px",footShow:!1},on:{"on-cancel":function(t){e.taskModal.show=!1}},model:{value:e.taskModal.show,callback:function(t){e.$set(e.taskModal,"show",t)},expression:"taskModal.show"}},[e.taskModal.model?t("let-table",{attrs:{data:e.taskModal.model.items}},[t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c1"),prop:"item_no"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c5"),prop:"command"}}),t("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),t("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}}),t("let-table-column",{attrs:{title:e.$t("common.status"),prop:"status_info"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c7"),prop:"execute_info"}})],1):e._e()],1)],1)}),de=[],me=(a("843c"),function(){var e=this,t=e._self._c;return t("div",[t("let-modal",{attrs:{title:e.$t("serverList.table.th.result"),width:"70%",footShow:!1},on:{"on-cancel":e.onClose,close:e.onClose},model:{value:e.finishModal.show,callback:function(t){e.$set(e.finishModal,"show",t)},expression:"finishModal.show"}},[e.finishModal.model?t("let-table",{attrs:{title:e.$t("serverList.servant.taskID")+e.finishModal.model.task_no,data:e.finishModal.model.items}},[t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"200px"}}),t("let-table-column",{attrs:{title:e.$t("common.status"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-tag",{attrs:{theme:3==a.row.status?"success":4==a.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[a.row.status]+(2!=a.row.status&&3!=a.row.status&&4!=a.row.status?a.row.desc:""))+" ")])]}}],null,!1,1412257332)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"execute_info"}})],1):e._e()],1)],1)}),ue=[],pe={name:"PublishStatus",data:function(){return{closeCallback:null,timerId:null,finishModal:{show:!1,model:{task_no:"",items:[]}},statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.preparing"),2:this.$t("serverList.restart.running"),3:this.$t("serverList.restart.success"),4:this.$t("serverList.restart.failed"),5:this.$t("serverList.restart.cancel"),6:this.$t("serverList.restart.pauseFlow")},statusMap:{0:"EM_T_NOT_START",1:"EM_T_PREPARE",2:"EM_T_RUNNING",3:"EM_T_SUCCESS",4:"EM_T_FAILED",5:"EM_T_CANCEL",6:"EM_T_PARIAL"},endStatus:[3,4]}},methods:{onClose:function(){this.closeCallback&&this.closeCallback(),clearTimeout(this.timerId)},savePublishServer:function(e,t,a,o){var s=this;a=a||"",o=o||e.model.patch_id.toString(),this.closeCallback=t;var i=[],r=e.elegant||!1;e.model.serverList.forEach((function(t){i.push({server_id:t.id.toString(),command:e.command||"patch_tars",parameters:{patch_id:o,bak_flag:t.bak_flag||!1,update_text:e.model.update_text||"",group_name:a,run_type:t.run_type||""}})}));var l=this.$Loading.show();this.$ajax.postJSON("/server/api/add_task",{serial:!r,elegant:r,eachnum:e.eachnum||1,items:i}).then((function(e){l.hide(),s.finishModal.model.task_no=e,s.finishModal.show=!0,s.getTaskRepeat(e)})).catch((function(e){l.hide(),s.$tip.error("".concat(s.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getTaskRepeat:function(e){var t=this;this.timerId&&clearTimeout(this.timerId);var a=function a(){t.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){var o=!0;e.items.forEach((function(e){t.endStatus.includes(e.status)||(o=!1),e.percent?e.desc="("+e.percent+"%)":e.desc="..."})),o?clearTimeout(t.timerId):t.timerId=setTimeout(a,2e3),t.finishModal.model.items=e.items})).catch((function(e){clearTimeout(t.timerId),t.timerId=null,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))};a()}}},he=pe,fe=Object(x["a"])(he,me,ue,!1,null,null,null),_e=fe.exports,ve={name:"ServerPublish",components:{PublishStatus:_e},data:function(){return{imgNew:'<img class="logo" src="/static/img/new.gif">',imgCur:'<img class="logo" src="/static/img/current.gif">',imgSpace:'<img class="logo" src="/static/img/space.png">',nowVersion:[],activeKey:"",treeData:[],totalServerList:[],serverList:[],isCheckedAll:!0,totalPage:0,pageSize:20,page:1,showPackage:!1,packageList:[],packageTotalPage:0,packagePage:1,packagePageSize:20,publishModal:{show:!1,model:null,elegant:!1,eachnum:1},statusMap:{0:"EM_T_NOT_START",1:"EM_T_PREPARE",2:"EM_T_RUNNING",3:"EM_T_SUCCESS",4:"EM_T_FAILED",5:"EM_T_CANCEL",6:"EM_T_PARIAL"},showHistory:!1,startTime:"",endTime:"",totalHistoryList:[],historyList:[],historyTotalPage:0,historyPage:1,historyPageSize:20,taskModal:{show:!1,modal:!0},uploadModal:{show:!1,model:null},patchType:"patch",patchRadioData:[{value:"patch",text:this.$t("pub.dlg.upload")}],pkgUpload:{show:!1,model:null},elegantChecked:!1,eachNum:0}},props:["treeid"],methods:{getServerList:function(){var e=this,t=this.$Loading.show();this.$ajax.getJSON("/server/api/server_list",{tree_node_id:this.treeid}).then((function(a){t.hide();var o=a||[];o.forEach((function(t){t.isChecked=e.isCheckedAll,t.present_state_in_node="",t.query_ret_code=0,t.setting_state=t.setting_state.charAt(0).toUpperCase()+t.setting_state.slice(1)})),e.totalServerList=o,e.totalPage=Math.ceil(e.totalServerList.length/e.pageSize),e.page=1,e.updateServerList(),e.updateServerState()})).catch((function(a){t.hide(),e.$confirm(a.err_msg||a.message||e.$t("serverList.table.msg.fail")).then((function(){e.getServerList()}))}))},updateServerState:function(){var e=this;if(0!=this.serverList.length){var t=this.serverList.map((function(e){return{application:e.application,server_name:e.server_name,node_name:e.node_name}}));this.$ajax.postJSON("/server/api/server_state",{queryState:t}).then((function(t){e.serverList.forEach((function(e){var a=t.filter((function(t){return t.application==e.application&&t.server_name==e.server_name&t.node_name==e.node_name}));e.present_state_in_node=a[0].present_state_in_node,e.query_ret_code=a[0].query_ret_code}))}))}},changePage:function(e){this.page=e},changeElegantStatus:function(e){this.checked=e,e&&(this.eachNum=1)},uploadPublishModal:function(){this.openPublishModal(!0)},openPublishModal:function(e){var t=this,a=this.serverList.filter((function(e){return e.isChecked}));if(a.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var o=a[0];this.publishModal.model={application:o.application,server_name:o.server_name,serverList:a,patchList:[],patch_id:"",update_text:"",show:!0},this.getNewVersionList(o).then((function(e){0!=e.length&&e.forEach((function(e){t.nowVersion.push(e.patch_version)}))})),this.getPatchList(o.application,o.server_name,1,50).then((function(a){t.publishModal.model.patchList=a.rows,t.publishModal.show=!0,e&&t.showUploadModal()}))}},getPatchList:function(e,t,a,o){var s=this;return this.$ajax.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:o}).catch((function(e){s.$tip.error("".concat(s.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getNewVersionList:function(e){var t=this;return this.$ajax.getJSON("/server/api/server_now_version",{application:e.application,serverName:e.server_name,enableSet:e.enable_set,setName:e.set_name,setArea:e.set_area,setGroup:e.set_group,nodeName:e.node_name}).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},closePublishModal:function(){this.publishModal.show=!1,this.nowVersion=[],this.publishModal.modal=null,this.patchType="patch",this.$refs.publishForm.resetValid()},savePublishServer:function(e,t){this.$refs.publishForm.validate()&&(this.publishModal.elegant=this.elegantChecked,this.publishModal.eachnum=this.eachNum,this.publishModal.command=t?"grace_patch_tars":"patch_tars",this.$refs.publishStatus.savePublishServer(this.publishModal,this.closePublishModal))},closeFinishModal:function(){this.$refs.finishForm.resetValid()},updateServerList:function(){var e=(this.page-1)*this.pageSize,t=this.page*this.pageSize;this.serverList=this.totalServerList.slice(e,t)},gotoPackage:function(){this.showPackage=!0,this.getPackageList(1)},getPackageList:function(e){var t=this;if("number"!=typeof e&&(e=1),!(this.serverList.length<=0)){var a=this.$Loading.show(),o=this.serverList[0];this.getPatchList(o.application,o.server_name,e,this.packagePageSize).then((function(o){a.hide(),t.packageList=o.rows,t.packagePage=e,t.packageTotalPage=Math.ceil(o.count/t.packagePageSize)})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))})),this.getPatchList(o.application,o.server_name,1,50).then((function(e){t.publishModal.model.patchList=e.rows}))}},changePackagePage:function(e){this.getPackageList(e)},downloadPackage:function(e){var t="/pages/server/api/download_package?id=".concat(e.id,"&name=").concat(e.tgz);window.open(t,!0)},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$ajax.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPackageList(t.packagePage)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},gotoHistory:function(){this.showHistory=!0,this.getHistoryList(1)},getHistoryList:function(e){var t=this;"number"!=typeof e&&(e=1);var a=this.$Loading.show(),o={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",from:this.startTime,to:this.endTime,page_size:this.historyPageSize,curr_page:e};this.historyPage=e,this.$ajax.getJSON("/server/api/task_list",o).then((function(e){a.hide(),t.totalHistoryList=e.rows||[],t.historyTotalPage=Math.ceil(e.count/t.historyPageSize)})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewTask:function(e){var t=this;this.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){t.taskModal.model=e,t.taskModal.show=!0}))},deleteTask:function(e){var t=this;this.$confirm(this.$t("historyList.delete")).then((function(){t.$ajax.getJSON("/server/api/del_task",{task_no:e}).then((function(e){t.getHistoryList(t.page)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},changeHistoryPage:function(e){this.getHistoryList(e)},showUploadModal:function(){this.serverList.length<=0&&this.$tip.warning(this.$t("pub.dlg.a")),this.uploadModal.model={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",file:null,comment:""},this.uploadModal.show=!0},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},uploadFile:function(e){var t=this.treeid,a=(t&&t.split(".")[0]&&t.split(".")[0].slice(1),t.split(".")),o=t&&a[a.length-1]&&a[a.length-1].slice(1),s=e.name&&e.name.split(".")&&e.name.split(".")[0];if(-1==s.toLowerCase().indexOf(o.toLowerCase()))return this.$tip.error("".concat(this.$t("releasePackage.uploadPackageTips")));this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.server_name),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),a.append("task_id",(new Date).getTime()),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){e.getPatchList(e.uploadModal.model.application,e.uploadModal.model.server_name,1,50).then((function(a){t.hide(),e.publishModal.model.patchList=a.rows,e.closeUploadModal()}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},patchChange:function(){"patch"==this.patchType?this.publishModal.model.show=!0:this.publishModal.model.show=!1},includes:function(e,t){return!!e.includes(String(t))},formatString:function(e,t){return null!=e&&e.length<t?e.padEnd(t-e.length):e.substring(0,t)}},mounted:function(){this.getServerList()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},page:function(){this.updateServerList()}}},ge=ve,be=(a("3db7"),Object(x["a"])(ge,ce,de,!1,null,null,null)),$e=be.exports,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_config"},[t("div",{staticStyle:{"margin-bottom":"5px"}},[t("h4",[e._v(" "+e._s(e.$t("cfg.title.a"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getConfigList(e.serverData)}}}),t("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cfg.btn.add")))])],1)]),t("wrapper",{ref:"configListLoading"},[t("let-table",{attrs:{data:e.configList,"empty-text":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:a.row.id},model:{value:e.checkedConfigId,callback:function(t){e.checkedConfigId=t},expression:"checkedConfigId"}},[t("span",[e._v(" ")])])]}}])}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.lastUser"),prop:"lastuser"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.changeConfig(a.row,"configList")}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.deleteConfig(a.row.id)}}},[e._v(e._s(e.$t("operate.delete")))]),t("let-table-operation",{on:{click:function(t){return e.showDetail(a.row)}}},[e._v(e._s(e.$t("cfg.title.viewConf")))]),t("let-table-operation",{on:{click:function(t){return e.showHistory(a.row.id)}}},[e._v(e._s(e.$t("pub.btn.history")))])]}}])})],1)],1),e.refFileList&&e.showOthers?t("div",{staticStyle:{"margin-bottom":"5px"}},[t("h4",[e._v(" "+e._s(e.$t("cfg.title.b"))+" "),t("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.openRefFileModal}},[e._v(e._s(e.$t("cfg.btn.addRef")))])],1)]):e._e(),e.refFileList&&e.showOthers?t("wrapper",{ref:"refFileListLoading"},[t("let-table",{attrs:{data:e.refFileList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.deleteRef(a.row.id)}}},[e._v(e._s(e.$t("operate.delete")))]),t("let-table-operation",{on:{click:function(t){return e.showDetail(a.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3391403769)})],1)],1):e._e(),e.nodeConfigList&&e.showOthers?t("div",{staticStyle:{"margin-bottom":"5px"}},[t("h4",[e._v(" "+e._s(e.$t("cfg.title.c"))+" "),t("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.pushNodeConfig}},[e._v(e._s(e.$t("cfg.btn.pushFile")))])],1)]):e._e(),e.nodeConfigList&&e.showOthers?t("wrapper",{ref:"nodeConfigListLoading"},[e.nodeConfigList.length?t("let-checkbox",{staticClass:"check-all",model:{value:e.nodeCheckAll,callback:function(t){e.nodeCheckAll=t},expression:"nodeCheckAll"}}):e._e(),t("let-table",{attrs:{data:e.nodeConfigList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-checkbox",{attrs:{label:a.row.id},model:{value:e.nodeCheckList,callback:function(t){e.nodeCheckList=t},expression:"nodeCheckList"}})]}}],null,!1,3731714217)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"400px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.changeConfig(a.row,"nodeConfigList")}}},[e._v(e._s(e.$t("cfg.table.modCfg")))]),t("let-table-operation",{on:{click:function(t){return e.showMergedDetail(a.row.id)}}},[e._v(e._s(e.$t("cfg.table.viewMerge")))]),t("let-table-operation",{on:{click:function(t){return e.showDetail(a.row)}}},[e._v(e._s(e.$t("cfg.table.viewIpContent")))]),t("let-table-operation",{on:{click:function(t){return e.showHistory(a.row.id)}}},[e._v(e._s(e.$t("pub.btn.history")))]),t("let-table-operation",{on:{click:function(t){return e.handleRefFiles(a.row.id)}}},[e._v(e._s(e.$t("cfg.table.mangeRefFile")))])]}}],null,!1,2593104344)})],1)],1):e._e(),t("let-modal",{attrs:{title:e.configModal.isNew?"".concat(e.$t("operate.title.add")," ").concat(e.$t("common.config")):"".concat(e.$t("operate.title.update")," ").concat(e.$t("common.config")),width:"80%"},on:{"on-confirm":e.configDiff,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?t("let-form",{ref:"configForm",attrs:{itemWidth:"100%"}},[t("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[t("let-input",{attrs:{size:"small",disabled:!e.configModal.isNew,required:""},model:{value:e.configModal.model.filename,callback:function(t){e.$set(e.configModal.model,"filename",t)},expression:"configModal.model.filename"}})],1),e.configModal.isNew?e._e():t("let-form-item",{attrs:{label:e.$t("cfg.btn.reason"),required:""}},[t("let-input",{attrs:{size:"small",required:""},model:{value:e.configModal.model.reason,callback:function(t){e.$set(e.configModal.model,"reason",t)},expression:"configModal.model.reason"}})],1),t("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[t("let-input",{attrs:{size:"large",type:"textarea",rows:20,required:""},model:{value:e.configContent,callback:function(t){e.configContent=t},expression:"configContent"}})],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.$t("filter.title.diffTxt"),width:"1200px"},on:{"on-confirm":e.updateConfigDiff,close:e.closeConfigDiffModal,"on-cancel":e.closeConfigDiffModal},model:{value:e.configDiffModal.show,callback:function(t){e.$set(e.configDiffModal,"show",t)},expression:"configDiffModal.show"}},[e.configDiffModal.model?t("div",{staticStyle:{"padding-top":"30px"}},[t("div",{staticClass:"codediff_head"},[t("div",{staticClass:"codediff_th"},[e._v("旧内容:")]),t("div",{staticClass:"codediff_th"},[e._v("新内容:")])]),t("diff",{attrs:{"old-string":e.configDiffModal.model.oldData,"new-string":e.configDiffModal.model.newData,context:10,"output-format":"side-by-side"}})],1):e._e()]),t("let-modal",{attrs:{title:e.detailModal.title,width:"80%",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model&&e.detailModal.model.table?t("let-table",{staticClass:"history-table",attrs:{data:e.detailModal.model.table,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("common.time"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.reason"),prop:"reason"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.content"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.showTableDeatil(a.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3817607729)})],1):e._e(),t("div",{staticClass:"pre_con"},[e.detailModal.model&&!e.detailModal.model.table||e.detailModal.model&&e.detailModal.model.table&&e.detailModal.model.detail?t("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e()]),t("div",{ref:"detailModalLoading",staticClass:"detail-loading"})],1),e.refFileModal.model?t("let-modal",{attrs:{title:this.$t("operate.title.add"),width:"80%"},on:{"on-confirm":e.addRefFile,close:e.closeRefFileModal},model:{value:e.refFileModal.show,callback:function(t){e.$set(e.refFileModal,"show",t)},expression:"refFileModal.show"}},[t("let-form",{ref:"refForm",attrs:{itemWidth:"100%"}},[t("let-form-item",{attrs:{label:e.$t("cfg.msg.refFile"),required:""}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:""},model:{value:e.refFileModal.model.filename,callback:function(t){e.$set(e.refFileModal.model,"filename",t)},expression:"refFileModal.model.filename"}},e._l(e.refFileModal.model.fileList,(function(a){return t("let-option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.filename))])})),1)],1)],1)],1):e._e(),t("let-modal",{attrs:{title:e.$t("cfg.table.mangeRefFile"),width:"700",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.nodeRefFileListModal.show,callback:function(t){e.$set(e.nodeRefFileListModal,"show",t)},expression:"nodeRefFileListModal.show"}},[e.nodeRefFileListModal.model?t("wrapper",[t("let-button",{staticClass:"add-btn",attrs:{size:"small",theme:"primary"},on:{click:e.openNodeRefFileModal}},[e._v(e._s(e.$t("cfg.btn.addRef")))]),t("let-table",{attrs:{data:e.nodeRefFileListModal.model.refFileList,title:e.$t("cfg.title.b"),"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.deleteRef(a.row.id,"nodeRef",a.row.config_id)}}},[e._v(e._s(e.$t("operate.delete")))]),t("let-table-operation",{on:{click:function(t){return e.showDetail(a.row)}}},[e._v(e._s(e.$t("operate.view")))]),t("let-table-operation",{on:{click:function(t){return e.showHistory(a.row.config_id)}}},[e._v(e._s(e.$t("pub.btn.history")))])]}}],null,!1,1797373192)})],1)],1):e._e()],1),t("let-modal",{attrs:{width:"700px",footShow:!1},on:{close:e.closePushResultModal},model:{value:e.pushResultModal.show,callback:function(t){e.$set(e.pushResultModal,"show",t)},expression:"pushResultModal.show"}},[e.pushResultModal.model?t("let-table",{attrs:{data:e.pushResultModal.model,title:e.$t("serverList.table.th.result"),"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:0!==a.row.ret_code?"danger":"success"},[e._v(e._s(a.row.server_name))])]}}],null,!1,1546843640)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"result",class:0!==a.row.ret_code?"danger":"success"},[e._v(e._s(a.row.err_msg))])]}}],null,!1,3216099087)})],1):e._e()],1)],1)},ye=[],Me=(a("8a79"),a("dcab")),ke=a("e68e"),Se={name:"ServerConfig",components:{wrapper:Me["a"],diff:ke["a"]},data:function(){return{oldStr:"old code",newStr:"new code",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},checkedConfigId:"",configList:[],refFileList:[],nodeConfigList:null,nodeCheckList:[],configContent:"",configModal:{show:!1,isNew:!0,model:null},configDiffModal:{type:"",show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},refFileModal:{show:!1,model:{fileList:[]}},nodeRefFileListModal:{show:!1,model:null},pushResultModal:{show:!1,model:null}}},computed:{showOthers:function(){return 5===this.serverData.level},nodeCheckAll:{get:function(){return!(!this.nodeConfigList||!this.nodeConfigList.length)&&this.nodeCheckList.length===this.nodeConfigList.length},set:function(e){this.nodeCheckList=e?this.nodeConfigList.map((function(e){return e.id})):[]}}},watch:{checkedConfigId:function(){var e=this;this.$nextTick((function(){e.getRefFileList(),e.getNodeConfigList()}))}},methods:{getConfigList:function(e){var t=this,a=this.$Loading.show();console.log(e),this.$ajax.getJSON("/server/api/config_file_list",e).then((function(e){a.hide(),t.configList=e,t.refFileList=[],t.nodeConfigList=[],e[0]&&e[0].id&&(t.checkedConfigId=e[0].id,t.getRefFileList(),t.getNodeConfigList())})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("common.error"),t.$t("common.retry"),t.$t("common.alert")).then((function(){t.getConfigList()}))}))},addConfig:function(){this.configModal.model={filename:this.serverData.server_name+".conf",config:""},""==this.serverData.server_name&&(this.configModal.model.filename=this.serverData.application+".conf"),this.configModal.isNew=!0,this.configModal.show=!0},changeConfig:function(e,t){this.configModal.model=Object.assign({reason:""},e),this.configContent=e.config,this.configModal.target=t,this.configModal.isNew=!1,this.configModal.show=!0},updateConfigFile:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.configModal.model.filename=this.configModal.model.filename.replace(/(^\s*)|(\s*$)/g,"");var a=this.configModal.model;if(this.configModal.isNew){var o=Object.assign({application:this.serverData.application,level:this.serverData.level,server_name:this.serverData.server_name,set_name:this.serverData.set_name,set_area:this.serverData.set_area,set_group:this.serverData.set_group},a);this.$ajax.postJSON("/server/api/add_config_file",o).then((function(a){t.hide(),e.configList.unshift(a),1===e.configList.length&&(e.checkedConfigId=a.id),e.$tip.success(e.$t("common.success")),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.$ajax.postJSON("/server/api/update_config_file",{config:a.config,id:a.id,reason:a.reason}).then((function(a){t.hide(),e[e.configModal.target]=e[e.configModal.target].map((function(e){return e.id===a.id?a:e})),e.checkedConfigId===a.id&&(e.getRefFileList(),e.getNodeConfigList()),e.$tip.success(e.$t("common.success")),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1},deleteConfig:function(e){var t=this;this.$confirm(this.$t("cfg.msg.confirmCfg"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_config_file",{id:e}).then((function(e){a.hide(),t.getConfigList(t.serverData),t.getNodeConfigList(),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},getUnusedFileList:function(e){var t=this;this.showOthers&&this.$ajax.getJSON("/server/api/unused_config_file_list",{config_id:e,application:this.serverData.application}).then((function(e){t.refFileModal.model.fileList=e})).catch((function(e){t.refFileModal.model.fileList=[],t.$tip.error({title:t.$t("common.error"),message:e.err_msg||e.message||t.$t("common.networkErr")})}))},getRefFileList:function(){var e=this;this.showOthers&&this.$ajax.getJSON("/server/api/config_ref_list",{config_id:this.checkedConfigId}).then((function(t){t.map((function(e){var t=e.id;return e=Object.assign(e,e.reference),e.refrence_id=e.id,e.id=t,e})),e.refFileList=t})).catch((function(t){e.refFileList=[],e.$tip.error({title:e.$t("common.error"),message:t.err_msg||t.message||e.$t("common.networkErr")})}))},openRefFileModal:function(){this.refFileModal.show=!0,this.refFileModal.isNodeRef=!1,this.getUnusedFileList(this.checkedConfigId)},openNodeRefFileModal:function(){this.refFileModal.show=!0,this.refFileModal.isNodeRef=!0,this.getUnusedFileList(this.refFileModal.id)},addRefFile:function(){var e=this;if(this.$refs.refForm.validate()){var t=this.$Loading.show();this.$ajax.getJSON("/server/api/add_config_ref",{config_id:this.refFileModal.isNodeRef?this.refFileModal.id:this.checkedConfigId,reference_id:this.refFileModal.model.filename}).then((function(a){t.hide(),e.refFileModal.show=!1,e.refFileModal.isNodeRef?e.getNodeRefFileList(e.refFileModal.id):e.getRefFileList()})).catch((function(a){t.hide(),e.$tip.error({title:e.$t("common.error"),message:a.err_msg||a.message||e.$t("common.networkErr")})}))}},closeRefFileModal:function(){this.refFileModal.show=!1},deleteRef:function(e,t,a){var o=this;this.$confirm(this.$t("cfg.msg.confirm"),this.$t("common.alert")).then((function(){var s=o.$Loading.show();o.$ajax.getJSON("/server/api/delete_config_ref",{id:e}).then((function(e){s.hide(),"nodeRef"==t?o.getNodeRefFileList(a):o.getRefFileList(),o.$tip.success(o.$t("common.success"))})).catch((function(e){s.hide(),o.$tip.error({title:o.$t("common.error"),message:e.err_msg||e.message||o.$t("common.networkErr")})}))}))},getNodeConfigList:function(){var e=this;if(this.showOthers){var t=Object.assign({config_id:this.checkedConfigId},this.serverData);this.$ajax.getJSON("/server/api/node_config_file_list",t).then((function(t){e.nodeConfigList=t})).catch((function(t){e.nodeConfigList=[],e.$tip.error({title:e.$t("common.error"),message:t.err_msg||t.message||e.$t("common.networkErr")})}))}},pushNodeConfig:function(){var e=this;if(this.nodeCheckList.length){var t=this.$Loading.show();this.$ajax.getJSON("/server/api/push_config_file",{ids:this.nodeCheckList.join(";")}).then((function(a){t.hide(),e.pushResultModal.model=a,e.pushResultModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.$tip.warning(this.$t("cfg.msg.selectNode"))},closePushResultModal:function(){this.pushResultModal.model=null,this.pushResultModal.show=!1},showDetail:function(e){this.detailModal.title=this.$t("cfg.title.viewConf"),this.detailModal.model={detail:e.config},this.detailModal.show=!0},showMergedDetail:function(e){var t=this;this.detailModal.title=this.$t("cfg.title.viewMerged"),this.detailModal.show=!0;var a=this.$loading.show();this.$ajax.getJSON("/server/api/merged_node_config",{id:e}).then((function(e){a.hide(),t.detailModal.model={detail:e}})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showHistory:function(e){var t=this;this.detailModal.title=this.$t("cfg.title.viewHistory"),this.detailModal.show=!0;var a=this.$loading.show();this.$ajax.getJSON("/server/api/config_file_history_list",{config_id:e}).then((function(e){a.hide(),t.detailModal.model={table:e.rows,detail:""}})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showTableDeatil:function(e){this.detailModal.model.detail=e.content},closeDetailModal:function(){this.detailModal.show=!1,this.detailModal.model=null},getNodeRefFileList:function(e){var t=this;this.$ajax.getJSON("/server/api/config_ref_list",{config_id:e}).then((function(e){e.map((function(e){var t=e.id;return e=Object.assign(e,e.reference),e.refrence_id=e.id,e.id=t,e})),t.nodeRefFileListModal.model={refFileList:e}})).catch((function(e){t.nodeRefFileListModal.model={refFileList:[]},t.$tip.error({title:t.$t("common.error"),message:e.err_msg||e.message||t.$t("common.networkErr")})}))},handleRefFiles:function(e){this.nodeRefFileListModal.show=!0,this.nodeRefFileListModal.model=null,this.refFileModal.id=e,this.getNodeRefFileList(e)},configDiff:function(){this.$refs.configForm.validate()&&(this.configDiffModal.type="config",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.configModal.model.config,newData:this.configContent})},updateConfigDiff:function(){var e=this.configDiffModal.type,t=this.configModal.model;if(t.filename.toLowerCase().endsWith(".json"))try{JSON.parse(this.configContent)}catch(r){return void alert("config format error:"+r.toString())}if(t.filename.toLowerCase().endsWith(".xml"))try{var a=new DOMParser,o=a.parseFromString(this.configContent,"text/xml"),s=o.getElementsByTagName("parsererror"),i="";if(s.length>0)return i="parsererror"==o.documentElement.nodeName?o.documentElement.childNodes[0].nodeValue:o.getElementsByTagName("parsererror")[0].innerHTML,void alert("config format error:"+i)}catch(r){return void alert("config format error:"+r.toString())}"config"===e&&(this.configModal.model.config=this.configContent,this.updateConfigFile())},closeConfigDiffModal:function(){this.configDiffModal.show=!1},nodeConfigDiff:function(){this.$refs.nodeConfigForm.validate()&&(this.configDiffModal.type="nodeConfig",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.nodeConfigModal.model.config,newData:this.nodeConfigContent})}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getConfigList(this.serverData)}},Le=Se,xe=(a("0523"),Object(x["a"])(Le,we,ye,!1,null,null,null)),Ce=xe.exports,Ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_history"},[e.serverListShow?t("div",{staticClass:"table_wrap"},[t("div",{staticClass:"table_head"},[t("h4",[e._v(e._s(this.$t("serverList.title.serverList")))])]),t("let-table",{ref:"serverListLoading",staticClass:"dcache",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata"),stripe:""}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"application"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app="+[a.row.application]+"&server_name="+[a.row.server_name]+"&node_name="+[a.row.node_name],title:e.$t("serverList.link.remoteLog"),target:"_blank"}},[e._v(" "+e._s(a.row.server_name)+" ")])]}}],null,!1,2262472970)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.is_node_ok?t("span",[t("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app="+[a.row.application]+"&server_name="+[a.row.server_name]+"&node_name="+[a.row.node_name],title:e.$t("serverList.link.nodeLog"),target:"_blank"}},[e._v(" "+e._s(a.row.node_name)+" ")])]):t("span",{staticStyle:{color:"#FF0000"}},[e._v(" "+e._s(a.row.node_name)+e._s(e.$t("serverList.link.invalidNode"))+" ")])]}}],null,!1,2244706928)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return["Inactive"===a.row.setting_state?t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.setting_state))]):t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.setting_state))])]}}],null,!1,4280848039)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return["0"!=a.row.query_ret_code?t("span",{staticStyle:{color:"#FF0000"}},[e._v("Inactive")]):"Active"===a.row.present_state_in_node?t("span",{staticStyle:{color:"#49CC8F"}},[e._v(e._s(a.row.present_state_in_node))]):t("span",{staticStyle:{color:"#FF0000"}},[e._v(e._s(a.row.present_state_in_node))])]}}],null,!1,2058566643)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID"),prop:"process_id"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(a.row.patch_time)))])]}}],null,!1,3144837894)}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"300px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.historyLink(a.row.id)}}},[e._v(e._s(e.$t("operate.goto")))])]}}],null,!1,1230847586)})],1),t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.goback}},[e._v(e._s(e.$t("operate.goback")))]),t("let-pagination",{attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}})],1):t("div",{staticClass:"history_search"},[t("label",{staticClass:"history_search_box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.historySearchKey,expression:"historySearchKey"}],staticClass:"history_search_key",attrs:{type:"text",placeholder:e.$t("home.searchKey")},domProps:{value:e.historySearchKey},on:{blur:e.historySearch,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.historySearch.apply(null,arguments)},input:function(t){t.target.composing||(e.historySearchKey=t.target.value)}}})]),t("div",{staticClass:"history_list_wrap"},[t("div",{staticClass:"history_list_title"},[e._v(e._s(e.$t("home.visited"))+"：")]),t("ul",{staticClass:"history_list"},e._l(e.historySearchList,(function(a){return t("li",{key:a,staticClass:"history_item"},[t("a",{staticClass:"history_link",attrs:{href:"javascript:;"},on:{click:function(t){return e.historySearchLink(a)}}},[e._v(e._s(a))])])})),0)])])])},Ee=[],De={name:"ServerHistory",data:function(){return{historySearchKey:"",historySearchList:[],serverList:[],serverListShow:!1,pageNum:1,pageSize:16,total:1}},mounted:function(){this.updateHistorySearchKey()},methods:{gotoPage:function(e){this.historySearch(e)},historySearch:function(e){var t=this;e&&"number"==typeof e||(e=this.pageNum||1);var a=this.historySearchKey;a&&(this.updateHistorySearchKey(),this.$ajax.getJSON("/server/api/server_search",{searchkey:a,page_size:this.pageSize,curr_page:e}).then((function(a){t.pageNum=e,t.total=Math.ceil(a.count/t.pageSize),a.rows.forEach((function(e){e.present_state_in_node="",e.is_node_ok=!0,e.query_ret_code=0,e.setting_state=e.setting_state.charAt(0).toUpperCase()+e.setting_state.slice(1)})),t.serverList=a.rows,t.updateServerState(),t.serverListShow=!0})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))})))},updateServerState:function(){var e=this;if(0!=this.serverList.length){var t=this.serverList.map((function(e){return{application:e.application,server_name:e.server_name,node_name:e.node_name}}));this.$ajax.postJSON("/server/api/server_state",{queryState:t}).then((function(t){e.serverList.forEach((function(e){var a=t.filter((function(t){return t.application==e.application&&t.server_name==e.server_name&t.node_name==e.node_name}));e.present_state_in_node=a[0].present_state_in_node,e.is_node_ok=a[0].is_node_ok,e.query_ret_code=a[0].query_ret_code}))}))}},historySearchLink:function(e){this.historySearchKey=e,this.historySearch()},historyLink:function(e){var t=this;this.$nextTick((function(){t.$parent.selectTree(e),t.$parent.getTreeData()}))},goback:function(){this.serverListShow=!1,this.historySearchKey=""},updateHistorySearchKey:function(){var e=this.historySearchKey,t=this.getLocalStorage("tars_history_key")||[];if(e){if(t&&t.length>0){var a=-1;t.forEach((function(t,o){t===e&&(a=o)})),-1!==a&&t.splice(a,1),t.unshift(e)}else t=[e];this.historySearchList=t.slice(0,20),this.setLocalStorage("tars_history_key",JSON.stringify(t))}else this.historySearchList=t},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}}},Ie=De,Te=(a("10a2"),Object(x["a"])(Ie,Ne,Ee,!1,null,null,null)),Oe=Te.exports,qe=a("c9e9"),je=a("4527"),Re=a("3430"),ze=a("f298"),Fe={name:"Server",components:{callChain:ne["a"],manage:le,publish:$e,config:Ce,"server-monitor":qe["a"],"property-monitor":je["a"],"user-manage":Re["a"],serverHistory:Oe,plugins:ze["a"]},data:function(){return{treeErrMsg:"load failed",treeData:null,treeSearchKey:"",treeid:"home",isIconPlay:!1,plugins:[],serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},homeTab:"home",BTabs:[]}},computed:{base:function(){return"/server/".concat(this.treeid)}},watch:{treeid:function(){this.serverData=this.getServerData(),this.$store.commit({type:"increment",name:this.serverData})},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},directives:{vscroll:{componentUpdated:function(e){var t=e||"",a=e.children||[],o="";for(var s in a){var i=a[s],r=i.attributes["class"];if(r&&r.value.indexOf("active")>-1){o=i;break}}if(o.offsetLeft<t.scrollLeft){var l=o.offsetLeft;t.scrollTo(l,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var n=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(n,0)}}}},methods:{getNewServerName:function(e){var t=e&&e.split(".");if(!t)return e;if(1==t.length){var a=e&&e.split(".")[0].substring(1);return"".concat(a)}if(t.length>1){var o=e&&e.split(".")[0].substring(1),s=e&&e.split(".")[e.split(".").length-1].substring(1);return"".concat(o,".").concat(s)}},getName:function(e){var t="";return e.lastIndexOf("/")>-1&&(t=e.substring(e.lastIndexOf("/")+1,e.length)),t},getPlugins:function(){var e=this;this.$ajax.getJSON("/plugin/api/list",{k8s:!1,type:2}).then((function(t){e.plugins=t,e.plugins.forEach((function(t){"en"==e.$cookie.get("locale")&&(t.f_name=t.f_name_en)}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},iconLoading:function(){var e=this;e.isIconPlay||(e.isIconPlay=!0,setTimeout((function(){e.isIconPlay=!1}),1e3))},treeSearch:function(e){this.iconLoading(),this.getTreeData(this.treeSearchKey,e)},selectTree:function(e){this.selectBTabs(e),this.checkCurrBTabs()},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey=e.id,a.treeSearchKey&&(e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(e,t){var a=this;this.treeData=null,this.$nextTick((function(){var o=a.$loading.show();a.$ajax.getJSON("/server/api/tree",{searchKey:e||"",type:t}).then((function(e){o.hide(),a.treeData=e,a.handleData(a.treeData,!0)})).catch((function(e){o.hide(),a.treeErrMsg=e.err_msg||e.message||"load failed",a.treeData=!1}))}))},getServerData:function(){var e={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""};if(!this.treeid)return{};if("home"==this.treeid)return e;var t=this.treeid.split(".");return t.forEach((function(t){var a=+t.substr(0,1),o=t.substr(1);switch(a){case 1:e.application=o;break;case 2:e.set_name=o;break;case 3:e.set_area=o;break;case 4:e.set_group=o;break;case 5:e.server_name=o;break;default:break}e.level=a})),e},checkTreeid:function(){this.treeid=this.getLocalStorage("_treeid_")||""},clickTab:function(e){var t=this,a=this.treeid,o=this.BTabs;o&&o.forEach((function(o){o.id===a&&(o.path=e.name,o.pluginPath=e.name.substr(t.base.length),o.pluginPath=o.pluginPath.substr(0,o.pluginPath.length-"/plugins".length))})),this.setLocalStorage("_tabs_",JSON.stringify(o))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;5===this.serverData.level||"publish"!==t&&"server-monitor"!==t&&"property-monitor"!==t&&"user-manage"!==t&&"interface-debuger"!==t||(a=!0),5!==this.serverData.level&&4!==this.serverData.level&&1!==this.serverData.level&&"config"===t&&(a=!0),a&&this.$router.replace("manage")},checkBTabs:function(){var e=this.BTabs,t=this.getLocalStorage("_tabs_");t&&t.length>0&&t.forEach((function(t){e.push({id:t.id,path:t.path})}))},checkCurrBTabs:function(){var e=this;this.$nextTick((function(){var t=e.$refs.btabs||"",a=t.children||[],o="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(o=e)})),o.offsetLeft<t.scrollLeft){var s=o.offsetLeft;t.scrollTo(s,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var i=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(i,0)}}))},selectBTabs:function(e){var t=this.BTabs,a=!1;t.forEach((function(t){t.id===e&&(a=!0,t.path="/server/".concat(e,"/manage"))})),a||this.BTabs.push({id:e,path:"/server/".concat(e,"/manage")}),this.treeid=e,this.setLocalStorage("_treeid_",JSON.stringify(e)),this.setLocalStorage("_tabs_",JSON.stringify(t))},clickBTabs:function(e,t){t==this.homeTab&&(Oe.data.serverListShow=!1),this.treeid=t,this.setLocalStorage("_treeid_",JSON.stringify(t))},closeBTabs:function(e){var t=this.BTabs,a=0;t.forEach((function(t,o){t.id===e&&(a=o)})),t.splice(a,1),this.setLocalStorage("_tabs_",JSON.stringify(t)),t.length>0?this.treeid=t[t.length-1].id:this.treeid="home",this.setLocalStorage("_treeid_",JSON.stringify(this.treeid)),this.getTreeData()},closeAllBTabs:function(){this.BTabs=[],this.treeid="home",this.setLocalStorage("_tabs_",JSON.stringify(this.BTabs)),this.setLocalStorage("_treeid_",JSON.stringify(this.treeid)),this.getTreeData()},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){this.checkTreeid(),this.checkBTabs(),this.getTreeData(),this.getPlugins();var e=this.BTabs;e.forEach((function(e){e.path="/server/".concat(e.id,"/manage")})),this.treeid||(this.treeid="home")}},Pe=Fe,Ae=(a("ebdf"),Object(x["a"])(Pe,j,R,!1,null,null,null)),Je=Ae.exports,Ve=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation"},[t("el-tabs",{attrs:{value:e.$route.path},on:{"tab-click":e.onTabClick}},[t("el-tab-pane",{attrs:{label:e.$t("deployService.title.deploy"),name:"/operation/deploy"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.expand"),name:"/operation/expand"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.template"),name:"/operation/templates"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.nodes"),name:"/operation/nodes"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.check"),name:"/operation/check"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.application"),name:"/operation/application"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.business"),name:"/operation/business"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.businessRelation"),name:"/operation/businessRelation"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.idcManage"),name:"/operation/idc"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.image"),name:"/operation/image"}}),e._l(e.plugins,(function(e){return t("el-tab-pane",{key:e.f_id,attrs:{name:"/operation/plugins"+e.f_path,label:e.f_name}})}))],2),t("router-view",{staticClass:"page_operation_children",attrs:{path:e.name}})],1)},We=[],He=a("03c6"),Ue="/operation/deploy",Be={name:"Operation",components:{plugins:He["a"]},data:function(){return{name:"",plugins:[]}},beforeRouteEnter:function(e,t,a){-1!=e.path.indexOf("/operation")&&e.path!=Ue?a(Ue):a()},beforeRouteLeave:function(e,t,a){Ue=t.path,a()},mounted:function(){this.getPlugins()},methods:{onTabClick:function(e){this.name=e.name,this.$router.replace(e.name)},getPlugins:function(){var e=this;this.$ajax.getJSON("/plugin/api/list",{k8s:!0,type:3}).then((function(t){e.plugins=t,e.plugins.forEach((function(t){"en"==e.$cookie.get("locale")&&(t.f_name=t.f_name_en)}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))}}},Ye=Be,Ke=(a("9d9a"),Object(x["a"])(Ye,Ve,We,!1,null,null,null)),Ge=Ke.exports,Ze=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_deploy"},[t("let-form",{directives:[{name:"show",rawName:"v-show",value:e.deployShow,expression:"deployShow"}],ref:"form",attrs:{inline:"","label-position":"top",itemWidth:"480px"},nativeOn:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[t("let-select",{attrs:{id:"inputApplication",size:"small",filterable:"",notFoundText:e.$t("deployService.form.appAdd")},model:{value:e.model.application,callback:function(t){e.$set(e.model,"application",t)},expression:"model.application"}},e._l(e.applicationList,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.model.server_name,callback:function(t){e.$set(e.model,"server_name",t)},expression:"model.server_name"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceType"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.serviceTypeTips")},model:{value:e.model.server_type,callback:function(t){e.$set(e.model,"server_type",t)},expression:"model.server_type"}},e._l(e.types,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.model.template_name,callback:function(t){e.$set(e.model,"template_name",t)},expression:"model.template_name"}},e._l(e.templates,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:"SET"}},[t("SetInputer",{attrs:{enabled:e.model.enable_set,name:e.model.set_name,area:e.model.set_area,group:e.model.set_group},on:{"update:enabled":function(t){return e.$set(e.model,"enable_set",t)},"update:name":function(t){return e.$set(e.model,"set_name",t)},"update:area":function(t){return e.$set(e.model,"set_area",t)},"update:group":function(t){return e.$set(e.model,"set_group",t)}}})],1),t("let-form-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{label:e.$t("user.op")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("user.tips.sep")},model:{value:e.model.operator,callback:function(t){e.$set(e.model,"operator",t)},expression:"model.operator"}})],1),t("let-form-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{label:e.$t("user.dev")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("user.tips.sep")},model:{value:e.model.developer,callback:function(t){e.$set(e.model,"developer",t)},expression:"model.developer"}})],1),e.baseImageList.length>0?t("let-form-item",{attrs:{label:e.$t("deployService.form.run_type")}},[t("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("pub.dlg.tgzRun")},{value:!1,text:e.$t("pub.dlg.containerRun")}]},on:{change:e.changeRunType},model:{value:e.runType,callback:function(t){e.runType=t},expression:"runType"}})],1):e._e(),"container"==e.model.run_type?t("let-form-item",{attrs:{label:e.$t("deployService.form.baseImageId")}},[t("let-select",{attrs:{size:"small"},model:{value:e.model.base_image_id,callback:function(t){e.$set(e.model,"base_image_id",t)},expression:"model.base_image_id"}},e._l(e.baseImageList,(function(a){return t("let-option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.image+"("+a.remark+")"))])})),1)],1):e._e(),t("let-table",{attrs:{data:e.model.adapters}},[t("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:a.row.obj_name,callback:function(t){e.$set(a.row,"obj_name",t)},expression:"props.row.obj_name"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.form.node_name"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-select",{attrs:{size:"small",required:"",filterable:""},on:{change:function(t){return e.nodeNameChange(a.row)}},model:{value:a.row.node_name,callback:function(t){e.$set(a.row,"node_name",t)},expression:"props.row.node_name"}},e._l(e.nodeList,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+" ")])})),1)]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.endpoint"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",placeholder:"IP",required:"","required-tip":e.$t("deployService.table.tips.ip")},model:{value:a.row.bind_ip,callback:function(t){e.$set(a.row,"bind_ip",t)},expression:"props.row.bind_ip"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.port,callback:function(t){e.$set(a.row,"port",t)},expression:"props.row.port"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:"tcp"},model:{value:a.row.port_type,callback:function(t){e.$set(a.row,"port_type",t)},expression:"props.row.port_type"}},[e._v("TCP")]),t("let-radio",{attrs:{label:"udp"},model:{value:a.row.port_type,callback:function(t){e.$set(a.row,"port_type",t)},expression:"props.row.port_type"}},[e._v("UDP")])]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:"tars"},model:{value:a.row.protocol,callback:function(t){e.$set(a.row,"protocol",t)},expression:"props.row.protocol"}},[e._v("TARS")]),t("let-radio",{attrs:{label:"not_tars"},model:{value:a.row.protocol,callback:function(t){e.$set(a.row,"protocol",t)},expression:"props.row.protocol"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"60px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.thread_num,callback:function(t){e.$set(a.row,"thread_num",t)},expression:"props.row.thread_num"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("serverList.servant.connections"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.max_connections,callback:function(t){e.$set(a.row,"max_connections",t)},expression:"props.row.max_connections"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.queuecap,callback:function(t){e.$set(a.row,"queuecap",t)},expression:"props.row.queuecap"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:a.row.queuetimeout,callback:function(t){e.$set(a.row,"queuetimeout",t)},expression:"props.row.queuetimeout"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.addAdapter(a.row)}}},[e._v(e._s(e.$t("operate.add")))]),a.$index?t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.model.adapters.splice(a.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]):e._e()]}}])})],1),t("let-button",{attrs:{type:"button",theme:"sub-primary"},on:{click:function(t){return e.getAutoPort()}}},[e._v(e._s(e.$t("deployService.form.getPort"))+" ")]),e._v("       "),t("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("common.submit")))])],1),t("let-modal",{staticClass:"more-cmd",staticStyle:{"text-align":"center"},attrs:{width:"700px",footShow:!1},on:{close:e.closeResultModal,"on-cancel":e.closeResultModal},model:{value:e.resultModal.show,callback:function(t){e.$set(e.resultModal,"show",t)},expression:"resultModal.show"}},[t("p",{staticClass:"result-text"},[e._v(" "+e._s(e.$t("deployService.form.ret.success"))+e._s(e.$t("resource.installRstMsg"))+" ")]),t("let-table",{attrs:{data:e.resultModal.resultList,"empty-msg":e.$t("common.nodata"),"row-class-name":e.resultModal.rowClassName}},[t("let-table-column",{attrs:{title:"ip",prop:"ip"}}),t("let-table-column",{attrs:{title:e.$t("resource.installResult"),prop:"rst"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("p",{domProps:{textContent:e._s(a.row.rst?e.$t("common.success"):e.$t("common.error"))}})]}}])}),t("let-table-column",{attrs:{title:e.$t("common.message"),prop:"msg"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.deployModal.show,expression:"deployModal.show"}],staticStyle:{width:"400px",margin:"0 auto","margin-top":"100px"}},[e.deployModal.nodeList.length>0?t("let-form",{ref:"deployForm",attrs:{itemWidth:"400px"}},[t("let-form-item",{attrs:{label:e.$t("nodes.node_name")}},[t("let-select",{model:{value:e.deployModal.node_name,callback:function(t){e.$set(e.deployModal,"node_name",t)},expression:"deployModal.node_name"}},e._l(e.deployModal.nodeList,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},[t("let-select",{attrs:{required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.deployModal.model.patch_id,callback:function(t){e.$set(e.deployModal.model,"patch_id",t)},expression:"deployModal.model.patch_id"}},e._l(e.deployModal.model.patchList,(function(a){return t("let-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.id)+" | "+e._s(a.posttime)+" | "+e._s(a.comment)+" ")])})),1)],1)],1):e._e(),e.deployModal.nodeList.length>0?t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-alert",{attrs:{"show-icon":"",title:e.$t("deployLog.info"),type:"warning",closable:!1}}),t("let-button",{staticStyle:{margin:"20px auto"},attrs:{type:"submit",theme:"primary"},on:{click:e.doDeployLog}},[e._v(" "+e._s(e.$t("deployLog.install"))+" ")])],1):t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-alert",{attrs:{"show-icon":"",title:e.$t("deployLog.add_node"),description:e.$t("deployLog.description"),type:"warning",closable:!1}})],1)],1),t("PublishStatus",{ref:"publishStatus"})],1)},Qe=[],Xe=(a("498a"),a("4d63"),a("c607"),a("2c3e"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"set_inputer"},[t("div",{staticClass:"set_inputer_item"},[t("let-input",{ref:"name",attrs:{size:"small",value:e.name,placeholder:e.$t("common.set.setName"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setNameFormatTips"),pattern:e.enabled?"^[a-z]+$":null,"pattern-tip":e.$t("deployService.form.setNameFormatTips")},on:{input:e.updaters.name}})],1),t("div",{staticClass:"set_inputer_item"},[t("let-input",{ref:"area",attrs:{size:"small",value:e.area,placeholder:e.$t("common.set.setArea"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setAreaTips"),pattern:e.enabled?"^[a-z]+$":null,"pattern-tip":e.$t("deployService.form.setAreaFormatTips")},on:{input:e.updaters.area}})],1),t("div",{staticClass:"set_inputer_item"},[t("let-input",{ref:"group",attrs:{size:"small",value:e.group,placeholder:e.$t("common.set.setGroup"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setGroupTips"),pattern:e.enabled?"^(\\d+|\\*)$":null,"pattern-tip":e.$t("deployService.form.setGroupFormatTips")},on:{input:e.updaters.group}})],1),t("let-checkbox",{staticClass:"set_inputer_switch",attrs:{value:e.enabled},on:{input:e.updaters.enabled,change:e.onEnabledChange}},[e._v(e._s(e.$t("serverList.table.th.enableSet"))+" ")])],1)}),et=[],tt={props:{enabled:Boolean,name:String,area:String,group:[Number,String]},created:function(){this.updaters={name:this.updater("name"),area:this.updater("area"),group:this.updater("group"),enabled:this.updater("enabled")}},methods:{updater:function(e){var t=this;return function(a){return t.$emit("update:".concat(e),a)}},onEnabledChange:function(){var e=this;this.$nextTick((function(){e.enabled||(e.updaters.name(""),e.$refs.name.resetValid(),e.updaters.area(""),e.$refs.area.resetValid(),e.updaters.group(""),e.$refs.group.resetValid())}))}}},at=tt,ot=(a("40ce"),Object(x["a"])(at,Xe,et,!1,null,null,null)),st=ot.exports,it=["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],rt=function(){return{application:"",server_name:"",server_type:it[0],template_name:"",node_name:"",enable_set:!1,set_name:"",set_area:"",set_group:"",operator:"",developer:"",run_type:"",base_image_id:0,adapters:[{obj_name:"",bind_ip:"",port:"",port_type:"tcp",protocol:"tars",thread_num:5,max_connections:1e5,queuecap:5e4,queuetimeout:2e4}]}},lt={name:"OperationDeploy",components:{SetInputer:st,PublishStatus:_e},data:function(){return{types:it,applicationList:[],nodeList:[],all_templates:[],baseImageList:[],templates:[],runType:!0,model:rt(),enableLogin:!1,deployShow:!1,deployModal:{show:!1,node_name:"",nodeList:[],model:{patch_id:"",patchList:[],serverList:[]}},resultModal:{show:!1,resultList:[],rowClassName:function(e){return e&&e.row&&!e.row.rst?"err-row":""}}}},watch:{runType:function(){this.model.run_type=this.runType?"":"container"}},mounted:function(){var e=this;this.$ajax.getJSON("/server/api/isEnableLogin").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){})),this.$ajax.getJSON("/server/api/application_list").then((function(t){e.applicationList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$ajax.getJSON("/server/api/node_list").then((function(t){e.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.templates=t,e.all_templates=t,e.model.template_name=t[0]})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$ajax.getJSON("/server/api/base_image_list").then((function(t){e.baseImageList=t,e.baseImageList.length>0&&(e.model.base_image_id=e.baseImageList[0].id)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$watch("props.row.node_name",(function(t,a){t!==a&&e.model.adapters.forEach((function(e){e.bind_ip=t}))})),this.checkDeployLog()},methods:{changeRunType:function(){this.model.run_type=this.runType?"":"container"},nodeNameChange:function(e){e.bind_ip=e.node_name},addAdapter:function(e){this.model.adapters.push(Object.assign({},e))},deploy:function(){for(var e=this,t=[],a=0;a<this.model.adapters.length;a++){var o=this.model.adapters[a].obj_name+"-"+this.model.adapters[a].node_name;if(-1!=t.indexOf(o))return void this.$tip.error("".concat(this.$t("deployService.infos.objNodedupErr")));t.push(o)}this.$confirm(this.$t("deployService.form.deployServiceTip"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/server/api/deploy_server",e.model).then((function(a){t.hide(),a.tars_node_rst&&a.tars_node_rst.length?e.showResultModal(a.tars_node_rst):e.$tip.success(e.$t("deployService.form.ret.success")),e.model=rt(),e.model.template_name=e.templates[0]})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}))},getAutoPort:function(){var e=this,t=this.$Loading.show(),a=this.model.adapters,o=[];a.forEach((function(e){o.push(e.bind_ip)})),this.$ajax.getJSON("/server/api/auto_port",{node_name:o.join(";")}).then((function(o){t.hide(),o.forEach((function(t,o){e.$set(a[o],"port",String(t.port||""))}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},save:function(){var e=this,t=document.querySelector("#inputApplication .let-select__filter__input").value.trim();""==this.model.application&&(this.model.application=t);var a=new RegExp("^[a-zA-Z]([a-zA-Z0-9]+)?$");if(this.applicationList.includes(this.model.application)&&a.test(this.model.application)){if(this.$refs.form.validate()){var o=this.model,s=this.$Loading.show(),i=[];o.adapters.forEach((function(e){i.push(e.node_name)})),this.$ajax.postJSON("/server/api/server_exist",{application:o.application,server_name:o.server_name,node_names:i}).then((function(t){s.hide(),t?e.$tip.error(e.$t("deployService.form.nameTips")):e.deploy()})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}}else this.$tip.error("".concat(this.$t("deployService.form.applicationTip")))},showResultModal:function(e){this.resultModal.resultList=e,this.resultModal.show=!0},closeResultModal:function(){this.resultModal.show=!1,this.resultModal.resultList=[]},checkDeployLog:function(){var e=this;this.$ajax.getJSON("/server/api/need_deploy_log").then((function(t){e.deployModal.show=t.need,e.deployShow=!t.need,t.need&&(e.deployModal.nodeList=e.nodeList.filter((function(e){return-1==e.indexOf("tars-")})),e.showDeployLog())})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getPatchList:function(e,t,a,o){return this.$ajax.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:o})},showDeployLog:function(){var e=this,t="tars",a="tarslog";this.deployModal.model={application:t,server_name:a,patch_id:"",patchList:[]},this.getPatchList(t,a,1,10).then((function(t){e.deployModal.model.patchList=t.rows}))},doDeployLog:function(){var e=this;this.$refs.deployForm.validate()&&this.$ajax.getJSON("/server/api/expand_deploy_log",{node_name:this.deployModal.node_name}).then((function(t){e.deployModal.model.serverList=t.server,e.$refs.publishStatus.savePublishServer(e.deployModal,e.onCancel)})).catch((function(t){e.$tip.error("".concat(e.$t("deployLog.failed"),": ").concat(t.err_msg||t.message))}))},onCancel:function(){this.checkDeployLog()}}},nt=lt,ct=(a("7587"),Object(x["a"])(nt,Ze,Qe,!1,null,null,null)),dt=ct.exports,mt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_expand"},[t("let-form",{ref:"configForm",attrs:{inline:"","label-position":"top",itemWidth:"480px"},nativeOn:{submit:function(t){return t.preventDefault(),e.previewExpand.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"240px",required:""}},[t("let-select",{attrs:{size:"small",required:"",filterable:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("application")}},model:{value:e.model.application,callback:function(t){e.$set(e.model,"application",t)},expression:"model.application"}},e._l(e.applications,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+" ")])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.service"),itemWidth:"240px",required:""}},[t("let-select",{attrs:{size:"small",required:"",filterable:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("server_name")}},model:{value:e.model.server_name,callback:function(t){e.$set(e.model,"server_name",t)},expression:"model.server_name"}},e._l(e.serverNames,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:"Set",itemWidth:"240px",required:""}},[t("let-select",{attrs:{size:"small",required:"",filterable:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("set")}},model:{value:e.model.set,callback:function(t){e.$set(e.model,"set",t)},expression:"model.set"}},e._l(e.sets,(function(a){return t("let-option",{key:a,attrs:{value:a||-1}},[e._v(" "+e._s(a||e.$t("serviceExpand.form.disableSet"))+" ")])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),itemWidth:"240px",required:""}},[t("let-select",{attrs:{size:"small",filterable:"",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.node_name,callback:function(t){e.$set(e.model,"node_name",t)},expression:"model.node_name"}},e._l(e.nodeNames,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("serviceExpand.form.tarIP"),itemWidth:"100%",required:""}},[t("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("serviceExpand.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.expandIpStr,callback:function(t){e.expandIpStr=t},expression:"expandIpStr"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet")}},[t("SetInputer",{attrs:{enabled:e.model.enable_set,name:e.model.set_name,area:e.model.set_area,group:e.model.set_group},on:{"update:enabled":function(t){return e.$set(e.model,"enable_set",t)},"update:name":function(t){return e.$set(e.model,"set_name",t)},"update:area":function(t){return e.$set(e.model,"set_area",t)},"update:group":function(t){return e.$set(e.model,"set_group",t)}}})],1),t("let-form-item",{attrs:{label:e.$t("serviceExpand.form.nodeConfig"),itemWidth:"100%"}},[t("let-checkbox",{model:{value:e.model.copy_node_config,callback:function(t){e.$set(e.model,"copy_node_config",t)},expression:"model.copy_node_config"}},[e._v(" "+e._s(e.$t("serviceExpand.form.copyNodeConfig"))+" ")])],1),t("let-button",{attrs:{type:"sumbit",theme:"primary"}},[e._v(e._s(e.$t("serviceExpand.form.preExpand")))])],1),t("let-form",{directives:[{name:"show",rawName:"v-show",value:e.previewItems.length>0,expression:"previewItems.length > 0"}],ref:"expandForm",staticClass:"mt40",attrs:{inline:""},nativeOn:{submit:function(t){return t.preventDefault(),e.expand.apply(null,arguments)}}},[t("let-table",{ref:"table",attrs:{data:e.previewItems,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(a){return[t("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(a){return[a.row.status==e.$t("serviceExpand.form.noExpand")?t("let-checkbox",{model:{value:a.row.isChecked,callback:function(t){e.$set(a.row,"isChecked",t)},expression:"scope.row.isChecked"}}):e._e()]}}])}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),t("let-table-column",{attrs:{title:"Set",prop:"set"}}),t("let-table-column",{attrs:{title:e.$t("serverList.servant.objName"),prop:"obj_name"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.endpoint")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-input",{model:{value:a.row.bind_ip,callback:function(t){e.$set(a.row,"bind_ip",t)},expression:"scope.row.bind_ip"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-input",{attrs:{type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.port,callback:function(t){e.$set(a.row,"port",t)},expression:"scope.row.port"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_name"}}),t("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c8"),prop:"status"}})],1),t("let-button",{attrs:{type:"button",theme:"sub-primary"},on:{click:function(t){return e.getAutoPort()}}},[e._v(e._s(e.$t("deployService.form.getPort"))+" ")]),e._v("    "),t("let-button",{attrs:{type:"sumbit",theme:"primary"}},[e._v(e._s(e.$t("deployService.title.expand")))])],1),t("let-modal",{staticClass:"more-cmd",attrs:{width:"700px",footShow:!1},on:{close:e.closeResultModal,"on-cancel":e.closeResultModal},model:{value:e.resultModal.show,callback:function(t){e.$set(e.resultModal,"show",t)},expression:"resultModal.show"}},[t("p",{staticClass:"result-text"},[e._v(e._s(e.$t("serviceExpand.form.errTips.success"))+e._s(e.$t("resource.installRstMsg")))]),t("let-table",{attrs:{data:e.resultModal.resultList,"empty-msg":e.$t("common.nodata"),"row-class-name":e.resultModal.rowClassName}},[t("let-table-column",{attrs:{title:"ip",prop:"ip"}}),t("let-table-column",{attrs:{title:e.$t("resource.installResult"),prop:"rst"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("p",{domProps:{textContent:e._s(a.row.rst?e.$t("common.success"):e.$t("common.error"))}})]}}])}),t("let-table-column",{attrs:{title:e.$t("common.message"),prop:"msg"}})],1)],1)],1)},ut=[],pt="((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])",ht=function(){return{application:"",server_name:"",set:"",node_name:"",expand_nodes:[],enable_set:!1,set_name:"",set_area:"",set_group:"",copy_node_config:!1}},ft={name:"OperationExpand",components:{SetInputer:st},data:function(){return{model:ht(),applications:[],serverNames:[],sets:[],nodeNames:[],expandIpStr:"",previewItems:[],ipReg:"^".concat(pt,"$"),isCheckedAll:!1,resultModal:{show:!1,resultList:[],rowClassName:function(e){return e&&e.row&&!e.row.rst?"err-row":""}}}},mounted:function(){var e=this;this.getCascadeSelectServer({level:1},this.$t("common.error")).then((function(t){e.applications=t}))},methods:{changeSelect:function(e){var t=this;switch(e){case"application":this.model.server_name="",this.serverNames=[],this.model.application&&this.getCascadeSelectServer({level:2,application:this.model.application},this.$t("common.error")).then((function(e){t.serverNames=e}));break;case"server_name":this.model.set="",this.sets=[],this.model.server_name&&this.getCascadeSelectServer({level:3,application:this.model.application,server_name:this.model.server_name},this.$t("common.error")).then((function(e){t.sets=e}));break;case"set":if(this.model.node_name="",this.model.nodeName=[],this.model.set){var a=-1===parseInt(this.model.set,10)?"":this.model.set;this.getCascadeSelectServer({level:4,application:this.model.application,server_name:this.model.server_name,set:a},this.$t("common.error")).then((function(e){t.nodeNames=e}))}break;default:break}},getCascadeSelectServer:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("common.error");return this.$ajax.getJSON("/server/api/cascade_select_server",e).then((function(e){return e})).catch((function(e){t.$tip.error("".concat(a,": ").concat(e.message||e.err_msg))}))},indexOf:function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return a;return-1},previewExpand:function(){var e=this;if(this.$refs.configForm.validate()){var t=Object.assign({},this.model);t.set=-1===parseInt(t.set,10)?"":t.set,t.expand_nodes=this.expandIpStr.trim().split(/[,;\n]/);var a=this.indexOf(t.expand_nodes,this.model.node_name);if(-1!=a)return void this.$tip.error("".concat(this.$t("serviceExpand.exists")));t.expand_nodes=t.expand_nodes.filter((function(e){return""!=e.trim()}));var o=this.$Loading.show();this.$ajax.postJSON("/server/api/expand_server_preview",t).then((function(t){o.hide();var a=t||[];a.forEach((function(e){e.isChecked=!1})),e.isCheckedAll=!1,e.previewItems=a})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getAutoPort:function(){var e=this,t=this.previewItems.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")&&t.isChecked}));if(0!=t.length){var a=this.$Loading.show(),o=[];t.forEach((function(e){o.push(e.bind_ip)})),this.$ajax.getJSON("/server/api/auto_port",{node_name:o.join(";")}).then((function(o){a.hide(),o.forEach((function(a,o){e.$set(t[o],"port",String(a.port||""))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}else this.$tip.error(this.$t("serviceExpand.form.errTips.nodeCheck"))},expand:function(){var e=this;if(this.$refs.expandForm.validate()){var t=this.previewItems.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")&&t.isChecked}));if(t.length>0){var a=[];t.forEach((function(e){a.push({bind_ip:e.bind_ip,node_name:e.node_name,obj_name:e.obj_name,port:e.port,set:e.set})}));var o={application:this.model.application,server_name:this.model.server_name,set:-1===parseInt(this.model.set,10)?"":this.model.set,node_name:this.model.node_name,copy_node_config:this.model.copy_node_config,expand_preview_servers:a},s=this.$Loading.show();this.$ajax.postJSON("/server/api/expand_server",o).then((function(t){s.hide(),t.tars_node_rst&&t.tars_node_rst.length?e.showResultModal(t.tars_node_rst):e.$tip.success(e.$t("serviceExpand.form.errTips.success"))})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}else this.$tip.error(this.$t("serviceExpand.form.errTips.noneNodes"))}},showResultModal:function(e){this.resultModal.resultList=e,this.resultModal.show=!0},closeResultModal:function(){this.resultModal.show=!1,this.resultModal.resultList=[]}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.previewItems.forEach((function(t){t.isChecked=e}))}}},_t=ft,vt=(a("77b8"),Object(x["a"])(_t,mt,ut,!1,null,null,null)),gt=vt.exports,bt=(a("841c"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_templates"},[t("el-form",{staticStyle:{display:"inline"},attrs:{inline:"",itemWidth:"200px"}},[t("el-form-item",{attrs:{label:e.$t("deployService.form.template")}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.template_name,callback:function(t){e.$set(e.query,"template_name",t)},expression:"query.template_name"}})],1),t("el-form-item",{attrs:{label:e.$t("template.search.parentTemplate")}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.parents_name,callback:function(t){e.$set(e.query,"parents_name",t)},expression:"query.parents_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1),t("span",{staticStyle:{float:"right"}},[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}}),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addTempate")))])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_name",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("template.search.parentTemplate"),prop:"parents_name",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"300px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.mergeItem(a.row)}}},[e._v(e._s(e.$t("operate.merge")))]),t("let-table-operation",{on:{click:function(t){return e.viewItem(a.row)}}},[e._v(e._s(e.$t("operate.view")))]),t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.profile))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("template.add.title"):this.$t("template.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("template.add.templateFormatTips"),required:"","required-tip":e.$t("template.add.templateNameTips"),pattern:"^[a-zA-Z-]([.a-zA-Z0-9-]+)?$","pattern-tip":e.$t("template.add.templateFormatTips")},model:{value:e.detailModal.model.template_name,callback:function(t){e.$set(e.detailModal.model,"template_name",t)},expression:"detailModal.model.template_name"}})],1),t("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate"),required:""}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.parents_name,callback:function(t){e.$set(e.detailModal.model,"parents_name",t)},expression:"detailModal.model.parents_name"}},[t("let-option",{attrs:{value:""}},[e._v(e._s(e.$t("pub.dlg.defaultValue")))]),e._l(e.items,(function(a){return t("let-option",{key:a.id,attrs:{value:a.template_name}},[e._v(e._s(a.template_name))])}))],2)],1),t("let-form-item",{attrs:{label:e.$t("template.form.content"),required:""}},[t("let-input",{attrs:{type:"textarea",rows:10,size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.profile,callback:function(t){e.$set(e.detailModal.model,"profile",t)},expression:"detailModal.model.profile"}})],1)],1):e._e()],1)],1)}),$t=[],wt={name:"OperationTemplates",data:function(){return{query:{template_name:"",parents_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_profile_template",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},mergeItem:function(e){var t=this,a=this.$Loading.show();this.$ajax.getJSON("/server/api/get_merge_profile_template",{template_name:e.template_name}).then((function(o){a.hide(),e.profile=o.template,t.viewModal.model=e,t.viewModal.show=!0})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.id?"/server/api/update_profile_template":"/server/api/add_profile_template",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_profile_template",{id:e.id}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},yt=wt,Mt=(a("21c0"),Object(x["a"])(yt,bt,$t,!1,null,null,null)),kt=Mt.exports,St=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_templates"},[t("el-form",{attrs:{inline:"",itemWidth:"200px"}},[t("el-form-item",{attrs:{label:e.$t("nodes.node_name")+"："}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.node_name,callback:function(t){e.$set(e.query,"node_name",t)},expression:"query.node_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"submit",theme:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))]),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.getNodeList()}}})],1),t("div",{staticStyle:{float:"right"}},[e.strict?e._e():t("span",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.manualAddItem}},[e._v(e._s(e.$t("nodes.btn.manualAddNode"))+" ")]),e._v("     "),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.autoAddItem}},[e._v(e._s(e.$t("nodes.btn.autoAddNode"))+" ")]),e._v("     "),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.autoUpdateItem}},[e._v(e._s(e.$t("nodes.btn.autoUpdateNode"))+" ")])],1)])],1),t("let-modal",{attrs:{title:e.$t("nodes.btn.manualAddNode"),footShow:!1,width:"800px"},model:{value:e.showManualAddItem,callback:function(t){e.showManualAddItem=t},expression:"showManualAddItem"}},[t("div",[t("br"),t("br"),t("let-tag",[e._v(e._s(e.$t("nodes.manualAddNode.OS1.title")))]),t("p",[e._v("1 "+e._s(e.$t("nodes.manualAddNode.OS1.step1")))]),t("p",[e._v("2 "+e._s(e.$t("nodes.manualAddNode.OS1.step2")))]),t("p",[e._v("3 "+e._s(e.$t("nodes.manualAddNode.OS1.step3")))]),t("p",[e._v("4 "+e._s(e.$t("nodes.manualAddNode.OS1.step4")))]),t("p",[e._v("5 "+e._s(e.$t("nodes.manualAddNode.OS1.step5")))]),t("br"),t("let-tag",[e._v(e._s(e.$t("nodes.manualAddNode.OS2.title")))]),t("p",[e._v("1 "+e._s(e.$t("nodes.manualAddNode.OS2.step1")))]),t("p",[e._v("2 "+e._s(e.$t("nodes.manualAddNode.OS2.step2")))]),t("p",[e._v("3 "+e._s(e.$t("nodes.manualAddNode.OS2.step3")))]),t("p",[e._v("4 "+e._s(e.$t("nodes.manualAddNode.OS2.step4")))]),t("p",[e._v("5 "+e._s(e.$t("nodes.manualAddNode.OS2.step5")))]),t("p",[e._v("6 "+e._s(e.$t("nodes.manualAddNode.OS2.step6")))]),t("br"),t("let-tag",{attrs:{theme:"success",checked:""}},[e._v(e._s(e.$t("nodes.manualAddNode.info1")))]),t("br"),t("br"),t("let-tag",{attrs:{theme:"success",checked:""}},[e._v(e._s(e.$t("nodes.manualAddNode.info2")))])],1)]),t("let-table",{ref:"nodeListLoading",attrs:{data:e.nodeList,stripe:"","empty-msg":e.$t("common.nodata"),"row-class-name":e.tableRowClassName}},[t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.node_name"),prop:"node_name"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.long_connection")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:""===a.row.node_obj?"active":"inactive"},[e._v(e._s(""===a.row.node_obj?"yes":"no"))])]}}])}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.present_state"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:"active"===a.row.present_state?"active":"inactive"},[e._v(e._s(a.row.present_state))])]}}])}),t("let-table-column",{attrs:{title:e.$t("common.time"),prop:"last_reg_time"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.last_heartbeat"),prop:"last_heartbeat"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.label"),prop:"label",width:"20%"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.version"),prop:"tars_version"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.load_avg5"),prop:"load_avg5"}}),t("let-table-column",{attrs:{title:e.$t("nodeList.table.th.check")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editNode(a.row.node_name)}}},[e._v(e._s(e.$t("nodeList.table.edit")))]),e._v("    "),t("let-table-operation",{on:{click:function(t){return e.checkNode(a.row.node_name)}}},[e._v(e._s(e.$t("nodeList.table.check")))]),e._v("    "),t("let-table-operation",{on:{click:function(t){return e.deleteNode(a.row.node_name)}}},[e._v(e._s(e.$t("nodeList.table.delete")))])]}}])})],1),t("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}}),t("let-modal",{attrs:{title:this.$t("connectNodeList.title"),width:"1200px",footShow:!1,showClose:!1},model:{value:e.connectModal.show,callback:function(t){e.$set(e.connectModal,"show",t)},expression:"connectModal.show"}},[t("let-table",{ref:"connectNodeListLoading",staticStyle:{"margin-top":"20px"},attrs:{data:e.connectNodeList,stripe:"","empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{type:"expand",width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"install_step"},[t("let-steps",{attrs:{current:a.row.step||0}},[t("let-step",{attrs:{title:e.$t("connectNodeList.step1")}}),t("let-step",{attrs:{title:e.$t("connectNodeList.step2")}}),t("let-step",{attrs:{title:e.$t("connectNodeList.step3")}}),t("let-step",{attrs:{title:e.$t("connectNodeList.step4")}}),t("let-step",{attrs:{title:e.$t("connectNodeList.step5")}})],1),"fail"==a.row.installState&&1==a.row.step?t("p",{staticClass:"fail_txt"},[e._v(" Error: please check file /usr/local/app/web/files/tarsnode.tgz ")]):e._e(),"fail"==a.row.installState&&2==a.row.step?t("p",{staticClass:"fail_txt"},[e._v(" Error: please ensure the ssh service is enabled, and the ip/port/user/password config is right ")]):e._e(),"fail"==a.row.installState&&3==a.row.step?t("p",{staticClass:"fail_txt"},[e._v(" Error: please install curl on the node ")]):e._e(),"fail"==a.row.installState&&4==a.row.step?t("p",{staticClass:"fail_txt"},[e._v(" Error: please ensure the registry is available ")]):e._e(),"fail"==a.row.installState&&5==a.row.step?t("p",{staticClass:"fail_txt"},[e._v(" Error: some unknown error, please check log ")]):e._e(),t("pre",{staticClass:"stdout"},[e._v(e._s(a.row.stdout))])],1)]}}])}),t("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.node_name"),prop:"ip"}}),t("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.connect"),prop:"connectInfo"}}),t("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.exists"),prop:"existsInfo"}}),t("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.install")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:{success_txt:"success"==a.row.installState,fail_txt:"fail"==a.row.installState}},[e._v(e._s(a.row.installInfo))])]}}])})],1),t("let-button",{attrs:{theme:"primary",disabled:e.executeConnect},on:{click:e.connectNode}},[e._v(e._s(e.btnConnectText))]),e._v("    "),t("let-button",{attrs:{theme:"primary",disabled:e.executeInstall},on:{click:e.installNode}},[e._v(e._s(e.btnInstallText))]),e._v("    "),t("let-button",{staticStyle:{float:"right"},attrs:{theme:"primary"},on:{click:e.closeConnectModal}},[e._v(e._s(e.$t("connectNodeList.btnClose")))])],1),t("let-modal",{attrs:{title:this.$t("nodes.add.title"),width:"500px"},on:{"on-confirm":e.showConnectNode,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[t("let-form",{ref:"detailForm",attrs:{itemWidth:"450px"}},[t("let-form-item",{attrs:{label:e.$t("nodes.node_name"),required:""}},[e.detailModal.add?t("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("nodes.nodeNameTips"),required:"","required-tip":e.$t("nodes.nodeNameTips")},model:{value:e.detailModal.model.node_name,callback:function(t){e.$set(e.detailModal.model,"node_name",t)},expression:"detailModal.model.node_name"}}):t("let-select",{attrs:{size:"small",required:"",multiple:""},model:{value:e.detailModal.model.update_node_name,callback:function(t){e.$set(e.detailModal.model,"update_node_name",t)},expression:"detailModal.model.update_node_name"}},e._l(e.nodeList,(function(a){return t("let-option",{key:a.node_name,attrs:{value:a.node_name}},[e._v(" "+e._s(a.node_name+"("+a.tars_version+")")+" ")])})),1)],1),t("let-form-item",{attrs:{label:e.$t("nodes.user"),required:""}},[t("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.user,callback:function(t){e.$set(e.detailModal.model,"user",t)},expression:"detailModal.model.user"}})],1),t("let-form-item",{attrs:{label:e.$t("nodes.port"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("nodes.portTips"),required:"","required-tip":e.$t("nodes.portTips"),pattern:"^[^\\s]+$","pattern-tip":e.$t("nodes.portTips")},model:{value:e.detailModal.model.port,callback:function(t){e.$set(e.detailModal.model,"port",t)},expression:"detailModal.model.port"}})],1),t("let-form-item",{attrs:{label:e.$t("nodes.password")}},[t("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.password,callback:function(t){e.$set(e.detailModal.model,"password",t)},expression:"detailModal.model.password"}})],1),t("let-form-item",{attrs:{label:e.$t("nodes.runuser"),required:""}},[t("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("nodes.runuserTips"),pattern:"^[^\\s]+$","pattern-tip":e.$t("nodes.runuserTips")},model:{value:e.detailModal.model.runuser,callback:function(t){e.$set(e.detailModal.model,"runuser",t)},expression:"detailModal.model.runuser"}})],1)],1)],1),t("let-modal",{attrs:{title:this.$t("nodes.label.title"),width:"500px"},on:{"on-confirm":e.onAddLabel},model:{value:e.labelModel.show,callback:function(t){e.$set(e.labelModel,"show",t)},expression:"labelModel.show"}},[t("let-form",{ref:"labelForm",attrs:{itemWidth:"450px"}},[t("let-table",{staticStyle:{"margin-top":"20px"},attrs:{data:e.labelModel.labelList,stripe:"","empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("nodes.label.name"),prop:"name"}}),t("let-table-column",{attrs:{title:e.$t("nodes.label.value"),prop:"value"}}),t("let-table-column",{attrs:{title:e.$t("nodes.label.operator")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.deleteLabel(e.labelModel.node_name,a.row.name)}}},[e._v(e._s(e.$t("nodes.label.delete")))])]}}])})],1),t("let-form-item",{attrs:{label:e.$t("nodes.label.name"),required:"",itemWidth:"150"}},[t("let-input",{attrs:{size:"small",required:"",width:"150px",pattern:"^[a-zA-Z0-9]([a-zA-Z0-9]+)?$"},model:{value:e.labelModel.model.name,callback:function(t){e.$set(e.labelModel.model,"name",t)},expression:"labelModel.model.name"}})],1),t("let-form-item",{attrs:{label:e.$t("nodes.label.value"),required:"",itemWidth:"150"}},[t("let-input",{attrs:{size:"small",required:"",width:"150px",pattern:"^[a-zA-Z0-9]([a-zA-Z0-9]+)?$"},model:{value:e.labelModel.model.value,callback:function(t){e.$set(e.labelModel.model,"value",t)},expression:"labelModel.model.value"}})],1)],1)],1)],1)},Lt=[],xt=a("c1df"),Ct=a.n(xt),Nt={name:"OperationNodes",data:function(){return{query:{node_name:""},nodeList:[],pageNum:1,pageSize:20,total:1,strict:!1,executeInstall:!1,executeConnect:!1,btnConnectText:"",btnInstallText:"",isCheckedAll:!1,connectNodeList:[],connectModal:{show:!1},showManualAddItem:!1,detailModal:{show:!1,add:!0,model:{node_name:"",update_node_name:[],user:"root",password:"",port:"22",runuser:"tars"}},labelModel:{show:!1,node_name:"",labelList:[],model:{name:"",value:""}}}},mounted:function(){this.getNodeList(1),this.isStrict()},methods:{isStrict:function(){var e=this;this.$ajax.getJSON("/server/api/is_strict").then((function(t){e.strict=t.strict})).catch((function(e){}))},updateLabel:function(e,t){for(var a=0;a<this.nodeList.length;a++){var o=this.nodeList[a];if(o.node_name==e)return void(o.label=t)}},updateLabelList:function(e){if(this.labelModel.labelList=[],e){var t=e;for(var a in t)this.labelModel.labelList.push({name:a,value:t[a]})}},editNode:function(e){var t=this;this.$ajax.getJSON("/server/api/load_node_label",{node_name:e}).then((function(a){t.labelModel.node_name=e,t.updateLabelList(a),t.updateLabel(t.labelModel.node_name,a),t.labelModel.show=!0})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},onAddLabel:function(){var e=this;this.$ajax.postJSON("/server/api/add_node_label",{node_name:this.labelModel.node_name,name:this.labelModel.model.name,value:this.labelModel.model.value}).then((function(t){e.updateLabelList(t),e.updateLabel(e.labelModel.node_name,t),e.labelModel.model.name="",e.labelModel.model.value=""})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},deleteLabel:function(e,t){var a=this;this.$ajax.postJSON("/server/api/delete_node_label",{node_name:e,name:t}).then((function(t){a.updateLabelList(t),a.updateLabel(e,t),a.$tip.success("".concat(a.$t("common.success")))})).catch((function(e){a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.err_msg||e.message))}))},checkNode:function(e){var t=this,a=this.$refs.nodeListLoading.$loading.show();this.$ajax.getJSON("/server/api/check_tars_node",{node_name:e}).then((function(e){a.hide(),e?t.$tip.success("".concat(t.$t("nodeList.checkNode"),": ").concat(e)):t.$tip.error("".concat(t.$t("nodeList.checkNode"),": ").concat(e))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},deleteNode:function(e){var t=this;this.$confirm(this.$t("nodeList.confirmDeleteNode"),this.$t("common.alert")).then((function(){var a=t.$refs.nodeListLoading.$loading.show();t.$ajax.getJSON("/server/api/uninstall_tars_node",{node_name:e}).then((function(e){a.hide(),t.getNodeList(),e.rst?t.$tip.success("".concat(t.$t("nodeList.deleteNode"),": ").concat(e.msg)):t.$tip.error("".concat(t.$t("nodeList.deleteNode"),": ").concat(e.msg))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"active"===t.present_state?"red-row":""},getNodeList:function(e){var t=this;e||(e=this.pageNum||1),this.$ajax.getJSON("/server/api/list_tars_node",{node_name:this.query.node_name,page_size:this.pageSize,curr_page:e}).then((function(a){t.pageNum=e,t.total=(a.count+1)/t.pageSize,t.nodeList=a.rows,t.nodeList.forEach((function(e){e.last_heartbeat&&(e.last_heartbeat=Ct()(e.last_heartbeat).format("YYYY-MM-DD HH:mm:ss")),e.last_reg_time=Ct()(e.last_reg_time).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},gotoPage:function(e){this.getNodeList(e)},search:function(){this.getNodeList(1)},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1},closeConnectModal:function(){this.executeConnect||this.executeInstall?alert(this.$t("connectNodeList.execute")):(this.btnConnectText=this.$t("connectNodeList.btnConnect"),this.btnInstallText=this.$t("connectNodeList.btnInstall"),this.connectModal.show=!1)},manualAddItem:function(){this.showManualAddItem=!0},autoAddItem:function(){this.detailModal.show=!0,this.detailModal.add=!0},autoUpdateItem:function(){this.detailModal.show=!0,this.detailModal.add=!1},showConnectNode:function(){var e=this;if(this.$refs.detailForm.validate()){this.btnConnectText=this.$t("connectNodeList.btnConnect"),this.btnInstallText=this.$t("connectNodeList.btnInstall"),this.connectNodeList=[];var t=this.detailModal.model,a=[];a=this.detailModal.add?t.node_name.split(/[,;\n]/):t.update_node_name,a.forEach((function(t){if(""!==t.trim()){var a={ip:t,connect:!1,connectInfo:"",exists:!1,existsInfo:"",step:0,stdout:"",installState:"",installInfo:""};e.connectNodeList.push(a)}})),this.connectModal.show=!0}},connectNode:function(e){var t=this;if(this.executeInstall)alert(this.$t("connectNodeList.executeInstall"));else if(0!=this.connectNodeList.length){this.btnConnectText=this.$t("connectNodeList.install.connect"),this.executeConnect=!0;var a=this.connectNodeList.length;this.connectNodeList.forEach((function(e){var o=Object.assign({},t.detailModal.model);o.node_name=e.ip,e.installState="",e.connectInfo="",e.existsInfo="",e.installInfo=t.$t("connectNodeList.install.connect"),t.$ajax.postJSON("/server/api/connect_tars_node",o).then((function(o){e.connectInfo=o.connectInfo,e.existsInfo=o.existsInfo,e.installInfo=o.installInfo,e.connect=o.connect,0==--a&&(t.btnConnectText=t.$t("connectNodeList.btnConnect"),t.executeConnect=!1)})).catch((function(o){t.$tip.error("".concat(t.$t("common.error"),": ").concat(o.message||o.err_msg)),e.installInfo=t.$t("common.error"),0==--a&&(t.btnConnectText=t.$t("connectNodeList.btnConnect"),t.executeConnect=!1)}))}))}},installNode:function(e){var t=this;if(this.executeConnect)alert(this.$t("connectNodeList.executeConnect"));else{var a=[];this.connectNodeList.forEach((function(e){a.push(e.ip),e.installState=""}));var o=this.detailModal.model,s=Object.assign({},o);s.node_name=a.join(";"),this.btnInstallText=this.$t("connectNodeList.btnInstalling"),this.executeInstall=!1,this.$ajax.postJSON("/server/api/install_tars_nodes",s).then((function(e){e.forEach((function(e){var a=t.connectNodeList.filter((function(t){return t.ip==e.ip}));a.length>0&&(a[0].installInfo=e.msg,a[0].installState=e.installState,a[0].step=e.step,a[0].stdout=e.stdout),e.rst||t.$tip.error(e.ip+":"+e.msg)})),t.getNodeList(1),t.btnInstallText=t.$t("connectNodeList.btnInstalled"),t.executeInstall=!1})).catch((function(e){t.btnInstallText=t.$t("connectNodeList.btnInstalled"),t.executeInstall=!1,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}}}},Et=Nt,Dt=(a("d687"),Object(x["a"])(Et,St,Lt,!1,null,"ae1ec656",null)),It=Dt.exports,Tt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_templates",staticStyle:{"text-align":"center"}},[t("let-form",{attrs:{inline:"",itemWidth:"200px"}},[t("div",{staticStyle:{float:"right"}},[t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.checkFramework}},[e._v(e._s(e.$t("nodes.btn.check")))]),e._v("     "),t("let-button",{attrs:{size:"small",theme:"info"},on:{click:e.openShowProblem}},[e._v(e._s(e.$t("nodes.btn.question")))])],1)]),t("br"),t("let-table",{ref:"checkLoading",attrs:{data:e.servers,stripe:"","row-class-name":e.tableRowClassName,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("checkTable.table.th.server_name"),prop:"serverName",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("checkTable.table.th.node_name"),prop:"nodeName",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("checkTable.table.th.obj_name"),prop:"objName",width:"55%"}}),t("let-table-column",{attrs:{title:e.$t("checkTable.table.th.status"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"status"},[e._v(e._s(a.row.status))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("checkTable.problemDialog.title"),width:"600px"},model:{value:e.showProblem,callback:function(t){e.showProblem=t},expression:"showProblem"}},[t("div",[t("br"),t("p",[e._v(e._s(e.$t("checkTable.problemDialog.info")))]),t("br"),t("p",[e._v(e._s(e.$t("checkTable.problemDialog.restartFramework")))]),t("p",[e._v(e._s(e.$t("checkTable.problemDialog.stopFramework")))]),t("p",[e._v(e._s(e.$t("checkTable.problemDialog.restartServer")))])])])],1)},Ot=[],qt={name:"OperationCheck",data:function(){return{showProblem:!1,servers:[]}},mounted:function(){},methods:{openShowProblem:function(){this.showProblem=!0},tableRowClassName:function(e){var t=e.row;e.rowIndex;return 1===t.check?"":2===t.check?"checking-row":0===t.check?"success-row":-1===t.check?"warning-row":""},checkFramework:function(){var e=this,t=this.$refs.checkLoading.$loading.show();this.$ajax.getJSON("/server/api/get_framework_list").then((function(a){t.hide();for(var o=0;o<a.servers.length;o++)a.servers[o].check=1,a.servers[o].status="waiting";e.servers=a.servers;var s=e;for(o=0;o<s.servers.length;o++)(function(e){setTimeout((function(){s.checkServer(e)}),100*e)})(o)})).catch((function(a){t.hide(),e.$Notice({title:e.$t("checkTable.adminRegistryFailed"),message:e.$t("checkTable.restartAdminRegistry"),type:"error",duration:0})}))},checkServer:function(e){var t=this,a=this.servers[e];a.check=2,a.status="checking",this.$ajax.postJSON("/server/api/check_framework_server",{server:a}).then((function(e){a.check=0,a.status="succ"})).catch((function(e){a.check=-1,a.status=t.$t("checkTable.failed")}))}}},jt=qt,Rt=(a("a059"),Object(x["a"])(jt,Tt,Ot,!1,null,"505bfec0",null)),zt=Rt.exports,Ft=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_application"},[t("el-form",{attrs:{inline:"",itemWidth:"200px"}},[t("el-form-item",{attrs:{label:e.$t("application.form.application")}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.f_name,callback:function(t){e.$set(e.query,"f_name",t)},expression:"query.f_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1),t("div",{staticStyle:{float:"right"}},[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}}),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("application.btn.add")))])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("application.form.application"),prop:"f_name"}}),t("let-table-column",{attrs:{title:e.$t("application.form.person"),prop:"f_create_person"}}),t("let-table-column",{attrs:{title:e.$t("application.form.time"),prop:"f_create_time"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("application.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.profile))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("application.add.title"):this.$t("application.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("application.form.application"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("application.add.formatTips"),required:"","required-tip":e.$t("application.add.nameTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("application.add.formatTips")},model:{value:e.detailModal.model.f_name,callback:function(t){e.$set(e.detailModal.model,"f_name",t)},expression:"detailModal.model.f_name"}})],1)],1):e._e()],1)],1)},Pt=[],At={name:"OperationApplication",data:function(){return{query:{f_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_application",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.id?"/server/api/update_application":"/server/api/add_application",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("application.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_application",{f_id:e.f_id}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},Jt=At,Vt=(a("e3d0"),Object(x["a"])(Jt,Ft,Pt,!1,null,null,null)),Wt=Vt.exports,Ht=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_business"},[t("el-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:e.$t("business.form.business")}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.f_name,callback:function(t){e.$set(e.query,"f_name",t)},expression:"query.f_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1),t("div",{staticStyle:{float:"right"}},[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}}),t("el-button",{staticStyle:{float:"right"},attrs:{size:"small",type:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("business.btn.add")))])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("business.form.business"),prop:"f_name"}}),t("let-table-column",{attrs:{title:e.$t("business.form.showName"),prop:"f_show_name"}}),t("let-table-column",{attrs:{title:e.$t("business.form.order"),prop:"f_order"}}),t("let-table-column",{attrs:{title:e.$t("business.form.person"),prop:"f_create_person"}}),t("let-table-column",{attrs:{title:e.$t("business.form.time"),prop:"f_create_time"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("business.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.profile))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("business.add.title"):this.$t("business.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("business.form.business"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("business.add.formatTips"),required:"","required-tip":e.$t("business.add.nameTips"),pattern:"^[a-zA-Z]([.a-zA-Z0-9]+)?$","pattern-tip":e.$t("business.add.formatTips")},model:{value:e.detailModal.model.f_name,callback:function(t){e.$set(e.detailModal.model,"f_name",t)},expression:"detailModal.model.f_name"}})],1),t("let-form-item",{attrs:{label:e.$t("business.form.showName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("common.notEmpty"),required:"","required-tip":e.$t("common.notEmpty"),"pattern-tip":e.$t("common.notEmpty")},model:{value:e.detailModal.model.f_show_name,callback:function(t){e.$set(e.detailModal.model,"f_show_name",t)},expression:"detailModal.model.f_show_name"}})],1),t("let-form-item",{attrs:{label:e.$t("business.form.order")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("common.needNumber"),"required-tip":e.$t("common.needNumber"),pattern:"^([0-9]+)?$","pattern-tip":e.$t("common.needNumber")},model:{value:e.detailModal.model.f_order,callback:function(t){e.$set(e.detailModal.model,"f_order",t)},expression:"detailModal.model.f_order"}})],1)],1):e._e()],1)],1)},Ut=[],Bt={name:"OperationApplication",data:function(){return{query:{f_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_business",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.f_id?"/server/api/update_business":"/server/api/add_business",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("business.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_business",{f_id:e.f_id}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},Yt=Bt,Kt=(a("3e32"),Object(x["a"])(Yt,Ht,Ut,!1,null,null,null)),Gt=Kt.exports,Zt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_businessRelation"},[t("el-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:e.$t("business.form.business")}},[e.business&&e.business.length>0?t("el-select",{attrs:{size:"small",filterable:""},model:{value:e.query.f_business_name,callback:function(t){e.$set(e.query,"f_business_name",t)},expression:"query.f_business_name"}},e._l(e.business,(function(a){return t("el-option",{key:a.f_id,attrs:{value:a.f_name}},[e._v(e._s(a.f_name))])})),1):t("el-input",{attrs:{size:"small"},model:{value:e.query.f_business_name,callback:function(t){e.$set(e.query,"f_business_name",t)},expression:"query.f_business_name"}})],1),t("el-form-item",{attrs:{label:e.$t("application.form.application")}},[e.application&&e.application.length>0?t("el-select",{attrs:{size:"small",filterable:""},model:{value:e.query.f_application_name,callback:function(t){e.$set(e.query,"f_application_name",t)},expression:"query.f_application_name"}},e._l(e.application,(function(a){return t("el-option",{key:a.f_id,attrs:{value:a.f_name}},[e._v(e._s(a.f_name))])})),1):t("el-input",{attrs:{size:"small"},model:{value:e.query.f_application_name,callback:function(t){e.$set(e.query,"f_application_name",t)},expression:"query.f_application_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1),t("div",{staticStyle:{float:"right"}},[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}}),t("el-button",{staticStyle:{float:"right"},attrs:{size:"small",type:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("businessRelation.btn.add")))])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("business.form.business"),prop:"f_business_name"}}),t("let-table-column",{attrs:{title:e.$t("application.form.application"),prop:"f_application_name"}}),t("let-table-column",{attrs:{title:e.$t("businessRelation.form.person"),prop:"f_create_person"}}),t("let-table-column",{attrs:{title:e.$t("businessRelation.form.time"),prop:"f_create_time"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("businessRelation.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.profile))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("businessRelation.add.title"):this.$t("businessRelation.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("application.form.application"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.detailModal.model.f_application_name,callback:function(t){e.$set(e.detailModal.model,"f_application_name",t)},expression:"detailModal.model.f_application_name"}},e._l(e.application,(function(a){return t("let-option",{key:a.f_id,attrs:{value:a.f_name}},[e._v(e._s(a.f_name))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("business.form.business"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.detailModal.model.f_business_name,callback:function(t){e.$set(e.detailModal.model,"f_business_name",t)},expression:"detailModal.model.f_business_name"}},e._l(e.business,(function(a){return t("let-option",{key:a.f_id,attrs:{value:a.f_name}},[e._v(e._s(a.f_name))])})),1)],1)],1):e._e()],1)],1)},Qt=[],Xt={name:"OperationApplication",data:function(){return{query:{f_business_name:"",f_application_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1},business:[],application:[]}},mounted:function(){this.fetchData(),this.getBusinessData(),this.getApplicationData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_business_relation",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.f_id?"/server/api/update_business_relation":"/server/api/add_business_relation",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("businessRelation.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_business_relation",{f_id:e.f_id}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getBusinessData:function(){var e=this;return this.$ajax.getJSON("/server/api/query_business").then((function(t){e.business=t}))},getApplicationData:function(){var e=this;return this.$ajax.getJSON("/server/api/query_application").then((function(t){e.application=t}))}}},ea=Xt,ta=(a("a302"),Object(x["a"])(ea,Zt,Qt,!1,null,null,null)),aa=ta.exports,oa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_templates"},[t("el-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:e.$t("idc.grid.groupName")}},[t("el-input",{attrs:{size:"small"},model:{value:e.query.group_name,callback:function(t){e.$set(e.query,"group_name",t)},expression:"query.group_name"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1),t("div",{staticStyle:{float:"right"}},[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}}),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addGroup}},[e._v(e._s(e.$t("idc.btn.add")))])],1)],1),t("let-table",{ref:"table",staticClass:"hideFir",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{staticStyle:{display:"none"},attrs:{prop:"group_id"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.groupName"),prop:"group_name"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.groupNameCN"),prop:"group_name_cn"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.ipOrder"),prop:"ip_order"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.allowIpRule"),prop:"allow_ip_rule"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.dennyIpRule"),prop:"denny_ip_rule"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.lastuser"),prop:"lastuser"}}),t("let-table-column",{attrs:{title:e.$t("idc.grid.modifyTime"),prop:"modify_time"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"300px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("idc.btn.add"):this.$t("idc.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",staticClass:"two-columns",attrs:{itemWidth:"300px",columns:"2"}},[e.detailModal.isNew?e._e():t("let-form-item",{attrs:{label:e.$t("idc.grid.groupName"),required:""}},[e._v(" "+e._s(e.detailModal.model.group_name)+" ")]),e.detailModal.isNew?t("let-form-item",{attrs:{label:e.$t("idc.grid.groupName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("idc.valid.groupName"),required:"","required-tip":e.$t("idc.valid.groupName"),pattern:"^[a-zA-Z-]([.a-zA-Z0-9-]+)?$","pattern-tip":e.$t("idc.valid.groupName")},model:{value:e.detailModal.model.group_name,callback:function(t){e.$set(e.detailModal.model,"group_name",t)},expression:"detailModal.model.group_name"}})],1):e._e(),t("let-form-item",{staticStyle:{"margin-left":"40px"},attrs:{label:e.$t("idc.grid.groupNameCN"),required:""}},[t("let-input",{attrs:{size:"small",required:"",placeholder:e.$t("idc.update.placeholder")},model:{value:e.detailModal.model.group_name_cn,callback:function(t){e.$set(e.detailModal.model,"group_name_cn",t)},expression:"detailModal.model.group_name_cn"}})],1),t("let-form-item",{attrs:{label:e.$t("idc.grid.ipOrder"),required:""}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("idc.update.allowType"),required:""},model:{value:e.detailModal.model.ip_order,callback:function(t){e.$set(e.detailModal.model,"ip_order",t)},expression:"detailModal.model.ip_order"}},e._l(e.ipOrders,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item"),t("let-form-item",{attrs:{label:e.$t("idc.grid.allowIpRule")}},[t("let-select",{attrs:{required:"",multiple:""},model:{value:e.detailModal.model.allowList,callback:function(t){e.$set(e.detailModal.model,"allowList",t)},expression:"detailModal.model.allowList"}},e._l(e.allowList,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{staticStyle:{"margin-left":"40px"},attrs:{label:e.$t("idc.grid.dennyIpRule")}},[t("let-select",{attrs:{required:"",multiple:""},model:{value:e.detailModal.model.dennyList,callback:function(t){e.$set(e.detailModal.model,"dennyList",t)},expression:"detailModal.model.dennyList"}},e._l(e.dennyList,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{itemWidth:"242px"}},[t("let-input",{attrs:{placeholder:e.$t("idc.update.addIp"),size:"small"},model:{value:e.addIp.addAllow,callback:function(t){e.$set(e.addIp,"addAllow",t)},expression:"addIp.addAllow"}})],1),t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addAllowIp}},[e._v(e._s(e.$t("operate.add")))]),t("let-form-item",{staticStyle:{"margin-left":"40px"},attrs:{itemWidth:"242px"}},[t("let-input",{attrs:{placeholder:e.$t("idc.update.addIp"),size:"small"},model:{value:e.addIp.addDenny,callback:function(t){e.$set(e.addIp,"addDenny",t)},expression:"addIp.addDenny"}})],1),t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addDennyIp}},[e._v(e._s(e.$t("operate.add")))])],1):e._e()],1)],1)},sa=[],ia={name:"OperationIDCManage",data:function(){return{showManualAddItem:!1,items:[],query:{group_name:""},detailModal:{show:!1,model:null,isNew:!1},ipOrders:["denny_allow","allow_denny"],allowList:[],dennyList:[],addIp:{addAllow:"",addDenny:""}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_idc",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},getIpList:function(e){var t=[];return""!=e.trim()&&e.split("|").forEach((function(e){t.push(e.trim())})),t},addGroup:function(){this.allowList=[],this.dennyList=[],this.detailModal.model={group_name:"",group_name_cn:"",ip_order:"denny_allow",allow_ip_rule:"",denny_ip_rule:"",allowList:[],dennyList:[]},this.detailModal.show=!0,this.detailModal.isNew=!0},editItem:function(e){var t=this,a=this.getIpList(e.allow_ip_rule),o=this.getIpList(e.denny_ip_rule);this.detailModal.model={allowList:[],dennyList:[]},this.detailModal.model=Object.assign({},this.detailModal.model,e),this.allowList=a,this.dennyList=o,a.forEach((function(e){t.detailModal.model.allowList.push(e)})),o.forEach((function(e){t.detailModal.model.dennyList.push(e)})),this.detailModal.show=!0,this.detailModal.isNew=!1},removeItem:function(e){var t=this;this.$confirm(this.$t("idc.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_idc",e).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/server/api/add_idc":"/server/api/update_idc",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null,this.detailModal.isNew=!1},addAllowIp:function(){if(this.validIp(this.addIp.addAllow)){if(this.allowList.includes(this.addIp.addAllow)&&this.detailModal.model.allowList.includes(this.addIp.addAllow))return void this.$tip.error("".concat(this.$t("idc.update.exists")));this.allowList.includes(this.addIp.addAllow)&&!this.detailModal.model.allowList.includes(this.addIp.addAllow)?(this.detailModal.model.allowList.push(this.addIp.addAllow),this.addIp.addAllow=""):(this.allowList.push(this.addIp.addAllow),this.detailModal.model.allowList.push(this.addIp.addAllow),this.addIp.addAllow="")}else this.$tip.error("".concat(this.$t("idc.update.errorIp")))},addDennyIp:function(){if(this.validIp(this.addIp.addDenny)){if(this.dennyList.includes(this.addIp.addDenny)&&this.detailModal.model.dennyList.includes(this.addIp.addDenny))return void this.$tip.error("".concat(this.$t("idc.update.exists")));this.dennyList.includes(this.addIp.addDenny)&&!this.detailModal.model.dennyList.includes(this.addIp.addDenny)?(this.detailModal.model.dennyList.push(this.addIp.addDenny),this.addIp.addDenny=""):(this.dennyList.push(this.addIp.addDenny),this.detailModal.model.dennyList.push(this.addIp.addDenny),this.addIp.addDenny="")}else this.$tip.error("".concat(this.$t("idc.update.errorIp")))},validIp:function(e){var t=new RegExp("^(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\.(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.((1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)|\\*)$");return t.test(e)}}},ra=ia,la=(a("d751"),Object(x["a"])(ra,oa,sa,!1,null,null,null)),na=la.exports,ca=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_approval"},[t("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[t("div",[t("span",[e._v(e._s(e.$t("deployService.title.baseRegistry"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.fetchRegistryData()}}})]),t("span",{staticStyle:{float:"right","margin-bottom":"10px"}},[t("el-button",{attrs:{type:"success",size:"small"},on:{click:e.showDockerLogin}},[e._v(e._s(e.$t("imageService.btn.docker"))+" ")]),e._v("    "),t("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addRegistryItem}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1)]),t("let-table",{ref:"tableRegistry",attrs:{data:e.baseRegistryLists,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("imageService.form.Registry"),prop:"registry",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.UserName"),prop:"username",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"remark",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.UpdateTime"),prop:"update_time"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"create_time"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editRegistryItem(a.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.removeRegistryItem(a.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),t("br"),t("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[t("div",[t("span",[e._v(e._s(e.$t("deployService.title.baseImage"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.fetchImageData()}}})]),t("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addImageItem}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),t("let-table",{ref:"table",attrs:{data:e.baseLists,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("imageService.form.Image"),prop:"image",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Registry"),prop:"registry",width:"10%"}}),t("let-table-column",{attrs:{title:"sha256",prop:"sha",width:"30%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"remark",width:"10%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Result"),prop:"result",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editImageItem(a.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.removeImageItem(a.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.pullImageItem(a.row)}}},[e._v(e._s(e.$t("operate.pull"))+" ")])]}}])})],1)],1),t("let-modal",{attrs:{title:e.baseRegistryModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),footShow:!1},model:{value:e.baseRegistryModal.show,callback:function(t){e.$set(e.baseRegistryModal,"show",t)},expression:"baseRegistryModal.show"}},[t("let-form",{ref:"detailRegistryForm",attrs:{rules:e.registryRules}},[t("let-form-item",{attrs:{label:e.$t("imageService.form.Registry")}},[t("let-input",{attrs:{size:"small",placeholder:"docker.io"},model:{value:e.baseRegistryModal.model.registry,callback:function(t){e.$set(e.baseRegistryModal.model,"registry",t)},expression:"baseRegistryModal.model.registry"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.UserName")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.UserName")},model:{value:e.baseRegistryModal.model.username,callback:function(t){e.$set(e.baseRegistryModal.model,"username",t)},expression:"baseRegistryModal.model.username"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Password")}},[t("let-input",{attrs:{size:"small",type:"password",placeholder:e.$t("imageService.form.Password")},model:{value:e.baseRegistryModal.model.password,callback:function(t){e.$set(e.baseRegistryModal.model,"password",t)},expression:"baseRegistryModal.model.password"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.baseRegistryModal.model.remark,callback:function(t){e.$set(e.baseRegistryModal.model,"remark",t)},expression:"baseRegistryModal.model.remark"}})],1),t("el-button",{attrs:{type:"success",size:"small"},on:{click:e.saveRegistryItem}},[e._v(e._s(e.$t("common.submit"))+" ")]),e._v("    "),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.baseRegistryModal.show=!1}}},[e._v(e._s(e.$t("common.cancel"))+" ")]),e._v("    "),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.checkDockerRegistry}},[e._v(e._s(e.$t("imageService.btn.checkRegistry"))+" ")])],1)],1),t("let-modal",{attrs:{title:e.baseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit")},on:{"on-confirm":e.saveImageItem},model:{value:e.baseModal.show,callback:function(t){e.$set(e.baseModal,"show",t)},expression:"baseModal.show"}},[t("let-form",{ref:"detailForm",attrs:{rules:e.rules,inline:""}},[t("let-form-item",{attrs:{label:e.$t("imageService.form.Registry"),required:""}},[t("let-select",{attrs:{size:"small"},model:{value:e.baseModal.model.registryId,callback:function(t){e.$set(e.baseModal.model,"registryId",t)},expression:"baseModal.model.registryId"}},e._l(e.baseRegistryLists,(function(a){return t("let-option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.registry+"("+a.remark+")"))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Image"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Image")},model:{value:e.baseModal.model.image,callback:function(t){e.$set(e.baseModal.model,"image",t)},expression:"baseModal.model.image"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.baseModal.model.remark,callback:function(t){e.$set(e.baseModal.model,"remark",t)},expression:"baseModal.model.remark"}})],1)],1)],1),t("let-modal",{attrs:{title:e.$t("imageService.btn.docker"),footShow:!1,width:"80%"},model:{value:e.nodeListModal.show,callback:function(t){e.$set(e.nodeListModal,"show",t)},expression:"nodeListModal.show"}},[t("el-table",{ref:"nodeListLoading",staticStyle:{margin:"10px"},attrs:{data:e.nodeListModal.nodeList,stripe:"","row-class-name":e.tableRowClassName,"empty-text":e.$t("common.nodata")},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80"}}),t("el-table-column",{attrs:{label:e.$t("nodeList.table.th.node_name"),prop:"node_name",width:"150"}}),t("el-table-column",{attrs:{label:e.$t("nodeList.table.th.present_state"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:"active"===a.row.present_state?"active":"inactive"},[e._v(e._s(a.row.present_state))])]}}])}),t("el-table-column",{attrs:{label:e.$t("nodeList.table.th.version"),prop:"tars_version",width:"200"}}),t("el-table-column",{attrs:{label:e.$t("nodeList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{domProps:{innerHTML:e._s(a.row.result)}})]}}])})],1),t("div",[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.forceDockerLogin}},[e._v(e._s(e.$t("imageService.btn.docker"))+" ")]),t("let-pagination",{staticStyle:{display:"inline",float:"right"},attrs:{page:e.nodeListModal.pageNum,total:e.nodeListModal.total},on:{change:e.gotoPage}})],1)],1)],1)},da=[],ma=(a("3ca3"),a("ddb0"),a("c740"),a("2ca0"),{name:"OperationImage",data:function(){return{baseRegistryLists:[],baseRegistryModal:{show:!1,model:{},isNew:!1},baseLists:[],nodeListModal:{show:!1,nodeList:[],pageNum:1,pageSize:20,total:1,multipleSelection:[]},baseModal:{show:!1,model:{},isNew:!1},registryRules:{remark:[{required:!0,message:"".concat(this.$t("imageService.node.markTip")),trigger:"blur"}]},rules:{image:[{required:!0,message:"".concat(this.$t("imageService.node.imageAddressTip")),trigger:"blur"}],remark:[{required:!0,message:"".concat(this.$t("imageService.node.markTip")),trigger:"blur"}]}}},mounted:function(){this.fetchRegistryData()},methods:{showDockerLogin:function(){this.nodeListModal.show=!0,this.getNodeList()},forceDockerLogin:function(){var e=this;return Object(J["a"])(Object(A["a"])().mark((function t(){var a,o;return Object(A["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=e.nodeListModal.multipleSelection.length){t.next=3;break}return e.$Notice({message:e.$t("imageService.form.Choose"),type:"warning"}),t.abrupt("return");case 3:a=Object(A["a"])().mark((function t(a){var o,s,i;return Object(A["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e.nodeListModal.multipleSelection[a].node_name,s=e.nodeListModal.nodeList.findIndex((function(e){return e.node_name==o})),e.nodeListModal.nodeList[s].result="docker login...",e.$set(e.nodeListModal.nodeList,s,e.nodeListModal.nodeList[s]),t.prev=4,t.next=7,e.$ajax.postJSON("/server/api/force_docker_login",{nodeName:o});case 7:i=t.sent,i.forEach((function(t){var a="";a=-1!=t.indexOf("Succeeded")?"color: green":"color: red",e.nodeListModal.nodeList[s].result+='<div style="'+a+'">'+t+"</div>"})),e.$set(e.nodeListModal.nodeList,s,e.nodeListModal.nodeList[s]),t.next=17;break;case 12:t.prev=12,t.t0=t["catch"](4),e.nodeListModal.nodeList[s].result+='<div style="red">'+"".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg)+"</div>",e.$set(e.nodeListModal.nodeList,s,e.nodeListModal.nodeList[s]),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[4,12]])})),o=0;case 5:if(!(o<e.nodeListModal.multipleSelection.length)){t.next=10;break}return t.delegateYield(a(o),"t0",7);case 7:o++,t.next=5;break;case 10:case"end":return t.stop()}}),t)})))()},handleSelectionChange:function(e){this.nodeListModal.multipleSelection=e},fetchRegistryData:function(){var e=this,t=this.$refs.tableRegistry.$loading.show();return this.$ajax.getJSON("/server/api/base_registry").then((function(a){t.hide(),e.baseRegistryLists=a,e.baseRegistryLists.forEach((function(e){e.create_time=Ct()(e.create_time).format("YYYY-MM-DD HH:mm:ss"),e.update_time=Ct()(e.update_time).format("YYYY-MM-DD HH:mm:ss")})),e.fetchImageData()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},checkDockerRegistry:function(){var e=this,t=this.$refs.tableRegistry.$loading.show();return this.baseRegistryModal.model.registry&&""!=this.baseRegistryModal.model.registry||(this.baseRegistryModal.model.registry="docker.io"),this.$ajax.postJSON("/server/api/check_docker_registry",this.baseRegistryModal.model).then((function(a){t.hide(),e.$tip.success(a)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},saveRegistryItem:function(){var e=this,t=this.$refs.tableRegistry.$loading.show();return this.baseRegistryModal.model.registry&&""!=this.baseRegistryModal.model.registry||(this.baseRegistryModal.model.registry="docker.io"),this.$ajax.postJSON(this.baseRegistryModal.isNew?"/server/api/add_registry":"/server/api/update_registry",this.baseRegistryModal.model).then((function(a){t.hide(),e.baseRegistryModal.show=!1,e.fetchRegistryData(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},addRegistryItem:function(){this.baseRegistryModal.show=!0,this.baseRegistryModal.model={},this.baseRegistryModal.isNew=!0},editRegistryItem:function(e){this.baseRegistryModal.show=!0,this.baseRegistryModal.model=e,this.baseRegistryModal.isNew=!1},removeRegistryItem:function(e){var t=this;this.$confirm(this.$t("imageService.form.DeleteRegistryTips"),this.$t("common.alert")).then((function(){var a=t.$refs.tableRegistry.$loading.show();return t.$ajax.postJSON("/server/api/delete_registry",{id:e.id}).then((function(e){a.hide(),t.fetchRegistryData()})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},fetchImageData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/base_image",{offset:0,limit:-1}).then((function(a){t.hide(),e.baseLists=a.rows,e.baseLists.forEach((function(t){t.create_time=Ct()(t.create_time).format("YYYY-MM-DD HH:mm:ss");var a=e.baseRegistryLists.filter((function(e){return e.id==t.registryId}));0==a.length?t.registry="error!!":t.registry=a[0].registry,t.update_time=Ct()(t.update_time).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},saveImageItem:function(){var e=this,t=this.baseRegistryLists.filter((function(t){return t.id==e.baseModal.model.registryId}))[0];if(t){if("docker.io"==t.registry||this.baseModal.model.image.startsWith(t.registry)){-1==this.baseModal.model.image.indexOf(":")&&(this.baseModal.model.image=this.baseModal.model.image+":latest");var a=this.$refs.table.$loading.show();return this.$ajax.postJSON(this.baseModal.isNew?"/server/api/add_image":"/server/api/update_image",this.baseModal.model).then((function(t){a.hide(),e.baseModal.show=!1,e.fetchImageData(),e.$tip.success(e.$t("common.success"))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}this.$tip.error("".concat(this.$t("imageService.btn.imageTips")))}else this.$tip.error("".concat(this.$t("common.error")))},addImageItem:function(){this.baseModal.show=!0,this.baseModal.model={},this.baseModal.isNew=!0},editImageItem:function(e){this.baseModal.show=!0,this.baseModal.isNew=!1,this.baseModal.model=e},removeImageItem:function(e){var t=this;this.$confirm(this.$t("imageService.form.DeleteImageTips"),this.$t("common.alert")).then((function(){var a=t.$refs.table.$loading.show();return t.$ajax.postJSON("/server/api/delete_image",{id:e.id}).then((function(e){a.hide(),t.fetchImageData()})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},pullImageItem:function(e){var t=this;this.$ajax.postJSON("/server/api/docker_pull",{id:e.id}).then((function(e){t.$tip.success("succ")})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"active"===t.present_state?"red-row":""},getNodeList:function(e){var t=this,a=this.$refs.nodeListLoading.$loading.show();e||(e=this.nodeListModal.pageNum||1),this.$ajax.getJSON("/server/api/list_tars_node",{node_name:"",page_size:this.nodeListModal.pageSize,curr_page:e}).then((function(o){a.hide(),t.nodeListModal.pageNum=e,t.nodeListModal.total=(o.count+1)/t.nodeListModal.pageSize,t.nodeListModal.nodeList=o.rows,t.nodeListModal.nodeList.forEach((function(e){e.last_heartbeat=Ct()(e.last_heartbeat).format("YYYY-MM-DD HH:mm:ss"),e.last_reg_time=Ct()(e.last_reg_time).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},gotoPage:function(e){this.getNodeList(e)}}}),ua=ma,pa=(a("4c4f"),Object(x["a"])(ua,ca,da,!1,null,"2dbf6346",null)),ha=pa.exports,fa=a("6414"),_a=a("9ea2"),va=a("5935");o["default"].use(q["a"]);var ga=q["a"].prototype.push;q["a"].prototype.push=function(e){return ga.call(this,e).catch((function(e){return e}))};var ba=q["a"].prototype.replace;q["a"].prototype.replace=function(e){return ba.call(this,e).catch((function(e){return e}))};var $a=function(e){return{default:e,market:va["a"]}},wa=new q["a"]({routes:[{path:"/server",name:"Server",components:$a(Je),children:[{path:":treeid/manage",component:le},{path:":treeid/publish",component:$e},{path:":treeid/config",component:Ce},{path:":treeid/server-monitor",component:qe["a"]},{path:":treeid/property-monitor",component:je["a"]},{path:":treeid/user-manage",component:Re["a"]},{path:":treeid/plugins",component:ze["a"]}]},{path:"/operation",name:"Operation",components:$a(Ge),redirect:"/operation/deploy",children:[{path:"deploy",component:dt},{path:"expand",component:gt},{path:"templates",component:kt},{path:"nodes",component:It},{path:"check",component:zt},{path:"application",component:Wt},{path:"business",component:Gt},{path:"businessRelation",component:aa},{path:"idc",component:na},{path:"image",component:ha},{path:"plugins/*",component:He["a"]}]},{path:"/market",name:"Market",components:{market:va["a"]}},{path:"/plugins/*",name:"Plugin",components:$a(_a["a"])},{path:"/plugins-manage",name:"PluginManage",components:$a(fa["a"])},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}}),ya=a("f51c");o["default"].config.productionTip=!1,ya["b"].call(void 0).then((function(){o["default"].use(n.a,{i18n:function(e,t){return ya["a"].t(e,t)}}),o["default"].use(r.a),new o["default"]({i18n:ya["a"],el:"#app",store:s["a"],router:wa,components:{indexApp:O},template:"<indexApp/>"})}))},c8a3:function(e,t,a){},cf77:function(e,t,a){},d687:function(e,t,a){"use strict";a("9d68")},d751:function(e,t,a){"use strict";a("6dd0")},da6c:function(e,t,a){},e3d0:function(e,t,a){"use strict";a("cf77")},e4a0:function(e,t,a){},eb07:function(e,t,a){"use strict";a("a7420")},ebcc:function(e,t,a){},ebdf:function(e,t,a){"use strict";a("c8a3")},ecd7:function(e,t,a){"use strict";a("606f")}});