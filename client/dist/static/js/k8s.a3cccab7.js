(function(e){function t(t){for(var o,s,l=t[0],n=t[1],c=t[2],u=0,p=[];u<l.length;u++)s=l[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],o=!0,l=1;l<a.length;l++){var n=a[l];0!==r[n]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=a[0]))}return e}var o={},r={k8s:0},i=[];function s(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=o,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(a,o,function(t){return e[t]}.bind(null,o));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],n=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=n;i.push([2,"chunk-vendors","chunk-common"]),a()})({"04e5":function(e,t,a){"use strict";var o=a("e93e"),r=a.n(o);r.a},"097a":function(e,t,a){},"0b66":function(e,t,a){"use strict";var o=a("097a"),r=a.n(o);r.a},"0d3c":function(e,t,a){"use strict";var o=a("8f5f"),r=a.n(o);r.a},"0d43":function(e,t,a){},"11e0":function(e,t,a){},"168e":function(e,t,a){},"1a6b":function(e,t,a){"use strict";var o=a("b697"),r=a.n(o);r.a},2:function(e,t,a){e.exports=a("4933")},"24ee":function(e,t,a){},"29ca":function(e,t,a){"use strict";var o=a("c49e"),r=a.n(o);r.a},3976:function(e,t,a){"use strict";var o=a("11e0"),r=a.n(o);r.a},"3d87":function(e,t,a){},4193:function(e,t,a){"use strict";var o=a("9bc2"),r=a.n(o);r.a},"437c":function(e,t,a){},"44ae":function(e,t,a){"use strict";var o=a("b2b3"),r=a.n(o);r.a},4933:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("a026"),r=a("42a2a"),i=(a("b3f5"),a("f77c"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("k8s-header"),a("keep-alive",[a("router-view",{staticClass:"main-width"})],1)],1)}),s=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_index__header"},[a("div",{staticClass:"main-width"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"logo-wrap"},["true"===e.enable&&"true"===e.show?a("a",{attrs:{href:"/tars.html"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]):e._e(),"true"===e.k8s?a("a",{class:{active:!0},attrs:{href:"/k8s.html"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/K8S.png"}})]):e._e()])]),a("el-col",{attrs:{span:9}},[a("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0].path},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab2"),tabkey:"/operation",icon:e.opaIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab9"),tabkey:"/market",icon:e.packageIcon}})],1)],1),a("el-col",{attrs:{span:3}},[a("div",{staticClass:"plugin-wrap"},[a("extentionSelect")],1)]),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"language-wrap"},[a("localeSelect")],1),a("div",{staticClass:"version-wrap"},[a("div",[e._v("web:"+e._s(e.web_version))]),a("el-link",{staticStyle:{"font-size":"9px"},attrs:{href:"https://doc.tarsyun.com",target:"_blank"}},[e._v(e._s("cn"==e.locale?"在线文档":"Online Manual"))])],1)]),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"user-wrap"},[a("el-dropdown",{staticStyle:{display:"block !important"},on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.uid)),a("i",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{command:"center"}},[e._v(e._s(e.$t("header.userCenter")))]),a("el-dropdown-item",{attrs:{command:"modifyPass"}},[e._v(e._s(e.$t("header.modifyPass")))]),a("el-dropdown-item",{attrs:{command:"quit"}},[e._v(e._s(e.$t("header.logout")))])],1)],1)],1)])],1)],1)])},n=[],c=(a("ac1f"),a("5319"),a("1817")),d=a.n(c),u=a("1ca6"),p=a.n(u),m=a("4d18"),h=a.n(m),f=a("cc08"),v=a.n(f),g=a("3e1a"),b=a.n(g),$=a("00b0"),_=a("3841"),y=a("bc3a"),w=a.n(y),k={components:{localeSelect:$["a"],extentionSelect:_["a"]},data:function(){return{serverIcon:d.a,opaIcon:p.a,releaseIcon:h.a,cacheIcon:v.a,operatorIcon:b.a,packageIcon:h.a,locale:this.$cookie.get("locale")||"cn",uid:"--",enableLogin:!1,isAdmin:!1,k8s:this.$cookie.get("k8s")||"false",enable:this.$cookie.get("enable")||"false",show:this.$cookie.get("show")||"false",web_version:"loading··",enableLdap:!1}},computed:{marketUid:function(){return this.$store.state.marketUid}},methods:{handleCommand:function(e){"center"==e?location.href="/auth.html":"modifyPass"==e&&(location.href="/pass.html"),"quit"==e&&(location.href="/pages/server/api/logout")},clickTab:function(e){this.$router.replace(e)},userCenter:function(){window.open("/pages/server/api/userCenter")},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?e.uid=t.uid:e.uid="***"})).catch((function(t){e.$tip.error("获取用户登录信息: ".concat(t.err_msg||t.message))}))},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))},checkEnableLdap:function(){var e=this;this.$ajax.getJSON("/server/api/isEnableLdap").then((function(t){e.enableLdap=t.enableLdap||!1})).catch((function(e){}))},checkAdmin:function(){var e=this;this.isAdmin=!1,this.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){}))}},mounted:function(){var e=this;this.getLoginUid(),this.checkEnableLogin(),this.checkAdmin(),this.checkEnableLdap(),w.a.create({baseURL:"/"})({method:"get",url:"/web/k8s_version"}).then((function(t){e.web_version=t.data,e.$store.commit({type:"version",version:e.web_version})})),window.header=this}},S=k,M=(a("c219"),a("2877")),x=Object(M["a"])(S,l,n,!1,null,null,null),C=x.exports,D=a("559f"),N={name:"App",components:{K8sHeader:C,AppFooter:D["a"]},data:function(){return{}},mounted:function(){}},T=N,L=(a("7b9a"),Object(M["a"])(T,i,s,!1,null,null,null)),I=L.exports,A=a("8c4f"),O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server"},[a("div",{staticClass:"left-view"},[a("div",{staticClass:"tree_search"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.treeSearchKey,expression:"treeSearchKey"}],staticClass:"tree_search_key",attrs:{placeholder:e.$t("home.placeholder")},domProps:{value:e.treeSearchKey},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filterTextChange(t)},input:function(t){t.target.composing||(e.treeSearchKey=t.target.value)}}}),a("i",{staticClass:"el-icon-refresh-right",class:{active:e.isIconPlay},staticStyle:{"z-index":"99"},on:{click:function(t){return e.treeSearch(1)}}})]),a("div",{staticClass:"tree_wrap"},[e.treeData&&e.treeData.length?a("el-tree",{ref:"trees",staticClass:"left-tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,"highlight-current":"","empty-text":e.$t("common.noService"),"node-key":"id"},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("el-tooltip",{attrs:{content:o.name+"("+o.serverType+")",placement:"bottom-start",effect:"light","open-delay":e.openDelay}},[a("span",[2==o.type?a("i",{class:e._f("serverTypeFilter")(o.serverType)}):e._e(),e._v(" "+e._s(o.name)+" ")])])],1)}}],null,!1,4191436028)}):e._e(),e.treeData?e._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"left-tree"},[!1===e.treeData?a("div",{staticClass:"loading"},[a("p",[e._v(e._s(e.treeErrMsg))]),a("a",{attrs:{href:"javascript:;"},on:{click:e.getTreeData}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()])],1)]),a("div",{staticClass:"right-view"},[a("div",{staticClass:"btabs_wrap"},[a("ul",{directives:[{name:"vscroll",rawName:"v-vscroll"}],ref:"btabs",staticClass:"btabs"},[a("li",{key:e.homeTab,staticClass:"btabs_item",class:{active:e.homeTab===e.treeid}},[a("a",{staticClass:"btabs_link",staticStyle:{"padding-right":"20px"},attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,e.homeTab)}}},[e._v(" "+e._s(e.$t("home.homeTab"))+" ")])]),e._l(e.BTabs,(function(t){return a("li",{key:t.id,staticClass:"btabs_item",class:{active:t.id===e.treeid}},[a("a",{staticClass:"btabs_link",attrs:{href:"javascript:;"},on:{click:function(a){return e.clickBTabs(a,t.id)}}},[e._v(e._s(e.getNewServerName(t.id)))]),a("a",{staticClass:"btabs_close",attrs:{href:"javascript:;"},on:{click:function(a){return e.closeBTabs(t.id)}}},[e._v(" "+e._s(e.$t("home.close")))])])}))],2),a("a",{staticClass:"btabs_all",attrs:{href:"javascript:;",title:e.$t("home.closeAll")},on:{click:e.closeAllBTabs}},[e._v(" "+e._s(e.$t("home.closeAll")))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.treeid===e.homeTab,expression:"treeid === homeTab"}],staticClass:"btabs_con_home",staticStyle:{height:"800px"}},[a("serverHistory")],1),a("div",{staticClass:"btabs_con"},e._l(e.BTabs,(function(t){return t.id===e.treeid?a("div",{key:t.id,staticClass:"btabs_con_item"},[a("el-tabs",{on:{"tab-click":e.clickTab},model:{value:t.path,callback:function(a){e.$set(t,"path",a)},expression:"item.path"}},[a("el-tab-pane",{attrs:{name:e.base+"/manage",label:e.$t("header.tab.tab1")}}),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/history",label:e.$t("header.tab.tab7")}}):e._e(),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/publish",label:e.$t("index.rightView.tab.patch")}}):e._e(),5===e.serverData.level||1===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/config",label:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}):e._e(),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/server-monitor",label:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/property-monitor",label:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/user-manage",label:e.$t("index.rightView.tab.privileage")}}):e._e(),5===e.serverData.level?a("el-tab-pane",{attrs:{name:e.base+"/callChain",label:e.$t("index.rightView.tab.treeConfig")}}):e._e(),e._l(e.plugins,(function(t){return 5===e.serverData.level?a("el-tab-pane",{key:t.f_id,attrs:{name:e.base+t.f_path+"/plugins",label:t.f_name}}):e._e()}))],2),a(e.getName(t.path),{ref:"childView",refInFor:!0,tag:"router-view",staticClass:"page_server_child",attrs:{treeid:t.id,path:t.pluginPath,k8s:!0}})],1):e._e()})),0)])])},j=[],P=(a("99af"),a("4de4"),a("4160"),a("c975"),a("baa5"),a("a434"),a("b0c0"),a("1276"),a("159b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",{staticStyle:{float:"left"}},[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})]),e.isApplication?e._e():a("span",{staticClass:"btn_group",staticStyle:{float:"right"}},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.manageK8S}},[e._v(e._s(e.$t("operate.k8s")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.configServer}},[e._v(e._s(e.$t("operate.server")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.manageServant}},[e._v(e._s(e.$t("operate.servant")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.viewTemplate}},[e._v(e._s(e.$t("operate.viewTemplate")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.privateTemplateManage}},[e._v(e._s(e.$t("operate.privateTemplateManage")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.startServer}},[e._v(e._s(e.$t("operate.startServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.restartServer}},[e._v(e._s(e.$t("operate.restartServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.stopServer}},[e._v(e._s(e.$t("operate.stopServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.showMoreCmd}},[e._v(e._s(e.$t("operate.more")))])],1)]),e.serverList?a("div",{ref:"serverListLoading"},[a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{on:{change:function(a){return e.checkChange(t.row)}},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,3049151486)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.subtype")},scopedSlots:e._u([{key:"default",fn:function(t){return["normal"==t.row.SubType?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Normal Server",placement:"top"}},[a("i",{staticClass:"el-icon-menu"})]):e._e(),"tars"==t.row.SubType?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Tars Server(manage by tarsnode)",placement:"top"}},[a("i",{staticClass:"el-icon-monitor"})]):e._e()]}}],null,!1,3327796356)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.readPodLog(t.row.PodName)}}},[e._v(e._s(t.row.ServerName)+" "),t.row.Source["tars.io/CloudInstall"]?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.Source["tars.io/CloudInstall"].group+"/"+t.row.Source["tars.io/CloudInstall"].name+":"+t.row.Source["tars.io/CloudInstall"].version,placement:"top-start"}},[a("i",{staticClass:"el-icon-cloudy",staticStyle:{cursor:"pointer"},on:{click:function(a){return e.goMarket(t.row)}}})]):e._e()],1)]}}],null,!1,2382412937)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:"pid"},scopedSlots:e._u([{key:"default",fn:function(t){return"tars"==t.row.SubType?[e._v(" "+e._s(t.row.Pid)+" ")]:void 0}}],null,!0)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.SettingState)},[e._v(e._s(t.row.SettingState))])]}}],null,!1,987565344)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.PresentState)},[e._v(e._s(t.row.PresentState))])]}}],null,!1,1754665792)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:t.row.PresentMessage||""}},[a("let-table-operation",[a("span",{staticClass:"over",on:{click:function(a){return e.describePod(t.row)}}},[e._v(e._s(t.row.PresentMessage))])])],1)]}}],null,!1,640804383)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.deletePod(t.row)}}},[e._v(e._s(e.$t("operate.deletePod"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.viewEvent(t.row)}}},[e._v(e._s(e.$t("operate.viewEvent"))+" ")])]}}],null,!1,702003604)})],1)],1):e._e(),a("div",{staticClass:"table_head"},[e.serverNotifyList&&e.showOthers?a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverStatus"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerNotifyList()}}},[e._v("")])]):e._e()]),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,stripe:"","empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.timeStr))])]}}],null,!1,3973901746)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"AppServer"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.app+"."+t.row._source.server))])]}}],null,!1,4255247636)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.podName))])]}}],null,!1,1996751150)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.source"),prop:"NotifySource"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.source))])]}}],null,!1,1994068079)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"NotifyMessage"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.statusStyle(t.row._source.message)},[e._v(e._s(t.row._source.message))])]}}],null,!1,2929402306)})],1):e._e(),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.notifyPagination.page,total:e.notifyPagination.total},on:{change:e.notifyGotoPage}})],1),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!!e.configModal.model},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ServerTemplate,callback:function(t){e.$set(e.configModal.model,"ServerTemplate",t)},expression:"configModal.model.ServerTemplate"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t.TemplateName,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName)+" ")])})),1):a("span",[e._v(e._s(e.configModal.model.ServerTemplate))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.dlg.placeholder.thread")},model:{value:e.configModal.model.AsyncThread,callback:function(t){e.$set(e.configModal.model,"AsyncThread",t)},expression:"configModal.model.AsyncThread"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:10},model:{value:e.configModal.model.ServerProfile,callback:function(t){e.$set(e.configModal.model,"ServerProfile",t)},expression:"configModal.model.ServerProfile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant ")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"OBJ",prop:"Name"}}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),prop:"Port"}}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTars?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3719090988)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTcp?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.AdapterId)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.AdapterId)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2769818527)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantAddModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"1200px",footShow:!!e.servantAddModal.model},on:{"on-confirm":e.saveServantAdd,close:e.closeServantAddModal,"on-cancel":e.closeServantAddModal},model:{value:e.servantAddModal.show,callback:function(t){e.$set(e.servantAddModal,"show",t)},expression:"servantAddModal.show"}},[e.servantAddModal.model&&e.servantAddModal.model.ServerServant?a("let-form",{ref:"servantAddForm"},[a("let-table",{attrs:{data:e.servantAddModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.Name,callback:function(a){e.$set(t.row,"Name",a)},expression:"props.row.Name"}})]}}],null,!1,3758810427)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Port,callback:function(a){e.$set(t.row,"Port",a)},expression:"props.row.Port"}})]}}],null,!1,2319070108)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,1519152386)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3031957841)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Threads,callback:function(a){e.$set(t.row,"Threads",a)},expression:"props.row.Threads"}})]}}],null,!1,1655720946)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Connections,callback:function(a){e.$set(t.row,"Connections",a)},expression:"props.row.Connections"}})]}}],null,!1,2060048682)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Capacity,callback:function(a){e.$set(t.row,"Capacity",a)},expression:"props.row.Capacity"}})]}}],null,!1,58581595)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:t.row.Timeout,callback:function(a){e.$set(t.row,"Timeout",a)},expression:"props.row.Timeout"}})]}}],null,!1,1471836343)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index===e.servantAddModal.model.ServerServant.length-1?a("let-table-operation",{on:{click:function(a){return e.addAdapter(t.row)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]):a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.servantAddModal.model.ServerServant.splice(t.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,1130946150)})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model&&1===e.servantDetailModal.model.ServerServant.length?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z0-9]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.ServerServant[0].Name,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Name",t)},expression:"servantDetailModal.model.ServerServant[0].Name"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.port"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.servantDetailModal.model.ServerServant[0].Port,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Port",t)},expression:"servantDetailModal.model.ServerServant[0].Port"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.ServerServant[0].Threads,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Threads",t)},expression:"servantDetailModal.model.ServerServant[0].Threads"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Connections,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Connections",t)},expression:"servantDetailModal.model.ServerServant[0].Connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Capacity,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Capacity",t)},expression:"servantDetailModal.model.ServerServant[0].Capacity"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Timeout,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Timeout",t)},expression:"servantDetailModal.model.ServerServant[0].Timeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("NOT TARS")])],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.portType"),required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("UDP")])],1)],1):e._e()],1),a("k8sManager",{ref:"k8s"}),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.logLevel"))+" ")]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.pushFile"))+" ")]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(" "+e._s(t.filename)+" ")])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.sendCommand"))+" ")]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.serviceLink"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.detailModal.title,width:"700px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[a("div",{staticStyle:{padding:"20px 0 0"}},[e.detailModal.model&&e.detailModal.model.detail?a("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),a("div",{ref:"detailModalLoading",staticClass:"detail-loading"})])]),a("let-modal",{attrs:{title:"Pod",width:"70%",footShow:!1},on:{close:e.closePodYaml},model:{value:e.showPodYaml,callback:function(t){e.showPodYaml=t},expression:"showPodYaml"}},[a("div",{staticStyle:{padding:"20px 0 0"}},[e.showPodYaml?a("yaml-editor",{ref:"yamlEdit",staticStyle:{margin:"1px"},model:{value:e.podYaml,callback:function(t){e.podYaml=t},expression:"podYaml"}}):e._e()],1)]),a("log",{ref:"log"}),a("el-dialog",{attrs:{visible:e.dialogCommandVisible,width:"80%"},on:{"update:visible":function(t){e.dialogCommandVisible=t}}},[a("span",{domProps:{innerHTML:e._s(e.commandHTML)}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogCommandVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))])],1)])],1)}),q=[],z=(a("7db0"),a("d81d"),a("96cf"),a("1da1")),E=a("5530"),R=a("dcab"),B=a("c1df"),J=a.n(B),V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.DetailModel.show?a("el-dialog",{attrs:{title:e.$t("operate.k8s"),visible:e.DetailModel.show,width:"1060px","before-close":e.closeDetailModel,top:"10px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.DetailModel,"show",t)}}},[a("el-collapse",{attrs:{accordion:""},on:{change:e.HandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"copyNode"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.copyNode")))])]),e.k8sModel?a("replicas",{attrs:{replicas:e.k8sModel.Replicas},on:{saveReplicas:e.saveReplicas}}):e._e()],2),a("el-collapse-item",{attrs:{name:"pull"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.pull")))])]),e.k8sModel?a("pull",{attrs:{pull:e.k8sModel.imagePullPolicy},on:{savePull:e.savePull}}):e._e()],2),a("el-collapse-item",{attrs:{name:"stacked"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.stacked")))])]),e.k8sModel?a("stacked",{attrs:{notStacked:e.k8sModel.notStacked},on:{saveStacked:e.saveStacked}}):e._e()],2),a("el-collapse-item",{attrs:{name:"jobModel"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.jobModel")))])]),e.k8sModel?a("jobModel",{attrs:{daemonSet:e.k8sModel.daemonSet},on:{saveJobModel:e.saveJobModel}}):e._e()],2),a("el-collapse-item",{attrs:{name:"launcherType"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.launcherType")))])]),e.k8sModel?a("launcher-type",{attrs:{launcherType:e.k8sModel.launcherType},on:{saveLauncherType:e.saveLauncherType}}):e._e()],2),a("el-collapse-item",{attrs:{name:"nodeSelect"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),e.k8sModel?a("abilityAffinity",{attrs:{k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator},on:{saveAffinity:e.saveAffinity}}):e._e()],2),a("el-collapse-item",{attrs:{name:"network"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.network")))])]),e.k8sModel?a("network-mapping",{attrs:{k8sModel:e.k8sModel},on:{saveNetwork:e.saveNetwork}}):e._e()],2),a("el-collapse-item",{attrs:{name:"disk"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.disk")))])]),e.k8sModel?a("disk-manger",{attrs:{k8sModel:e.k8sModel,mounts:e.mounts},on:{saveDisk:e.saveDisk}}):e._e()],2),a("el-collapse-item",{attrs:{name:"resource"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.resource")))])]),e.k8sModel?a("resource-manger",{attrs:{sourceModel:e.sourceModel},on:{saveResource:e.saveResource}}):e._e()],2),a("el-collapse-item",{attrs:{name:"hpa"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.hpa")))])]),a("div",[e.k8sModel?a("hpa-manger",{attrs:{hpaModel:e.hpaModel,serverData:e.serverData,sourceModel:e.sourceModel,indicators:e.indicators},on:{saveHpa:e.saveHpa}}):e._e()],1)],2),a("el-collapse-item",{attrs:{name:"yaml"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.yaml")))])]),a("k8s-yaml-edit",{ref:"yamlEdit",on:{flushOthers:e.show}})],2)],1)],1):e._e()},H=[],F=(a("c740"),a("b64b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[a("el-input",{attrs:{size:"small",type:"number",min:0,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1)],1)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)}),Y=[],W={props:["replicas","install"],name:"ReplicasK8S",data:function(){return{inputValue:this.replicas}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveReplicas",this.inputValue)}}},K=W,U=Object(M["a"])(K,F,Y,!1,null,null,null),Z=U.exports,G=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("operate.pull"),itemWidth:"45%",required:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},e._l(e.pulls,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1)],1)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},Q=[],X={props:["pull","install"],name:"PullK8S",data:function(){return{inputValue:this.pull,pulls:["Always","IfNotPresent","Never"]}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("savePull",this.inputValue)}}},ee=X,te=Object(M["a"])(ee,G,Q,!1,null,null,null),ae=te.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("operate.launcherType"),itemWidth:"45%"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},e._l(e.launcherTypes,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1),a("el-alert",{staticStyle:{"margin-top":"5px","margin-bottom":"5px"},attrs:{title:e.$t("operate.backgroundInfo"),"show-icon":"",closable:!1,type:"warning"}}),a("el-alert",{attrs:{title:e.$t("operate.foregroundInfo"),"show-icon":"",closable:!1,type:"warning"}})],1)],1)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},re=[],ie={props:["launcherType","install"],name:"LauncherType",data:function(){return{inputValue:this.launcherType,launcherTypes:["background","foreground"]}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveLauncherType",this.inputValue)}}},se=ie,le=Object(M["a"])(se,oe,re,!1,null,null,null),ne=le.exports,ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("operate.stacked"),itemWidth:"60%"}},[a("el-switch",{attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("ON")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("OFF")])]),a("el-alert",{staticStyle:{"margin-top":"5px","margin-bottom":"5px"},attrs:{title:e.$t("operate.stackedInvalid"),"show-icon":"",closable:!1,type:"warning"}}),a("el-alert",{attrs:{title:e.$t("operate.stackedInfo"),"show-icon":"",closable:!1,type:"warning"}})],1)],1)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},de=[],ue={props:["notStacked","install"],name:"stackedK8S",data:function(){return{inputValue:!this.notStacked}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveStacked",!this.inputValue)}}},pe=ue,me=Object(M["a"])(pe,ce,de,!1,null,null,null),he=me.exports,fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("operate.jobModel"),itemWidth:"45%",required:""}},[a("el-switch",{attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("DaemonSet")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("StatefullSet")])])],1)],1)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},ve=[],ge={props:["daemonSet","install"],name:"JobModel",data:function(){return{inputValue:this.daemonSet}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveJobModel",this.inputValue)}}},be=ge,$e=Object(M["a"])(be,fe,ve,!1,null,null,null),_e=$e.exports,ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.k8sModelData?a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("el-form-item",{attrs:{label:e.$t("deployService.form.affinity"),itemWidth:"100%"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.k8sModelData.abilityAffinity,callback:function(t){e.$set(e.k8sModelData,"abilityAffinity",t)},expression:"k8sModelData.abilityAffinity"}},e._l(e.abilityAffinities,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1),a("el-alert",{staticStyle:{margin:"5px"},attrs:{size:"small",type:"warning"}},[e._v("AppRequired:在满足其他条件后,节点必须有tars.io/ability.${namespace}.${App} 标签")]),a("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("ServerRequired: 在满足其他条件后,节点必须有tars.io/ability.${namespace}.${App}-${Server} 标签")]),a("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("AppOrServerPreferred: 在满足其他条件后,优先选择有tars.io/ability.${namespace}.${App}-${Server}, tars.io/ability.${namespace}.${App} 标签的节点")]),a("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("None: 不对节点标签做要求")])],1),0==e.labelMatchArrData.length?a("el-form-item",{attrs:{itemWidth:"45%"}},[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addItems(0,e.labelMatchArrData)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1):e._e(),e._l(e.labelMatchArrData,(function(t,o){return a("div",{key:o},[a("el-form-item",{attrs:{label:e.$t("deployService.table.th.label"),itemWidth:"30%"}},[a("el-input",{attrs:{size:"small",placeholder:e.$t("deployService.table.th.label"),"pattern-tip":e.$t("deployService.form.labelMatch.labelValid")},model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}})],1),a("el-form-item",{attrs:{label:"operator",itemWidth:"15%"}},[a("el-select",{attrs:{size:"small"},on:{change:e.changeLabelOperator},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"item.operator"}},e._l(e.LabelMatchOperator,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("el-form-item",{attrs:{label:e.$t("deployService.table.th.value"),itemWidth:"40%"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{disabled:t.disableValue,multiple:"",filterable:"","allow-create":"","multiple-limit":63,"default-first-option":"",placeholder:e.$t("deployService.form.labelMatch.labelValue"),size:"small"},on:{change:function(t){e.addLabelValues(t,o)}},model:{value:t.values,callback:function(a){e.$set(t,"values",a)},expression:"item.values"}},e._l(t.values,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",circle:""},on:{click:function(t){return e.addItems(o,e.labelMatchArrData)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-minus",size:"mini",circle:""},on:{click:function(t){return e.delItems(o,e.labelMatchArrData)}}})],1)}))],2)]),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1):e._e()},we=[],ke=(a("d3b7"),a("498a"),a("ddb0"),a("b85c")),Se={props:["k8sModel","labelMatchArr","LabelMatchOperator","install"],name:"AbilityAffinity",data:function(){return{k8sModelData:null,abilityAffinities:["AppRequired","ServerRequired","AppOrServerPreferred","None"]}},mounted:function(){this.k8sModelData=this.k8sModel,this.labelMatchArrData=this.labelMatchArr},methods:{changeKind:function(){this.$forceUpdate()},adapterServerK8S:function(e){var t=Object.assign({},e),a=this.labelMatchArrData.map((function(e){return{key:e.key,operator:e.operator,values:e.values}}));return t.NodeSelector=a,t},save:function(){if(this.$refs.k8sDetailForm.validate()&&this.validateLabels()){var e=this.adapterServerK8S(this.k8sModelData);this.$emit("saveAffinity",e)}},validateLabels:function(e){var t,a=!0,o=Object(ke["a"])(this.labelMatchArrData);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(""==r.key.trim()){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorKey"))),a=!1;break}if(-1=="Exists,DoesNotExist".indexOf(r.operator)&&0==r.values.length){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorValue"))),a=!1;break}}}catch(i){o.e(i)}finally{o.f()}return a},addLabelValues:function(e,t){var a=this,o=/^([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]?$/;this.labelMatchArrData[t].values.forEach((function(e,t){o.test(e)||(a.labelMatchArrData[t].values.splice(t,1),a.$message.error("".concat(a.$t("deployService.form.labelMatch.labelValueValid"))))}))},changeLabelOperator:function(e){var t=this;this.labelMatchArrData.forEach((function(e){"Exists"==e.operator||"DoesNotExist"==e.operator?(t.$set(e,"disableValue",!0),t.$set(e,"values",[])):t.$set(e,"disableValue",!1)}))},addItems:function(e,t){t.length>=63?this.$message.error("".concat(this.$t("deployService.form.labelMatch.labelMax"))):(t.splice(e+1,0,{key:"",operator:"In",values:[]}),this.$forceUpdate())},delItems:function(e,t){t.splice(e,1),this.$forceUpdate()}}},Me=Se,xe=Object(M["a"])(Me,ye,we,!1,null,null,null),Ce=xe.exports,De=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.k8sData?a("el-card",{staticStyle:{padding:"5px"},attrs:{shadow:"never"}},[a("el-form",{ref:"k8sDetailForm",attrs:{inline:"","label-position":"top"}},[a("div",[a("el-row",{attrs:{gutter:18}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostIpc"),"label-width":"200px"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.HostIpc,callback:function(t){e.$set(e.k8sData,"HostIpc",t)},expression:"k8sData.HostIpc"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostNetwork"),"label-width":"200px"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.HostNetwork,callback:function(t){e.$set(e.k8sData,"HostNetwork",t)},expression:"k8sData.HostNetwork"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostPort"),"label-width":"200px"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.showHostPort,callback:function(t){e.$set(e.k8sData,"showHostPort",t)},expression:"k8sData.showHostPort"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1)],1),e.k8sData.showHostPort?a("el-table",{staticStyle:{"padding-right":"30px"},attrs:{data:e.HostPortArr}},[a("el-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",disabled:"",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.obj,callback:function(a){e.$set(t.row,"obj",a)},expression:"props.row.obj"}})]}}],null,!1,4025241129)}),a("el-table-column",{attrs:{title:e.$t("deployService.table.th.hostPort")},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small",type:"number",min:1,max:65535,placeholder:"1-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.HostPort,callback:function(a){e.$set(t.row,"HostPort",a)},expression:"props.row.HostPort"}})]}}],null,!1,2205710664)}),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"port-button",attrs:{size:"small",theme:"primary"},on:{click:function(a){return e.generateHostPort(t.row)}}},[e._v(" "+e._s(e.$t("deployService.table.th.checkHostPort"))+" ")])]}}],null,!1,2032453516)}),a("el-table-column",{attrs:{title:"Open"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{size:"small"},on:{change:e.change},model:{value:t.row.open,callback:function(a){e.$set(t.row,"open",a)},expression:"props.row.open"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("ON")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("OFF")])])]}}],null,!1,860095306)})],1):e._e()],1)]),e.install?e._e():a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1):e._e()},Ne=[],Te={props:["k8sModel","install"],name:"NetworkK8S",data:function(){return{k8sData:null,HostPortArr:[]}},mounted:function(){this.k8sData=this.k8sModel,this.HostPortArr=this.k8sData.HostPortArr},methods:{changeKind:function(){if(this.k8sData.showHostPort){var e=this.HostPortArr.findIndex((function(e){return e.open}));-1==e&&(this.HostPortArr.forEach((function(e){e.open=!0})),this.k8sData.HostPortArr=this.HostPortArr)}this.$forceUpdate()},change:function(){var e=this.HostPortArr.findIndex((function(e){return e.open}));-1==e&&(this.showHostPort=!1),this.$forceUpdate()},save:function(){this.$refs.k8sDetailForm.validate()&&(this.k8sData.HostPortArr=this.HostPortArr,this.$emit("saveNetwork",this.k8sData))},generateHostPort:function(e){var t=this;this.$ajax.getJSON("/k8s/api/check_host_port",{NodePort:e.HostPort}).then((function(e){var a="";e.forEach((function(e){-1==e.ret?a+="<p>".concat(e.node,":").concat(e.port,": can use</p>"):a+='<p style="color: #F56C6C">'.concat(e.node,":").concat(e.port,": cannot use</p>")})),t.$message.success({dangerouslyUseHTMLString:!0,message:a})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}}},Le=Te,Ie=Object(M["a"])(Le,De,Ne,!1,null,null,null),Ae=Ie.exports,Oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"},attrs:{shadow:"never"}},[0==e.mounts.length?a("div",[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addDisk(0,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")])],1):e._e(),a("el-form",{ref:"disk",attrs:{"label-position":"top","label-width":"120px",size:"mini"}},[e._l(e.mounts,(function(t,o){return a("div",{key:o},[a("el-card",{staticStyle:{padding:"10px"},attrs:{shadow:"never"}},[a("el-row",{attrs:{gutter:22}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.diskName"),required:""}},[a("el-input",{model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"disk.name"}})],1)],1),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.path"),required:""}},[a("el-input",{model:{value:t.mountPath,callback:function(a){e.$set(t,"mountPath",a)},expression:"disk.mountPath"}})],1)],1)],1),a("el-row",{attrs:{gutter:22}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"uid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.uid,callback:function(a){e.$set(t.source.tLocalVolume,"uid",a)},expression:"disk.source.tLocalVolume.uid"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"gid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.gid,callback:function(a){e.$set(t.source.tLocalVolume,"gid",a)},expression:"disk.source.tLocalVolume.gid"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"mode",required:""}},[a("el-input",{attrs:{placeholder:"755"},model:{value:t.source.tLocalVolume.mode,callback:function(a){e.$set(t.source.tLocalVolume,"mode",a)},expression:"disk.source.tLocalVolume.mode"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{offset:18}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")]),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.delDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.delDisk"))+" ")])],1)],1)],1)],1)})),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex"}},[a("el-col",{attrs:{span:18}},[a("el-alert",{attrs:{title:e.$t("deployService.disk.info"),type:"info"}})],1),a("el-col",{attrs:{span:4}}),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],2)],1)},je=[],Pe={props:["k8sModel","mounts","install"],name:"diskK8S",methods:{save:function(){this.$emit("saveDisk",this.mounts)},addDisk:function(e,t){t.splice(e+1,0,{name:"",source:{tLocalVolume:{uid:"",gid:"",mode:""}},mountPath:""}),this.$forceUpdate()},delDisk:function(e,t){t.splice(e,1),this.$forceUpdate()}}},qe=Pe,ze=Object(M["a"])(qe,Oe,je,!1,null,"85c092ca",null),Ee=ze.exports,Re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{attrs:{"label-width":"100px","label-position":"top",size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.limitCpu,callback:function(t){e.$set(e.resources,"limitCpu",t)},expression:"resources.limitCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.limitMem,callback:function(t){e.$set(e.resources,"limitMem",t)},expression:"resources.limitMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.requestCpu,callback:function(t){e.$set(e.resources,"requestCpu",t)},expression:"resources.requestCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.requestMem,callback:function(t){e.$set(e.resources,"requestMem",t)},expression:"resources.requestMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),e.install?e._e():a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)],1)},Be=[],Je={props:["sourceModel","install"],name:"resourceK8S",data:function(){return{resources:{}}},mounted:function(){this.resources=this.sourceModel},methods:{save:function(){console.log(this.resources);var e=JSON.parse(JSON.stringify(this.resources));for(var t in e)e[t]=e[t].replace(/[^\d]/g,""),""!=e[t]&&(e[t]+="m");this.$emit("saveResource",e)}}},Ve=Je,He=Object(M["a"])(Ve,Re,Be,!1,null,"953844b8",null),Fe=He.exports,Ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticStyle:{padding:"5px"}},[a("el-form",{ref:"hpaForm",attrs:{"label-position":"top",size:"small",model:e.hpaModelData}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.minReplicas"),prop:"minReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.minReplicas"),trigger:"blur"}]}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.minReplicas")},model:{value:e.hpaModelData.minReplicas,callback:function(t){e.$set(e.hpaModelData,"minReplicas",t)},expression:"hpaModelData.minReplicas"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.maxReplicas"),prop:"maxReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.maxReplicas")}]}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.maxReplicas")},model:{value:e.hpaModelData.maxReplicas,callback:function(t){e.$set(e.hpaModelData,"maxReplicas",t)},expression:"hpaModelData.maxReplicas"}})],1)],1)],1),a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("inf.benchmark.detail")))]),e._l(e.hpaModelData.indicatorData,(function(t,o){return a("el-card",{key:o,staticStyle:{"margin-bottom":"5px"},attrs:{shadow:"hover"}},[a("el-alert",{attrs:{type:"warning",title:e.$t("deployService.hpa.tip.t2"),"show-icon":"",closable:!1}}),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.IndicatorName"),prop:"indicatorData."+o+".name",rules:[{required:!0,message:e.$t("deployService.hpa.tip.IndicatorName"),trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},on:{change:function(a){return e.changeType(o,t.name)}},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}},e._l(e.customTargets,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.targetType"),prop:"indicatorData."+o+".targetType",rules:[{required:!0,message:e.$t("deployService.hpa.tip.targetType"),trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.$forceUpdate()}},model:{value:t.targetType,callback:function(a){e.$set(t,"targetType",a)},expression:"item.targetType"}},e._l(e.getTargetTypes(t.name),(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.value"),prop:"indicatorData."+o+".value",rules:[{required:!0,message:e.$t("deployService.hpa.tip.value"),trigger:"change"}]}},[a("el-input",{attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}},[a("template",{slot:"append"},[e._v(e._s(e._f("getValueUnit")(t.targetType)))])],2)],1)],1)],1),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.addItems(o,e.hpaModelData.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.addIndicator"))+" ")])],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.delItems(o,e.hpaModelData.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.delIndicator"))+" ")])],1)],1)],1)}))],2),e.install?e._e():a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},We=[],Ke=(a("4d63"),a("25f0"),a("466d"),{props:["hpaModel","serverData","sourceModel","indicators","install"],name:"hpaK8S",data:function(){return{customTargets:["cpu","memory"]}},mounted:function(){this.hpaModelData=this.hpaModel},filters:{getValueUnit:function(e){return"averagevalue"==e.toLowerCase()?"MiB":"averageutilization"==e.toLowerCase()?"%":"MiB"}},methods:{save:function(){var e=this;this.sourceModel.limitCpu||this.sourceModel.limitMem||this.sourceModel.requestCpu||this.sourceModel.requestMem?this.$refs.hpaForm.validate((function(t){var a=Object.assign({},e.hpaModelData,{serverData:e.serverData});t&&e.$emit("saveHpa",a)})):this.$message.error("".concat(this.$t("deployService.resources.tip.resources")))},addItems:function(e,t){t.splice(e+1,0,{name:"cpu",targetType:"AverageUtilization",value:""}),this.$forceUpdate()},delItems:function(e,t){1!==t.length&&(t.splice(e,1),this.$forceUpdate())},changeType:function(e,t){var a=this.getMatchIndicators(t);this.$set(this.hpaModelData.indicatorData[e],"targetType",a.target[0].type),this.$forceUpdate()},getMatchIndicators:function(e){var t,a,o=Object(ke["a"])(this.indicators);try{for(o.s();!(a=o.n()).done;){var r=a.value;if("exact"==r.matchType&&r.match.toLowerCase()==e.toLowerCase()){t=r;break}if("regex"==r.matchType){var i=new RegExp(r.match);if(i.test(e)){t=r;break}}}}catch(s){o.e(s)}finally{o.f()}return t||this.$message.error("".concat(this.$t("deployService.hpa.tip.noIndicator"))),t},getTargetTypes:function(e){var t=this,a=this.getMatchIndicators(e),o={};return a.target.forEach((function(e){e.type.toLowerCase()=="AverageValue".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageValue")),e.type.toLowerCase()=="AverageUtilization".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageUtilization"))})),o}}}),Ue=Ke,Ze=(a("0b66"),Object(M["a"])(Ue,Ye,We,!1,null,"3d9461a4",null)),Ge=Ze.exports,Qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{attrs:{shadow:"never"}},[a("div",{staticStyle:{border:"1px solid #595656","border-radius":"5px"}},[a("yaml-editor",{ref:"yamlEdit",staticStyle:{margin:"1px"},model:{value:e.yamlContent,callback:function(t){e.yamlContent=t},expression:"yamlContent"}})],1),a("div",{staticClass:"bottom"},[a("el-upload",{attrs:{"before-upload":e.uploadFile,"show-file-list":!1,action:"","list-type":"yml/yaml"}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v(e._s(e.$t("deployService.form.uploadConf"))+" ")])],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save"))+" ")])],1)])},Xe=[],et=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"yaml-editor"},[a("textarea",{ref:"textarea",attrs:{id:"textarea"}})])},tt=[],at=a("56b3"),ot=a.n(at);a("0dd0"),a("a7be"),a("b866"),a("ced0"),a("8822"),a("b8d1");window.jsyaml=a("e2c1");var rt={name:"yaml-editor",props:["value"],data:function(){return{yamlEditor:!1}},watch:{value:function(e){var t=this.yamlEditor.getValue();e!==t&&this.yamlEditor.setValue(this.value)}},mounted:function(){var e=this;this.yamlEditor=ot.a.fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"text/x-yaml",theme:"idea",lint:!0,lineWrapping:!0,autofocus:!0,extraKeys:{"Ctrl-Space":"autocomplete"},foldGutter:!0,gutters:["CodeMirror-lint-markers"],smartIndent:!0}),this.yamlEditor.on("change",(function(t){e.$emit("changed",t.getValue()),e.$emit("input",t.getValue())})),this.yamlEditor.setValue(this.value),this.$nextTick((function(){var t=e;setInterval((function(){t.yamlEditor.refresh()}),500)}))},methods:{getValue:function(){return this.yamlEditor.getValue()},refresh:function(){this.yamlEditor.refresh()},readonly:function(){this.yamlEditor.setOption("readOnly",!0)}}},it=rt,st=(a("0d3c"),Object(M["a"])(it,et,tt,!1,null,"d17a4854",null)),lt=st.exports,nt={name:"k8sYamlEdit",components:{YamlEditor:lt},data:function(){return{treeid:"",plural:"",yamlContent:""}},methods:{refresh:function(){this.$refs.yamlEdit.refresh()},readonly:function(){this.$refs.yamlEdit.readonly()},show:function(e,t){var a=this;this.treeid=e,this.plural=t,this.$ajax.getJSON("/k8s/api/get_object",{plural:t,tree_node_id:this.treeid}).then((function(e){a.yamlContent=e})).catch((function(e){a.$message.error("".concat(a.$t("common.error"),": ").concat(e.err_msg||e.message))}))},save:function(){var e=this;this.$ajax.postJSON("/k8s/api/update_object",{plural:this.plural,tree_node_id:this.treeid,yamlContent:this.yamlContent}).then((function(t){e.$emit("flushOthers",e.treeid),e.$message.success("".concat(e.$t("common.success"))),e.$emit("successFun")})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},uploadFile:function(e){var t=e.name;if(-1==t.lastIndexOf("."))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var a=".yml|.yaml|",o=t.substring(t.lastIndexOf(".")).toLowerCase();if(-1==a.indexOf(o+"|"))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var r=new FileReader;r.readAsText(e,"UTF-8");var i=this;r.onload=function(e){e.target.result;i.$nextTick((function(){i.yamlContent=r.result}))}}}},ct=nt,dt=(a("767a0"),Object(M["a"])(ct,Qe,Xe,!1,null,"5f42cf78",null)),ut=dt.exports,pt={name:"index",components:{pull:ae,launcherType:ne,stacked:he,jobModel:_e,replicas:Z,abilityAffinity:Ce,diskManger:Ee,networkMapping:Ae,resourceManger:Fe,K8sYamlEdit:ut,hpaManger:Ge},data:function(){return{DetailModel:{show:!1},activeName:"copyNode",k8sModel:null,labelMatchArr:[],LabelMatchOperator:[],sourceModel:{},serverData:{},hpaModel:{minReplicas:"",maxReplicas:"",indicatorData:[]},indicators:[],yamlContent:"",mounts:[],treeid:""}},methods:{HandleClick:function(e){var t=this;"yaml"==e&&this.$nextTick((function(){t.$refs.yamlEdit.show(t.treeid,"tservers"),t.$refs.yamlEdit.refresh()}))},saveLauncherType:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,launcherType:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},savePull:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,pull:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveStacked:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,notStacked:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveJobModel:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,daemonSet:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveReplicas:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,Replicas:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveAffinity:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,abilityAffinity:e.abilityAffinity,NodeSelector:e.NodeSelector}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveHpa:function(e){var t=this;e=Object.assign(e,{tree_node_id:this.treeid}),this.$ajax.postJSON("/k8s/api/create_hpa",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveDisk:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update_disk",{tree_node_id:this.treeid,mounts:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveResource:function(e){var t=this;e.tree_node_id=this.treeid,this.$ajax.postJSON("/k8s/api/server_k8s_update_resource",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},adapterServerK8S:function(e){var t=Object.assign({},e);return t.tree_node_id=this.treeid,t.HostNetwork&&t.showHostPort?this.$message.error("".concat(this.$t("deployService.form.portOrNetWork"))):(t.showHostPort&&(t.HostPort=[],t.HostPortArr&&t.HostPortArr.forEach((function(e){e.open&&t.HostPort.push({NameRef:e.obj,Port:Math.floor(e.HostPort)})}))),t)},saveNetwork:function(e){var t=this,a=this.$Loading.show(),o=this.adapterServerK8S(e);this.$ajax.postJSON("/k8s/api/server_k8s_update_network",o).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},closeDetailModel:function(){this.DetailModel.show=!1,this.k8sModel=null,this.mounts=[],this.labelMatchArr=[],this.sourceModel={},this.serverData={},this.hpaModel={minReplicas:"",maxReplicas:"",indicatorData:[]}},show:function(e){var t=this;this.treeid=e,this.DetailModel.show=!0,this.getDefaultValue(),this.$nextTick((function(){t.getServerInfo(e),t.getHpaInfo(e),t.$refs.yamlEdit.show(e,"tservers")}))},getDefaultValue:function(){var e=this,t=this.LabelMatchOperator,a=this.indicators;this.$ajax.getJSON("/k8s/api/default",{}).then((function(o){e.defaultObj=o.ServerServantElem,o.LabelMatchOperator&&(t=o.LabelMatchOperator),o.indicators&&(a=o.indicators),e.LabelMatchOperator=t,e.indicators=a}))},getServerInfo:function(){var e=this;this.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:this.treeid}).then((function(t){t=t.Data[0],e.serverData=t,e.sourceModel.tree_node_id=e.treeid,t.resources&&Object.keys(t.resources).length>0&&(t.resources.limits&&(t.resources.limits.cpu&&e.$set(e.sourceModel,"limitCpu",t.resources.limits.cpu.replace(/m/g,"")),t.resources.limits.memory&&e.$set(e.sourceModel,"limitMem",t.resources.limits.memory.replace(/m/g,""))),t.resources.requests&&(t.resources.requests.cpu&&e.$set(e.sourceModel,"requestCpu",t.resources.requests.cpu.replace(/m/g,"")),t.resources.requests.memory&&e.$set(e.sourceModel,"requestMem",t.resources.requests.memory.replace(/m/g,"")))),t.showHostPort=!1,t&&(t.HostPortArr=[],"tars"==t.subType?t.servants.forEach((function(e){var a=t.HostPort.findIndex((function(t){return t.nameRef==e.name}));t.HostPortArr.push({obj:e.name,HostPort:-1!=a?t.HostPort[a].port:e.port,open:-1!=a})})):t.normal.ports.forEach((function(e){var a=t.HostPort.findIndex((function(t){return t.port==e.port}));t.HostPortArr.push({obj:e.name,HostPort:-1!=a?t.HostPort[a].port:e.port,open:-1!=a})})),t.showHostPort=-1!=t.HostPortArr.findIndex((function(e){return e.open}))),t.NodeSelector=t.NodeSelector,e.labelMatchArr=t.NodeSelector,e.labelMatchArr.forEach((function(e){-1!="Exists,DoesNotExist".indexOf(e.operator)&&(e.disableValue=!0)})),e.k8sModel=t,e.mounts=t.mounts.filter((function(e){return e.source.hasOwnProperty("tLocalVolume")}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},getHpaInfo:function(e){var t=this;this.$ajax.getJSON("/k8s/api/get_hpa",{tree_node_id:e}).then((function(e){if(e&&Object.keys(e).length>1){var a=e.body.spec;t.$set(t.hpaModel,"minReplicas",a.minReplicas),t.$set(t.hpaModel,"maxReplicas",a.maxReplicas),a.metrics.forEach((function(e,a){var o={};"Resource"==e.type&&(o.name=e.resource.name,"averagevalue"==e.resource.target.type.toLowerCase()?(o.targetType="AverageValue",o.value=e.resource.target.averageValue.replace(/m/g,"")):(o.targetType="AverageUtilization",o.value=e.resource.target.averageUtilization)),"Pods"==e.type&&(o.name=e.pods.metric.name,o.targetType=e.pods.target.type,o.value=e.pods.target.averageValue.replace(/m/g,"")),"object"==e.type.toLowerCase()&&(o.name=e.object.metric.name,"averagevalue"==e.object.target.type.toLowerCase()&&(o.targetType="AverageValue",o.value=e.object.target.averageValue.replace(/m/g,""))),t.$set(t.hpaModel.indicatorData,a,o)})),a.metrics&&0==a.metrics.length&&t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageValue",value:""})}else t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageUtilization",value:""})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}}},mt=pt,ht=Object(M["a"])(mt,V,H,!1,null,null,null),ft=ht.exports,vt=a("e2c1"),gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("let-modal",{attrs:{title:e.podName+"(Stdout)",width:"80%",height:"60%",footShow:!1},on:{close:e.closePodLog},model:{value:e.showPodLog,callback:function(t){e.showPodLog=t},expression:"showPodLog"}},[e.showPodLog?a("div",{staticClass:"pre log-body"},e._l(e.podLog,(function(t){return a("div",{key:t.id,staticClass:"log-msg"},[a("span",{staticClass:"log-date"},[e._v(e._s(t.time))]),a("span",{class:e.wrap?"wrap-lines":"",staticStyle:{color:"27aa5e"}},[e._v(e._s(t.message))])])})),0):e._e(),a("let-checkbox",{on:{change:e.changeWrap},model:{value:e.wrap,callback:function(t){e.wrap=t},expression:"wrap"}},[e._v(e._s(e.$t("operate.wrap")))]),e._v(" "),a("let-checkbox",{on:{change:e.changePrevious},model:{value:e.previous,callback:function(t){e.previous=t},expression:"previous"}},[e._v(e._s(e.$t("operate.previous")))]),a("span",{staticStyle:{float:"right"}},[a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:e.clearScreen}},[e._v(e._s(e.$t("operate.clear")))]),e._v(" "),a("let-button",{attrs:{size:"mini"},on:{click:function(t){e.showPodLog=!1}}},[e._v(e._s(e.$t("operate.close")))])],1)],1)},bt=[],$t={props:[],name:"log",data:function(){return{showPodLog:!1,podLog:[],podName:"",wrap:!1,previous:!1,socket:null}},methods:{changeWrap:function(){},changePrevious:function(){this.podLog=[],this.readPodLog(this.podName)},clearScreen:function(){this.podLog=[]},closePodLog:function(){this.podLog=[]},show:function(e){this.podName=e;var t="";if("http:"==window.location.protocol)t="ws://".concat(window.location.host,"/web/log?podName=").concat(e,"&previous=").concat(this.previous);else{if("https:"!=window.location.protocol)return void console.log("unknown protocol",window.location);t="wss://".concat(window.location.host,"/web/log?podName=").concat(e,"&previous=").concat(this.previous)}var a=this;this.socket&&this.socket.close(),this.socket=new WebSocket(t,"log-protocol"),this.socket.onopen=function(){a.showPodLog=!0,a.podLog=[]},this.socket.onerror=function(){console.log("[error] Connection error"),a.socket=null},this.socket.close=function(){console.log("[close] Connection closed cleanly"),a.socket=null},this.socket.onmessage=function(e){var t=e.data.indexOf(" ");a.podLog.push({id:a.podLog.length,time:J()(e.data.substring(0,t)).format("YYYY-MM-DD HH:mm:ss"),message:e.data.substring(t)})},this.socket.onsend=function(e){a.socket.send(e)}}}},_t=$t,yt=Object(M["a"])(_t,gt,bt,!1,null,"a519c4d8",null),wt=yt.exports,kt={name:"ServerManage",components:{wrapper:R["a"],k8sManager:ft,YamlEditor:lt,log:wt},data:function(){return{serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},commandHTML:"",dialogCommandVisible:!1,isreloadlist:!0,reloadTask:null,reloadlist:null,serverList:[],serverNotifyList:[],notifyPagination:{page:1,size:10,total:1},defaultObj:{},configModal:{show:!1,model:null},servantAddModal:{show:!1,isNew:!0,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},logLevels:["NONE","DEBUG","TARS","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},showPodYaml:!1,podYaml:null,isCheckedAll:!1,checkedList:[]}},props:["treeid"],computed:{isApplication:function(){return-1==this.treeid.indexOf(".")},showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},isNormal:function(){return"normal"===this.serverData.server_type}},methods:{gotoLog:function(e){var t="/logview.html?History=false&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},closePodYaml:function(){this.podYaml=null},readPodLog:function(e){this.$refs.log.show(e)},describePod:function(e){var t=this,a=this.$loading.show();this.$ajax.getJSON("/k8s/api/describe_pod",{PodName:e.PodName}).then((function(e){t.podYaml=vt["default"].dump(e),t.showPodYaml=!0,t.$nextTick((function(){t.$refs.yamlEdit.readonly(),a.hide()}))})).catch((function(e){a.hide()}))},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},reloadServerList:function(){var e=this;if(this.$parent.BTabs.length>0){var t=this.$parent.BTabs[0].path,a=t.substring(t.lastIndexOf("/")+1);"manage"!==a&&e.reloadTask||(e.reloadTask=setTimeout((function(){e.isreloadlist&&"#/server"==location.hash&&e.$parent.treeid==e.treeid&&(e.getServerList(),e.getServerNotifyList()),e.reloadServerList()}),3e3))}},startServerList:function(){this.isreloadlist=!0},stopServerList:function(){this.isreloadlist=!1},getServerList:function(){var e=this;this.$ajax.getJSON("/k8s/api/pod_list",{tree_node_id:this.treeid}).then((function(t){e.serverList=[],t.hasOwnProperty("Data")&&(t.Data.forEach((function(e){e.isChecked=!1,e.Source=JSON.parse(e.Source||"{}"),e.CreateTime=J()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.StartTime=J()(e.StartTime).format("YYYY-MM-DD HH:mm:ss")})),e.serverList=t.Data)})).catch((function(e){}))},getServerNotifyList:function(){var e=this;this.showOthers&&this.$ajax.getJSON("/k8s/api/server_notify_list",{tree_node_id:this.treeid,size:this.notifyPagination.size,page:this.notifyPagination.page}).then((function(t){e.notifyPagination.total=Math.ceil(t.total.value/e.notifyPagination.size),e.serverNotifyList=t.hits||[],e.serverNotifyList.forEach((function(e){e._source.timeStr=J()(e._source.notifyTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){}))},statusStyle:function(e){return e=e||"","restart"==e||-1!=e.indexOf("[succ]")?"color: green":"stop"==e||-1!=e.indexOf("[alarm]")||-1!=e.indexOf("error")||-1!=e.indexOf("ERROR")?"color: red":""},notifyGotoPage:function(e){this.notifyPagination.page=e,this.getServerNotifyList()},getServerConfig:function(){var e=this;this.stopServerList();var t=this.$loading.show({target:this.$refs.configFormLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.configModal.model?e.configModal.model=Object.assign({},e.configModal.model,a.Data[0]):(a.templates=[],e.configModal.model=a.Data[0]),e.configModal.model["tree_node_id"]=e.treeid,e.startServerList()})).catch((function(a){t.hide(),e.closeConfigModal(),e.startServerList(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.err_msg||a.message))}))},configServer:function(){var e=this;this.stopServerList(),this.configModal.show=!0,this.$ajax.getJSON("/k8s/api/template_select").then((function(t){e.configModal.model?e.configModal.model.templates=t.Data:e.configModal.model={templates:t.Data},e.getServerConfig(),e.startServerList()})).catch((function(t){e.startServerList(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_option_update",Object(E["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.closeConfigModal(),e.$tip.success(e.$t("common.success"))})).catch((function(){t.hide()}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null,this.startServerList()},startServer:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodName})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.startService.msg.startService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StartServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},restartServer:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodName})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.restartService.msg.restartService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"RestartServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},stopServer:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodName})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.stopService.msg.stopService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StopServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},deletePod:function(e){var t=this;this.$confirm(this.$t("serverList.tips.deletePod"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_pod",{PodName:e.PodName}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getServerList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},viewEvent:function(e){var t=Object.assign({},e),a={application:t.ServerApp,serverName:t.ServerName};this.$router.push({path:"/operation/event",query:a})},viewTemplate:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_template",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewTemplate"),e.detailModal.model={detail:a},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},privateTemplateManage:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewProfileTemplate"),e.detailModal.model={detail:a&&a.Data[0].ServerProfile||""},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},manageServant:function(e){var t=this;this.stopServerList(),this.servantModal.show=!0,this.$ajax.getJSON("/k8s/api/server_adapter_select",{tree_node_id:this.treeid}).then((function(a){t.servantModal.model=a.Data,t.servantModal.currentServer=e})).catch((function(e){t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},manageK8S:function(){this.$refs.k8s.show(this.treeid)},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null,this.startServerList()},addAdapter:function(e){this.servantAddModal.model.ServerServant.push(Object.assign({},e,{Port:this.getPort(e.Port)}))},getPort:function(e){var t=this.defaultObj,a=this.servantModal,o=0;if(e)o=e;else if(o=Math.floor(t.Port),a.model&&a.model.length>0){var r=a.model.sort((function(e,t){return t.Port-e.Port}))||[];o=Math.floor(r[0].Port)}return o++,19385===o&&o++,o},configServant:function(e){var t=this.defaultObj,a={tree_node_id:this.treeid,ServerServant:[{Name:"",Port:this.getPort()||0,Threads:t.Threads||0,Connections:t.Connections||0,Capacity:t.Capacity||0,Timeout:t.Timeout||0,IsTcp:t.IsTcp,IsTars:t.IsTars}]};if(e){this.servantDetailModal.model=a,this.servantDetailModal.isNew=!0;var o=this.servantModal.model.find((function(t){return t.AdapterId===e}));this.servantDetailModal.model={AdapterId:o.AdapterId,ServerServant:[o]},this.servantDetailModal.isNew=!1,this.servantDetailModal.show=!0}else this.servantAddModal.model=a,this.servantAddModal.isNew=!0,this.servantAddModal.show=!0},closeServantAddModal:function(){this.$refs.servantAddForm&&this.$refs.servantAddForm.resetValid(),this.servantAddModal.show=!1,this.servantAddModal.model=null},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,o=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,r=/^t\s([1-9]|[1-9]\d+)$/i,i=/^p\s\d{4,5}$/i,s=!0;if(a.test(t[0])){for(var l=0,n=1;n<t.length;n++)if(o&&o.test(t[n])&&(l++,this.servantDetailModal.model.node_name=t[n].split(/\s/)[1],o=null),r&&r.test(t[n])&&(l++,r=null),i&&i.test(t[n])){var c=t[n].substring(2);c<0||c>65535||l++,i=null}s=3===l}else s=!1;return s},saveServantAdd:function(){var e=this;if(this.$refs.servantAddForm.validate()){var t=this.$Loading.show();if(this.servantAddModal.isNew){var a=Object.assign({},this.servantAddModal.model);if(a.ServerServant){var o={};a.ServerServant.forEach((function(e){o[e.Name]=e})),a.ServerServant=o}this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.manageServant(),e.$tip.success(e.$t("common.success")),e.closeServantAddModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else t.hide()}},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else{this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name;var o=Object.assign({},this.servantDetailModal.model);this.$ajax.postJSON("/k8s/api/server_adapter_update",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/server_adapter_delete",{AdapterId:e}).then((function(o){a.hide(),t.servantModal.model=t.servantModal.model.filter((function(t){return t.AdapterId!==e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},closeDetailModal:function(){this.detailModal.show=!1,this.detailModal.model=null},showMoreCmd:function(e){var t=this;this.stopServerList();var a=this.checkedList.filter((function(e){return e.isChecked}));if(a.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var o=a.map((function(e){return e.PodName})),r=a[0].ServerApp,i=a[0].ServerName;this.moreCmdModal.model={podIp:o,serverApp:r,serverName:i,selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e}},sendCommand:function(e,t,a,o,r){var i=this,s=this.$Loading.show();this.$ajax.getJSON("/k8s/api/send_command",{serverApp:e,serverName:t,podIp:a,command:o}).then((function(e){s.hide();for(var t=0;t<e.length;t++)if(0!=e[t].ret_code)return void i.$tip.error(i.$t("common.error")+", ret_code:"+e[t].ret_code);var a=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(a);i.commandHTML=a,i.dialogCommandVisible=!0,i.getServerNotifyList()})).catch((function(e){s.hide(),i.$tip.error({title:i.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model;this.moreCmdModal.currentServer;"setloglevel"===e.selected?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,e.command):"connection"===e.selected&&this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.checkedList=[],this.moreCmdModal.show=!1,this.moreCmdModal.model=null,this.startServerList()},checkChange:function(e){this.stopServerList();var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.PodId===e.PodId&&(o=!0)})),o||t.push(e)}else{var r=!1,i=-1;t.forEach((function(t,a){t.PodId===e.PodId&&(r=!0,i=a)})),r&&t.splice(i,1)}},checkLauncherType:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:e.treeid});case 2:return a=t.sent,o=a.Data[0].launcherType,t.abrupt("return","foreground"==o);case 5:case"end":return t.stop()}}),t)})))()},goMarket:function(e){var t;t=e.Source["tars.io/CloudProduct"]?"/static/market/index.html#/market/product/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version):"/static/market/index.html#/market/service/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version),window.open(t)}},created:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.serverData=e.$parent.getServerData(),e.serverData.server_type){t.next=12;break}return t.prev=2,t.next=5,e.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:e.treeid});case 5:a=t.sent,e.$set(e.serverData,"server_type",a.Data[0].serverType),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),e.$set(e.serverData,"server_type","normal");case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))()},mounted:function(){this.getServerList(),this.reloadServerList(),this.startServerList(),this.getServerNotifyList()},beforeMount:function(){this.startServerList()},beforeDestroy:function(){this.stopServerList()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]},checkedList:function(){var e=this.checkedList;e.length>0?this.stopServerList():this.startServerList()}}},St=kt,Mt=(a("cb44"),Object(M["a"])(St,P,q,!1,null,null,null)),xt=Mt.exports,Ct=a("67ac"),Dt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_publish"},[e.buildList.length>0?a("div",[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.buildList"))+" "),a("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getBuildList()}}})])]),a("div",[a("let-table",{ref:"table",attrs:{data:e.buildList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.buildId"),prop:"Id"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.phase"),prop:"Phase"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.message"),prop:"Message"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteBuild(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,4039036093)})],1)],1)]):e._e(),a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.patchList"))+" "),a("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getImageList()}}})])]),a("div",[a("let-button",{staticStyle:{float:"left","margin-right":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(e._s(e.$t("pub.dlg.upload")))]),a("let-button",{staticStyle:{float:"left"},attrs:{theme:"primary",size:"small"},on:{click:e.showAddImageModal}},[e._v(e._s(e.$t("pub.dlg.image")))]),a("let-button",{staticStyle:{float:"right"},attrs:{theme:"primary",size:"small"},on:{click:e.openPublishVersionModal}},[e._v(e._s(e.$t("pub.btn.pubk8s")))])],1),a("br"),a("div",[a("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.id"),prop:"Id"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.secret"),prop:"Secret"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:e.getState(t.row.Enabled)})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createPerson"),prop:"CreatePerson"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.removeReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"},attrs:{slot:"operations"},slot:"operations"}),a("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?a("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.Id,callback:function(t){e.$set(e.publishModal.model,"Id",t)},expression:"publishModal.model.Id"}},e._l(e.publishModal.model.patchList,(function(t){return a("let-option",{key:t.Id,attrs:{value:t.Id}},[""+t.Enabled=="true"?a("span",{domProps:{innerHTML:e._s(e.imgCur)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),a("span",[e._v(e._s(t.Id)+" | "+e._s(t.CreateTime)+" | "+e._s(t.Image))])])})),1)],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.nodeImage"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.nodeImageTip")},model:{value:e.publishModal.model.NodeImage,callback:function(t){e.$set(e.publishModal.model,"NodeImage",t)},expression:"publishModal.model.NodeImage"}},e._l(e.publishModal.model.nodeList,(function(t){return a("let-option",{key:t.Image,attrs:{value:t.Image}},[t.isDefaultNode?a("span",{domProps:{innerHTML:e._s(e.imgNew)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),t.isCurrNode?a("span",{domProps:{innerHTML:e._s(e.imgCur)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),a("span",[e._v(e._s(t.Id)+" | "+e._s(t.CreateTime)+" | "+e._s(t.Image))])])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[a("let-input",{attrs:{size:"small",type:"number",min:1,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.publishModal.model.Replicas,callback:function(t){e.$set(e.publishModal.model,"Replicas",t)},expression:"publishModal.model.Replicas"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{model:{value:e.publishModal.model.EnableMark,callback:function(t){e.$set(e.publishModal.model,"EnableMark",t)},expression:"publishModal.model.EnableMark"}}),a("let-button",{staticClass:"mt20",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch")))])],1)]],2):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.serviceTypeTips")},on:{change:e.changeServerType},model:{value:e.uploadModal.model.ServerType,callback:function(t){e.$set(e.uploadModal.model,"ServerType",t)},expression:"uploadModal.model.ServerType"}},e._l(e.serverType,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.baseImage"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageTips")},on:{change:e.changeBaseImage},model:{value:e.uploadModal.model.BaseImage,callback:function(t){e.$set(e.uploadModal.model,"BaseImage",t)},expression:"uploadModal.model.BaseImage"}},e._l(e.baseImage,(function(t){return a("let-option",{key:t.Name,attrs:{value:t.Name}},[e._v(e._s(t.Name+"("+t.Mark+")"))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.baseImageRelease"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageReleaseTips")},model:{value:e.uploadModal.model.BaseImageRelease,callback:function(t){e.$set(e.uploadModal.model,"BaseImageRelease",t)},expression:"uploadModal.model.BaseImageRelease"}},e._l(e.baseImageRelease,(function(t){return a("let-option",{key:t.Image,attrs:{value:t.Image}},[e._v(e._s(t.Image+"("+(t.Mark||t.Id)+")"))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serverTag")}},[a("let-input",{attrs:{type:"text",size:"small",placeholder:e.$t("deployService.form.serverTagTip")},model:{value:e.uploadModal.model.ServerTag,callback:function(t){e.$set(e.uploadModal.model,"ServerTag","string"===typeof t?t.trim():t)},expression:"uploadModal.model.ServerTag"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.image"),width:"600px",footShow:!1},on:{"on-cancel":e.closeAddImageModal},model:{value:e.addImageModal.show,callback:function(t){e.$set(e.addImageModal,"show",t)},expression:"addImageModal.show"}},[e.addImageModal.model?a("let-form",{ref:"addImageForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.addImage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),required:""}},[a("let-input",{attrs:{type:"text",size:"small",required:""},model:{value:e.addImageModal.model.Image,callback:function(t){e.$set(e.addImageModal.model,"Image",t)},expression:"addImageModal.model.Image"}})],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.secret"),required:""}},[a("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Secret,callback:function(t){e.$set(e.addImageModal.model,"Secret",t)},expression:"addImageModal.model.Secret"}})],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.mark")}},[a("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Mark,callback:function(t){e.$set(e.addImageModal.model,"Mark",t)},expression:"addImageModal.model.Mark"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("pub.dlg.add")))])],1):e._e()],1)],1)])},Nt=[],Tt=a("2699"),Lt={name:"ServerPublish",data:function(){return{imgNew:'<img class="logo" src="/static/img/new.gif">',imgCur:'<img class="logo" src="/static/img/current.gif">',imgSpace:'<img class="logo" src="/static/img/space.png">',serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},buildList:[],serverList:[],publishModal:{show:!1,model:{patchList:[],nodeList:[]}},timer:null,reloadTask:null,serverK8S:{},serverType:[],baseImage:[],baseImageRelease:[],defaultImage:null,tfc:null,uploadModal:{show:!1,model:null},addImageModal:{show:!1,model:null}}},props:["treeid"],methods:{getServerType:function(){return this.$ajax.getJSON("/k8s/api/server_list",{tree_node_id:this.treeid})},getDefault:function(){var e=this;this.$ajax.getJSON("/k8s/api/default").then((function(t){e.serverK8S=t.ServerK8S||{},e.serverType=t.ServerTypeOptional||[]}))},changeServerType:function(){var e=this;this.$ajax.getJSON("/k8s/api/base_image_list",{ServerType:this.uploadModal.model.ServerType}).then((function(t){e.baseImage=t.Data||[],e.uploadModal.model.BaseImage=e.baseImage[0].Name}))},changeBaseImage:function(){var e=this;this.baseImageRelease=this.baseImage.filter((function(t){return t.Name==e.uploadModal.model.BaseImage}))[0].Release,this.$set(this.uploadModal.model,"BaseImageRelease",this.baseImageRelease[0].Image)},getState:function(e){var t="";switch("".concat(e)){case"true":t="status-active";break}return t},formatDate:function(e,t){return Object(Tt["b"])(e,"YYYY-MM-DD HH:mm:ss")},reloadBuildList:function(){var e=this,t=this;this.timer=setTimeout((function(){if(e.$parent.BTabs.length>0&&t.$parent.treeid==t.treeid){var a=e.$parent.BTabs.filter((function(e){return-1!=e.path.indexOf(t.treeid+"/publish")}));a.length>0&&t.getBuildList()}t.reloadBuildList()}),1e3)},getBuildList:function(){var e=this;this.$ajax.getJSON("/k8s/api/build_list",{tree_node_id:this.treeid}).then((function(t){t.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime)})),e.buildList=t.Data;var a=e.buildList.findIndex((function(e){return"Done"!=e.Phase}));-1==a&&(e.reloadTask=!1)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deleteBuild:function(e){var t=this;this.$confirm(this.$t("deployService.form.delete"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_build",{ImageName:e.ImageName}).then((function(){t.getBuildList(),t.getImageList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},getImageList:function(){var e=this;this.$ajax.getJSON("/k8s/api/patch_list",{tree_node_id:this.treeid}).then((function(t){e.getNowImages().then((function(a){var o=t.Data||[];o.forEach((function(t){t.Id==a.Id&&(t.Enabled=!0),t.CreateTime=e.formatDate(t.CreateTime)})),e.serverList=o})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))},openPublishVersionModal:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.publishModal.model={tree_node_id:e.treeid,Replicas:e.serverK8S.Replicas||1,show:!0},t.next=3,e.getPatchList();case 3:return a=t.sent,t.next=6,e.getK8SData();case 6:return o=t.sent,t.next=9,e.getNowImages();case 9:return r=t.sent,t.next=12,e.getImageNodes();case 12:i=t.sent,e.publishModal.model.Replicas=o.Data[0].Replicas||e.serverK8S.Replicas||1,a.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime),t.Image==r.Image&&(t.Enabled=!0)})),i.Data.forEach((function(t){t.Image==r.NodeImage&&(t.isCurrNode=!0,e.publishModal.model.NodeImage=r.NodeImage),t.Image==e.defaultImage&&(t.isDefaultNode=!0,e.publishModal.model.NodeImage||(e.publishModal.model.NodeImage=e.defaultImage))})),e.publishModal.model.patchList=a.Data,e.publishModal.model.nodeList=i.Data,e.publishModal.show=!0;case 19:case"end":return t.stop()}}),t)})))()},getPatchList:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/patch_list",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getNowImages:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_now_image",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getK8SData:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getImageNodes:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/image_node_select");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getNodeImage:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:e.tfc=t.sent,a=e.tfc.filter((function(e){return"nodeImage.image"===e.column})),e.defaultImage=1==a.length?a[0].value:"";case 5:case"end":return t.stop()}}),t)})))()},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.$refs.publishForm.resetValid()},savePublishServer:function(){var e=this,t=this.$Loading.show();this.$refs.publishForm.validate()&&(t.hide(),this.$ajax.postJSON("/k8s/api/patch_publish",{tree_node_id:this.publishModal.model.tree_node_id,Id:this.publishModal.model.Id,Replicas:this.publishModal.model.Replicas,EnableMark:this.publishModal.model.EnableMark,NodeImage:this.publishModal.model.NodeImage}).then((function(a){t.hide(),e.getImageList(),e.closePublishModal(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))})))},showUploadModal:function(){var e=this;this.getServerType().then((function(t){e.uploadModal.model={tree_node_id:e.treeid,file:null,ServerMark:"",ServerType:t.Data[0].ServerType},e.uploadModal.show=!0}))},showAddImageModal:function(){this.addImageModal.model={tree_node_id:this.treeid,Id:"",Image:"",Secret:"tars-image-secret",Mark:""},this.addImageModal.show=!0},closeAddImageModal:function(){this.addImageModal.show=!1,this.addImageModal.model=null,this.$refs.addImageForm.resetValid()},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.getImageList()})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData,o=this.tfc.filter((function(e){return"imageBuild.secret"===e.column})),r=o.length>=1?o[0].value:"";console.log(this.tfc,r,o),a.append("tree_node_id",this.treeid),a.append("ServerType",this.uploadModal.model.ServerType),a.append("ServerTag",this.uploadModal.model.ServerTag||"v-".concat(Object(Tt["b"])(new Date,"YYYYMMDDHHmmss"))),a.append("BaseImage",this.uploadModal.model.BaseImageRelease),a.append("Secret",r),a.append("suse",this.uploadModal.model.file),a.append("CreateMark",this.uploadModal.model.comment||""),this.$ajax.postForm("/k8s/api/patch_upload",a).then((function(a){e.closeUploadModal(),e.reloadBuildList(),t.hide(),setTimeout(e.getImageList,1e3)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},addImage:function(){var e=this;if(this.$refs.addImageForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("tree_node_id",this.treeid),a.append("Image",this.addImageModal.model.Image),a.append("Secret",this.addImageModal.model.Secret||""),a.append("Mark",this.addImageModal.model.Mark||""),this.$ajax.postForm("/k8s/api/image_release_create",a).then((function(a){e.closeAddImageModal(),t.hide(),setTimeout(e.getImageList,1e3)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}}},created:function(){this.serverData=this.$parent.getServerData()},beforeMount:function(){this.reloadBuildList()},beforeDestroy:function(){clearTimeout(this.timer),this.timer=null},mounted:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getImageList(),e.getDefault(),t.next=4,e.getNodeImage();case 4:case"end":return t.stop()}}),t)})))()}},It=Lt,At=(a("9df2"),Object(M["a"])(It,Dt,Nt,!1,null,null,null)),Ot=At.exports,jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_config"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("h4",{staticStyle:{float:"left"}},[e._v(" "+e._s(this.$t("cfg.title.a"))+" "),a("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getConfigList()}}})]),a("span",{staticStyle:{float:"right"}},[a("let-button",{attrs:{size:"mini",theme:"sub-primary"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cfg.btn.add")))]),e._v(" "),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.nodeConfigAdd(e.configList,e.checkedConfigId)}}},[e._v(e._s(e.$t("filter.btn.addNode")))]),e._v(" "),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.changeConfig(e.configList,"ConfigName",e.checkedConfigId,"configList")}}},[e._v(e._s(e.$t("operate.update")))]),e._v(" "),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("operate.delete")))]),e._v(" "),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showDetail(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("cfg.title.viewConf")))]),e._v(" "),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showHistory(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1)]),e.configList?a("wrapper",{ref:"configListLoading"},[a("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.ConfigName},model:{value:e.checkedConfigId,callback:function(t){e.checkedConfigId=t},expression:"checkedConfigId"}},[a("span",{staticStyle:{"font-size":"0"}},[e._v(e._s(t.row.ConfigName))])])]}}],null,!1,367281790)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"250px"}})],1)],1):e._e(),e.nodeConfigList&&e.showOthers?a("wrapper",{ref:"nodeConfigListLoading"},[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.changeConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList,"nodeConfigList")}}},[e._v(e._s(e.$t("cfg.table.modCfg")))]),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showMergedDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewMerge")))]),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewIpContent")))]),a("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showHistory(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1),e.nodeConfigList.length?a("let-checkbox",{staticClass:"check-all",model:{value:e.nodeCheckAll,callback:function(t){e.nodeCheckAll=t},expression:"nodeCheckAll"}}):e._e(),a("let-table",{attrs:{data:e.nodeConfigList,title:e.$t("cfg.title.c"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{label:t.row.ConfigId},model:{value:e.nodeCheckList,callback:function(t){e.nodeCheckList=t},expression:"nodeCheckList"}})]}}],null,!1,1794674851)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"PodSeq"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-"+e._s(t.row.PodSeq)+" ")]}}],null,!1,3597062101)}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"180px"}})],1)],1):e._e(),a("let-modal",{attrs:{title:e.configModal.isNew?e.$t("operate.title.add")+" "+e.$t("common.config"):e.$t("operate.title.update")+" "+e.$t("common.config"),width:"80%"},on:{"on-confirm":e.configDiff,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?a("let-form",{ref:"configForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[a("let-input",{attrs:{size:"small",disabled:!e.configModal.isNew,required:""},model:{value:e.configModal.model.ConfigName,callback:function(t){e.$set(e.configModal.model,"ConfigName",t)},expression:"configModal.model.ConfigName"}})],1),e.configModal.isNew?e._e():a("let-form-item",{attrs:{label:e.$t("cfg.btn.reason"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ConfigMark,callback:function(t){e.$set(e.configModal.model,"ConfigMark",t)},expression:"configModal.model.ConfigMark"}})],1),a("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.configContent,callback:function(t){e.configContent=t},expression:"configContent"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.nodeConfigModal.isNew?e.$t("operate.title.add")+" "+e.$t("common.config"):e.$t("operate.title.update")+" "+e.$t("common.config"),width:"80%"},on:{"on-confirm":e.updateNodeConfigFile,close:e.closeNodeConfigModal,"on-cancel":e.closeNodeConfigModal},model:{value:e.nodeConfigModal.show,callback:function(t){e.$set(e.nodeConfigModal,"show",t)},expression:"nodeConfigModal.show"}},[e.nodeConfigModal.model?a("let-form",{ref:"nodeConfigForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[a("let-input",{attrs:{disabled:"",size:"small",required:""},model:{value:e.nodeConfigModal.model.ConfigName,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigName",t)},expression:"nodeConfigModal.model.ConfigName"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),required:""}},[a("div",{staticStyle:{display:"flex"}},[a("span",{staticStyle:{display:"block"}},[e._v(e._s(e.nodeConfigModal.model.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-")]),a("let-input",{staticStyle:{display:"block",flex:"1"},attrs:{type:"number",min:0,max:20,size:"small",required:""},model:{value:e.nodeConfigModal.model.PodSeq,callback:function(t){e.$set(e.nodeConfigModal.model,"PodSeq",t)},expression:"nodeConfigModal.model.PodSeq"}})],1)]),a("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.nodeConfigModal.model.ConfigContent,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigContent",t)},expression:"nodeConfigModal.model.ConfigContent"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("filter.title.diffTxt"),width:"1200px"},on:{"on-confirm":e.updateConfigDiff,close:e.closeConfigDiffModal,"on-cancel":e.closeConfigDiffModal},model:{value:e.configDiffModal.show,callback:function(t){e.$set(e.configDiffModal,"show",t)},expression:"configDiffModal.show"}},[e.configDiffModal.model?a("div",{staticStyle:{"padding-top":"30px"}},[a("div",{staticClass:"codediff_head"},[a("div",{staticClass:"codediff_th"},[e._v("OLD:")]),a("div",{staticClass:"codediff_th"},[e._v("NEW:")])]),a("diff",{attrs:{"old-string":e.configDiffModal.model.oldData,"new-string":e.configDiffModal.model.newData,context:10,"output-format":"side-by-side"}})],1):e._e()]),a("let-modal",{attrs:{title:e.detailModal.title,width:"1200px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model&&e.detailModal.model.table?a("let-button",{staticStyle:{"margin-top":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.backConfig}},[e._v("恢复")]):e._e(),e.detailModal.model&&e.detailModal.model.table?a("let-table",{staticClass:"history-table",attrs:{data:e.detailModal.model.table,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.ConfigId},model:{value:e.backConfigId,callback:function(t){e.backConfigId=t},expression:"backConfigId"}},[e._v(e._s(""))])]}}],null,!1,316818822)}),a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"CreateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(" "+e._s(t.row.CreateTime)+" ")])]}}],null,!1,1722398695)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(" "+e._s(t.row.ConfigVersion)+" ")])]}}],null,!1,1586553542)}),a("let-table-column",{attrs:{width:"400px",title:e.$t("cfg.btn.reason"),prop:"ConfigMark"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(" "+e._s(t.row.ConfigMark||" ")+" ")])]}}],null,!1,1734026985)}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.content"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.showTableDeatil(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3817607729)})],1):e._e(),e.detailModal.model&&!e.detailModal.model.table||e.detailModal.model&&e.detailModal.model.table&&e.detailModal.model.detail?a("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),a("div",{ref:"detailModalLoading",staticClass:"detail-loading"})],1)],1)},Pt=[],qt=(a("8a79"),a("e68e")),zt={name:"ServerConfig",components:{wrapper:R["a"],diff:qt["a"]},data:function(){return{oldStr:"old code",newStr:"new code",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},checkedConfigId:"",backConfigId:"",configList:[],nodeConfigList:null,nodeCheckList:[],configContent:"",configModal:{show:!1,isNew:!0,model:null},nodeConfigContent:"",nodeConfigModal:{show:!1,isNew:!0,model:null},configDiffModal:{type:"",show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},refFileModal:{show:!1,model:{fileList:[]}},nodeRefFileListModal:{show:!1,model:null},pushResultModal:{show:!1,model:null}}},props:["treeid"],computed:{showOthers:function(){return 5===this.serverData.level},nodeCheckAll:{get:function(){return!(!this.nodeConfigList||!this.nodeConfigList.length)&&this.nodeCheckList.length===this.nodeConfigList.length},set:function(e){this.nodeCheckList=e?this.nodeConfigList.map((function(e){return e.ConfigId})):[]}}},watch:{checkedConfigId:function(){var e=this;this.$nextTick((function(){e.getNodeConfigList()}))}},methods:{getConfigList:function(e){var t=this,a=this.$refs.configListLoading.$loading.show(),o=this.treeid;this.$ajax.getJSON("/k8s/api/server_config_select",{tree_node_id:o}).then((function(e){a.hide(),t.configList=[],t.refFileList=[],t.nodeConfigList=[],e.hasOwnProperty("Data")&&(e.Data[0]&&e.Data[0].ConfigId&&(t.checkedConfigId=e.Data[0].ConfigName,t.getNodeConfigList()),e.Data.forEach((function(e){e.CreateTime=Object(Tt["b"])(e.CreateTime)})),t.configList=e.Data)})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("common.error"),t.$t("common.retry"),t.$t("common.alert")).then((function(){t.getConfigList()}))}))},addConfig:function(){this.configContent="",this.configModal.model={ConfigName:this.serverData.server_name+".conf",ConfigContent:""},this.configModal.isNew=!0,this.configModal.show=!0},changeConfig:function(e,t,a,o){var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));if(!a||0===a.length||0==r.length)return this.$tip.warning(this.$t("dialog.tips.item"));this.configContent=r[0].ConfigContent,this.configModal.model=Object.assign(r[0],{ConfigMark:""}),this.configModal.target=o,this.configModal.isNew=!1,this.configModal.show=!0},updateConfigFile:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show(),a=this.configModal.model;if(this.configModal.isNew){var o=Object.assign({tree_node_id:this.treeid},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}else this.$ajax.postJSON("/k8s/api/server_config_update",{ConfigId:a.ConfigId,ConfigMark:a.ConfigMark,ConfigContent:a.ConfigContent}).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}},updateNodeConfigFile:function(){var e=this;if(this.$refs.nodeConfigForm.validate()){var t=this.$Loading.show(),a=this.nodeConfigModal.model;if(this.nodeConfigModal.isNew){var o=Object.assign({tree_node_id:this.treeid},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeNodeConfigModal()})).catch((function(a){t.hide(),e.$tip.error(a.err_msg)}))}}},backConfig:function(){var e=this,t=this.backConfigId;if(!t)return this.$tip.error("请先选择一项");var a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_config_history_back",{HistoryId:t}).then((function(t){a.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeDetailModal()})).catch((function(){a.hide(),e.$tip.error(e.$t("common.error"))}))},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1},closeNodeConfigModal:function(){this.$refs.nodeConfigForm&&this.$refs.nodeConfigForm.resetValid(),this.nodeConfigModal.show=!1},deleteConfig:function(e,t,a){var o=this;if(!a)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.$confirm(this.$t("cfg.msg.confirmCfg"),this.$t("common.alert")).then((function(){var e=o.$Loading.show();o.$ajax.getJSON("/k8s/api/server_config_delete",{ConfigId:r[0].ConfigId}).then((function(t){e.hide(),o.getConfigList(o.serverData),o.$tip.success(o.$t("common.success"))})).catch((function(t){e.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(t.err_msg||t.message))}))}))},getNodeConfigList:function(){var e=this;if(this.showOthers){var t={tree_node_id:this.treeid,ConfigName:this.checkedConfigId};this.$ajax.getJSON("/k8s/api/server_config_select",t).then((function(t){t.Data.forEach((function(e){e.CreateTime=Object(Tt["b"])(e.CreateTime)})),e.nodeCheckList=[],e.nodeConfigList=t.Data})).catch((function(t){e.nodeConfigList=[],e.$tip.error({title:e.$t("common.error"),message:t.err_msg||t.message||e.$t("common.networkErr")})}))}},nodeConfigAdd:function(e,t){if(!t)return this.$tip.warning(this.$t("dialog.tips.item"));var a=e.filter((function(e){return e.ConfigName===t}));this.nodeConfigModal.model={ServerId:this.treeid,ConfigName:a[0].ConfigName,ConfigContent:""},this.nodeConfigModal.isNew=!0,this.nodeConfigModal.show=!0},showDetail:function(e,t,a){if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var o=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewConf"),this.detailModal.model={detail:o[0].ConfigContent},this.detailModal.show=!0},showMergedDetail:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewMerged"),this.detailModal.show=!0;var i=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/merged_node_config",{tree_node_id:this.treeid,ConfigName:r[0].ConfigName,PodSeq:r[0].PodSeq}).then((function(e){i.hide(),o.detailModal.model={detail:e}})).catch((function(e){i.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showHistory:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewHistory"),this.detailModal.show=!0;var i=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/server_config_history_select",{ConfigId:r[0].ConfigId}).then((function(e){i.hide(),e.Data.forEach((function(e){e.CreateTime=Object(Tt["b"])(e.CreateTime)})),o.detailModal.model={currentVersion:r[0].ConfigVersion,ConfigId:r[0].ConfigId,table:e.Data,detail:""}})).catch((function(e){i.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showTableDeatil:function(e){this.detailModal.model.detail=e.ConfigContent},closeDetailModal:function(){this.backConfigId="",this.detailModal.show=!1,this.detailModal.model=null},configDiff:function(){this.$refs.configForm.validate()&&(this.configDiffModal.type="config",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.configModal.model.ConfigContent,newData:this.configContent})},updateConfigDiff:function(){var e=this.configDiffModal.type,t=this.configModal.model;if(t.ConfigName.toLowerCase().endsWith(".json"))try{JSON.parse(this.configContent)}catch(s){return void alert("config format error:"+s.toString())}if(t.ConfigName.toLowerCase().endsWith(".xml"))try{var a=new DOMParser,o=a.parseFromString(this.configContent,"text/xml"),r=o.getElementsByTagName("parsererror"),i="";if(r.length>0)return i="parsererror"==o.documentElement.nodeName?o.documentElement.childNodes[0].nodeValue:o.getElementsByTagName("parsererror")[0].innerHTML,void alert("config format error:"+i)}catch(s){return void alert("config format error:"+s.toString())}"config"===e&&(this.configModal.model.ConfigContent=this.configContent,this.updateConfigFile())},closeConfigDiffModal:function(){this.configDiffModal.show=!1},nodeConfigDiff:function(){this.$refs.nodeConfigForm.validate()&&(this.configDiffModal.type="nodeConfig",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.nodeConfigModal.model.ConfigContent,newData:this.nodeConfigContent})},historyClick:function(e){this.backConfigId=e.HistoryId}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getConfigList(this.serverData)}},Et=zt,Rt=(a("44ae"),Object(M["a"])(Et,jt,Pt,!1,null,null,null)),Bt=Rt.exports,Jt=a("c9e9"),Vt=a("4527"),Ht=a("3430"),Ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})])]),e.serverList?a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.deleteTime"),prop:"DeleteTime"}})],1):e._e()],1)},Yt=[],Wt={name:"ServerManage",data:function(){return{serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[]}},props:["treeid"],methods:{gotoLog:function(e){var t="/logview.html?History=true&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getServerList:function(e){var t=this;this.$ajax.getJSON("/k8s/api/pod_history_list",{tree_node_id:this.treeid}).then((function(e){e.Data.forEach((function(e){e.CreateTime=J()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.DeleteTime=J()(e.DeleteTime).format("YYYY-MM-DD HH:mm:ss")})),t.serverList=e.Data})).catch((function(e){t.$confirm(e.err_msg||e.message||t.$t("serverList.msg.fail"),t.$t("common.alert")).then((function(){t.getServerList()}))}))},more:function(){this.getServerList(this.continue)}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getServerList()}},Kt=Wt,Ut=(a("29ca"),Object(M["a"])(Kt,Ft,Yt,!1,null,null,null)),Zt=Ut.exports,Gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_history"},[e.serverListShow?a("div",{staticClass:"table_wrap"},[a("div",{staticClass:"table_head"},[a("h4",[e._v(e._s(this.$t("serverList.title.serverList")))])]),a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.SettingState)},[e._v(e._s(t.row.SettingState))])]}}],null,!1,987565344)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.PresentState)},[e._v(e._s(t.row.PresentState))])]}}],null,!1,1754665792)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:t.row.PresentMessage||""}},[a("let-table-operation",[e._v(e._s(t.row.PresentMessage))])],1)]}}],null,!1,524765591)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.historyLink(t.row.id)}}},[e._v(e._s(e.$t("operate.goto")))])]}}],null,!1,1467617346)})],1),a("let-button",{attrs:{theme:"danger"},on:{click:function(t){return e.getMore()}}},[e._v(e._s(e.$t("operate.more")))])],1):a("div",{staticClass:"history_search"},[a("label",{staticClass:"history_search_box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.historySearchKey,expression:"historySearchKey"}],staticClass:"history_search_key",attrs:{type:"text",placeholder:"请输入 应用名/服务名/IP地址 搜索"},domProps:{value:e.historySearchKey},on:{blur:e.historySearch,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.historySearch(t)},input:function(t){t.target.composing||(e.historySearchKey=t.target.value)}}})]),a("div",{staticClass:"history_list_wrap"},[a("div",{staticClass:"history_list_title"},[e._v("Last Access：")]),a("ul",{staticClass:"history_list"},e._l(e.historySearchList,(function(t){return a("li",{key:t,staticClass:"history_item"},[a("a",{staticClass:"history_link",attrs:{href:"javascript:;"},on:{click:function(a){return e.historySearchLink(t)}}},[e._v(e._s(t))])])})),0)])])])},Qt=[],Xt=(a("fb6a"),{name:"ServerHistory",data:function(){return{historySearchKey:"",historySearchList:[],serverList:[],serverListShow:!1,continue:null}},mounted:function(){this.updateHistorySearchKey()},methods:{gotoLog:function(e){var t="/logview.html?History=true&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},getMore:function(){this.historySearch(this.continue)},historySearch:function(e){var t=this,a=this.historySearchKey;a&&(this.updateHistorySearchKey(),this.$ajax.getJSON("/k8s/api/server_search",{searchkey:a,continue:e}).then((function(e){t.continue=e.continue,t.serverList=e.rows,t.serverListShow=!0})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))})))},historySearchLink:function(e){this.historySearchKey=e,this.historySearch()},historyLink:function(e){var t=this;this.$nextTick((function(){t.$parent.selectTree(e),t.$parent.getTreeData()}))},updateHistorySearchKey:function(){var e=this.historySearchKey,t=this.getLocalStorage("taf_history_key")||[];if(e){if(t&&t.length>0){var a=-1;t.forEach((function(t,o){t===e&&(a=o)})),-1!==a&&t.splice(a,1),t.unshift(e)}else t=[e];this.historySearchList=t.slice(0,20),this.setLocalStorage("taf_history_key",JSON.stringify(t))}else this.historySearchList=t},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}}}),ea=Xt,ta=(a("98b3"),Object(M["a"])(ea,Gt,Qt,!1,null,null,null)),aa=ta.exports,oa=a("f298"),ra={name:"Server",components:{callChain:Ct["a"],manage:xt,publish:Ot,config:Bt,"server-monitor":Jt["a"],"property-monitor":Vt["a"],"user-manage":Ht["a"],history:Zt,serverHistory:aa,plugins:oa["a"]},data:function(){return{treeErrMsg:"load failed",treeData:null,treeSearchKey:"",treeid:"",isIconPlay:!1,serverData:{level:5,application:"",server_name:""},BTabs:[],plugins:[],defaultProps:{children:"children",label:"name"},openDelay:1e3,loading:!1,homeTab:"home"}},computed:{base:function(){return"/k8s/".concat(this.treeid)}},filters:{serverTypeFilter:function(e){return"tars"==e?"el-icon-tickets":"el-icon-document-copy"}},watch:{treeid:function(){this.serverData=this.getServerData(),this.$store.commit({type:"increment",name:this.serverData})},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},directives:{vscroll:{componentUpdated:function(e){var t=e||"",a=e.children||[],o="";for(var r in a){var i=a[r],s=i.attributes["class"];if(s&&s.value.indexOf("active")>-1){o=i;break}}if(o.offsetLeft<t.scrollLeft){var l=o.offsetLeft;t.scrollTo(l,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var n=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(n,0)}}}},methods:{getNewServerName:function(e){var t=e&&e.split(".");if(!t)return e;if(1==t.length){var a=e&&e.split(".")[0].substring(1);return"".concat(a)}if(t.length>1){var o=e&&e.split(".")[0].substring(1),r=e&&e.split(".")[e.split(".").length-1].substring(1);return"".concat(o,".").concat(r)}},getName:function(e){var t="";return e.lastIndexOf("/")>-1&&(t=e.substring(e.lastIndexOf("/")+1,e.length)),t},getPlugins:function(){var e=this;this.$ajax.getJSON("/plugin/api/list",{k8s:!0,type:2}).then((function(t){e.plugins=t,console.log(t)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},iconLoading:function(){var e=this;e.isIconPlay||(e.isIconPlay=!0,setTimeout((function(){e.isIconPlay=!1}),1e3))},handleNodeClick:function(e){e.id&&0!=e.type&&(this.selectBTabs(e.id),this.checkCurrBTabs())},filterTextChange:function(){this.$refs.trees.filter(this.treeSearchKey)},filterNode:function(e,t){return!e||-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},treeSearch:function(e){this.iconLoading(),this.getTreeData(this.treeSearchKey,e,!0)},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey="0"!==e.type?e.id:"",a.treeSearchKey&&(e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(e,t,a){var o=this;this.treeData=null,this.$nextTick((function(){o.loading=!0,o.$ajax.getJSON("/k8s/api/tree",{searchKey:e||"",force:a,type:t}).then((function(e){o.loading=!1,o.treeData=e,o.handleData(o.treeData,!0)})).catch((function(e){o.loading=!1,o.treeErrMsg=e.err_msg||e.message||"load failed"}))}))},getServerData:function(){this.treeid||(this.treeid=this.getLocalStorage("k8s_treeid"));if(this.$refs.trees){var e=this.$refs.trees.getNode(this.treeid);e&&(e.data.serverType||"")}var t={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},a=this.treeid.split(".");return a.forEach((function(e){var a=+e.substr(0,1),o=e.substr(1);switch(a){case 1:t.application=o;break;case 2:t.set_name=o;break;case 3:t.set_area=o;break;case 4:t.set_group=o;break;case 5:t.server_name=o;break;default:break}t.level=a})),t},checkTreeid:function(){this.treeid=this.getLocalStorage("k8s_treeid")||""},clickTab:function(e){var t=this,a=this.treeid,o=this.BTabs;o&&o.forEach((function(o){o.id===a&&(o.path=e.name,o.pluginPath=e.name.substr(t.base.length),o.pluginPath=o.pluginPath.substr(0,o.pluginPath.length-"/plugins".length))})),this.setLocalStorage("k8s_tabs",JSON.stringify(o))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;"server"===t&&1!==this.serverData.level&&(a=!0),2===this.serverData.level||"manage"!==t&&"history"!==t&&"publish"!==t||(a=!0),a&&(1===this.serverData.level?this.$router.replace("server"):2===this.serverData.level&&this.$router.replace("manage"))},checkBTabs:function(){var e=this.BTabs,t=this.getLocalStorage("k8s_tabs");t&&t.length>0&&t.forEach((function(t){e.push({id:t.id,path:t.path})}))},checkCurrBTabs:function(){var e=this;this.$nextTick((function(){var t=e.$refs.btabs||"",a=t.children||[],o="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(o=e)})),o.offsetLeft<t.scrollLeft){var r=o.offsetLeft;t.scrollTo(r,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var i=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(i,0)}}))},selectBTabs:function(e){var t=this.BTabs,a=!1;t.forEach((function(t){t.id===e&&(a=!0,t.path="/server/".concat(e,"/manage"))})),a||this.BTabs.push({id:e,path:"/server/".concat(e,"/manage")}),this.treeid=e,this.setLocalStorage("k8s_treeid",JSON.stringify(e)),this.setLocalStorage("k8s_tabs",JSON.stringify(t))},clickBTabs:function(e,t){t==this.homeTab&&(aa.data.serverListShow=!1),this.treeid=t,this.setLocalStorage("k8s_treeid",JSON.stringify(t))},closeBTabs:function(e){var t=this.BTabs,a=0;t.forEach((function(t,o){t.id===e&&(a=o)})),t.splice(a,1),this.setLocalStorage("k8s_tabs",JSON.stringify(t)),t.length>0?this.treeid=t[t.length-1].id:this.treeid="home",this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid))},closeAllBTabs:function(){this.BTabs=[],this.treeid="home",this.setLocalStorage("k8s_tabs",JSON.stringify(this.BTabs)),this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid)),this.getTreeData()},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){this.checkTreeid(),this.checkBTabs(),this.getTreeData(),this.getPlugins(),this.treeid||(this.treeid="home")}},ia=ra,sa=(a("5d82"),Object(M["a"])(ia,O,j,!1,null,null,null)),la=sa.exports,na=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.deploy"),tabkey:"/operation/deploy"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.undeploy"),tabkey:"/operation/undeploy"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.template"),tabkey:"/operation/templates"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.business"),tabkey:"/operation/business"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.application"),tabkey:"/operation/application"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.node"),tabkey:"/operation/node"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.event"),tabkey:"/operation/event"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.image"),tabkey:"/operation/image"}}),e.isAdmin?a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.framework"),tabkey:"/operation/tfc"}}):e._e()],1),a("router-view",{staticClass:"page_operation_children"})],1)},ca=[],da="/operation/deploy",ua={name:"Operation",data:function(){return{isAdmin:!1}},beforeRouteEnter:function(e,t,a){"/operation"===e.path?a(da):a()},beforeRouteLeave:function(e,t,a){da=t.path,a()},created:function(){this.checkAdmin()},methods:{checkAdmin:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isAdmin=!1,t.abrupt("return",e.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){})));case 2:case"end":return t.stop()}}),t)})))()},selectTree:function(e){"/operation"===this.$route.path?this.$router.push(da):this.$router.push({params:{treeid:e}})},onTabClick:function(e){this.$router.replace(e)}}},pa=ua,ma=(a("04e5"),Object(M["a"])(pa,na,ca,!1,null,null,null)),ha=ma.exports,fa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_deploy"},[e.deployObj?a("baseInfo",{attrs:{deployObj:e.deployObj},on:{next:e.next}}):e._e(),e.show?a("install",{ref:"install",attrs:{deployObj:e.deployObj},on:{doInstall:e.doInstall}}):e._e()],1)},va=[],ga=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.deployObj?a("let-form",{ref:"form",attrs:{inline:"","label-position":"top",itemWidth:"30%"},nativeOn:{submit:function(t){return t.preventDefault(),e.next(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.deployObj.app,callback:function(t){e.$set(e.deployObj,"app",t)},expression:"deployObj.app"}},e._l(e.appList,(function(t){return a("let-option",{key:t.ServerApp,attrs:{value:t.ServerApp}},[e._v(e._s(t.ServerApp))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.deployObj.server,callback:function(t){e.$set(e.deployObj,"server",t)},expression:"deployObj.server"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.deployObj.template,callback:function(t){e.$set(e.deployObj,"template",t)},expression:"deployObj.template"}},e._l(e.templates,(function(t){return a("let-option",{key:t.TemplateId,attrs:{value:t.TemplateId}},[e._v(e._s(t.TemplateId))])})),1)],1),a("let-table",{attrs:{data:e.deployObj.servants}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",disabled:!e.deployObj.new,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"props.row.name"}})]}}],null,!1,3854246402)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.port,callback:function(a){e.$set(t.row,"port",a)},expression:"props.row.port"}})]}}],null,!1,1220625212)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{disabled:!e.deployObj.new,label:!0},model:{value:t.row.isTcp,callback:function(a){e.$set(t.row,"isTcp",a)},expression:"props.row.isTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{disabled:!e.deployObj.new,label:!1},model:{value:t.row.isTcp,callback:function(a){e.$set(t.row,"isTcp",a)},expression:"props.row.isTcp"}},[e._v("UDP")])]}}],null,!1,2191313922)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{disabled:!e.deployObj.new,label:!0},model:{value:t.row.isTars,callback:function(a){e.$set(t.row,"isTars",a)},expression:"props.row.isTars"}},[e._v("TARS")]),a("let-radio",{attrs:{disabled:!e.deployObj.new,label:!1},model:{value:t.row.isTars,callback:function(a){e.$set(t.row,"isTars",a)},expression:"props.row.isTars"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}],null,!1,1987037891)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"60px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.thread,callback:function(a){e.$set(t.row,"thread",a)},expression:"props.row.thread"}})]}}],null,!1,759048193)}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.connections"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.connection,callback:function(a){e.$set(t.row,"connection",a)},expression:"props.row.connection"}})]}}],null,!1,2155341273)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.capacity,callback:function(a){e.$set(t.row,"capacity",a)},expression:"props.row.capacity"}})]}}],null,!1,1786573115)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{staticStyle:{"padding-right":"20px"},attrs:{size:"small",type:"number",min:0},model:{value:t.row.timeout,callback:function(a){e.$set(t.row,"timeout",a)},expression:"props.row.timeout"}})]}}],null,!1,1790878308)}),e.deployObj.new?a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.$index?a("let-table-operation",{on:{click:function(a){return e.addAdapter(t.row)}}},[e._v(e._s(e.$t("operate.add"))+" ")]):e._e(),t.$index?a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deployObj.servants.splice(t.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]):e._e()]}}],null,!1,2141953043)}):e._e()],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("common.submit")))])],1):e._e()],1)},ba=[],$a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.DetailModel.show?a("el-dialog",{attrs:{title:e.$t("operate.k8s"),visible:e.DetailModel.show,width:"1060px","before-close":e.closeDetailModel,top:"10px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.DetailModel,"show",t)}}},[a("el-collapse",{attrs:{accordion:""},on:{change:e.HandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"copyNode"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.copyNode")))])]),a("replicas",{ref:"replicas",attrs:{install:!0,replicas:e.deployObjData.replicas},on:{saveReplicas:e.saveReplicas}})],2),a("el-collapse-item",{attrs:{name:"pull"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.pull")))])]),a("pull",{ref:"pull",attrs:{install:!0,pull:e.deployObjData.imagePullPolicy},on:{savePull:e.savePull}})],2),a("el-collapse-item",{attrs:{name:"stacked"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.stacked")))])]),a("stacked",{ref:"stacked",attrs:{install:!0,notStacked:e.deployObjData.notStacked},on:{saveStacked:e.saveStacked}})],2),a("el-collapse-item",{attrs:{name:"launcherType"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.launcherType")))])]),a("launcher-type",{ref:"launcherType",attrs:{install:!0,launcherType:e.deployObjData.launcherType},on:{saveLauncherType:e.saveLauncherType}})],2),a("el-collapse-item",{attrs:{name:"jobModel"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.jobModel")))])]),e.k8sModel?a("jobModel",{ref:"jobModel",attrs:{install:!0,daemonSet:e.deployObjData.daemonSet},on:{saveJobModel:e.saveJobModel}}):e._e()],2),a("el-collapse-item",{attrs:{name:"nodeSelect"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),a("abilityAffinity",{ref:"affinity",attrs:{install:!0,k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator},on:{saveAffinity:e.saveAffinity}})],2),a("el-collapse-item",{attrs:{name:"network"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.network")))])]),a("network-mapping",{ref:"network",attrs:{install:!0,k8sModel:e.k8sModel},on:{saveNetwork:e.saveNetwork}})],2),a("el-collapse-item",{attrs:{name:"disk"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.disk")))])]),a("disk-manger",{ref:"disk",attrs:{install:!0,k8sModel:e.k8sModel,mounts:e.mounts},on:{saveDisk:e.saveDisk}})],2),a("el-collapse-item",{attrs:{name:"resource"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.resource")))])]),a("resource-manger",{ref:"resource",attrs:{install:!0,sourceModel:e.sourceModel},on:{saveResource:e.saveResource}})],2),a("el-collapse-item",{attrs:{name:"yaml"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.yaml")))])]),a("YamlEditor",{ref:"yamlEdit",model:{value:e.yamlContent,callback:function(t){e.yamlContent=t},expression:"yamlContent"}})],2)],1),a("br"),a("el-button",{attrs:{type:"submit",theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("common.submit")))])],1):e._e()},_a=[],ya={name:"installK8S",components:{pull:ae,launcherType:ne,stacked:he,jobModel:_e,replicas:Z,abilityAffinity:Ce,diskManger:Ee,networkMapping:Ae,resourceManger:Fe,YamlEditor:lt,hpaManger:Ge},props:["deployObj"],data:function(){return{DetailModel:{show:!1},activeName:"copyNode",deployObjData:null,k8sModel:{},labelMatchArr:[],LabelMatchOperator:[],sourceModel:{},serverData:{},hpaModel:{minReplicas:"",maxReplicas:"",indicatorData:[]},indicators:[],yamlContent:"",mounts:this.deployObj.mounts||[]}},mounted:function(){this.deployObjData=this.deployObj,this.show()},methods:{HandleClick:function(e){var t=this;"yaml"==e&&this.$nextTick((function(){var e=JSON.parse(JSON.stringify(t.deployObjData));delete e.cloud,t.yamlContent=vt["default"].dump(e),t.$refs.yamlEdit.refresh()}))},show:function(){var e=this;this.getDefaultValue(),this.deployObjData.repo=this.deployObjData.repo||{},this.deployObjData.repo.id="",this.deployObjData.replicas=this.deployObjData.replicas||1,this.deployObjData.daemonSet=this.deployObjData.daemonSet||!1,this.deployObjData.launcherType=this.deployObjData.launcherType||"background",this.deployObjData.notStacked=this.deployObjData.notStacked||!0,this.deployObjData.imagePullPolicy=this.deployObjData.imagePullPolicy||"Always",this.k8sModel.abilityAffinity=this.deployObjData.abilityAffinity||"AppOrServerPreferred",this.k8sModel.labelMatchArr=this.deployObjData.nodeSelector||[],this.k8sModel.HostIpc=this.deployObjData.hostIPC||!1,this.k8sModel.HostNetwork=this.deployObjData.hostNetwork||!1,this.k8sModel.showHostPort=this.deployObjData.hostPorts.length>0,this.k8sModel.HostPortArr=[],(this.deployObjData.servants||[]).forEach((function(t){var a=e.deployObjData.hostPorts.findIndex((function(e){return e.name==t.name}));e.k8sModel.HostPortArr.push({obj:t.name,HostPort:t.port,open:-1!=a})})),this.DetailModel.show=!0},saveLauncherType:function(e){this.deployObjData.launcherType=e},savePull:function(e){this.deployObjData.imagePullPolicy=e},saveStacked:function(e){this.deployObjData.notStacked=e},saveReplicas:function(e){this.deployObjData.replicas=parseInt(e)},saveJobModel:function(e){this.deployObjData.daemonSet=e},saveAffinity:function(e){this.deployObjData.abilityAffinity=e.abilityAffinity,this.deployObjData.nodeSelector=e.NodeSelector},saveHpa:function(e){},saveDisk:function(e){this.deployObjData.mounts=e},saveResource:function(e){this.deployObjData.resources=e},saveNetwork:function(e){var t=this;if(e.HostNetwork&&e.showHostPort)return this.$message.error("".concat(this.$t("deployService.form.portOrNetWork")));e.showHostPort&&(this.deployObjData.hostPorts=[],e.HostPortArr&&e.HostPortArr.forEach((function(e){e.open&&t.deployObjData.hostPorts.push({nameRef:e.obj,port:Math.floor(e.HostPort)})}))),this.deployObjData.hostIPC=e.HostIpc,this.deployObjData.hostNetwork=e.HostNetwork},submit:function(){for(var e in this.$refs)"yamlEdit"!=e&&this.$refs[e].save();var t=vt["default"].load(this.yamlContent);this.deployObjData=Object.assign(this.deployObjData,t),this.$emit("doInstall",this.deployObjData)},closeDetailModel:function(){this.DetailModel.show=!1,this.k8sModel={},this.mounts=[],this.labelMatchArr=[],this.sourceModel={},this.serverData={},this.hpaModel={minReplicas:"",maxReplicas:"",indicatorData:[]}},getDefaultValue:function(){var e=this;this.$ajax.getJSON("/k8s/api/default",{}).then((function(t){e.defaultObj=t.ServerServantElem,e.LabelMatchOperator=t.LabelMatchOperator||[],e.indicators=t.indicators||[]}))},getDeployData:function(){for(var e in this.$refs)"yamlEdit"!=e&&this.$refs[e].save();var t=vt["default"].load(this.yamlContent);return this.deployObjData=Object.assign(this.deployObjData,t),this.deployObjData}}},wa=ya,ka=Object(M["a"])(wa,$a,_a,!1,null,null,null),Sa=ka.exports,Ma={name:"Base",components:{install:Sa},data:function(){return{appList:[],templates:[]}},props:["deployObj"],mounted:function(){this.getServerTemplate(),this.getAppList()},methods:{addAdapter:function(e){e=this.deployObj.servants[this.deployObj.servants.length-1];var t=e.Port+1,a=Object.assign({},e,{Port:t});this.deployObj.servants.push(Object.assign({},a))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.appList=t.Data;var a=e.appList.find((function(t){return t.ServerApp==e.deployObj.app}));-1==a&&e.appList.push({ServerApp:e.deployObj.app})})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerTemplate:function(){var e=this;this.$ajax.getJSON("/k8s/api/template_select",{isAll:!0}).then((function(t){e.templates=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},next:function(){var e=this;this.$ajax.getJSON("/k8s/api/exists",{app:this.deployObj.app,server:this.deployObj.server}).then((function(t){t?e.$message({showClose:!0,message:e.$t("deployService.deploy.existsK8S"),type:"warning"}):e.$emit("next",e.deployObj)})).catch((function(e){}))}}},xa=Ma,Ca=Object(M["a"])(xa,ga,ba,!1,null,null,null),Da=Ca.exports,Na=function(){return{app:"",server:"",template:"",profile:"",servants:[{name:"",port:1e4,isTars:!0,isTcp:!0,thread:2,capacity:1e5,connection:1e4,timeout:3e4}],replicas:2,hostNetwork:!1,hostIPC:!1,hostPorts:[],new:!0}},Ta={name:"OperationDeploy",components:{baseInfo:Da,install:Sa},data:function(){return{templates:[],appList:[],show:!1,deployObj:Na()}},mounted:function(){},methods:{next:function(e){var t=this;console.log(e),this.deployObj=e,this.show=!0,this.$nextTick((function(){t.$refs.install.show()}))},doInstall:function(){var e=this;this.$confirm(this.$t("deployService.form.deployServiceTip"),"Hint",{confirmButtonText:this.$t("common.submit"),cancelButtonText:this.$t("common.cancel"),type:"warning"}).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/install",{deploy:e.deployObj}).then((function(a){t.hide(),e.$message({message:"".concat(e.$t("common.success")),type:"success"}),e.dialogVisible=!1,e.$refs.install.closeDetailModel()})).catch((function(a){t.hide(),201==a.ret_code?e.$message({showClose:!0,message:e.$t("deployService.deploy.existsK8S"),type:"warning"}):e.$message({message:a,type:"error"})}))})).catch((function(){}))}}},La=Ta,Ia=Object(M["a"])(La,fa,va,!1,null,null,null),Aa=Ia.exports,Oa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_history"},[a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestPerson"),prop:"RequestPerson",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalTime"),prop:"ApprovalTime"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalResult"),prop:"ApprovalResult"},scopedSlots:e._u([{key:"default",fn:function(t){return[""+t.row.ApprovalResult==="true"?a("span",{staticClass:"success"},[e._v("Approval")]):""+t.row.ApprovalResult==="false"?a("span",{staticClass:"warn"},[e._v("Reject")]):a("span",[e._v(e._s(t.row.ApprovalResult))])]}}])}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalMark"),prop:"ApprovalMark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}])})],1),""!=this.Continue?a("let-button",{on:{click:e.fetchData}},[e._v("more")]):e._e(),a("let-modal",{attrs:{title:e.$t("deployService.title.history"),width:"80%"},on:{"on-confirm":e.closeViewModal,"on-cancel":e.closeViewModal},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("let-form",{ref:"viewForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerApp))]),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerName))]),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerMark))]),a("let-table",{attrs:{data:e.viewModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Name))]}}],null,!1,1485259994)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port")},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[e._v(e._s(t.row.Port))]}}],null,!1,1805883483)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTcp?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTars?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}],null,!1,3126702782)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),a("let-table-column",{attrs:{width:"10px"}})],1),a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalResult")}},[e.viewModal.model.ApprovalResult?a("span",{class:e.viewModal.model.ApprovalResult?"success":"warn"},[e._v(e._s(e.viewModal.model.ApprovalResult?"通过":"驳回"))]):e._e()]),a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalMark"),itemWidth:"100%"}},[e._v(e._s(e.viewModal.model.ApprovalMark))])],1):e._e()],1)],1)},ja=[],Pa={name:"OperationHistory",data:function(){return{items:[],Continue:null,viewModal:{show:!1,model:null},K8SisCheckedAll:!1,K8SNodeList:[]}},mounted:function(){this.getDefaultValue(),this.getNodeList(),this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/approval_select",{Continue:this.Continue}).then((function(a){t.hide(),e.Continue=a.Continue,a.Data&&a.Data.forEach((function(t){var a=[];if(t.ServerServant){for(var o in t.ServerServant)a.push(t.ServerServant[o]);t.ServerServant=a}t.ApprovalTime=Object(Tt["b"])(t.ApprovalTime,"YYYY-MM-DD HH:mm:ss"),e.items.push(t)}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_list",{isAll:!0}).then((function(t){e.K8SNodeList=t}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){var t=this.adapterServerK8S(e);this.viewModal.model=t,this.viewModal.show=!0},adapterServerK8S:function(e){return e}}},qa=Pa,za=(a("afb9"),Object(M["a"])(qa,Oa,ja,!1,null,null,null)),Ea=za.exports,Ra=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_undeploy"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.fetchData(!0,1)}}},[e._v(e._s(e.$t("operate.search")))]),a("span",[a("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData(!0,1)}}})])],1)],1),a("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"60px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{on:{change:function(a){return e.checkChange(t.row)}},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.source")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.Source["tars.io/CloudInstall"]?a("el-tag",{staticStyle:{cursor:"pointer"},on:{click:function(a){return e.goMarket(t.row)}}},[e._v(" "+e._s(t.row.Source["tars.io/CloudInstall"].group+"/"+t.row.Source["tars.io/CloudInstall"].name+":"+t.row.Source["tars.io/CloudInstall"].version)+" ")]):e._e()]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.undeployServer}},[e._v(e._s(e.$t("operate.undeploy")))])],1),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1)],1)},Ba=[],Ja={name:"OperationUndeploy",data:function(){return{query:{ServerApp:"",ServerName:""},pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},serverList:[],isCheckedAll:!1,checkedList:[]}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(e,t){var a=this,o=this.$refs.table.$loading.show();return console.log("fetchData",e,t),this.$ajax.getJSON("/k8s/api/server_list",{ServerApp:this.query.ServerApp,ServerName:this.query.ServerName,page:t||this.pagination.page,size:this.pagination.size,force:e}).then((function(e){o.hide(),a.serverList=[],e.hasOwnProperty("Data")&&(e.Data.forEach((function(e){e.isChecked=!1,e.Source=e.Source||"{}",e.Source=JSON.parse(e.Source)})),a.serverList=e.Data),a.pagination.total=Math.ceil(e.Count.AllCount/a.pagination.size)})).catch((function(e){o.hide(),a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.message||e.err_msg))}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},checkChange:function(e){var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.ServerId===e.ServerId&&(o=!0)})),o||t.push(e)}else{var r=!1,i=-1;t.forEach((function(t,a){t.ServerId===e.ServerId&&(r=!0,i=a)})),r&&t.splice(i,1)}},undeployServer:function(){var e=this,t=this.checkedList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("dialog.tips.item"));else{var a=t.map((function(e){return e.ServerId}));this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/server_undeploy",{ServerIds:a}).then((function(a){t.hide(),e.fetchData(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}))}},goMarket:function(e){var t;t=e.Source["tars.io/CloudProduct"]?"/static/market/index.html#/market/product/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version):"/static/market/index.html#/market/service/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version),window.open(t)}}},Va=Ja,Ha=(a("4e15"),Object(M["a"])(Va,Ra,Ba,!1,null,null,null)),Fa=Ha.exports,Ya=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_templates"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.template_name,callback:function(t){e.$set(e.query,"template_name",t)},expression:"query.template_name"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.parents_name,callback:function(t){e.$set(e.query,"parents_name",t)},expression:"query.parents_name"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addTempate")))]),a("span",[a("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"TemplateName",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("template.search.parentTemplate"),prop:"TemplateParent",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"UpdateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("template.add.title"):this.$t("template.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("template.add.templateFormatTips"),required:"","required-tip":e.$t("template.add.templateNameTips"),pattern:"^[a-zA-Z]([.a-zA-Z0-9]+)?$","pattern-tip":e.$t("template.add.templateFormatTips")},model:{value:e.detailModal.model.TemplateName,callback:function(t){e.$set(e.detailModal.model,"TemplateName",t)},expression:"detailModal.model.TemplateName"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate"),required:""}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateParent,callback:function(t){e.$set(e.detailModal.model,"TemplateParent",t)},expression:"detailModal.model.TemplateParent"}},[a("let-option",{attrs:{value:""}},[e._v(e._s(e.$t("pub.dlg.defaultValue")))]),e._l(e.items,(function(t){return a("let-option",{key:t.id,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName))])}))],2)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.detailModal.model.CreateMark,callback:function(t){e.$set(e.detailModal.model,"CreateMark",t)},expression:"detailModal.model.CreateMark"}})],1),a("let-form-item",{attrs:{label:e.$t("template.form.content"),required:""}},[a("let-input",{attrs:{type:"textarea",rows:10,size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateContent,callback:function(t){e.$set(e.detailModal.model,"TemplateContent",t)},expression:"detailModal.model.TemplateContent"}})],1)],1):e._e()],1)],1)},Wa=[],Ka={name:"OperationTemplates",data:function(){return{query:{template_name:"",parents_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/template_select",{TemplateName:this.query.template_name,ParentName:this.query.parents_name}).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.UpdateTime=J()(e.UpdateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.TemplateId?"/k8s/api/template_update":"/k8s/api/template_create",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/template_delete",{TemplateId:e.TemplateId}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},Ua=Ka,Za=(a("3976"),Object(M["a"])(Ua,Ya,Wa,!1,null,null,null)),Ga=Za.exports,Qa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_approval"},[a("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[a("div",[a("span",[e._v(e._s(e.$t("deployService.title.baseImage")))]),a("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addItem}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),a("let-table",{ref:"table",attrs:{data:e.baseLists,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("imageService.form.SupportedType"),prop:"SupportedTypeShow"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Count"),prop:"Count",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),a("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[a("div",[a("span",[e._v(e._s(e.$t("deployService.title.nodeImage")))]),a("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addNodeImage}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),a("let-table",{ref:"table",attrs:{data:e.tafNodeImages,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[t.row.isDefault?a("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(t.row.Id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("pub.dlg.imageAddress"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("pub.dlg.mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editNodeImage(t.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.deleteNodeImage(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),a("let-modal",{attrs:{title:e.baseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.baseModal.show,callback:function(t){e.$set(e.baseModal,"show",t)},expression:"baseModal.show"}},[e.baseModal.model?a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("imageService.form.SupportedType"),itemWidth:"600px",required:""}},e._l(e.SupportedType,(function(t){return a("let-checkbox",{key:t,attrs:{value:e.baseModal.model.SupportedType.indexOf(t)>-1},on:{change:function(a){return e.SupportedTypeChange(t)}}},[e._v(" "+e._s(t)+" ")])})),1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.baseModal.model.Mark,callback:function(t){e.$set(e.baseModal.model,"Mark",t)},expression:"baseModal.model.Mark"}})],1)],1):e._e()],1),a("let-modal",{attrs:{footShow:!1,title:this.$t("imageService.title.view"),width:"80%"},model:{value:e.releaseListsModal.show,callback:function(t){e.$set(e.releaseListsModal,"show",t)},expression:"releaseListsModal.show"}},[a("br"),e.releaseListsModal.model?a("let-table",{ref:"table",attrs:{data:e.releaseListsModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("imageService.form.Image"),prop:"Image",width:"40%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreatePerson"),prop:"CreatePerson",width:"10%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.view"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.removeReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,3590708250)})],1):e._e()],1),a("let-modal",{attrs:{title:e.releaseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveReleaseItem,"on-cancel":e.closeReleaseModal},model:{value:e.releaseModal.show,callback:function(t){e.$set(e.releaseModal,"show",t)},expression:"releaseModal.show"}},[e.releaseModal.model?a("let-form",{ref:"releaseForm"},[a("let-form-item",{attrs:{label:e.$t("imageService.form.Image"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.ImageHolder"),required:"","required-tip":e.$t("imageService.form.ImageTips")},model:{value:e.releaseModal.model.Image,callback:function(t){e.$set(e.releaseModal.model,"Image",t)},expression:"releaseModal.model.Image"}})],1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Secret")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.SecretTips"),required:"","required-tip":e.$t("imageService.form.SecretTips")},model:{value:e.releaseModal.model.Secret,callback:function(t){e.$set(e.releaseModal.model,"Secret",t)},expression:"releaseModal.model.Secret"}})],1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.releaseModal.model.Mark,callback:function(t){e.$set(e.releaseModal.model,"Mark",t)},expression:"releaseModal.model.Mark"}})],1)],1):e._e()],1),a("el-dialog",{attrs:{title:e.nodeImageModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),visible:e.nodeImageModal.show,width:"600px","before-close":e.closeNodeModal,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.nodeImageModal,"show",t)}}},[a("el-form",{ref:"nodeForm",attrs:{model:e.nodeImageModal.model,size:"small","label-position":"top",rules:e.rules}},[a("el-form-item",{attrs:{label:"Id",prop:"Id"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Id,callback:function(t){e.$set(e.nodeImageModal.model,"Id",t)},expression:"nodeImageModal.model.Id"}})],1),a("el-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),prop:"Image"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Image,callback:function(t){e.$set(e.nodeImageModal.model,"Image",t)},expression:"nodeImageModal.model.Image"}})],1),a("el-form-item",{attrs:{label:e.$t("pub.dlg.mark"),prop:"Mark"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Mark,callback:function(t){e.$set(e.nodeImageModal.model,"Mark",t)},expression:"nodeImageModal.model.Mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeNodeModal}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveNodeModal}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],1)},Xa=[],eo=(a("a15b"),{name:"OperationImage",data:function(){return{baseLists:[],tafNodeImages:[],SupportedType:["cpp","nodejs","java-war","java-jar","go"],baseModal:{show:!1,model:null,isNew:!1},releaseListsModal:{Name:"",show:!1,model:null,isNew:!1},releaseModal:{Name:"",show:!1,model:null,isNew:!1},nodeImageModal:{show:!1,model:{},isNew:!1},rules:{Id:[{required:!0,message:"".concat(this.$t("imageService.node.idTip")),trigger:"blur"}],Image:[{required:!0,message:"".concat(this.$t("imageService.node.imageAddressTip")),trigger:"blur"}],Mark:[{required:!0,message:"".concat(this.$t("imageService.node.markTip")),trigger:"blur"}]}}},mounted:function(){this.fetchData(),this.getTafNodeList()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_select",{}).then((function(a){t.hide(),e.baseLists=a.Data,e.baseLists.forEach((function(e){e.SupportedTypeShow=e.SupportedType.join(", "),e.CreateTime=J()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},SupportedTypeChange:function(e){this.baseModal.model.SupportedType.indexOf(e)>-1?this.baseModal.model.SupportedType.splice(this.baseModal.model.SupportedType.indexOf(e),1):this.baseModal.model.SupportedType.push(e)},addItem:function(){this.baseModal.model={SupportedType:[]},this.baseModal.show=!0,this.baseModal.isNew=!0},fetchReleaseData:function(e){var t=this,a=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_release_select",{Name:e}).then((function(o){a.hide(),t.releaseListsModal.Name=e,t.releaseListsModal.model=o.Data,t.releaseListsModal.model.forEach((function(t){t.CreateTime=J()(t.CreateTime).format("YYYY-MM-DD HH:mm:ss"),t.Name=e}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewItem:function(e){var t=this;this.fetchReleaseData(e.Name).then((function(){t.releaseListsModal.show=!0}))},editItem:function(e){this.baseModal.model=e,this.baseModal.show=!0,this.baseModal.isNew=!1},removeItem:function(e){var t=this,a=this.$refs.table.$loading.show();this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){return t.$ajax.postJSON("/k8s/api/image_delete",{Name:e.Name}).then((function(e){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.baseModal.show=!1,this.baseModal.model=null},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.baseModal.model,a=this.$Loading.show(),o=t.Name?"/k8s/api/image_update":"/k8s/api/image_create";this.$ajax.postJSON(o,t).then((function(){a.hide(),e.fetchData().then((function(){e.baseModal.show=!1,e.$tip.success(e.$t("common.success"))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},addReleaseItem:function(e){this.releaseModal.model={Name:e},this.releaseModal.show=!0,this.releaseModal.isNew=!0},closeReleaseModal:function(){this.$refs.releaseForm.resetValid(),this.releaseModal.show=!1,this.releaseModal.model=null},editReleaseItem:function(e){this.releaseModal.model=e,this.releaseModal.show=!0,this.releaseModal.isNew=!1},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.fetchReleaseData(e.Name).then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},saveReleaseItem:function(){var e=this;if(this.$refs.releaseForm.validate()){var t=this.releaseModal.model,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/image_release_create",t).then((function(){a.hide(),e.$tip.success(e.$t("common.success")),e.fetchReleaseData(t.Name),e.releaseModal.show=!1})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getTafNodeList:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDefaultNodeImage();case 2:a=t.sent,e.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){t.Data.forEach((function(e){e.Image==a&&(e.isDefault=!0)})),e.tafNodeImages=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}));case 4:case"end":return t.stop()}}),t)})))()},getDefaultNodeImage:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:return a=t.sent,o=a.filter((function(e){return"nodeImage.image"===e.column})),t.abrupt("return",1==o.length?o[0].value:"");case 5:case"end":return t.stop()}}),t)})))()},setDefault:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",{column:"nodeImage.image",value:e.Image}).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},addNodeImage:function(){this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!0},editNodeImage:function(e){this.nodeImageModal.model=Object.assign({},e),this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!1},saveNodeModal:function(){var e=this;this.$refs.nodeForm.validate((function(t){if(!t)return!1;e.$ajax.postJSON("/k8s/api/image_node_update",e.nodeImageModal.model).then((function(t){e.closeNodeModal(),e.getTafNodeList(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}))},deleteNodeImage:function(e){var t=this;if(e.isDefault)this.$message.warning("".concat(this.$t("imageService.node.deleteTip")));else{var a=Object.assign({},e);this.$ajax.postJSON("/k8s/api/image_node_delete",a).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},closeNodeModal:function(){this.nodeImageModal.show=!1,this.nodeImageModal.model={},this.$refs.nodeForm.resetFields()}}}),to=eo,ao=(a("1a6b"),a("c3f0"),Object(M["a"])(to,Qa,Xa,!1,null,"54dfd50a",null)),oo=ao.exports,ro=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_application"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addApplication")))]),a("span",[a("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.business"),prop:"BusinessName",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.appMark"),prop:"AppMark"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createPerson"),prop:"CreatePerson"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[a("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}},e._l(e.BusinessList,(function(t){return a("let-option",{key:t.BusinessName,attrs:{value:t.BusinessName}},[e._v(e._s(t.BusinessShow))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.appMark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.AppMark,callback:function(t){e.$set(e.detailModal.model,"AppMark",t)},expression:"detailModal.model.AppMark"}})],1)],1):e._e()],1)],1)},io=[],so={name:"BaseApplication",data:function(){return{query:{ServerApp:"",BusinessName:""},items:[],BusinessList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData(),this.getBusinessList()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/application_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.CreateTime=J()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")})),e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/application_create":"/k8s/api/application_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/application_delete",{ServerApp:e.ServerApp}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getBusinessList:function(){var e=this;this.$ajax.getJSON("/k8s/api/business_select",{isAll:!0}).then((function(t){e.BusinessList=[{BusinessMark:"",BusinessName:"",BusinessOrder:0,BusinessShow:"",CreatePerson:"",CreateTime:new Date}].concat(t.Data)}))}}},lo=so,no=(a("5de2"),Object(M["a"])(lo,ro,io,!1,null,null,null)),co=no.exports,uo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_business"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessShow,callback:function(t){e.$set(e.query,"BusinessShow",t)},expression:"query.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessMark,callback:function(t){e.$set(e.query,"BusinessMark",t)},expression:"query.BusinessMark"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("filter.btn.add")))]),a("span",[a("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("filter.title.business"),prop:"BusinessName",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.name"),prop:"BusinessShow",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.mark"),prop:"BusinessMark",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.order"),prop:"BusinessOrder"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.appListItem(t.row)}}},[e._v(e._s(e.$t("table.btn.appList")))]),a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[a("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessShow,callback:function(t){e.$set(e.detailModal.model,"BusinessShow",t)},expression:"detailModal.model.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.order"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",min:0,max:100,required:""},model:{value:e.detailModal.model.BusinessOrder,callback:function(t){e.$set(e.detailModal.model,"BusinessOrder",t)},expression:"detailModal.model.BusinessOrder"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.BusinessMark,callback:function(t){e.$set(e.detailModal.model,"BusinessMark",t)},expression:"detailModal.model.BusinessMark"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.AppModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.appListSaveItem,"on-cancel":e.closeAppModal},model:{value:e.AppModal.show,callback:function(t){e.$set(e.AppModal,"show",t)},expression:"AppModal.show"}},[e.AppModal.model?a("let-form",{ref:"AppForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[a("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessName,callback:function(t){e.$set(e.AppModal.model,"BusinessName",t)},expression:"AppModal.model.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[a("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessShow,callback:function(t){e.$set(e.AppModal.model,"BusinessShow",t)},expression:"AppModal.model.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[a("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}},[e._v("全选")]),a("div",{staticClass:"checkbox_list"},e._l(e.AppList,(function(t){return a("let-checkbox",{key:t.ServerApp,staticClass:"checkbox_item",attrs:{value:e.checkBoxAddList.indexOf(t.ServerApp)>-1},on:{change:function(a){return e.checkedChange(t.ServerApp)}}},[e._v(e._s(t.ServerApp))])})),1)],1)],1):e._e()],1)],1)},po=[],mo={name:"BaseBusiness",data:function(){return{isCheckedAll:!1,checkBoxAddList:[],checkBoxDelList:[],query:{BusinessName:"",BusinessShow:"",BusinessMark:""},items:[],AppList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1},AppServerArr:[],AppServerStr:"",AppServerDeleteArr:[],AppModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},watch:{isCheckedAll:function(){var e=this,t=this.isCheckedAll;t?this.AppList.forEach((function(t){-1===e.checkBoxAddList.indexOf(t.ServerApp)&&e.checkBoxAddList.push(t.ServerApp),e.checkBoxDelList=[]})):this.AppList.forEach((function(t){-1===e.checkBoxDelList.indexOf(t.ServerApp)&&e.checkBoxDelList.push(t.ServerApp),e.checkBoxAddList=[]}))}},methods:{checkedChange:function(e){-1===this.checkBoxAddList.indexOf(e)?(this.checkBoxAddList.push(e),this.checkBoxDelList.splice(this.checkBoxDelList.indexOf(e),1)):(this.checkBoxDelList.push(e),this.checkBoxAddList.splice(this.checkBoxAddList.indexOf(e),1)),0===this.checkBoxAddList.length&&(this.isCheckedAll=!1)},gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/business_select",Object.assign(this.query,{isAll:!1,page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},closeAppModal:function(){this.$refs.AppForm.resetValid(),this.AppModal.show=!1,this.AppModal.model=null},addItem:function(){this.checkBoxAddList=[],this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.checkBoxAddList=e.AppServer||[],this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/business_create":"/k8s/api/business_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/business_delete",{BusinessName:e.BusinessName}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.AppList=t.Data}))},appListItem:function(e){var t=this;this.getAppList();var a=this.$refs.table.$loading.show();return this.$ajax.postJSON("/k8s/api/business_list_app",{BusinessNames:[e.BusinessName]}).then((function(e){a.hide(),t.appListEditItem(e[0])})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},appListEditItem:function(e){this.checkBoxAddList=e.App||[],this.AppModal.model=e,this.AppModal.show=!0,this.AppModal.isNew=!1},appListSaveItem:function(){var e=this;if(this.$refs.AppForm.validate()){var t=this.AppModal.model,a=(this.AppModal.isNew,"/k8s/api/business_add_app"),o=this.$Loading.show();this.checkBoxAddList&&this.checkBoxAddList.length>0?this.$ajax.postJSON(a,{BusinessName:t.BusinessName,AppNames:this.checkBoxAddList}).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeAppModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})):(o.hide(),this.closeAppModal())}}}},ho=mo,fo=(a("b50eb"),Object(M["a"])(ho,uo,po,!1,null,null,null)),vo=fo.exports,go=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_node"},[e.showDetail?e._e():[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{itemWidth:"600px"}},[a("el-tag",{staticStyle:{"margin-top":"30px","margin-right":"10px",cursor:"pointer"},attrs:{effect:e.hold?"dark":"plain",type:"warning"},on:{click:e.chooseHold}},[e._v(" Hold ")]),a("el-tag",{staticStyle:{"margin-top":"30px","margin-right":"10px",cursor:"pointer"},attrs:{effect:e.localPV?"dark":"plain",type:"warning"},on:{click:e.chooseLocalPV}},[e._v(" LocalPV ")])],1),a("let-form-item",{staticStyle:{float:"right"},attrs:{itemWidth:"600px"}},[a("span",{staticStyle:{float:"right","margin-top":"30px"}},[a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain"}},[e._v(" "+e._s(e.$t("filter.title.CommonTag"))+" ")]),a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain",type:"warning"}},[e._v(" "+e._s(e.$t("filter.title.FrameWorkTag"))+" ")]),a("let-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditCommon}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),a("let-button",{attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditAffinity}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])],1)])],1),a("el-table",{ref:"table",attrs:{data:e.items,width:"100%",border:"",stripe:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeName"),prop:"NodeName",width:"150"}}),a("el-table-column",{attrs:{label:e.$t("common.status"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["Active"==t.row.status?a("el-tag",{attrs:{size:"small",effect:"plain",type:"success"}},[e._v(" "+e._s(t.row.status)+" ")]):e._e(),"Unavailable"==t.row.status?a("el-tag",{attrs:{size:"small",effect:"plain",type:"danger"}},[e._v(" "+e._s(t.row.status)+" ")]):e._e()]}}],null,!1,3672167682)}),a("el-table-column",{attrs:{label:"Version",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.NodInfo.kubeletVersion)+" ")]}}],null,!1,2972685414)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeFramework"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-switch",{on:{change:function(a){return e.changeStatus(t.row)}},model:{value:t.row.NodePublic,callback:function(a){e.$set(t.row,"NodePublic",a)},expression:"scope.row.NodePublic"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("开")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("关")])])]}}],null,!1,1705370074)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeLabels")},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.commonLabels,(function(t,o){return a("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+t)+" ")])}))}}],null,!1,2926056322)}),a("el-table-column",{attrs:{label:e.$t("filter.title.AbilityTag"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.NodeAbility,(function(t){return a("el-tag",{key:t,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("abilityType")(t)}},[e._v(" "+e._s(t)+" ")])}))}}],null,!1,3467388542)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeAddress"),width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.NodeAddress,(function(t){return a("div",{key:t.NodeName,staticStyle:{margin:"2px 2px"}},[a("el-tag",{attrs:{effect:"plain",type:"info"}},[e._v(e._s(t.type+":"+t.address)+" ")])],1)}))}}],null,!1,402632902)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{staticStyle:{"padding-left":"10px"},on:{click:function(a){return e.viewItem(t.row)}}},[e._v(" "+e._s(e.$t("operate.view"))+" ")]),a("br"),a("let-table-operation",{on:{click:function(a){return e.editCommonTag(t.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),a("br"),a("let-table-operation",{on:{click:function(a){return e.editAbilityTag(t.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])]}}],null,!1,3380904561)})],1),a("br"),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}}),a("el-dialog",{attrs:{title:e.$t("filter.dialog.editCommonTag"),visible:e.commonTagDialog.show,width:"40%","before-close":e.closeCommonTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.commonTagDialog,"show",t)}}},[a("el-form",{ref:"commonForm",attrs:{model:e.commonTagDialog.model,"inline-message":""}},[a("el-table",{attrs:{data:e.commonTagDialog.model.commonArr,border:""}},[a("template",{slot:"empty"},[a("let-table-operation",{on:{click:function(t){return e.addCommonTag(0,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1),a("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"commonArr."+t.$index+".name",rules:[{validator:function(a,o,r){e.validateTagName(a,o,r,t.row.name)},trigger:"blur"}]}},[a("el-input",{model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})],1)]}}],null,!1,1739047982)}),a("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}],null,!1,4065949250)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.addCommonTag(t.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.delCommonTag(t.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2871227552)})],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeCommonTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCommonTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1),a("el-dialog",{attrs:{title:e.$t("filter.dialog.editAbilityTag"),visible:e.abilityTagDialog.show,width:"40%","before-close":e.closeAbilityTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.abilityTagDialog,"show",t)}}},[a("el-form",{ref:"abilityForm",attrs:{model:e.abilityTagDialog.model,"inline-message":""}},[a("el-table",{attrs:{data:e.abilityTagDialog.model.abilityArr,border:""}},[a("template",{slot:"empty"},[a("let-table-operation",{on:{click:function(t){return e.addAbilityTag(0,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("filter.tip.addAffinityGroup"))+" ")])],1),a("el-table-column",{attrs:{label:e.$t("filter.title.app")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"abilityArr."+t.$index+".application",rules:[{validator:function(a,o,r){e.validateAppName(a,o,r,t.row.application)},trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),filterable:""},on:{change:function(a){return e.changeApp(t.$index,t.row.application)}},model:{value:t.row.application,callback:function(a){e.$set(t.row,"application",a)},expression:"scope.row.application"}},e._l(e.appList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)]}}],null,!1,3541109157)}),a("el-table-column",{attrs:{label:e.$t("filter.title.serverName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",filterable:""},model:{value:t.row.serverName,callback:function(a){e.$set(t.row,"serverName",a)},expression:"scope.row.serverName"}},e._l(t.row.serverNames,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}],null,!1,695734775)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.addAbilityTag(t.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.delAbilityTag(t.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2609683168)})],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeAbilityTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveAbilityTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],e.showDetail?a("node-detail",{attrs:{nodeDetail:e.nodeDetail},on:{closeDetail:e.closeDetail}}):e._e()],2)},bo=[],$o=(a("2ca0"),a("2ef0")),_o=a.n($o),yo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("span",{staticClass:"title"},[e._v(e._s(e.nodeDetail.NodeName))]),a("span",{staticStyle:{"margin-left":"10px"}},["Active"==e.nodeDetail.status?a("el-tag",{attrs:{effect:"plain",type:"success"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e(),"Unavailable"==e.nodeDetail.status?a("el-tag",{attrs:{effect:"plain",type:"danger"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e()],1),a("span",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-back",size:"small"},on:{click:e.closeDetail}})],1)]),a("div",{staticStyle:{"margin-top":"10px"}},[a("span",[e._v("Age:"+e._s(e.getAge(e.nodeDetail.CreationTimestamp)))])]),a("el-divider"),a("div",[e._l(e.nodeDetail.NodeAddress,(function(t){return a("span",{staticClass:"item"},[e._v(e._s(t.type+":"+t.address))])})),a("span",{staticClass:"item"},[e._v("Version:"+e._s(e.nodeDetail.NodInfo.kernelVersion))]),a("span",{staticClass:"item"},[e._v("OS:"+e._s(e.nodeDetail.NodInfo.osImage))]),a("span",{staticClass:"item"},[e._v("containerRuntimeVersion:"+e._s(e.nodeDetail.NodInfo.containerRuntimeVersion))])],2),a("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Labels: "),e._l(e.nodeDetail.Labels,(function(t,o){return a("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+t)+" ")])}))],2),a("el-divider"),a("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Conditions: "),e._l(e.nodeDetail.Conditions,(function(t){return a("el-tooltip",{key:t.type,attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},e._l(t,(function(t,o){return a("p",{key:o,staticStyle:{margin:"4px 0","font-size":"12px"}},[e._v(" "+e._s(o+":"+t)+" ")])})),0),a("el-tag",{staticStyle:{margin:"2px 15px"},attrs:{effect:"dark",type:e._f("conditionsStatus")(t)}},[e._v(" "+e._s(t.type)+" ")])],1)})),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("CPU")]),a("span",{staticStyle:{float:"right"}},[e._v("0 of 4")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("MEMORY")]),a("span",{staticStyle:{float:"right"}},[e._v("0 of 7.78 GiB ")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("PODS")]),a("span",{staticStyle:{float:"right"}},[e._v("8 of 110")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:7.3}})],1)],1)],1)],2),a("el-divider"),a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"Info"}},[a("el-form",{attrs:{"label-width":"300px","label-position":"left"}},e._l(e.nodeDetail.NodInfo,(function(t,o){return a("div",{key:o},[a("el-form-item",{attrs:{label:o}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1),a("el-tab-pane",{attrs:{label:"Images"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Images,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"names"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.names,(function(t){return a("p",{key:t},[e._v(" "+e._s(t)+" ")])}))}}])}),a("el-table-column",{attrs:{label:"size",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(Math.ceil(t.row.sizeBytes/1024/1024)+"M")+" ")]}}])})],1)],1),a("el-tab-pane",{attrs:{label:"Taints"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Taints,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"effect",prop:"effect",width:"300"}}),a("el-table-column",{attrs:{label:"key",prop:"key"}})],1)],1),a("el-tab-pane",{attrs:{label:"Conditions"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Conditions,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),a("el-table-column",{attrs:{label:"status",prop:"status",width:"80"}}),a("el-table-column",{attrs:{label:"message",prop:"message"}}),a("el-table-column",{attrs:{label:"reason",prop:"reason"}}),a("el-table-column",{attrs:{label:"lastTransitionTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTransitionTime)))]}}])}),a("el-table-column",{attrs:{label:"lastHeartbeatTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastHeartbeatTime)))]}}])})],1)],1)],1)],1)},wo=[],ko={name:"node-detail",props:["nodeDetail"],filters:{tagType:function(e){return e.startsWith("tars.io/node")?"warning":e.startsWith("tars.io/ability")?"success":""},conditionsStatus:function(e){return"False"==e.status?"danger":"success"},timeFormat:function(e){return J()(e).format("YYYY-MM-DD HH:mm:ss")}},methods:{closeDetail:function(){this.$emit("closeDetail")},getAge:function(e){var t=Math.ceil((new Date-new Date(e))/36e5),a=0,o=0;return t>=24&&(a=Math.ceil(t/24),o=t%24),"".concat(a,"d").concat(o>0?o+"h":"")}}},So=ko,Mo=(a("f333"),Object(M["a"])(So,yo,wo,!1,null,"38a1db4e",null)),xo=Mo.exports,Co={name:"BaseBusiness",components:{nodeDetail:xo},data:function(){return{multipleSelection:[],query:{NodeName:""},items:[],pagination:{page:1,size:10,total:1},commonTagDialog:{flag:"one",show:!1,model:{}},abilityTagDialog:{flag:"one",show:!1,model:{}},appList:[],serList:[],showDetail:!1,localPV:!1,hold:!1,nodeDetail:{}}},filters:{tagType:function(e){return e.startsWith("tars.io")?"warning":""},abilityType:function(e){return-1!=e.indexOf(".")?"success":""}},computed:{batchEnabled:function(){return this.multipleSelection.length>0}},mounted:function(){this.fetchData(),this.getAppList()},methods:{handleSelectionChange:function(e){this.multipleSelection=e},gotoPage:function(e){this.pagination.page=e,this.fetchData()},chooseHold:function(){this.hold=!this.hold,this.fetchData()},chooseLocalPV:function(){this.localPV=!this.localPV,this.fetchData()},fetchData:function(){var e=this;return this.$ajax.getJSON("/k8s/api/node_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size,localPV:this.localPV,hold:this.hold})).then((function(t){t.Data.forEach((function(e){var t="";e.Conditions.forEach((function(e){"Ready"==e.Type&&(t=e.status)})),e.status="False"==t?"Unavailable":"Active"})),e.items=t.Data,e.pagination.total=Math.ceil(t.Count.AllCount/e.pagination.size)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},editCommonTag:function(e){for(var t in this.commonTagDialog.show=!0,this.commonTagDialog.flag="one",this.commonTagDialog.model=_o.a.cloneDeep(e),this.commonTagDialog.model.commonArr=[],e.Labels)t.startsWith("tars.io/node")||t.startsWith("tars.io/ability")||this.commonTagDialog.model.commonArr.push({name:t,value:e.Labels[t]})},batchEditCommon:function(){1==this.multipleSelection.length?this.editCommonTag(this.multipleSelection[0]):(this.commonTagDialog.show=!0,this.commonTagDialog.flag="batch",this.commonTagDialog.model.nodes=this.multipleSelection,this.commonTagDialog.model.commonArr=[{name:"",value:""}])},saveCommonTag:function(){var e=this;if(this.validate(this.$refs.commonForm)){var t=[];this.commonTagDialog.model.nodes&&(t=this.commonTagDialog.model.nodes.map((function(e){return e.NodeName})));var a="",o={};"one"==this.commonTagDialog.flag?(a="/k8s/api/edit_common_tag",o={nodeName:this.commonTagDialog.model.NodeName,tags:this.commonTagDialog.model.commonArr}):(a="/k8s/api/batch_edit_common_tag",o={nodeNames:t,tags:this.commonTagDialog.model.commonArr}),this.$ajax.postJSON(a,o).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeCommonTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeCommonTagDialog:function(){this.commonTagDialog={flag:"one",show:!1,model:{}}},editAbilityTag:function(e){var t=this;return Object(z["a"])(regeneratorRuntime.mark((function a(){var o,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.abilityTagDialog.show=!0,t.abilityTagDialog.flag="one",t.abilityTagDialog.model=_o.a.cloneDeep(e),t.abilityTagDialog.model.abilityArr=[],o=Object(ke["a"])(e.NodeAbility),a.prev=5,o.s();case 7:if((r=o.n()).done){a.next=19;break}return i=r.value,a.t0=t.abilityTagDialog.model.abilityArr,a.t1=i.split(".")[0],a.t2=i.split(".")[1]||"",a.next=14,t.getServerList(i.split(".")[0]);case 14:a.t3=a.sent,a.t4={application:a.t1,serverName:a.t2,serverNames:a.t3},a.t0.push.call(a.t0,a.t4);case 17:a.next=7;break;case 19:a.next=24;break;case 21:a.prev=21,a.t5=a["catch"](5),o.e(a.t5);case 24:return a.prev=24,o.f(),a.finish(24);case 27:case"end":return a.stop()}}),a,null,[[5,21,24,27]])})))()},batchEditAffinity:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!=e.multipleSelection.length){t.next=5;break}return t.next=3,e.editCommonTag(e.multipleSelection[0]);case 3:t.next=9;break;case 5:e.abilityTagDialog.show=!0,e.abilityTagDialog.flag="batch",e.abilityTagDialog.model.nodes=e.multipleSelection,e.abilityTagDialog.model.abilityArr=[{application:"",serverName:"",serverNames:""}];case 9:case"end":return t.stop()}}),t)})))()},saveAbilityTag:function(){var e=this;if(this.validate(this.$refs.abilityForm)){var t=[];this.abilityTagDialog.model.nodes&&(t=this.abilityTagDialog.model.nodes.map((function(e){return e.NodeName})));var a=this.abilityTagDialog.model.abilityArr.map((function(e){return{application:e.application,serverName:e.serverName}})),o="",r={};"one"==this.abilityTagDialog.flag?(o="/k8s/api/edit_ability_tag",r={nodeName:this.abilityTagDialog.model.NodeName,tags:a}):(o="/k8s/api/batch_edit_ability_tag",r={nodeNames:t,tags:a}),this.$ajax.postJSON(o,r).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeAbilityTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeAbilityTagDialog:function(){this.abilityTagDialog={flag:"one",show:!1,model:{}}},validate:function(e){var t=!0;return e.validate((function(e){e||(t=!1)})),t},viewItem:function(e){this.showDetail=!0,this.nodeDetail=_o.a.cloneDeep(e)},closeDetail:function(){this.showDetail=!1,this.fetchData()},changeStatus:function(e){if(e.NodePublic){if(e.Labels.hasOwnProperty("node-role.kubernetes.io/master"))return void this.fetchData();this.addTag(e.NodeName)}else this.delTag(e.NodeName)},addTag:function(e){var t=this;this.$confirm(this.$t("cloud.deploy.install"),"Hint",{confirmButtonText:this.$t("cloud.deploy.confirm"),cancelButtonText:this.$t("cloud.deploy.cancel"),type:"warning"}).then((function(){t.$ajax.postJSON("/k8s/api/ability_open",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch()},delTag:function(e){var t=this;this.$ajax.postJSON("/k8s/api/ability_close",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return Object(z["a"])(regeneratorRuntime.mark((function a(){var o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 2:return o=a.sent,r=o.Data.map((function(e){return e.ServerName})),a.abrupt("return",r);case 5:case"end":return a.stop()}}),a)})))()},changeApp:function(e,t){var a=this;return Object(z["a"])(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,a.getServerList(t);case 2:r=o.sent,a.$set(a.abilityTagDialog.model.abilityArr[e],"serverNames",r);case 4:case"end":return o.stop()}}),o)})))()},queryAppChange:function(){var e=this;return Object(z["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getServerList(e.query.ServerApp);case 2:a=t.sent,e.$set(e.query,"ServerName",""),e.serList=a;case 5:case"end":return t.stop()}}),t)})))()},addCommonTag:function(e,t){t.splice(e+1,0,{name:"",value:""}),this.$forceUpdate()},delCommonTag:function(e,t){t.splice(e,1),this.$forceUpdate()},addAbilityTag:function(e,t){t.splice(e+1,0,{application:"",serverName:"",serverNames:[]}),this.$forceUpdate()},delAbilityTag:function(e,t){t.splice(e,1),this.$forceUpdate()},validateTagName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.notNull")))):o.toLowerCase().startsWith("tars.io")?a(new Error("".concat(this.$t("filter.tip.notTaf")))):a()},validateAppName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.application")))):a()}}},Do=Co,No=(a("c8ef2"),a("cdeb"),Object(M["a"])(Do,go,bo,!1,null,"4f953089",null)),To=No.exports,Lo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-form",{attrs:{inline:"",itemWidth:"180px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{staticStyle:{width:"400px"},attrs:{label:e.$t("callChain.date")}},[a("el-date-picker",{attrs:{size:"small",type:"datetimerange","range-separator":"~","start-placeholder":e.$t("board.alarm.form.startDate"),"end-placeholder":e.$t("board.alarm.form.endDate"),"value-format":"timestamp"},model:{value:e.eventDate,callback:function(t){e.eventDate=t},expression:"eventDate"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),size:"small",disabled:!e.serverEnable,clearable:""},on:{change:function(t){return e.getServerList(e.query.application)}},model:{value:e.query.application,callback:function(t){e.$set(e.query,"application",t)},expression:"query.application"}},e._l(e.appList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("filter.title.serverName")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.getPods},model:{value:e.query.serverName,callback:function(t){e.$set(e.query,"serverName",t)},expression:"query.serverName"}},e._l(e.serverNames,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.podName")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.search},model:{value:e.query.pod,callback:function(t){e.$set(e.query,"pod",t)},expression:"query.pod"}},e._l(e.pods,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("event.eventLevel")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",size:"small"},on:{change:e.search},model:{value:e.query.level,callback:function(t){e.$set(e.query,"level",t)},expression:"query.level"}},e._l(e.levels,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{staticStyle:{width:"240px"}},[a("el-radio-group",{attrs:{size:"small"},on:{change:e.checkedChange},model:{value:e.query.check,callback:function(t){e.$set(e.query,"check",t)},expression:"query.check"}},[a("el-radio-button",{attrs:{label:"Server"}},[e._v(e._s(e.$t("event.type.server")))]),a("el-radio-button",{attrs:{label:"Cluster"}},[e._v(e._s(e.$t("event.type.cluster")))]),a("el-radio-button",{attrs:{label:"Downtime"}},[e._v(e._s(e.$t("event.type.downtime")))])],1)],1),a("let-form-item",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.events,border:"",stripe:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"kind",width:"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.kind||""))]}}])}),a("el-table-column",{attrs:{label:"namespace",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.namespace||""))]}}])}),a("el-table-column",{attrs:{label:"name",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.name||""))]}}])}),a("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),a("el-table-column",{attrs:{label:"reason",prop:"reason",width:"150"}}),a("el-table-column",{attrs:{label:"message",prop:"message","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"firstTime",width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.firstTimestamp)))]}}])}),a("el-table-column",{attrs:{label:"lastTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTimestamp)))]}}])})],1),a("br"),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.handleCurrentChange}})],1)},Io=[],Ao=(a("841c"),{name:"event",data:function(){return{query:{application:"",serverName:"",check:"Server"},eventDate:[new Date((new Date).getTime()-72e5).getTime(),(new Date).getTime()],appList:[],serverNames:[],pods:[],levels:["Normal","Warning"],loading:!1,pagination:{page:1,size:20,total:1},events:[]}},filters:{timeFormat:function(e){return J()(e).format("YYYY-MM-DD HH:mm:ss")}},watch:{$route:function(e,t){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.search()}},mounted:function(){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.getAppList(),this.search()},computed:{serverEnable:function(){return"Server"==this.query.check}},methods:{checkedChange:function(){this.pagination.page=1,this.loadData(1)},handleCurrentChange:function(e){this.loadData(e)},search:function(){this.loadData(1)},loadData:function(e){var t=this;e||(e=1);var a="",o="";this.eventDate&&(a=this.eventDate[0],o=this.eventDate[1]);var r=Object.assign({},this.query,{currPage:e,pageSize:this.pagination.size},{startDate:a,endDate:o});this.loading=!0,this.$ajax.getJSON("/k8s/api/get_events",r).then((function(e){t.events=e.rows,t.pagination.total=e.total,t.loading=!1})).catch((function(e){t.loading=!1,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return Object(z["a"])(regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$set(t.query,"serverName",""),a.next=3,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 3:o=a.sent,t.serverNames=o.Data.map((function(e){return e.ServerName})),t.search();case 6:case"end":return a.stop()}}),a)})))()},getPods:function(){var e=this;this.$set(this.query,"pod","");var t="",a="";this.eventDate&&(t=this.eventDate[0],a=this.eventDate[1]);var o=Object.assign({},this.query,{startDate:t,endDate:a});this.$ajax.getJSON("/k8s/api/get_pods",o).then((function(t){e.pods=t,e.search()})).catch((function(t){e.$set(e,"pods","")})),this.search()}}}),Oo=Ao,jo=Object(M["a"])(Oo,Lo,Io,!1,null,"62e254f2",null),Po=jo.exports,qo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_framework_config"},[[a("span",[a("el-button",{staticStyle:{width:"100px",margin:"10px 0 5px 0"},attrs:{size:"mini",type:"primary"},on:{click:e.showYaml}},[e._v(e._s(e.$t("operate.yaml"))+" ")]),a("span",[a("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.getTfc()}}})])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.config,stripe:"",border:""}},[a("el-table-column",{attrs:{prop:"column",label:"key",width:"300"}}),a("el-table-column",{attrs:{prop:"remark",label:"remark",width:"300"}}),a("el-table-column",{attrs:{label:"value"},scopedSlots:e._u([{key:"default",fn:function(t){return["nodeImage.image"==t.row.column?a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}},e._l(e.nodeList,(function(t){return a("el-option",{key:t.Image,attrs:{value:t.Image}},[a("span",[e._v(e._s(t.Image))])])})),1):a("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:8},placeholder:"请输入内容"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.saveTfcItem(t.row)}}},[e._v(" "+e._s(e.$t("operate.save"))+" ")])]}}])})],1),a("el-dialog",{attrs:{title:"Framework config",width:"50%",top:"50px",visible:e.showDialog,"before-close":e.closeDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("k8s-yaml-edit",{ref:"yamlEdit",on:{successFun:e.closeDialog}})],1)]],2)},zo=[],Eo={name:"frameworkConfig",data:function(){return{showDialog:!1,config:[],nodeList:[]}},components:{K8sYamlEdit:ut},mounted:function(){this.getTfc(),this.getTafNodeList()},methods:{getTfc:function(){var e=this;this.$ajax.getJSON("/k8s/api/get_tfc").then((function(t){e.config=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getTafNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){e.nodeList=t.Data}))},saveTfcItem:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},showYaml:function(){var e=this;this.showDialog=!0,this.$nextTick((function(){e.$refs.yamlEdit.show("111","tframeworkconfigs"),e.$refs.yamlEdit.refresh()}))},closeDialog:function(){this.showDialog=!1,this.getTfc()}}},Ro=Eo,Bo=(a("4193"),Object(M["a"])(Ro,qo,zo,!1,null,"bee8c302",null)),Jo=Bo.exports,Vo=a("6414"),Ho=(a("03c6"),a("9ea2")),Fo=a("5935");o["default"].use(A["a"]);var Yo=A["a"].prototype.push;A["a"].prototype.push=function(e){return Yo.call(this,e).catch((function(e){return e}))};var Wo=A["a"].prototype.replace;A["a"].prototype.replace=function(e){return Wo.call(this,e).catch((function(e){return e}))};var Ko=function(e){return{default:e,market:Fo["a"]}},Uo=new A["a"]({routes:[{path:"/server",name:"Server",components:Ko(la),children:[{path:":treeid/manage",component:xt},{path:":treeid/history",component:Zt},{path:":treeid/publish",component:Ot},{path:":treeid/config",component:Bt},{path:":treeid/server-monitor",component:Jt["a"]},{path:":treeid/property-monitor",component:Vt["a"]},{path:":treeid/user-manage",component:Ht["a"]},{path:":treeid/plugins",component:oa["a"]}]},{path:"/operation",name:"Operation",components:Ko(ha),redirect:"/operation/deploy",children:[{path:"deploy",component:Aa},{path:"history",component:Ea},{path:"undeploy",component:Fa},{path:"templates",component:Ga},{path:"image",component:oo},{path:"application",component:co},{path:"business",component:vo},{path:"node",component:To},{path:"event",component:Po},{path:"tfc",component:Jo}]},{path:"/market",name:"Market",components:Ko()},{path:"/plugins/*",name:"Plugin",components:Ko(Ho["a"])},{path:"/plugins-manage",name:"PluginManage",components:Ko(Vo["a"])},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}}),Zo=a("77a0"),Go=a.n(Zo),Qo=(a("aaf0"),a("f51c")),Xo=a("5c96"),er=a.n(Xo),tr=(a("a082"),a("42a1"),a("e7c1"),a("0808"),a("6944")),ar=a.n(tr);o["default"].config.productionTip=!1,Qo["b"].call(void 0).then((function(){o["default"].use(ar.a),o["default"].use(er.a,{i18n:function(e,t){return Qo["a"].t(e,t)}}),o["default"].use(Go.a),new o["default"]({i18n:Qo["a"],el:"#app",router:Uo,store:r["a"],components:{k8sApp:I},template:"<k8sApp/>"})}))},"4e15":function(e,t,a){"use strict";var o=a("0d43"),r=a.n(o);r.a},"4fc8":function(e,t,a){},"5d82":function(e,t,a){"use strict";var o=a("ff5a"),r=a.n(o);r.a},"5de2":function(e,t,a){"use strict";var o=a("c37c"),r=a.n(o);r.a},"5e23":function(e,t,a){},"67f3":function(e,t,a){},"767a0":function(e,t,a){"use strict";var o=a("4fc8"),r=a.n(o);r.a},"7b9a":function(e,t,a){"use strict";var o=a("24ee"),r=a.n(o);r.a},8924:function(e,t,a){},"8f5f":function(e,t,a){},"98b3":function(e,t,a){"use strict";var o=a("e779"),r=a.n(o);r.a},"9bc2":function(e,t,a){},"9df2":function(e,t,a){"use strict";var o=a("8924"),r=a.n(o);r.a},afb9:function(e,t,a){"use strict";var o=a("3d87"),r=a.n(o);r.a},b2b3:function(e,t,a){},b50eb:function(e,t,a){"use strict";var o=a("c26a"),r=a.n(o);r.a},b697:function(e,t,a){},b739:function(e,t,a){},c219:function(e,t,a){"use strict";var o=a("168e"),r=a.n(o);r.a},c26a:function(e,t,a){},c37c:function(e,t,a){},c3f0:function(e,t,a){"use strict";var o=a("e5f7"),r=a.n(o);r.a},c49e:function(e,t,a){},c8ef2:function(e,t,a){"use strict";var o=a("b739"),r=a.n(o);r.a},cb44:function(e,t,a){"use strict";var o=a("5e23"),r=a.n(o);r.a},cdeb:function(e,t,a){"use strict";var o=a("67f3"),r=a.n(o);r.a},e5f7:function(e,t,a){},e779:function(e,t,a){},e93e:function(e,t,a){},f333:function(e,t,a){"use strict";var o=a("437c"),r=a.n(o);r.a},ff5a:function(e,t,a){}});