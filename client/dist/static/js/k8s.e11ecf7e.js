(function(){"use strict";var e={76840:function(e,t,a){a(752),a(73964),a(60429),a(36409);var o=a(70538),r=a(45588),i=(a(75847),a(35184),function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("k8s-header"),e.market?e._e():t("div",[t("keep-alive",[t("router-view",{staticClass:"main-width",attrs:{id:"m1"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.market,expression:"market"}]},[t("router-view",{staticClass:"main-width",attrs:{id:"m2",name:"market"}})],1)],1)}),s=[],l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app_index__header"},[t("div",{staticClass:"main-width"},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"logo-wrap"},["true"===e.enable&&"true"===e.show?t("a",{attrs:{href:"/tars.html"}},[t("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]):e._e(),"true"===e.k8s?t("a",{class:{active:!0},attrs:{href:"/k8s.html"}},[t("img",{staticClass:"logo",attrs:{src:"/static/img/K8S.png"}})]):e._e()])]),t("el-col",{attrs:{span:9}},[t("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0].path},on:{click:e.clickTab}},[t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab2"),tabkey:"/operation",icon:e.opaIcon}}),t("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab9"),tabkey:"/market",icon:e.packageIcon}})],1)],1),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"plugin-wrap"},[t("extentionSelect")],1)]),t("el-col",{attrs:{span:4}},[t("div",{staticClass:"language-wrap"},[t("localeSelect")],1),t("div",{staticClass:"version-wrap"},[t("div",[e._v("web:"+e._s(e.web_version))]),t("el-link",{staticStyle:{"font-size":"9px"},attrs:{href:"https://doc.tarsyun.com",target:"_blank"}},[e._v(e._s("cn"==e.locale?"在线文档":"Online Manual"))])],1)]),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"user-wrap"},[t("el-dropdown",{staticStyle:{display:"block !important"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.uid)),t("i",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{command:"center"}},[e._v(e._s(e.$t("header.userCenter")))]),t("el-dropdown-item",{attrs:{command:"modifyPass"}},[e._v(e._s(e.$t("header.modifyPass")))]),t("el-dropdown-item",{attrs:{command:"quit"}},[e._v(e._s(e.$t("header.logout")))])],1)],1)],1)])],1)],1)])},n=[],c=(a(64043),a(57267),a(14399)),d=a(3221),u=a(198),p=a(95633),m=a(87329),h=a(60366),f=a(66239),v=a(9669),g=a.n(v),b={components:{localeSelect:h.Z,extentionSelect:f.Z},data:function(){return{serverIcon:c,opaIcon:d,releaseIcon:u,cacheIcon:p,operatorIcon:m,packageIcon:u,locale:this.$cookie.get("locale")||"cn",uid:"--",enableLogin:!1,isAdmin:!1,k8s:this.$cookie.get("k8s")||"false",enable:this.$cookie.get("enable")||"false",show:this.$cookie.get("show")||"false",web_version:"loading··",enableLdap:!1}},computed:{marketUid:function(){return this.$store.state.marketUid}},methods:{handleCommand:function(e){"center"==e?location.href="/auth.html":"modifyPass"==e&&(location.href="/pass.html"),"quit"==e&&(location.href="/pages/server/api/logout")},clickTab:function(e){this.$router.replace(e)},userCenter:function(){window.open("/pages/server/api/userCenter")},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?e.uid=t.uid:e.uid="***"})).catch((function(t){e.$tip.error("获取用户登录信息: ".concat(t.err_msg||t.message))}))},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))},checkEnableLdap:function(){var e=this;this.$ajax.getJSON("/server/api/isEnableLdap").then((function(t){e.enableLdap=t.enableLdap||!1})).catch((function(e){}))},checkAdmin:function(){var e=this;this.isAdmin=!1,this.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){}))}},mounted:function(){var e=this;this.getLoginUid(),this.checkEnableLogin(),this.checkAdmin(),this.checkEnableLdap(),g().create({baseURL:"/"})({method:"get",url:"/web/k8s_version"}).then((function(t){e.web_version=t.data,e.$store.commit({type:"version",version:e.web_version})})),g().create({baseURL:"/"})({method:"get",url:"/web/title"}).then((function(e){document.title=e.data.title||""})),window.header=this}},$=b,_=a(43736),y=(0,_.Z)($,l,n,!1,null,null,null),w=y.exports,k=a(29084),S={name:"App",components:{K8sHeader:w,AppFooter:k.Z},watch:{$route:function(e,t){"/market"==e.path?this.market=!0:this.market=!1}},data:function(){return{market:!1}},mounted:function(){"/market"==this.$route.path?this.market=!0:this.market=!1}},M=S,x=(0,_.Z)(M,i,s,!1,null,null,null),C=x.exports,D=a(78345),N=(a(34284),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server"},[t("div",{staticClass:"left-view"},[t("div",{staticClass:"tree_search"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.treeSearchKey,expression:"treeSearchKey"}],staticClass:"tree_search_key",attrs:{placeholder:e.$t("home.placeholder")},domProps:{value:e.treeSearchKey},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filterTextChange.apply(null,arguments)},input:function(t){t.target.composing||(e.treeSearchKey=t.target.value)}}}),t("i",{staticClass:"el-icon-refresh-right",class:{active:e.isIconPlay},staticStyle:{"z-index":"99"},on:{click:function(t){return e.treeSearch(1)}}})]),t("div",{staticClass:"tree_wrap"},[e.treeData&&e.treeData.length?t("el-tree",{ref:"trees",staticClass:"left-tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,"highlight-current":"","empty-text":e.$t("common.noService"),"node-key":"id"},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){a.node;var o=a.data;return t("span",{staticClass:"custom-tree-node"},[t("el-tooltip",{attrs:{content:o.name+"("+o.serverType+")",placement:"bottom-start",effect:"light","open-delay":e.openDelay}},[t("span",[2==o.type?t("i",{class:e._f("serverTypeFilter")(o.serverType)}):e._e(),e._v(" "+e._s(o.name)+" ")])])],1)}}],null,!1,4191436028)}):e._e(),e.treeData?e._e():t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"left-tree"},[!1===e.treeData?t("div",{staticClass:"loading"},[t("p",[e._v(e._s(e.treeErrMsg))]),t("a",{attrs:{href:"javascript:;"},on:{click:e.getTreeData}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()])],1)]),t("div",{staticClass:"right-view"},[t("div",{staticClass:"btabs_wrap"},[t("ul",{directives:[{name:"vscroll",rawName:"v-vscroll"}],ref:"btabs",staticClass:"btabs"},[t("li",{key:e.homeTab,staticClass:"btabs_item",class:{active:e.homeTab===e.treeid}},[t("a",{staticClass:"btabs_link",staticStyle:{"padding-right":"20px"},attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,e.homeTab)}}},[e._v(" "+e._s(e.$t("home.homeTab"))+" ")])]),e._l(e.BTabs,(function(a){return t("li",{key:a.id,staticClass:"btabs_item",class:{active:a.id===e.treeid}},[t("a",{staticClass:"btabs_link",attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,a.id)}}},[e._v(e._s(e.getNewServerName(a.id)))]),t("a",{staticClass:"btabs_close",attrs:{href:"javascript:;"},on:{click:function(t){return e.closeBTabs(a.id)}}},[e._v(" "+e._s(e.$t("home.close")))])])}))],2),t("a",{staticClass:"btabs_all",attrs:{href:"javascript:;",title:e.$t("home.closeAll")},on:{click:e.closeAllBTabs}},[e._v(" "+e._s(e.$t("home.closeAll")))])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.treeid===e.homeTab,expression:"treeid === homeTab"}],staticClass:"btabs_con_home",staticStyle:{height:"800px"}},[t("serverHistory")],1),t("div",{staticClass:"btabs_con"},e._l(e.BTabs,(function(a){return a.id===e.treeid?t("div",{key:a.id,staticClass:"btabs_con_item"},[t("el-tabs",{on:{"tab-click":e.clickTab},model:{value:a.path,callback:function(t){e.$set(a,"path",t)},expression:"item.path"}},[t("el-tab-pane",{attrs:{name:e.base+"/manage",label:e.$t("header.tab.tab1")}}),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/history",label:e.$t("header.tab.tab7")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/publish",label:e.$t("index.rightView.tab.patch")}}):e._e(),5===e.serverData.level||1===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/config",label:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/server-monitor",label:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/property-monitor",label:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/user-manage",label:e.$t("index.rightView.tab.privileage")}}):e._e(),5===e.serverData.level?t("el-tab-pane",{attrs:{name:e.base+"/callChain",label:e.$t("index.rightView.tab.treeConfig")}}):e._e(),e._l(e.plugins,(function(a){return 5===e.serverData.level?t("el-tab-pane",{key:a.f_id,attrs:{name:e.base+a.f_path+"/plugins",label:a.f_name}}):e._e()}))],2),t(e.getName(a.path),{ref:"childView",refInFor:!0,tag:"router-view",staticClass:"page_server_child",attrs:{treeid:a.id,path:a.pluginPath,k8s:!0}})],1):e._e()})),0)])])}),T=[],L=(a(34338),a(38077),a(60228),a(47522),a(48324),a(70560),a(62506),a(69358),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_manage"},[t("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[t("h4",{staticStyle:{float:"left"}},[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})]),e.isApplication?e._e():t("span",{staticClass:"btn_group",staticStyle:{float:"right"}},[t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.manageK8S}},[e._v(e._s(e.$t("operate.k8s")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.configServer}},[e._v(e._s(e.$t("operate.server")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.manageServant}},[e._v(e._s(e.$t("operate.servant")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.viewTemplate}},[e._v(e._s(e.$t("operate.viewTemplate")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.privateTemplateManage}},[e._v(e._s(e.$t("operate.privateTemplateManage")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.startServer}},[e._v(e._s(e.$t("operate.startServer")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.restartServer}},[e._v(e._s(e.$t("operate.restartServer")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.stopServer}},[e._v(e._s(e.$t("operate.stopServer")))]),e._v("   "),t("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.showMoreCmd}},[e._v(e._s(e.$t("operate.more")))])],1)]),e.serverList?t("div",{ref:"serverListLoading"},[t("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(a){return[t("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(a){return[t("let-checkbox",{on:{change:function(t){return e.checkChange(a.row)}},model:{value:a.row.isChecked,callback:function(t){e.$set(a.row,"isChecked",t)},expression:"scope.row.isChecked"}})]}}],null,!1,3049151486)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.subtype")},scopedSlots:e._u([{key:"default",fn:function(a){return["normal"==a.row.SubType?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Normal Server",placement:"top"}},[t("i",{staticClass:"el-icon-menu"})]):e._e(),"tars"==a.row.SubType?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Tars Server(manage by tarsnode)",placement:"top"}},[t("i",{staticClass:"el-icon-monitor"})]):e._e()]}}],null,!1,3327796356)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.readPodLog(a.row.PodName)}}},[e._v(e._s(a.row.ServerName)+" "),a.row.Source["tars.io/CloudInstall"]?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.Source["tars.io/CloudInstall"].group+"/"+a.row.Source["tars.io/CloudInstall"].name+":"+a.row.Source["tars.io/CloudInstall"].version,placement:"top-start"}},[t("i",{staticClass:"el-icon-cloudy",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.goMarket(a.row)}}})]):e._e()],1)]}}],null,!1,3061454345)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.gotoLog(a.row)}}},[e._v(e._s(a.row.PodName))])]}}],null,!1,2844911292)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),t("let-table-column",{attrs:{title:"pid"},scopedSlots:e._u([{key:"default",fn:function(t){return"tars"==t.row.SubType?[e._v(" "+e._s(t.row.Pid)+" ")]:void 0}}],null,!0)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.getState(a.row.SettingState)},[e._v(e._s(a.row.SettingState))])]}}],null,!1,987565344)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.getState(a.row.PresentState)},[e._v(e._s(a.row.PresentState))])]}}],null,!1,1754665792)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:a.row.PresentMessage||""}},[t("let-table-operation",[t("span",{staticClass:"over",on:{click:function(t){return e.describePod(a.row)}}},[e._v(e._s(a.row.PresentMessage))])])],1)]}}],null,!1,640804383)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.deletePod(a.row)}}},[e._v(e._s(e.$t("operate.deletePod"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.viewEvent(a.row)}}},[e._v(e._s(e.$t("operate.viewEvent"))+" ")])]}}],null,!1,702003604)})],1)],1):e._e(),t("div",{staticClass:"table_head"},[e.serverNotifyList&&e.showOthers?t("h4",[e._v(" "+e._s(this.$t("serverList.title.serverStatus"))+" "),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerNotifyList()}}},[e._v("")])]):e._e()]),e.serverNotifyList&&e.showOthers?t("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,stripe:"","empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("common.time"),width:"160px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(a.row._source.timeStr))])]}}],null,!1,3973901746)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"AppServer"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(a.row._source.app+"."+a.row._source.server))])]}}],null,!1,4255247636)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(a.row._source.podName))])]}}],null,!1,1996751150)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.source"),prop:"NotifySource"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(a.row._source.source))])]}}],null,!1,1994068079)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"NotifyMessage"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.statusStyle(a.row._source.message)},[e._v(e._s(a.row._source.message))])]}}],null,!1,2929402306)})],1):e._e(),t("div",{staticStyle:{"margin-bottom":"20px"}},[t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.notifyPagination.page,total:e.notifyPagination.total},on:{change:e.notifyGotoPage}})],1),t("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!!e.configModal.model},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?t("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[t("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?t("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ServerTemplate,callback:function(t){e.$set(e.configModal.model,"ServerTemplate",t)},expression:"configModal.model.ServerTemplate"}},e._l(e.configModal.model.templates,(function(a){return t("let-option",{key:a.TemplateName,attrs:{value:a.TemplateName}},[e._v(e._s(a.TemplateName)+" ")])})),1):t("span",[e._v(e._s(e.configModal.model.ServerTemplate))])],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.dlg.placeholder.thread")},model:{value:e.configModal.model.AsyncThread,callback:function(t){e.$set(e.configModal.model,"AsyncThread",t)},expression:"configModal.model.AsyncThread"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[t("let-input",{attrs:{size:"large",type:"textarea",rows:10},model:{value:e.configModal.model.ServerProfile,callback:function(t){e.$set(e.configModal.model,"ServerProfile",t)},expression:"configModal.model.ServerProfile"}})],1)],1):t("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),t("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[t("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant ")]),e.servantModal.model?t("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:"OBJ",prop:"Name"}}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),prop:"Port"}}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.IsTars?t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v("TARS")]):t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3719090988)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.IsTcp?t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("TCP")]):t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.configServant(a.row.AdapterId)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteServant(a.row.AdapterId)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2769818527)})],1):t("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),t("let-modal",{attrs:{title:e.servantAddModal.isNew?"".concat(e.$t("operate.title.add")," Servant"):"".concat(e.$t("operate.title.update")," Servant"),width:"1200px",footShow:!!e.servantAddModal.model},on:{"on-confirm":e.saveServantAdd,close:e.closeServantAddModal,"on-cancel":e.closeServantAddModal},model:{value:e.servantAddModal.show,callback:function(t){e.$set(e.servantAddModal,"show",t)},expression:"servantAddModal.show"}},[e.servantAddModal.model&&e.servantAddModal.model.ServerServant?t("let-form",{ref:"servantAddForm"},[t("let-table",{attrs:{data:e.servantAddModal.model.ServerServant}},[t("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:a.row.Name,callback:function(t){e.$set(a.row,"Name",t)},expression:"props.row.Name"}})]}}],null,!1,3758810427)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.Port,callback:function(t){e.$set(a.row,"Port",t)},expression:"props.row.Port"}})]}}],null,!1,2319070108)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("TCP")]),t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,1519152386)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v("TARS")]),t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3031957841)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.Threads,callback:function(t){e.$set(a.row,"Threads",t)},expression:"props.row.Threads"}})]}}],null,!1,1655720946)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.Connections,callback:function(t){e.$set(a.row,"Connections",t)},expression:"props.row.Connections"}})]}}],null,!1,2060048682)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.Capacity,callback:function(t){e.$set(a.row,"Capacity",t)},expression:"props.row.Capacity"}})]}}],null,!1,58581595)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:a.row.Timeout,callback:function(t){e.$set(a.row,"Timeout",t)},expression:"props.row.Timeout"}})]}}],null,!1,1471836343)}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.$index===e.servantAddModal.model.ServerServant.length-1?t("let-table-operation",{on:{click:function(t){return e.addAdapter(a.row)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]):t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.servantAddModal.model.ServerServant.splice(a.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2635590502)})],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.servantDetailModal.isNew?"".concat(e.$t("operate.title.add")," Servant"):"".concat(e.$t("operate.title.update")," Servant"),width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model&&1===e.servantDetailModal.model.ServerServant.length?t("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[t("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z0-9]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.ServerServant[0].Name,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Name",t)},expression:"servantDetailModal.model.ServerServant[0].Name"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.table.th.port"),required:""}},[t("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.servantDetailModal.model.ServerServant[0].Port,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Port",t)},expression:"servantDetailModal.model.ServerServant[0].Port"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[t("let-input",{attrs:{size:"small",type:"number",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.ServerServant[0].Threads,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Threads",t)},expression:"servantDetailModal.model.ServerServant[0].Threads"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Connections,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Connections",t)},expression:"servantDetailModal.model.ServerServant[0].Connections"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Capacity,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Capacity",t)},expression:"servantDetailModal.model.ServerServant[0].Capacity"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[t("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Timeout,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Timeout",t)},expression:"servantDetailModal.model.ServerServant[0].Timeout"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[t("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("TARS")]),t("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("NOT TARS")])],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.portType"),required:""}},[t("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("TCP")]),t("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("UDP")])],1)],1):e._e()],1),t("k8sManager",{ref:"k8s"}),t("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?t("let-form",{ref:"moreCmdForm"},[t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.logLevel"))+" ")]),t("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.pushFile"))+" ")]),t("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(a){return t("let-option",{key:a.filename,attrs:{value:a.filename}},[e._v(" "+e._s(a.filename)+" ")])})),1)],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.sendCommand"))+" ")]),t("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),t("let-form-item",{attrs:{itemWidth:"100%"}},[t("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.serviceLink"))+" ")])],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.detailModal.title,width:"700px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[t("div",{staticStyle:{padding:"20px 0 0"}},[e.detailModal.model&&e.detailModal.model.detail?t("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),t("div",{ref:"detailModalLoading",staticClass:"detail-loading"})])]),t("let-modal",{attrs:{title:"Pod",width:"70%",footShow:!1},on:{close:e.closePodYaml},model:{value:e.showPodYaml,callback:function(t){e.showPodYaml=t},expression:"showPodYaml"}},[t("div",{staticStyle:{padding:"20px 0 0"}},[e.showPodYaml?t("yaml-editor",{ref:"yamlEdit",staticStyle:{margin:"1px"},model:{value:e.podYaml,callback:function(t){e.podYaml=t},expression:"podYaml"}}):e._e()],1)]),t("log",{ref:"log"}),t("el-dialog",{attrs:{visible:e.dialogCommandVisible,width:"80%"},on:{"update:visible":function(t){e.dialogCommandVisible=t}}},[t("span",{domProps:{innerHTML:e._s(e.commandHTML)}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogCommandVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))])],1)])],1)}),I=[],A=a(51907),O=a(85617),P=a(56384),j=(a(50886),a(65137),a(25728),a(9873),a(7409),a(91719),a(21057),a(62764)),q=a(30381),z=a.n(q),B=function(){var e=this,t=e._self._c;return e.DetailModel.show?t("el-dialog",{attrs:{title:e.$t("operate.k8s"),visible:e.DetailModel.show,width:"1060px","before-close":e.closeDetailModel,top:"10px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.DetailModel,"show",t)}}},[t("el-collapse",{attrs:{accordion:""},on:{change:e.HandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-collapse-item",{attrs:{name:"copyNode"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.copyNode")))])]),e.k8sModel?t("replicas",{attrs:{replicas:e.k8sModel.Replicas},on:{saveReplicas:e.saveReplicas}}):e._e()],2),t("el-collapse-item",{attrs:{name:"pull"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.pull")))])]),e.k8sModel?t("pull",{attrs:{pull:e.k8sModel.imagePullPolicy},on:{savePull:e.savePull}}):e._e()],2),t("el-collapse-item",{attrs:{name:"stacked"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.stacked")))])]),e.k8sModel?t("stacked",{attrs:{notStacked:e.k8sModel.notStacked},on:{saveStacked:e.saveStacked}}):e._e()],2),t("el-collapse-item",{attrs:{name:"jobModel"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.jobModel")))])]),e.k8sModel?t("jobModel",{attrs:{daemonSet:e.k8sModel.daemonSet},on:{saveJobModel:e.saveJobModel}}):e._e()],2),t("el-collapse-item",{attrs:{name:"launcherType"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.launcherType")))])]),e.k8sModel?t("launcher-type",{attrs:{launcherType:e.k8sModel.launcherType},on:{saveLauncherType:e.saveLauncherType}}):e._e()],2),t("el-collapse-item",{attrs:{name:"nodeSelect"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),e.k8sModel?t("abilityAffinity",{attrs:{k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator},on:{saveAffinity:e.saveAffinity}}):e._e()],2),t("el-collapse-item",{attrs:{name:"network"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.network")))])]),e.k8sModel?t("network-mapping",{attrs:{k8sModel:e.k8sModel},on:{saveNetwork:e.saveNetwork}}):e._e()],2),t("el-collapse-item",{attrs:{name:"disk"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.disk")))])]),e.k8sModel?t("disk-manger",{attrs:{k8sModel:e.k8sModel,mounts:e.mounts},on:{saveDisk:e.saveDisk}}):e._e()],2),t("el-collapse-item",{attrs:{name:"resource"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.resource")))])]),e.k8sModel?t("resource-manger",{attrs:{sourceModel:e.sourceModel},on:{saveResource:e.saveResource}}):e._e()],2),t("el-collapse-item",{attrs:{name:"hpa"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.hpa")))])]),t("div",[e.k8sModel?t("hpa-manger",{attrs:{hpaModel:e.hpaModel,serverData:e.serverData,sourceModel:e.sourceModel,indicators:e.indicators},on:{saveHpa:e.saveHpa}}):e._e()],1)],2),t("el-collapse-item",{attrs:{name:"yaml"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.yaml")))])]),t("k8s-yaml-edit",{ref:"yamlEdit",on:{flushOthers:e.show}})],2)],1)],1):e._e()},J=[],E=(a(39772),function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",model:this,columns:2}},[t("div",[t("el-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[t("el-input",{attrs:{size:"small",type:"number",min:0,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}})],1)],1)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)}),Z=[],V={props:["replicas","install"],name:"ReplicasK8S",data:function(){return{inputValue:this.replicas}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveReplicas",this.inputValue)}}},H=V,F=(0,_.Z)(H,E,Z,!1,null,null,null),R=F.exports,Y=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2,model:this}},[t("div",[t("el-form-item",{attrs:{label:e.$t("operate.pull"),itemWidth:"45%",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},e._l(e.pulls,(function(a){return t("el-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1)],1)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},W=[],K={props:["pull","install"],name:"PullK8S",data:function(){return{inputValue:this.pull,pulls:["Always","IfNotPresent","Never"]}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("savePull",this.inputValue)}}},U=K,G=(0,_.Z)(U,Y,W,!1,null,null,null),Q=G.exports,X=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2,model:this}},[t("div",[t("el-form-item",{attrs:{label:e.$t("operate.launcherType"),itemWidth:"45%"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},e._l(e.launcherTypes,(function(a){return t("el-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1),t("el-alert",{staticStyle:{"margin-top":"5px","margin-bottom":"5px"},attrs:{title:e.$t("operate.backgroundInfo"),"show-icon":"",closable:!1,type:"warning"}}),t("el-alert",{attrs:{title:e.$t("operate.foregroundInfo"),"show-icon":"",closable:!1,type:"warning"}})],1)],1)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},ee=[],te={props:["launcherType","install"],name:"LauncherType",data:function(){return{inputValue:this.launcherType,launcherTypes:["background","foreground"]}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveLauncherType",this.inputValue)}}},ae=te,oe=(0,_.Z)(ae,X,ee,!1,null,null,null),re=oe.exports,ie=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",model:this,columns:2}},[t("div",[t("el-form-item",{attrs:{label:e.$t("operate.stacked"),itemWidth:"60%"}},[t("el-switch",{attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("ON")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("OFF")])]),t("el-alert",{staticStyle:{"margin-top":"5px","margin-bottom":"5px"},attrs:{title:e.$t("operate.stackedInvalid"),"show-icon":"",closable:!1,type:"warning"}}),t("el-alert",{attrs:{title:e.$t("operate.stackedInfo"),"show-icon":"",closable:!1,type:"warning"}})],1)],1)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},se=[],le={props:["notStacked","install"],name:"stackedK8S",data:function(){return{inputValue:!this.notStacked}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveStacked",!this.inputValue)}}},ne=le,ce=(0,_.Z)(ne,ie,se,!1,null,null,null),de=ce.exports,ue=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2,model:this}},[t("div",[t("el-form-item",{attrs:{label:e.$t("operate.jobModel"),itemWidth:"45%",required:""}},[t("el-switch",{attrs:{size:"small"},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("DaemonSet")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("StatefullSet")])])],1)],1)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},pe=[],me={props:["daemonSet","install"],name:"JobModel",data:function(){return{inputValue:this.daemonSet}},methods:{save:function(){this.$refs.k8sDetailForm.validate()&&this.$emit("saveJobModel",this.inputValue)}}},he=me,fe=(0,_.Z)(he,ue,pe,!1,null,null,null),ve=fe.exports,ge=(a(76265),function(){var e=this,t=e._self._c;return e.k8sModelData?t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",model:this,columns:2}},[t("div",[t("el-form-item",{attrs:{label:e.$t("deployService.form.affinity"),itemWidth:"100%"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.k8sModelData.abilityAffinity,callback:function(t){e.$set(e.k8sModelData,"abilityAffinity",t)},expression:"k8sModelData.abilityAffinity"}},e._l(e.abilityAffinities,(function(a){return t("el-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1),t("el-alert",{staticStyle:{margin:"5px"},attrs:{size:"small",type:"warning"}},[e._v("AppRequired:在满足其他条件后,节点必须有tars.io/ability.${namespace}.${App} 标签")]),t("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("ServerRequired: 在满足其他条件后,节点必须有tars.io/ability.${namespace}.${App}-${Server} 标签")]),t("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("AppOrServerPreferred: 在满足其他条件后,优先选择有tars.io/ability.${namespace}.${App}-${Server}, tars.io/ability.${namespace}.${App} 标签的节点")]),t("el-alert",{staticStyle:{margin:"5px"},attrs:{type:"warning"}},[e._v("None: 不对节点标签做要求")])],1),0==e.labelMatchArrData.length?t("el-form-item",{attrs:{itemWidth:"45%"}},[t("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addItems(0,e.labelMatchArrData)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1):e._e(),e._l(e.labelMatchArrData,(function(a,o){return t("div",{key:o},[t("el-form-item",{attrs:{label:e.$t("deployService.table.th.label"),itemWidth:"30%"}},[t("el-input",{attrs:{size:"small",placeholder:e.$t("deployService.table.th.label"),"pattern-tip":e.$t("deployService.form.labelMatch.labelValid")},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}})],1),t("el-form-item",{attrs:{label:"operator",itemWidth:"15%"}},[t("el-select",{attrs:{size:"small"},on:{change:e.changeLabelOperator},model:{value:a.operator,callback:function(t){e.$set(a,"operator",t)},expression:"item.operator"}},e._l(e.LabelMatchOperator,(function(a){return t("el-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("el-form-item",{attrs:{label:e.$t("deployService.table.th.value"),itemWidth:"40%"}},[t("el-select",{staticStyle:{width:"95%"},attrs:{disabled:a.disableValue,multiple:"",filterable:"","allow-create":"","multiple-limit":63,"default-first-option":"",placeholder:e.$t("deployService.form.labelMatch.labelValue"),size:"small"},on:{change:function(t){e.addLabelValues(t,o)}},model:{value:a.values,callback:function(t){e.$set(a,"values",t)},expression:"item.values"}},e._l(a.values,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",circle:""},on:{click:function(t){return e.addItems(o,e.labelMatchArrData)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-minus",size:"mini",circle:""},on:{click:function(t){return e.delItems(o,e.labelMatchArrData)}}})],1)}))],2)]),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1):e._e()}),be=[],$e=a(70531),_e=(a(28436),{props:["k8sModel","labelMatchArr","LabelMatchOperator","install"],name:"AbilityAffinity",data:function(){return{k8sModelData:null,abilityAffinities:["AppRequired","ServerRequired","AppOrServerPreferred","None"]}},mounted:function(){this.k8sModelData=this.k8sModel,this.labelMatchArrData=this.labelMatchArr},methods:{changeKind:function(){this.$forceUpdate()},adapterServerK8S:function(e){var t=Object.assign({},e),a=this.labelMatchArrData.map((function(e){return{key:e.key,operator:e.operator,values:e.values}}));return t.NodeSelector=a,t},save:function(){if(this.$refs.k8sDetailForm.validate()&&this.validateLabels()){var e=this.adapterServerK8S(this.k8sModelData);this.$emit("saveAffinity",e)}},validateLabels:function(e){var t,a=!0,o=(0,$e.Z)(this.labelMatchArrData);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(""==r.key.trim()){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorKey"))),a=!1;break}if(-1=="Exists,DoesNotExist".indexOf(r.operator)&&0==r.values.length){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorValue"))),a=!1;break}}}catch(i){o.e(i)}finally{o.f()}return a},addLabelValues:function(e,t){var a=this,o=/^([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]?$/;this.labelMatchArrData[t].values.forEach((function(e,t){o.test(e)||(a.labelMatchArrData[t].values.splice(t,1),a.$message.error("".concat(a.$t("deployService.form.labelMatch.labelValueValid"))))}))},changeLabelOperator:function(e){var t=this;this.labelMatchArrData.forEach((function(e){"Exists"==e.operator||"DoesNotExist"==e.operator?(t.$set(e,"disableValue",!0),t.$set(e,"values",[])):t.$set(e,"disableValue",!1)}))},addItems:function(e,t){t.length>=63?this.$message.error("".concat(this.$t("deployService.form.labelMatch.labelMax"))):(t.splice(e+1,0,{key:"",operator:"In",values:[]}),this.$forceUpdate())},delItems:function(e,t){t.splice(e,1),this.$forceUpdate()}}}),ye=_e,we=(0,_.Z)(ye,ge,be,!1,null,null,null),ke=we.exports,Se=function(){var e=this,t=e._self._c;return e.k8sData?t("el-card",{staticStyle:{padding:"5px"},attrs:{shadow:"never"}},[t("el-form",{ref:"k8sDetailForm",attrs:{inline:"",model:this,"label-position":"top"}},[t("div",[t("el-row",{attrs:{gutter:18}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostIpc"),"label-width":"200px"}},[t("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.HostIpc,callback:function(t){e.$set(e.k8sData,"HostIpc",t)},expression:"k8sData.HostIpc"}},[t("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),t("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostNetwork"),"label-width":"200px"}},[t("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.HostNetwork,callback:function(t){e.$set(e.k8sData,"HostNetwork",t)},expression:"k8sData.HostNetwork"}},[t("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),t("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:e.$t("deployService.table.th.hostPort"),"label-width":"200px"}},[t("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sData.showHostPort,callback:function(t){e.$set(e.k8sData,"showHostPort",t)},expression:"k8sData.showHostPort"}},[t("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),t("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1)],1),e.k8sData.showHostPort?t("el-table",{staticStyle:{"padding-right":"30px"},attrs:{data:e.HostPortArr}},[t("el-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("el-input",{attrs:{size:"small",disabled:"",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:a.row.obj,callback:function(t){e.$set(a.row,"obj",t)},expression:"props.row.obj"}})]}}],null,!1,4025241129)}),t("el-table-column",{attrs:{title:e.$t("deployService.table.th.hostPort")},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("el-input",{attrs:{size:"small",type:"number",min:1,max:65535,placeholder:"1-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.HostPort,callback:function(t){e.$set(a.row,"HostPort",t)},expression:"props.row.HostPort"}})]}}],null,!1,2205710664)}),t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticClass:"port-button",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.generateHostPort(a.row)}}},[e._v(" "+e._s(e.$t("deployService.table.th.checkHostPort"))+" ")])]}}],null,!1,2032453516)}),t("el-table-column",{attrs:{title:"Open"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{size:"small"},on:{change:e.change},model:{value:a.row.open,callback:function(t){e.$set(a.row,"open",t)},expression:"props.row.open"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("ON")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("OFF")])])]}}],null,!1,860095306)})],1):e._e()],1)]),e.install?e._e():t("el-row",{attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1):e._e()},Me=[],xe={props:["k8sModel","install"],name:"NetworkK8S",data:function(){return{k8sData:null,HostPortArr:[]}},mounted:function(){this.k8sData=this.k8sModel,this.HostPortArr=this.k8sData.HostPortArr},methods:{changeKind:function(){if(this.k8sData.showHostPort){var e=this.HostPortArr.findIndex((function(e){return e.open}));-1==e&&(this.HostPortArr.forEach((function(e){e.open=!0})),this.k8sData.HostPortArr=this.HostPortArr)}this.$forceUpdate()},change:function(){var e=this.HostPortArr.findIndex((function(e){return e.open}));-1==e&&(this.showHostPort=!1),this.$forceUpdate()},save:function(){this.$refs.k8sDetailForm.validate()&&(this.k8sData.HostPortArr=this.HostPortArr,this.$emit("saveNetwork",this.k8sData))},generateHostPort:function(e){var t=this;this.$ajax.getJSON("/k8s/api/check_host_port",{NodePort:e.HostPort}).then((function(e){var a="";e.forEach((function(e){-1==e.ret?a+="<p>".concat(e.node,":").concat(e.port,": can use</p>"):a+='<p style="color: #F56C6C">'.concat(e.node,":").concat(e.port,": cannot use</p>")})),t.$message.success({dangerouslyUseHTMLString:!0,message:a})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}}},Ce=xe,De=(0,_.Z)(Ce,Se,Me,!1,null,null,null),Ne=De.exports,Te=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"},attrs:{shadow:"never"}},[0==e.mounts.length?t("div",[t("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addDisk(0,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")])],1):e._e(),t("el-form",{ref:"disk",attrs:{"label-position":"top","label-width":"120px",size:"mini"}},[e._l(e.mounts,(function(a,o){return t("div",{key:o},[t("el-card",{staticStyle:{padding:"10px"},attrs:{shadow:"never"}},[t("el-row",{attrs:{gutter:22}},[t("el-col",{attrs:{span:10}},[t("el-form-item",{attrs:{label:e.$t("deployService.disk.diskName"),required:""}},[t("el-input",{model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"disk.name"}})],1)],1),t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{label:e.$t("deployService.disk.path"),required:""}},[t("el-input",{model:{value:a.mountPath,callback:function(t){e.$set(a,"mountPath",t)},expression:"disk.mountPath"}})],1)],1)],1),t("el-row",{attrs:{gutter:22}},[t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"uid",required:""}},[t("el-input",{attrs:{placeholder:"0"},model:{value:a.source.tLocalVolume.uid,callback:function(t){e.$set(a.source.tLocalVolume,"uid",t)},expression:"disk.source.tLocalVolume.uid"}})],1)],1),t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"gid",required:""}},[t("el-input",{attrs:{placeholder:"0"},model:{value:a.source.tLocalVolume.gid,callback:function(t){e.$set(a.source.tLocalVolume,"gid",t)},expression:"disk.source.tLocalVolume.gid"}})],1)],1),t("el-col",{attrs:{span:7}},[t("el-form-item",{attrs:{label:"mode",required:""}},[t("el-input",{attrs:{placeholder:"755"},model:{value:a.source.tLocalVolume.mode,callback:function(t){e.$set(a.source.tLocalVolume,"mode",t)},expression:"disk.source.tLocalVolume.mode"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{offset:18}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")]),t("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.delDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.delDisk"))+" ")])],1)],1)],1)],1)})),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex"}},[t("el-col",{attrs:{span:18}},[t("el-alert",{attrs:{title:e.$t("deployService.disk.info"),type:"info"}})],1),t("el-col",{attrs:{span:4}}),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],2)],1)},Le=[],Ie={props:["k8sModel","mounts","install"],name:"diskK8S",methods:{save:function(){this.$emit("saveDisk",this.mounts)},addDisk:function(e,t){t.splice(e+1,0,{name:"",source:{tLocalVolume:{uid:"",gid:"",mode:""}},mountPath:""}),this.$forceUpdate()},delDisk:function(e,t){t.splice(e,1),this.$forceUpdate()}}},Ae=Ie,Oe=(0,_.Z)(Ae,Te,Le,!1,null,"85c092ca",null),Pe=Oe.exports,je=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[t("el-form",{attrs:{"label-width":"100px","label-position":"top",size:"mini"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.resources.limitCpu"),itemWidth:"50%"}},[t("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.limitCpu,callback:function(t){e.$set(e.resources,"limitCpu",t)},expression:"resources.limitCpu"}},[t("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.resources.limitMem"),itemWidth:"50%"}},[t("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.limitMem,callback:function(t){e.$set(e.resources,"limitMem",t)},expression:"resources.limitMem"}},[t("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.resources.requestCpu"),itemWidth:"50%"}},[t("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.requestCpu,callback:function(t){e.$set(e.resources,"requestCpu",t)},expression:"resources.requestCpu"}},[t("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.resources.requestMem"),itemWidth:"50%"}},[t("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.resources.requestMem,callback:function(t){e.$set(e.resources,"requestMem",t)},expression:"resources.requestMem"}},[t("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),e.install?e._e():t("el-row",{attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)],1)},qe=[],ze={props:["sourceModel","install"],name:"resourceK8S",data:function(){return{resources:{}}},mounted:function(){this.resources=this.sourceModel},methods:{save:function(){console.log(this.resources);var e=JSON.parse(JSON.stringify(this.resources));for(var t in e)e[t]=e[t].replace(/[^\d]/g,""),""!=e[t]&&(e[t]+="m");this.$emit("saveResource",e)}}},Be=ze,Je=(0,_.Z)(Be,je,qe,!1,null,"953844b8",null),Ee=Je.exports,Ze=function(){var e=this,t=e._self._c;return t("el-card",{staticStyle:{padding:"5px"}},[e.hpaModelData?t("el-form",{ref:"hpaForm",attrs:{"label-position":"top",size:"small",model:e.hpaModelData}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.minReplicas"),prop:"minReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.minReplicas"),trigger:"blur"}]}},[t("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.minReplicas")},model:{value:e.hpaModelData.minReplicas,callback:function(t){e.$set(e.hpaModelData,"minReplicas",t)},expression:"hpaModelData.minReplicas"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.maxReplicas"),prop:"maxReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.maxReplicas")}]}},[t("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.maxReplicas")},model:{value:e.hpaModelData.maxReplicas,callback:function(t){e.$set(e.hpaModelData,"maxReplicas",t)},expression:"hpaModelData.maxReplicas"}})],1)],1)],1),e._l(e.hpaModelData.indicatorData,(function(a,o){return t("el-card",{key:o,staticClass:"box-card",staticStyle:{margin:"5px"},attrs:{"body-style":{padding:"10px"}}},[t("el-alert",{attrs:{type:"warning",title:e.$t("deployService.hpa.tip.t2"),"show-icon":"",closable:!1}}),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.IndicatorName"),prop:"indicatorData.".concat(o,".name"),rules:[{required:!0,message:e.$t("deployService.hpa.tip.IndicatorName"),trigger:"change"}]}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},on:{change:function(t){return e.changeType(o,a.name)}},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"item.name"}},e._l(e.customTargets,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.targetType"),prop:"indicatorData.".concat(o,".targetType"),rules:[{required:!0,message:e.$t("deployService.hpa.tip.targetType"),trigger:"change"}]}},[t("el-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.$forceUpdate()}},model:{value:a.targetType,callback:function(t){e.$set(a,"targetType",t)},expression:"item.targetType"}},e._l(e.getTargetTypes(a.name),(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:a}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.value"),prop:"indicatorData.".concat(o,".value"),rules:[{required:!0,message:e.$t("deployService.hpa.tip.value"),trigger:"change"}]}},[t("el-input",{attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("template",{slot:"append"},[e._v(e._s(e._f("getValueUnit")(a.targetType)))])],2)],1)],1)],1),t("el-row",{attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:3}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.addItems(o,e.hpaModelData.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.addIndicator"))+" ")])],1),t("el-col",{attrs:{span:3}},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.delItems(o,e.hpaModelData.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.delIndicator"))+" ")])],1)],1)],1)}))],2):e._e(),e.install?e._e():t("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},Ve=[],He=(a(22462),a(52003),a(68518),a(13440),a(12826),{props:["hpaModel","serverData","sourceModel","indicators","install"],name:"hpaK8S",data:function(){return{customTargets:["cpu","memory"],hpaModelData:null}},mounted:function(){this.hpaModelData=this.hpaModel},filters:{getValueUnit:function(e){return"averagevalue"==e.toLowerCase()?"MiB":"averageutilization"==e.toLowerCase()?"%":"MiB"}},methods:{save:function(){var e=this;this.sourceModel.limitCpu||this.sourceModel.limitMem||this.sourceModel.requestCpu||this.sourceModel.requestMem?this.$refs.hpaForm.validate((function(t){var a=Object.assign({},e.hpaModelData,{serverData:e.serverData});t&&e.$emit("saveHpa",a)})):this.$message.error("".concat(this.$t("deployService.resources.tip.resources")))},addItems:function(e,t){t.splice(e+1,0,{name:"cpu",targetType:"AverageUtilization",value:""}),this.$forceUpdate()},delItems:function(e,t){1!==t.length&&(t.splice(e,1),this.$forceUpdate())},changeType:function(e,t){var a=this.getMatchIndicators(t);this.$set(this.hpaModelData.indicatorData[e],"targetType",a.target[0].type),this.$forceUpdate()},getMatchIndicators:function(e){var t,a,o=(0,$e.Z)(this.indicators);try{for(o.s();!(a=o.n()).done;){var r=a.value;if("exact"==r.matchType&&r.match.toLowerCase()==e.toLowerCase()){t=r;break}if("regex"==r.matchType){var i=new RegExp(r.match);if(i.test(e)){t=r;break}}}}catch(s){o.e(s)}finally{o.f()}return t||this.$message.error("".concat(this.$t("deployService.hpa.tip.noIndicator"))),t},getTargetTypes:function(e){var t=this,a=this.getMatchIndicators(e),o={};return a.target.forEach((function(e){e.type.toLowerCase()=="AverageValue".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageValue")),e.type.toLowerCase()=="AverageUtilization".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageUtilization"))})),o}}}),Fe=He,Re=(0,_.Z)(Fe,Ze,Ve,!1,null,"a5ea5c7e",null),Ye=Re.exports,We=function(){var e=this,t=e._self._c;return t("el-card",{attrs:{shadow:"never"}},[t("div",{staticStyle:{border:"1px solid #595656","border-radius":"5px"}},[t("yaml-editor",{ref:"yamlEdit",staticStyle:{margin:"1px"},model:{value:e.yamlContent,callback:function(t){e.yamlContent=t},expression:"yamlContent"}})],1),t("div",{staticClass:"bottom"},[t("el-upload",{attrs:{"before-upload":e.uploadFile,"show-file-list":!1,action:"","list-type":"yml/yaml"}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v(e._s(e.$t("deployService.form.uploadConf"))+" ")])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save"))+" ")])],1)])},Ke=[],Ue=function(){var e=this,t=e._self._c;return t("div",{staticClass:"yaml-editor"},[t("textarea",{ref:"textarea",attrs:{id:"textarea"}})])},Ge=[],Qe=a(4631),Xe=a.n(Qe);a(53631),a(3256),a(82783);window.jsyaml=a(93320);var et={name:"yaml-editor",props:["value"],data:function(){return{yamlEditor:!1}},watch:{value:function(e){var t=this.yamlEditor.getValue();e!==t&&this.yamlEditor.setValue(this.value)}},mounted:function(){var e=this;this.yamlEditor=Xe().fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"text/x-yaml",theme:"idea",lint:!0,lineWrapping:!0,autofocus:!0,extraKeys:{"Ctrl-Space":"autocomplete"},foldGutter:!0,gutters:["CodeMirror-lint-markers"],smartIndent:!0}),this.yamlEditor.on("change",(function(t){e.$emit("changed",t.getValue()),e.$emit("input",t.getValue())})),this.yamlEditor.setValue(this.value),this.$nextTick((function(){var t=e;setInterval((function(){t.yamlEditor.refresh()}),500)}))},methods:{getValue:function(){return this.yamlEditor.getValue()},refresh:function(){this.yamlEditor.refresh()},readonly:function(){this.yamlEditor.setOption("readOnly",!0)}}},tt=et,at=(0,_.Z)(tt,Ue,Ge,!1,null,"d17a4854",null),ot=at.exports,rt={name:"k8sYamlEdit",components:{YamlEditor:ot},data:function(){return{treeid:"",plural:"",yamlContent:""}},methods:{refresh:function(){this.$refs.yamlEdit.refresh()},readonly:function(){this.$refs.yamlEdit.readonly()},show:function(e,t){var a=this;this.treeid=e,this.plural=t,this.$ajax.getJSON("/k8s/api/get_object",{plural:t,tree_node_id:this.treeid}).then((function(e){a.yamlContent=e})).catch((function(e){a.$message.error("".concat(a.$t("common.error"),": ").concat(e.err_msg||e.message))}))},save:function(){var e=this;this.$ajax.postJSON("/k8s/api/update_object",{plural:this.plural,tree_node_id:this.treeid,yamlContent:this.yamlContent}).then((function(t){e.$emit("flushOthers",e.treeid),e.$message.success("".concat(e.$t("common.success"))),e.$emit("successFun")})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},uploadFile:function(e){var t=e.name;if(-1==t.lastIndexOf("."))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var a=".yml|.yaml|",o=t.substring(t.lastIndexOf(".")).toLowerCase();if(-1==a.indexOf(o+"|"))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var r=new FileReader;r.readAsText(e,"UTF-8");var i=this;r.onload=function(e){e.target.result;i.$nextTick((function(){i.yamlContent=r.result}))}}}},it=rt,st=(0,_.Z)(it,We,Ke,!1,null,"5f42cf78",null),lt=st.exports,nt={name:"index",components:{pull:Q,launcherType:re,stacked:de,jobModel:ve,replicas:R,abilityAffinity:ke,diskManger:Pe,networkMapping:Ne,resourceManger:Ee,K8sYamlEdit:lt,hpaManger:Ye},data:function(){return{DetailModel:{show:!1},activeName:"copyNode",k8sModel:null,labelMatchArr:[],LabelMatchOperator:[],sourceModel:{},serverData:{},hpaModel:{minReplicas:"",maxReplicas:"",indicatorData:[]},indicators:[],yamlContent:"",mounts:[],treeid:""}},methods:{HandleClick:function(e){var t=this;"yaml"==e&&this.$nextTick((function(){t.$refs.yamlEdit.show(t.treeid,"tservers"),t.$refs.yamlEdit.refresh()}))},saveLauncherType:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,launcherType:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},savePull:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,pull:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveStacked:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,notStacked:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveJobModel:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,daemonSet:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveReplicas:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,Replicas:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveAffinity:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update",{tree_node_id:this.treeid,abilityAffinity:e.abilityAffinity,NodeSelector:e.NodeSelector}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveHpa:function(e){var t=this;e=Object.assign(e,{tree_node_id:this.treeid}),this.$ajax.postJSON("/k8s/api/create_hpa",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveDisk:function(e){var t=this,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update_disk",{tree_node_id:this.treeid,mounts:e}).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},saveResource:function(e){var t=this;e.tree_node_id=this.treeid,this.$ajax.postJSON("/k8s/api/server_k8s_update_resource",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},adapterServerK8S:function(e){var t=Object.assign({},e);return t.tree_node_id=this.treeid,t.HostNetwork&&t.showHostPort?this.$message.error("".concat(this.$t("deployService.form.portOrNetWork"))):(t.showHostPort&&(t.HostPort=[],t.HostPortArr&&t.HostPortArr.forEach((function(e){e.open&&t.HostPort.push({NameRef:e.obj,Port:Math.floor(e.HostPort)})}))),t)},saveNetwork:function(e){var t=this,a=this.$Loading.show(),o=this.adapterServerK8S(e);this.$ajax.postJSON("/k8s/api/server_k8s_update_network",o).then((function(e){a.hide(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){a.hide(),t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},closeDetailModel:function(){this.DetailModel.show=!1,this.k8sModel=null,this.mounts=[],this.labelMatchArr=[],this.sourceModel={},this.serverData={},this.hpaModel={minReplicas:"",maxReplicas:"",indicatorData:[]}},show:function(e){var t=this;this.treeid=e,this.DetailModel.show=!0,this.getDefaultValue(),this.$nextTick((function(){t.getServerInfo(e),t.getHpaInfo(e),t.$refs.yamlEdit.show(e,"tservers")}))},getDefaultValue:function(){var e=this,t=this.LabelMatchOperator,a=this.indicators;this.$ajax.getJSON("/k8s/api/default",{}).then((function(o){e.defaultObj=o.ServerServantElem,o.LabelMatchOperator&&(t=o.LabelMatchOperator),o.indicators&&(a=o.indicators),e.LabelMatchOperator=t,e.indicators=a}))},getServerInfo:function(){var e=this;this.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:this.treeid}).then((function(t){t=t.Data[0],e.serverData=t,e.sourceModel.tree_node_id=e.treeid,t.resources&&Object.keys(t.resources).length>0&&(t.resources.limits&&(t.resources.limits.cpu&&e.$set(e.sourceModel,"limitCpu",t.resources.limits.cpu.replace(/m/g,"")),t.resources.limits.memory&&e.$set(e.sourceModel,"limitMem",t.resources.limits.memory.replace(/m/g,""))),t.resources.requests&&(t.resources.requests.cpu&&e.$set(e.sourceModel,"requestCpu",t.resources.requests.cpu.replace(/m/g,"")),t.resources.requests.memory&&e.$set(e.sourceModel,"requestMem",t.resources.requests.memory.replace(/m/g,"")))),t.showHostPort=!1,t&&(t.HostPortArr=[],"tars"==t.subType?t.servants.forEach((function(e){var a=t.HostPort.findIndex((function(t){return t.nameRef==e.name}));t.HostPortArr.push({obj:e.name,HostPort:-1!=a?t.HostPort[a].port:e.port,open:-1!=a})})):t.normal.ports.forEach((function(e){var a=t.HostPort.findIndex((function(t){return t.port==e.port}));t.HostPortArr.push({obj:e.name,HostPort:-1!=a?t.HostPort[a].port:e.port,open:-1!=a})})),t.showHostPort=-1!=t.HostPortArr.findIndex((function(e){return e.open}))),t.NodeSelector=t.NodeSelector,e.labelMatchArr=t.NodeSelector,e.labelMatchArr.forEach((function(e){-1!="Exists,DoesNotExist".indexOf(e.operator)&&(e.disableValue=!0)})),e.k8sModel=t,e.mounts=t.mounts.filter((function(e){return e.source.hasOwnProperty("tLocalVolume")}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},getHpaInfo:function(e){var t=this;this.$ajax.getJSON("/k8s/api/get_hpa",{tree_node_id:e}).then((function(e){if(e&&Object.keys(e).length>1){var a=e.body.spec;t.$set(t.hpaModel,"minReplicas",a.minReplicas),t.$set(t.hpaModel,"maxReplicas",a.maxReplicas),a.metrics.forEach((function(e,a){var o={};"Resource"==e.type&&(o.name=e.resource.name,"averagevalue"==e.resource.target.type.toLowerCase()?(o.targetType="AverageValue",o.value=e.resource.target.averageValue.replace(/m/g,"")):(o.targetType="AverageUtilization",o.value=e.resource.target.averageUtilization)),"Pods"==e.type&&(o.name=e.pods.metric.name,o.targetType=e.pods.target.type,o.value=e.pods.target.averageValue.replace(/m/g,"")),"object"==e.type.toLowerCase()&&(o.name=e.object.metric.name,"averagevalue"==e.object.target.type.toLowerCase()&&(o.targetType="AverageValue",o.value=e.object.target.averageValue.replace(/m/g,""))),t.$set(t.hpaModel.indicatorData,a,o)})),a.metrics&&0==a.metrics.length&&t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageValue",value:""})}else t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageUtilization",value:""})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}}},ct=nt,dt=(0,_.Z)(ct,B,J,!1,null,null,null),ut=dt.exports,pt=a(1272),mt=function(){var e=this,t=e._self._c;return t("let-modal",{attrs:{title:e.podName+"(Stdout)",width:"80%",height:"60%",footShow:!1},on:{close:e.closePodLog},model:{value:e.showPodLog,callback:function(t){e.showPodLog=t},expression:"showPodLog"}},[e.showPodLog?t("div",{staticClass:"pre log-body"},e._l(e.podLog,(function(a){return t("div",{key:a.id,staticClass:"log-msg"},[t("span",{staticClass:"log-date"},[e._v(e._s(a.time))]),t("span",{class:e.wrap?"wrap-lines":"",staticStyle:{color:"27aa5e"}},[e._v(e._s(a.message))])])})),0):e._e(),t("let-checkbox",{on:{change:e.changeWrap},model:{value:e.wrap,callback:function(t){e.wrap=t},expression:"wrap"}},[e._v(e._s(e.$t("operate.wrap")))]),e._v("    "),t("let-checkbox",{on:{change:e.changePrevious},model:{value:e.previous,callback:function(t){e.previous=t},expression:"previous"}},[e._v(e._s(e.$t("operate.previous")))]),t("span",{staticStyle:{float:"right"}},[t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:e.clearScreen}},[e._v(e._s(e.$t("operate.clear")))]),e._v("    "),t("let-button",{attrs:{size:"mini"},on:{click:function(t){e.showPodLog=!1}}},[e._v(e._s(e.$t("operate.close")))])],1)],1)},ht=[],ft={props:[],name:"log",data:function(){return{showPodLog:!1,podLog:[],podName:"",wrap:!1,previous:!1,socket:null}},methods:{changeWrap:function(){},changePrevious:function(){this.podLog=[],this.readPodLog(this.podName)},clearScreen:function(){this.podLog=[]},closePodLog:function(){this.podLog=[]},show:function(e){this.podName=e;var t="";if("http:"==window.location.protocol)t="ws://".concat(window.location.host,"/web/log?podName=").concat(e,"&previous=").concat(this.previous);else{if("https:"!=window.location.protocol)return void console.log("unknown protocol",window.location);t="wss://".concat(window.location.host,"/web/log?podName=").concat(e,"&previous=").concat(this.previous)}var a=this;this.socket&&this.socket.close(),this.socket=new WebSocket(t,"log-protocol"),this.socket.onopen=function(){a.showPodLog=!0,a.podLog=[]},this.socket.onerror=function(){console.log("[error] Connection error"),a.socket=null},this.socket.close=function(){console.log("[close] Connection closed cleanly"),a.socket=null},this.socket.onmessage=function(e){var t=e.data.indexOf(" ");a.podLog.push({id:a.podLog.length,time:z()(e.data.substring(0,t)).format("YYYY-MM-DD HH:mm:ss"),message:e.data.substring(t)})},this.socket.onsend=function(e){a.socket.send(e)}}}},vt=ft,gt=(0,_.Z)(vt,mt,ht,!1,null,"a519c4d8",null),bt=gt.exports,$t={name:"ServerManage",components:{wrapper:j.Z,k8sManager:ut,YamlEditor:ot,log:bt},data:function(){return{serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},commandHTML:"",dialogCommandVisible:!1,isreloadlist:!0,reloadTask:null,reloadlist:null,serverList:[],serverNotifyList:[],notifyPagination:{page:1,size:10,total:1},defaultObj:{},configModal:{show:!1,model:null},servantAddModal:{show:!1,isNew:!0,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},logLevels:["NONE","DEBUG","TARS","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},showPodYaml:!1,podYaml:null,isCheckedAll:!1,checkedList:[]}},props:["treeid"],computed:{isApplication:function(){return-1==this.treeid.indexOf(".")},showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},isNormal:function(){return"normal"===this.serverData.server_type}},methods:{gotoLog:function(e){var t="/logview.html?History=false&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},closePodYaml:function(){this.podYaml=null},readPodLog:function(e){this.$refs.log.show(e)},describePod:function(e){var t=this,a=this.$loading.show();this.$ajax.getJSON("/k8s/api/describe_pod",{PodName:e.PodName}).then((function(e){t.podYaml=pt.ZP.dump(e),t.showPodYaml=!0,t.$nextTick((function(){t.$refs.yamlEdit.readonly(),a.hide()}))})).catch((function(e){a.hide()}))},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},reloadServerList:function(){var e=this;if(this.$parent.BTabs.length>0){var t=this.$parent.BTabs[0].path,a=t.substring(t.lastIndexOf("/")+1);"manage"!==a&&e.reloadTask||(e.reloadTask=setTimeout((function(){e.isreloadlist&&"#/server"==location.hash&&e.$parent.treeid==e.treeid&&(e.getServerList(),e.getServerNotifyList()),e.reloadServerList()}),3e3))}},startServerList:function(){this.isreloadlist=!0},stopServerList:function(){this.isreloadlist=!1},getServerList:function(){var e=this;this.$ajax.getJSON("/k8s/api/pod_list",{tree_node_id:this.treeid}).then((function(t){e.serverList=[],t.hasOwnProperty("Data")&&(t.Data.forEach((function(e){e.isChecked=!1,e.Source=JSON.parse(e.Source||"{}"),e.CreateTime=z()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.StartTime=z()(e.StartTime).format("YYYY-MM-DD HH:mm:ss")})),e.serverList=t.Data)})).catch((function(e){}))},getServerNotifyList:function(){var e=this;this.showOthers&&this.$ajax.getJSON("/k8s/api/server_notify_list",{tree_node_id:this.treeid,size:this.notifyPagination.size,page:this.notifyPagination.page}).then((function(t){e.notifyPagination.total=Math.ceil(t.total.value/e.notifyPagination.size),e.serverNotifyList=t.hits||[],e.serverNotifyList.forEach((function(e){e._source.timeStr=z()(e._source.notifyTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){}))},statusStyle:function(e){return e=e||"","restart"==e||-1!=e.indexOf("[succ]")?"color: green":"stop"==e||-1!=e.indexOf("[alarm]")||-1!=e.indexOf("error")||-1!=e.indexOf("ERROR")?"color: red":""},notifyGotoPage:function(e){this.notifyPagination.page=e,this.getServerNotifyList()},getServerConfig:function(){var e=this;this.stopServerList();var t=this.$loading.show({target:this.$refs.configFormLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.configModal.model?e.configModal.model=Object.assign({},e.configModal.model,a.Data[0]):(a.templates=[],e.configModal.model=a.Data[0]),e.configModal.model["tree_node_id"]=e.treeid,e.startServerList()})).catch((function(a){t.hide(),e.closeConfigModal(),e.startServerList(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.err_msg||a.message))}))},configServer:function(){var e=this;this.stopServerList(),this.configModal.show=!0,this.$ajax.getJSON("/k8s/api/template_select").then((function(t){e.configModal.model?e.configModal.model.templates=t.Data:e.configModal.model={templates:t.Data},e.getServerConfig(),e.startServerList()})).catch((function(t){e.startServerList(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_option_update",(0,P.Z)({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.closeConfigModal(),e.$tip.success(e.$t("common.success"))})).catch((function(){t.hide()}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null,this.startServerList()},startServer:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o,r,i;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.startService.msg.startService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StartServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},restartServer:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o,r,i;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.restartService.msg.restartService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"RestartServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},stopServer:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o,r,i;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,i=a[0].ServerName,e.$confirm(e.$t("serverList.stopService.msg.stopService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StopServer",podIp:o,serverApp:r,serverName:i}).then((function(t){for(var a=0;a<t.length;a++)if(0!=t[a].ret_code)return void e.$tip.error(e.$t("common.error")+", ret_code:"+t[a].ret_code);e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},deletePod:function(e){var t=this;this.$confirm(this.$t("serverList.tips.deletePod"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_pod",{PodName:e.PodName}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getServerList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},viewEvent:function(e){var t=Object.assign({},e),a={application:t.ServerApp,serverName:t.ServerName};this.$router.push({path:"/operation/event",query:a})},viewTemplate:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_template",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewTemplate"),e.detailModal.model={detail:a},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},privateTemplateManage:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:this.treeid}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewProfileTemplate"),e.detailModal.model={detail:a&&a.Data[0].ServerProfile||""},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},manageServant:function(e){var t=this;this.stopServerList(),this.servantModal.show=!0,this.$ajax.getJSON("/k8s/api/server_adapter_select",{tree_node_id:this.treeid}).then((function(a){t.servantModal.model=a.Data,t.servantModal.currentServer=e})).catch((function(e){t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},manageK8S:function(){this.$refs.k8s.show(this.treeid)},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null,this.startServerList()},addAdapter:function(e){this.servantAddModal.model.ServerServant.push(Object.assign({},e,{Port:this.getPort(e.Port)}))},getPort:function(e){var t=this.defaultObj,a=this.servantModal,o=0;if(e)o=e;else if(o=Math.floor(t.Port),a.model&&a.model.length>0){var r=a.model.sort((function(e,t){return t.Port-e.Port}))||[];o=Math.floor(r[0].Port)}return o++,19385===o&&o++,o},configServant:function(e){var t=this.defaultObj,a={tree_node_id:this.treeid,ServerServant:[{Name:"",Port:this.getPort()||0,Threads:t.Threads||0,Connections:t.Connections||0,Capacity:t.Capacity||0,Timeout:t.Timeout||0,IsTcp:t.IsTcp,IsTars:t.IsTars}]};if(e){this.servantDetailModal.model=a,this.servantDetailModal.isNew=!0;var o=this.servantModal.model.find((function(t){return t.AdapterId===e}));this.servantDetailModal.model={AdapterId:o.AdapterId,ServerServant:[o]},this.servantDetailModal.isNew=!1,this.servantDetailModal.show=!0}else this.servantAddModal.model=a,this.servantAddModal.isNew=!0,this.servantAddModal.show=!0},closeServantAddModal:function(){this.$refs.servantAddForm&&this.$refs.servantAddForm.resetValid(),this.servantAddModal.show=!1,this.servantAddModal.model=null},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,o=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,r=/^t\s([1-9]|[1-9]\d+)$/i,i=/^p\s\d{4,5}$/i,s=!0;if(a.test(t[0])){for(var l=0,n=1;n<t.length;n++)if(o&&o.test(t[n])&&(l++,this.servantDetailModal.model.node_name=t[n].split(/\s/)[1],o=null),r&&r.test(t[n])&&(l++,r=null),i&&i.test(t[n])){var c=t[n].substring(2);c<0||c>65535||l++,i=null}s=3===l}else s=!1;return s},saveServantAdd:function(){var e=this;if(this.$refs.servantAddForm.validate()){var t=this.$Loading.show();if(this.servantAddModal.isNew){var a=Object.assign({},this.servantAddModal.model);if(a.ServerServant){var o={};a.ServerServant.forEach((function(e){o[e.Name]=e})),a.ServerServant=o}this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.manageServant(),e.$tip.success(e.$t("common.success")),e.closeServantAddModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else t.hide()}},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else{this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name;var o=Object.assign({},this.servantDetailModal.model);this.$ajax.postJSON("/k8s/api/server_adapter_update",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/server_adapter_delete",{AdapterId:e}).then((function(o){a.hide(),t.servantModal.model=t.servantModal.model.filter((function(t){return t.AdapterId!==e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},closeDetailModal:function(){this.detailModal.show=!1,this.detailModal.model=null},showMoreCmd:function(e){var t=this;this.stopServerList();var a=this.checkedList.filter((function(e){return e.isChecked}));if(a.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,i=a[0].ServerName;this.moreCmdModal.model={podIp:o,serverApp:r,serverName:i,selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e}},sendCommand:function(e,t,a,o,r){var i=this,s=this.$Loading.show();this.$ajax.getJSON("/k8s/api/send_command",{serverApp:e,serverName:t,podIp:a,command:o}).then((function(e){s.hide();for(var t=0;t<e.length;t++)if(0!=e[t].ret_code)return void i.$tip.error(i.$t("common.error")+", ret_code:"+e[t].ret_code);var a=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(a);i.commandHTML=a,i.dialogCommandVisible=!0,i.getServerNotifyList()})).catch((function(e){s.hide(),i.$tip.error({title:i.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model;this.moreCmdModal.currentServer;"setloglevel"===e.selected?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,e.command):"connection"===e.selected&&this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.checkedList=[],this.moreCmdModal.show=!1,this.moreCmdModal.model=null,this.startServerList()},checkChange:function(e){this.stopServerList();var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.PodId===e.PodId&&(o=!0)})),o||t.push(e)}else{var r=!1,i=-1;t.forEach((function(t,a){t.PodId===e.PodId&&(r=!0,i=a)})),r&&t.splice(i,1)}},checkLauncherType:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:e.treeid});case 2:return a=t.sent,o=a.Data[0].launcherType,t.abrupt("return","foreground"==o);case 5:case"end":return t.stop()}}),t)})))()},goMarket:function(e){var t;t=e.Source["tars.io/CloudProduct"]?"/static/market/index.html#/market/product/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version):"/static/market/index.html#/market/service/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version),window.open(t)}},created:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.serverData=e.$parent.getServerData(),e.serverData.server_type){t.next=12;break}return t.prev=2,t.next=5,e.$ajax.getJSON("/k8s/api/server_option_select",{tree_node_id:e.treeid});case 5:a=t.sent,e.$set(e.serverData,"server_type",a.Data[0].serverType),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),e.$set(e.serverData,"server_type","normal");case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))()},mounted:function(){this.getServerList(),this.reloadServerList(),this.startServerList(),this.getServerNotifyList()},beforeMount:function(){this.startServerList()},beforeDestroy:function(){this.stopServerList()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]},checkedList:function(){var e=this.checkedList;e.length>0?this.stopServerList():this.startServerList()}}},_t=$t,yt=(0,_.Z)(_t,L,I,!1,null,null,null),wt=yt.exports,kt=a(46302),St=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_publish"},[e.buildList.length>0?t("div",[t("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[t("h4",[e._v(" "+e._s(this.$t("serverList.title.buildList"))+" "),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getBuildList()}}})])]),t("div",[t("let-table",{ref:"table",attrs:{data:e.buildList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.buildId"),prop:"Id"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.phase"),prop:"Phase"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.message"),prop:"Message"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteBuild(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,4039036093)})],1)],1)]):e._e(),t("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[t("h4",[e._v(" "+e._s(this.$t("serverList.title.patchList"))+" "),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getImageList()}}})])]),t("div",[t("let-button",{staticStyle:{float:"left","margin-right":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(e._s(e.$t("pub.dlg.upload")))]),t("let-button",{staticStyle:{float:"left"},attrs:{theme:"primary",size:"small"},on:{click:e.showAddImageModal}},[e._v(e._s(e.$t("pub.dlg.image")))]),t("let-button",{staticStyle:{float:"right"},attrs:{theme:"primary",size:"small"},on:{click:e.openPublishVersionModal}},[e._v(e._s(e.$t("pub.btn.pubk8s")))])],1),t("br"),t("div",[t("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.id"),prop:"Id"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.secret"),prop:"Secret"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.currStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:e.getState(a.row.Enabled)})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.form.mark"),prop:"Mark"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.createPerson"),prop:"CreatePerson"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.removeReleaseItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("div",{staticStyle:{overflow:"hidden"},attrs:{slot:"operations"},slot:"operations"}),t("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?t("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[[t("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.Id,callback:function(t){e.$set(e.publishModal.model,"Id",t)},expression:"publishModal.model.Id"}},e._l(e.publishModal.model.patchList,(function(a){return t("let-option",{key:a.Id,attrs:{value:a.Id}},["true"=="".concat(a.Enabled)?t("span",{domProps:{innerHTML:e._s(e.imgCur)}}):t("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),t("span",[e._v(e._s(a.Id)+" | "+e._s(a.CreateTime)+" | "+e._s(a.Image))])])})),1)],1),t("let-form-item",{attrs:{label:e.$t("pub.dlg.nodeImage"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.nodeImageTip")},model:{value:e.publishModal.model.NodeImage,callback:function(t){e.$set(e.publishModal.model,"NodeImage",t)},expression:"publishModal.model.NodeImage"}},e._l(e.publishModal.model.nodeList,(function(a){return t("let-option",{key:a.Image,attrs:{value:a.Image}},[a.isDefaultNode?t("span",{domProps:{innerHTML:e._s(e.imgNew)}}):t("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),a.isCurrNode?t("span",{domProps:{innerHTML:e._s(e.imgCur)}}):t("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),t("span",[e._v(e._s(a.Id)+" | "+e._s(a.CreateTime)+" | "+e._s(a.Image))])])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[t("let-input",{attrs:{size:"small",type:"number",min:1,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.publishModal.model.Replicas,callback:function(t){e.$set(e.publishModal.model,"Replicas",t)},expression:"publishModal.model.Replicas"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[t("let-input",{model:{value:e.publishModal.model.EnableMark,callback:function(t){e.$set(e.publishModal.model,"EnableMark",t)},expression:"publishModal.model.EnableMark"}}),t("let-button",{staticClass:"mt20",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch")))])],1)]],2):e._e()],1),t("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?t("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[t("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?t("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceType"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.serviceTypeTips")},on:{change:e.changeServerType},model:{value:e.uploadModal.model.ServerType,callback:function(t){e.$set(e.uploadModal.model,"ServerType",t)},expression:"uploadModal.model.ServerType"}},e._l(e.serverType,(function(a){return t("let-option",{key:a,attrs:{value:a}},[e._v(e._s(a))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.baseImage"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageTips")},on:{change:e.changeBaseImage},model:{value:e.uploadModal.model.BaseImage,callback:function(t){e.$set(e.uploadModal.model,"BaseImage",t)},expression:"uploadModal.model.BaseImage"}},e._l(e.baseImage,(function(a){return t("let-option",{key:a.Name,attrs:{value:a.Name}},[e._v(e._s(a.Name+"("+a.Mark+")"))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.baseImageRelease"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageReleaseTips")},model:{value:e.uploadModal.model.BaseImageRelease,callback:function(t){e.$set(e.uploadModal.model,"BaseImageRelease",t)},expression:"uploadModal.model.BaseImageRelease"}},e._l(e.baseImageRelease,(function(a){return t("let-option",{key:a.Image,attrs:{value:a.Image}},[e._v(e._s(a.Image+"("+(a.Mark||a.Id)+")"))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serverTag")}},[t("let-input",{attrs:{type:"text",size:"small",placeholder:e.$t("deployService.form.serverTagTip")},model:{value:e.uploadModal.model.ServerTag,callback:function(t){e.$set(e.uploadModal.model,"ServerTag","string"===typeof t?t.trim():t)},expression:"uploadModal.model.ServerTag"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[t("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),t("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),t("let-modal",{attrs:{title:e.$t("pub.dlg.image"),width:"600px",footShow:!1},on:{"on-cancel":e.closeAddImageModal},model:{value:e.addImageModal.show,callback:function(t){e.$set(e.addImageModal,"show",t)},expression:"addImageModal.show"}},[e.addImageModal.model?t("let-form",{ref:"addImageForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.addImage.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),required:""}},[t("let-input",{attrs:{type:"text",size:"small",required:""},model:{value:e.addImageModal.model.Image,callback:function(t){e.$set(e.addImageModal.model,"Image",t)},expression:"addImageModal.model.Image"}})],1),t("let-form-item",{attrs:{label:e.$t("pub.dlg.secret"),required:""}},[t("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Secret,callback:function(t){e.$set(e.addImageModal.model,"Secret",t)},expression:"addImageModal.model.Secret"}})],1),t("let-form-item",{attrs:{label:e.$t("pub.dlg.mark")}},[t("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Mark,callback:function(t){e.$set(e.addImageModal.model,"Mark",t)},expression:"addImageModal.model.Mark"}})],1),t("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("pub.dlg.add")))])],1):e._e()],1)],1)])},Mt=[],xt=a(74409),Ct={name:"ServerPublish",data:function(){return{imgNew:'<img class="logo" src="/static/img/new.gif">',imgCur:'<img class="logo" src="/static/img/current.gif">',imgSpace:'<img class="logo" src="/static/img/space.png">',serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},buildList:[],serverList:[],publishModal:{show:!1,model:{patchList:[],nodeList:[]}},timer:null,reloadTask:null,serverK8S:{},serverType:[],baseImage:[],baseImageRelease:[],defaultImage:null,tfc:null,uploadModal:{show:!1,model:null},addImageModal:{show:!1,model:null}}},props:["treeid"],methods:{getServerType:function(){return this.$ajax.getJSON("/k8s/api/server_list",{tree_node_id:this.treeid})},getDefault:function(){var e=this;this.$ajax.getJSON("/k8s/api/default").then((function(t){e.serverK8S=t.ServerK8S||{},e.serverType=t.ServerTypeOptional||[]}))},changeServerType:function(){var e=this;this.$ajax.getJSON("/k8s/api/base_image_list",{ServerType:this.uploadModal.model.ServerType}).then((function(t){e.baseImage=t.Data||[],e.uploadModal.model.BaseImage=e.baseImage[0].Name}))},changeBaseImage:function(){var e=this;this.baseImageRelease=this.baseImage.filter((function(t){return t.Name==e.uploadModal.model.BaseImage}))[0].Release,this.$set(this.uploadModal.model,"BaseImageRelease",this.baseImageRelease[0].Image)},getState:function(e){var t="";switch("".concat(e)){case"true":t="status-active";break}return t},formatDate:function(e,t){return(0,xt.p6)(e,"YYYY-MM-DD HH:mm:ss")},reloadBuildList:function(){var e=this,t=this;this.timer=setTimeout((function(){if(e.$parent.BTabs.length>0&&t.$parent.treeid==t.treeid){var a=e.$parent.BTabs.filter((function(e){return-1!=e.path.indexOf(t.treeid+"/publish")}));a.length>0&&t.getBuildList()}t.reloadBuildList()}),1e3)},getBuildList:function(){var e=this;this.$ajax.getJSON("/k8s/api/build_list",{tree_node_id:this.treeid}).then((function(t){t.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime)})),e.buildList=t.Data;var a=e.buildList.findIndex((function(e){return"Done"!=e.Phase}));-1==a&&(e.reloadTask=!1)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deleteBuild:function(e){var t=this;this.$confirm(this.$t("deployService.form.delete"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_build",{ImageName:e.ImageName}).then((function(){t.getBuildList(),t.getImageList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},getImageList:function(){var e=this;this.$ajax.getJSON("/k8s/api/patch_list",{tree_node_id:this.treeid}).then((function(t){e.getNowImages().then((function(a){var o=t.Data||[];o.forEach((function(t){t.Id==a.Id&&(t.Enabled=!0),t.CreateTime=e.formatDate(t.CreateTime)})),e.serverList=o})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))},openPublishVersionModal:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o,r,i;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.publishModal.model={tree_node_id:e.treeid,Replicas:e.serverK8S.Replicas||1,show:!0},t.next=3,e.getPatchList();case 3:return a=t.sent,t.next=6,e.getK8SData();case 6:return o=t.sent,t.next=9,e.getNowImages();case 9:return r=t.sent,t.next=12,e.getImageNodes();case 12:i=t.sent,e.publishModal.model.Replicas=o.Data[0].Replicas||e.serverK8S.Replicas||1,a.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime),t.Image==r.Image&&(t.Enabled=!0)})),i.Data.forEach((function(t){t.Image==r.NodeImage&&(t.isCurrNode=!0,e.publishModal.model.NodeImage=r.NodeImage),t.Image==e.defaultImage&&(t.isDefaultNode=!0,e.publishModal.model.NodeImage||(e.publishModal.model.NodeImage=e.defaultImage))})),e.publishModal.model.patchList=a.Data,e.publishModal.model.nodeList=i.Data,e.publishModal.show=!0;case 19:case"end":return t.stop()}}),t)})))()},getPatchList:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/patch_list",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getNowImages:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_now_image",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getK8SData:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{tree_node_id:e.treeid});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getImageNodes:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/image_node_select");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getNodeImage:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:e.tfc=t.sent,a=e.tfc.filter((function(e){return"nodeImage.image"===e.column})),e.defaultImage=1==a.length?a[0].value:"";case 5:case"end":return t.stop()}}),t)})))()},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.$refs.publishForm.resetValid()},savePublishServer:function(){var e=this,t=this.$Loading.show();this.$refs.publishForm.validate()&&(t.hide(),this.$ajax.postJSON("/k8s/api/patch_publish",{tree_node_id:this.publishModal.model.tree_node_id,Id:this.publishModal.model.Id,Replicas:this.publishModal.model.Replicas,EnableMark:this.publishModal.model.EnableMark,NodeImage:this.publishModal.model.NodeImage}).then((function(a){t.hide(),e.getImageList(),e.closePublishModal(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))})))},showUploadModal:function(){var e=this;this.getServerType().then((function(t){e.uploadModal.model={tree_node_id:e.treeid,file:null,ServerMark:"",ServerType:t.Data[0].ServerType},e.uploadModal.show=!0}))},showAddImageModal:function(){this.addImageModal.model={tree_node_id:this.treeid,Id:"",Image:"",Secret:"tars-image-secret",Mark:""},this.addImageModal.show=!0},closeAddImageModal:function(){this.addImageModal.show=!1,this.addImageModal.model=null,this.$refs.addImageForm.resetValid()},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.getImageList()})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData,o=this.tfc.filter((function(e){return"imageBuild.secret"===e.column})),r=o.length>=1&&o[0].value||"";a.append("tree_node_id",this.treeid),a.append("ServerType",this.uploadModal.model.ServerType),a.append("ServerTag",this.uploadModal.model.ServerTag||"v-".concat((0,xt.p6)(new Date,"YYYYMMDDHHmmss"))),a.append("BaseImage",this.uploadModal.model.BaseImageRelease),a.append("Secret",r),a.append("suse",this.uploadModal.model.file),a.append("CreateMark",this.uploadModal.model.comment||""),this.$ajax.postForm("/k8s/api/patch_upload",a).then((function(a){e.closeUploadModal(),e.reloadBuildList(),t.hide(),setTimeout(e.getImageList,1e3)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},addImage:function(){var e=this;if(this.$refs.addImageForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("tree_node_id",this.treeid),a.append("Image",this.addImageModal.model.Image),a.append("Secret",this.addImageModal.model.Secret||""),a.append("Mark",this.addImageModal.model.Mark||""),this.$ajax.postForm("/k8s/api/image_release_create",a).then((function(a){e.closeAddImageModal(),t.hide(),setTimeout(e.getImageList,1e3)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}}},created:function(){this.serverData=this.$parent.getServerData()},beforeMount:function(){this.reloadBuildList()},beforeDestroy:function(){clearTimeout(this.timer),this.timer=null},mounted:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getImageList(),e.getDefault(),t.next=4,e.getNodeImage();case 4:case"end":return t.stop()}}),t)})))()}},Dt=Ct,Nt=(0,_.Z)(Dt,St,Mt,!1,null,null,null),Tt=Nt.exports,Lt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_config"},[t("div",{staticStyle:{"margin-bottom":"10px"}},[t("h4",{staticStyle:{float:"left"}},[e._v(" "+e._s(this.$t("cfg.title.a"))+" "),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getConfigList()}}})]),t("span",{staticStyle:{float:"right"}},[t("let-button",{attrs:{size:"mini",theme:"sub-primary"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cfg.btn.add")))]),e._v("    "),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.nodeConfigAdd(e.configList,e.checkedConfigId)}}},[e._v(e._s(e.$t("filter.btn.addNode")))]),e._v("    "),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.changeConfig(e.configList,"ConfigName",e.checkedConfigId,"configList")}}},[e._v(e._s(e.$t("operate.update")))]),e._v("    "),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("operate.delete")))]),e._v("    "),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showDetail(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("cfg.title.viewConf")))]),e._v("    "),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showHistory(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1)]),e.configList?t("wrapper",{ref:"configListLoading"},[t("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:a.row.ConfigName},model:{value:e.checkedConfigId,callback:function(t){e.checkedConfigId=t},expression:"checkedConfigId"}},[t("span",{staticStyle:{"font-size":"0"}},[e._v(e._s(a.row.ConfigName))])])]}}],null,!1,367281790)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"250px"}})],1)],1):e._e(),e.nodeConfigList&&e.showOthers?t("wrapper",{ref:"nodeConfigListLoading"},[t("div",{staticClass:"btn_group"},[t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.changeConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList,"nodeConfigList")}}},[e._v(e._s(e.$t("cfg.table.modCfg")))]),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showMergedDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewMerge")))]),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("operate.delete")))]),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewIpContent")))]),t("let-button",{attrs:{size:"mini",theme:"primary"},on:{click:function(t){return e.showHistory(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1),e.nodeConfigList.length?t("let-checkbox",{staticClass:"check-all",model:{value:e.nodeCheckAll,callback:function(t){e.nodeCheckAll=t},expression:"nodeCheckAll"}}):e._e(),t("let-table",{attrs:{data:e.nodeConfigList,title:e.$t("cfg.title.c"),"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-checkbox",{attrs:{label:a.row.ConfigId},model:{value:e.nodeCheckList,callback:function(t){e.nodeCheckList=t},expression:"nodeCheckList"}})]}}],null,!1,1794674851)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"PodSeq"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-"+e._s(t.row.PodSeq)+" ")]}}],null,!1,3597062101)}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"180px"}})],1)],1):e._e(),t("let-modal",{attrs:{title:e.configModal.isNew?"".concat(e.$t("operate.title.add")," ").concat(e.$t("common.config")):"".concat(e.$t("operate.title.update")," ").concat(e.$t("common.config")),width:"80%"},on:{"on-confirm":e.configDiff,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?t("let-form",{ref:"configForm",attrs:{itemWidth:"100%"}},[t("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[t("let-input",{attrs:{size:"small",disabled:!e.configModal.isNew,required:""},model:{value:e.configModal.model.ConfigName,callback:function(t){e.$set(e.configModal.model,"ConfigName",t)},expression:"configModal.model.ConfigName"}})],1),e.configModal.isNew?e._e():t("let-form-item",{attrs:{label:e.$t("cfg.btn.reason"),required:""}},[t("let-input",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ConfigMark,callback:function(t){e.$set(e.configModal.model,"ConfigMark",t)},expression:"configModal.model.ConfigMark"}})],1),t("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[t("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.configContent,callback:function(t){e.configContent=t},expression:"configContent"}})],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.nodeConfigModal.isNew?"".concat(e.$t("operate.title.add")," ").concat(e.$t("common.config")):"".concat(e.$t("operate.title.update")," ").concat(e.$t("common.config")),width:"80%"},on:{"on-confirm":e.updateNodeConfigFile,close:e.closeNodeConfigModal,"on-cancel":e.closeNodeConfigModal},model:{value:e.nodeConfigModal.show,callback:function(t){e.$set(e.nodeConfigModal,"show",t)},expression:"nodeConfigModal.show"}},[e.nodeConfigModal.model?t("let-form",{ref:"nodeConfigForm",attrs:{itemWidth:"100%"}},[t("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[t("let-input",{attrs:{disabled:"",size:"small",required:""},model:{value:e.nodeConfigModal.model.ConfigName,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigName",t)},expression:"nodeConfigModal.model.ConfigName"}})],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),required:""}},[t("div",{staticStyle:{display:"flex"}},[t("span",{staticStyle:{display:"block"}},[e._v(e._s(e.nodeConfigModal.model.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-")]),t("let-input",{staticStyle:{display:"block",flex:"1"},attrs:{type:"number",min:0,max:20,size:"small",required:""},model:{value:e.nodeConfigModal.model.PodSeq,callback:function(t){e.$set(e.nodeConfigModal.model,"PodSeq",t)},expression:"nodeConfigModal.model.PodSeq"}})],1)]),t("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[t("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.nodeConfigModal.model.ConfigContent,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigContent",t)},expression:"nodeConfigModal.model.ConfigContent"}})],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.$t("filter.title.diffTxt"),width:"1200px"},on:{"on-confirm":e.updateConfigDiff,close:e.closeConfigDiffModal,"on-cancel":e.closeConfigDiffModal},model:{value:e.configDiffModal.show,callback:function(t){e.$set(e.configDiffModal,"show",t)},expression:"configDiffModal.show"}},[e.configDiffModal.model?t("div",{staticStyle:{"padding-top":"30px"}},[t("div",{staticClass:"codediff_head"},[t("div",{staticClass:"codediff_th"},[e._v("OLD:")]),t("div",{staticClass:"codediff_th"},[e._v("NEW:")])]),t("diff",{attrs:{"old-string":e.configDiffModal.model.oldData,"new-string":e.configDiffModal.model.newData,context:10,"output-format":"side-by-side"}})],1):e._e()]),t("let-modal",{attrs:{title:e.detailModal.title,width:"1200px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model&&e.detailModal.model.table?t("let-button",{staticStyle:{"margin-top":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.backConfig}},[e._v("恢复")]):e._e(),e.detailModal.model&&e.detailModal.model.table?t("let-table",{staticClass:"history-table",attrs:{data:e.detailModal.model.table,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-radio",{attrs:{label:a.row.ConfigId},model:{value:e.backConfigId,callback:function(t){e.backConfigId=t},expression:"backConfigId"}},[e._v(e._s(""))])]}}],null,!1,316818822)}),t("let-table-column",{attrs:{title:e.$t("common.time"),prop:"CreateTime"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{on:{click:function(t){return e.historyClick(a.row)}}},[e._v(" "+e._s(a.row.CreateTime)+" ")])]}}],null,!1,1722398695)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{on:{click:function(t){return e.historyClick(a.row)}}},[e._v(" "+e._s(a.row.ConfigVersion)+" ")])]}}],null,!1,1586553542)}),t("let-table-column",{attrs:{width:"400px",title:e.$t("cfg.btn.reason"),prop:"ConfigMark"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{on:{click:function(t){return e.historyClick(a.row)}}},[e._v(" "+e._s(a.row.ConfigMark||" ")+" ")])]}}],null,!1,3265173353)}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.content"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.showTableDeatil(a.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3817607729)})],1):e._e(),e.detailModal.model&&!e.detailModal.model.table||e.detailModal.model&&e.detailModal.model.table&&e.detailModal.model.detail?t("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),t("div",{ref:"detailModalLoading",staticClass:"detail-loading"})],1)],1)},It=[],At=(a(2918),a(783)),Ot={name:"ServerConfig",components:{wrapper:j.Z,diff:At.Z},data:function(){return{oldStr:"old code",newStr:"new code",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},checkedConfigId:"",backConfigId:"",configList:[],nodeConfigList:null,nodeCheckList:[],configContent:"",configModal:{show:!1,isNew:!0,model:null},nodeConfigContent:"",nodeConfigModal:{show:!1,isNew:!0,model:null},configDiffModal:{type:"",show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},refFileModal:{show:!1,model:{fileList:[]}},nodeRefFileListModal:{show:!1,model:null},pushResultModal:{show:!1,model:null}}},props:["treeid"],computed:{showOthers:function(){return 5===this.serverData.level},nodeCheckAll:{get:function(){return!(!this.nodeConfigList||!this.nodeConfigList.length)&&this.nodeCheckList.length===this.nodeConfigList.length},set:function(e){this.nodeCheckList=e?this.nodeConfigList.map((function(e){return e.ConfigId})):[]}}},watch:{checkedConfigId:function(){var e=this;this.$nextTick((function(){e.getNodeConfigList()}))}},methods:{getConfigList:function(e){var t=this,a=this.$refs.configListLoading.$loading.show(),o=this.treeid;this.$ajax.getJSON("/k8s/api/server_config_select",{tree_node_id:o}).then((function(e){a.hide(),t.configList=[],t.refFileList=[],t.nodeConfigList=[],e.hasOwnProperty("Data")&&(e.Data[0]&&e.Data[0].ConfigId&&(t.checkedConfigId=e.Data[0].ConfigName,t.getNodeConfigList()),e.Data.forEach((function(e){e.CreateTime=(0,xt.p6)(e.CreateTime)})),t.configList=e.Data)})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("common.error"),t.$t("common.retry"),t.$t("common.alert")).then((function(){t.getConfigList()}))}))},addConfig:function(){this.configContent="",this.configModal.model={ConfigName:this.serverData.server_name+".conf",ConfigContent:""},this.configModal.isNew=!0,this.configModal.show=!0},changeConfig:function(e,t,a,o){var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));if(!a||0===a.length||0==r.length)return this.$tip.warning(this.$t("dialog.tips.item"));this.configContent=r[0].ConfigContent,this.configModal.model=Object.assign(r[0],{ConfigMark:""}),this.configModal.target=o,this.configModal.isNew=!1,this.configModal.show=!0},updateConfigFile:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show(),a=this.configModal.model;if(this.configModal.isNew){var o=Object.assign({tree_node_id:this.treeid},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}else this.$ajax.postJSON("/k8s/api/server_config_update",{ConfigId:a.ConfigId,ConfigMark:a.ConfigMark,ConfigContent:a.ConfigContent}).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}},updateNodeConfigFile:function(){var e=this;if(this.$refs.nodeConfigForm.validate()){var t=this.$Loading.show(),a=this.nodeConfigModal.model;if(this.nodeConfigModal.isNew){var o=Object.assign({tree_node_id:this.treeid},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeNodeConfigModal()})).catch((function(a){t.hide(),e.$tip.error(a.err_msg)}))}}},backConfig:function(){var e=this,t=this.backConfigId;if(!t)return this.$tip.error("请先选择一项");var a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_config_history_back",{HistoryId:t}).then((function(t){a.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeDetailModal()})).catch((function(){a.hide(),e.$tip.error(e.$t("common.error"))}))},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1},closeNodeConfigModal:function(){this.$refs.nodeConfigForm&&this.$refs.nodeConfigForm.resetValid(),this.nodeConfigModal.show=!1},deleteConfig:function(e,t,a){var o=this;if(!a)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.$confirm(this.$t("cfg.msg.confirmCfg"),this.$t("common.alert")).then((function(){var e=o.$Loading.show();o.$ajax.getJSON("/k8s/api/server_config_delete",{ConfigId:r[0].ConfigId}).then((function(t){e.hide(),o.getConfigList(o.serverData),o.$tip.success(o.$t("common.success"))})).catch((function(t){e.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(t.err_msg||t.message))}))}))},getNodeConfigList:function(){var e=this;if(this.showOthers){var t={tree_node_id:this.treeid,ConfigName:this.checkedConfigId};this.$ajax.getJSON("/k8s/api/server_config_select",t).then((function(t){t.Data.forEach((function(e){e.CreateTime=(0,xt.p6)(e.CreateTime)})),e.nodeCheckList=[],e.nodeConfigList=t.Data})).catch((function(t){e.nodeConfigList=[],e.$tip.error({title:e.$t("common.error"),message:t.err_msg||t.message||e.$t("common.networkErr")})}))}},nodeConfigAdd:function(e,t){if(!t)return this.$tip.warning(this.$t("dialog.tips.item"));var a=e.filter((function(e){return e.ConfigName===t}));this.nodeConfigModal.model={ServerId:this.treeid,ConfigName:a[0].ConfigName,ConfigContent:""},this.nodeConfigModal.isNew=!0,this.nodeConfigModal.show=!0},showDetail:function(e,t,a){if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var o=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewConf"),this.detailModal.model={detail:o[0].ConfigContent},this.detailModal.show=!0},showMergedDetail:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewMerged"),this.detailModal.show=!0;var i=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/merged_node_config",{tree_node_id:this.treeid,ConfigName:r[0].ConfigName,PodSeq:r[0].PodSeq}).then((function(e){i.hide(),o.detailModal.model={detail:e}})).catch((function(e){i.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showHistory:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewHistory"),this.detailModal.show=!0;var i=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/server_config_history_select",{ConfigId:r[0].ConfigId}).then((function(e){i.hide(),e.Data.forEach((function(e){e.CreateTime=(0,xt.p6)(e.CreateTime)})),o.detailModal.model={currentVersion:r[0].ConfigVersion,ConfigId:r[0].ConfigId,table:e.Data,detail:""}})).catch((function(e){i.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showTableDeatil:function(e){this.detailModal.model.detail=e.ConfigContent},closeDetailModal:function(){this.backConfigId="",this.detailModal.show=!1,this.detailModal.model=null},configDiff:function(){this.$refs.configForm.validate()&&(this.configDiffModal.type="config",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.configModal.model.ConfigContent,newData:this.configContent})},updateConfigDiff:function(){var e=this.configDiffModal.type,t=this.configModal.model;if(t.ConfigName.toLowerCase().endsWith(".json"))try{JSON.parse(this.configContent)}catch(s){return void alert("config format error:"+s.toString())}if(t.ConfigName.toLowerCase().endsWith(".xml"))try{var a=new DOMParser,o=a.parseFromString(this.configContent,"text/xml"),r=o.getElementsByTagName("parsererror"),i="";if(r.length>0)return i="parsererror"==o.documentElement.nodeName?o.documentElement.childNodes[0].nodeValue:o.getElementsByTagName("parsererror")[0].innerHTML,void alert("config format error:"+i)}catch(s){return void alert("config format error:"+s.toString())}"config"===e&&(this.configModal.model.ConfigContent=this.configContent,this.updateConfigFile())},closeConfigDiffModal:function(){this.configDiffModal.show=!1},nodeConfigDiff:function(){this.$refs.nodeConfigForm.validate()&&(this.configDiffModal.type="nodeConfig",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.nodeConfigModal.model.ConfigContent,newData:this.nodeConfigContent})},historyClick:function(e){this.backConfigId=e.HistoryId}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getConfigList(this.serverData)}},Pt=Ot,jt=(0,_.Z)(Pt,Lt,It,!1,null,null,null),qt=jt.exports,zt=a(65585),Bt=a(33490),Jt=a(95888),Et=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_manage"},[t("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[t("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),t("i",{staticClass:"el-icon-refresh-right",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})])]),e.serverList?t("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.gotoLog(a.row)}}},[e._v(e._s(a.row.PodName))])]}}],null,!1,2844911292)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.deleteTime"),prop:"DeleteTime"}})],1):e._e()],1)},Zt=[],Vt={name:"ServerManage",data:function(){return{serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[]}},props:["treeid"],methods:{gotoLog:function(e){var t="/logview.html?History=true&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getServerList:function(e){var t=this;this.$ajax.getJSON("/k8s/api/pod_history_list",{tree_node_id:this.treeid}).then((function(e){e.Data.forEach((function(e){e.CreateTime=z()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.DeleteTime=z()(e.DeleteTime).format("YYYY-MM-DD HH:mm:ss")})),t.serverList=e.Data})).catch((function(e){t.$confirm(e.err_msg||e.message||t.$t("serverList.msg.fail"),t.$t("common.alert")).then((function(){t.getServerList()}))}))},more:function(){this.getServerList(this.continue)}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getServerList()}},Ht=Vt,Ft=(0,_.Z)(Ht,Et,Zt,!1,null,null,null),Rt=Ft.exports,Yt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_server_history"},[e.serverListShow?t("div",{staticClass:"table_wrap"},[t("div",{staticClass:"table_head"},[t("h4",[e._v(e._s(this.$t("serverList.title.serverList")))])]),t("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.gotoLog(a.row)}}},[e._v(e._s(a.row.PodName))])]}}],null,!1,2844911292)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.getState(a.row.SettingState)},[e._v(e._s(a.row.SettingState))])]}}],null,!1,987565344)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:e.getState(a.row.PresentState)},[e._v(e._s(a.row.PresentState))])]}}],null,!1,1754665792)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:a.row.PresentMessage||""}},[t("let-table-operation",[e._v(e._s(a.row.PresentMessage))])],1)]}}],null,!1,524765591)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.historyLink(a.row.id)}}},[e._v(e._s(e.$t("operate.goto")))])]}}],null,!1,1467617346)})],1),t("let-button",{attrs:{theme:"danger"},on:{click:function(t){return e.getMore()}}},[e._v(e._s(e.$t("operate.more")))])],1):t("div",{staticClass:"history_search"},[t("label",{staticClass:"history_search_box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.historySearchKey,expression:"historySearchKey"}],staticClass:"history_search_key",attrs:{type:"text",placeholder:"请输入 应用名/服务名/IP地址 搜索"},domProps:{value:e.historySearchKey},on:{blur:e.historySearch,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.historySearch.apply(null,arguments)},input:function(t){t.target.composing||(e.historySearchKey=t.target.value)}}})]),t("div",{staticClass:"history_list_wrap"},[t("div",{staticClass:"history_list_title"},[e._v("Last Access：")]),t("ul",{staticClass:"history_list"},e._l(e.historySearchList,(function(a){return t("li",{key:a,staticClass:"history_item"},[t("a",{staticClass:"history_link",attrs:{href:"javascript:;"},on:{click:function(t){return e.historySearchLink(a)}}},[e._v(e._s(a))])])})),0)])])])},Wt=[],Kt=(a(89730),{name:"ServerHistory",data:function(){return{historySearchKey:"",historySearchList:[],serverList:[],serverListShow:!1,continue:null}},mounted:function(){this.updateHistorySearchKey()},methods:{gotoLog:function(e){var t="/logview.html?History=true&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},getMore:function(){this.historySearch(this.continue)},historySearch:function(e){var t=this,a=this.historySearchKey;a&&(this.updateHistorySearchKey(),this.$ajax.getJSON("/k8s/api/server_search",{searchkey:a,continue:e}).then((function(e){t.continue=e.continue,t.serverList=e.rows,t.serverListShow=!0})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))})))},historySearchLink:function(e){this.historySearchKey=e,this.historySearch()},historyLink:function(e){var t=this;this.$nextTick((function(){t.$parent.selectTree(e),t.$parent.getTreeData()}))},updateHistorySearchKey:function(){var e=this.historySearchKey,t=this.getLocalStorage("taf_history_key")||[];if(e){if(t&&t.length>0){var a=-1;t.forEach((function(t,o){t===e&&(a=o)})),-1!==a&&t.splice(a,1),t.unshift(e)}else t=[e];this.historySearchList=t.slice(0,20),this.setLocalStorage("taf_history_key",JSON.stringify(t))}else this.historySearchList=t},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}}}),Ut=Kt,Gt=(0,_.Z)(Ut,Yt,Wt,!1,null,null,null),Qt=Gt.exports,Xt=a(78813),ea={name:"Server",components:{callChain:kt.Z,manage:wt,publish:Tt,config:qt,"server-monitor":zt.Z,"property-monitor":Bt.Z,"user-manage":Jt.Z,history:Rt,serverHistory:Qt,plugins:Xt.Z},data:function(){return{treeErrMsg:"load failed",treeData:null,treeSearchKey:"",treeid:"",isIconPlay:!1,serverData:{level:5,application:"",server_name:""},BTabs:[],plugins:[],defaultProps:{children:"children",label:"name"},openDelay:1e3,loading:!1,homeTab:"home"}},computed:{base:function(){return"/k8s/".concat(this.treeid)}},filters:{serverTypeFilter:function(e){return"tars"==e?"el-icon-tickets":"el-icon-document-copy"}},watch:{treeid:function(){this.serverData=this.getServerData(),this.$store.commit({type:"increment",name:this.serverData})},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},directives:{vscroll:{componentUpdated:function(e){var t=e||"",a=e.children||[],o="";for(var r in a){var i=a[r],s=i.attributes["class"];if(s&&s.value.indexOf("active")>-1){o=i;break}}if(o.offsetLeft<t.scrollLeft){var l=o.offsetLeft;t.scrollTo(l,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var n=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(n,0)}}}},methods:{getNewServerName:function(e){var t=e&&e.split(".");if(!t)return e;if(1==t.length){var a=e&&e.split(".")[0].substring(1);return"".concat(a)}if(t.length>1){var o=e&&e.split(".")[0].substring(1),r=e&&e.split(".")[e.split(".").length-1].substring(1);return"".concat(o,".").concat(r)}},getName:function(e){var t="";return e.lastIndexOf("/")>-1&&(t=e.substring(e.lastIndexOf("/")+1,e.length)),t},getPlugins:function(){var e=this;this.$ajax.getJSON("/plugin/api/list",{k8s:!0,type:2}).then((function(t){e.plugins=t,console.log(t)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},iconLoading:function(){var e=this;e.isIconPlay||(e.isIconPlay=!0,setTimeout((function(){e.isIconPlay=!1}),1e3))},handleNodeClick:function(e){e.id&&0!=e.type&&(this.selectBTabs(e.id),this.checkCurrBTabs())},filterTextChange:function(){this.$refs.trees.filter(this.treeSearchKey)},filterNode:function(e,t){return!e||-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},treeSearch:function(e){this.iconLoading(),this.getTreeData(this.treeSearchKey,e,!0)},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey="0"!==e.type?e.id:"",a.treeSearchKey&&(e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(e,t,a){var o=this;this.treeData=null,this.$nextTick((function(){o.loading=!0,o.$ajax.getJSON("/k8s/api/tree",{searchKey:e||"",force:a,type:t}).then((function(e){o.loading=!1,o.treeData=e,o.handleData(o.treeData,!0)})).catch((function(e){o.loading=!1,o.treeErrMsg=e.err_msg||e.message||"load failed"}))}))},getServerData:function(){this.treeid||(this.treeid=this.getLocalStorage("k8s_treeid"));var e={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""};if(!this.treeid)return{};if("home"==this.treeid)return e;if(this.$refs.trees){var t=this.$refs.trees.getNode(this.treeid);t&&(t.data.serverType||"")}var a=this.treeid.split(".");return a.forEach((function(t){var a=+t.substr(0,1),o=t.substr(1);switch(a){case 1:e.application=o;break;case 2:e.set_name=o;break;case 3:e.set_area=o;break;case 4:e.set_group=o;break;case 5:e.server_name=o;break;default:break}e.level=a})),e},checkTreeid:function(){this.treeid=this.getLocalStorage("k8s_treeid")||""},clickTab:function(e){var t=this,a=this.treeid,o=this.BTabs;o&&o.forEach((function(o){o.id===a&&(o.path=e.name,o.pluginPath=e.name.substr(t.base.length),o.pluginPath=o.pluginPath.substr(0,o.pluginPath.length-8))})),this.setLocalStorage("k8s_tabs",JSON.stringify(o))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;"server"===t&&1!==this.serverData.level&&(a=!0),2===this.serverData.level||"manage"!==t&&"history"!==t&&"publish"!==t||(a=!0),a&&(1===this.serverData.level?this.$router.replace("server"):2===this.serverData.level&&this.$router.replace("manage"))},checkBTabs:function(){var e=this.BTabs,t=this.getLocalStorage("k8s_tabs");t&&t.length>0&&t.forEach((function(t){e.push({id:t.id,path:t.path})}))},checkCurrBTabs:function(){var e=this;this.$nextTick((function(){var t=e.$refs.btabs||"",a=t.children||[],o="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(o=e)})),o.offsetLeft<t.scrollLeft){var r=o.offsetLeft;t.scrollTo(r,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var i=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(i,0)}}))},selectBTabs:function(e){var t=this.BTabs,a=!1;t.forEach((function(t){t.id===e&&(a=!0,t.path="/server/".concat(e,"/manage"))})),a||this.BTabs.push({id:e,path:"/server/".concat(e,"/manage")}),this.treeid=e,this.setLocalStorage("k8s_treeid",JSON.stringify(e)),this.setLocalStorage("k8s_tabs",JSON.stringify(t))},clickBTabs:function(e,t){t==this.homeTab&&(Qt.data.serverListShow=!1),this.treeid=t,this.setLocalStorage("k8s_treeid",JSON.stringify(t))},closeBTabs:function(e){var t=this.BTabs,a=0;t.forEach((function(t,o){t.id===e&&(a=o)})),t.splice(a,1),this.setLocalStorage("k8s_tabs",JSON.stringify(t)),t.length>0?this.treeid=t[t.length-1].id:this.treeid="home",this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid))},closeAllBTabs:function(){this.BTabs=[],this.treeid="home",this.setLocalStorage("k8s_tabs",JSON.stringify(this.BTabs)),this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid)),this.getTreeData()},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}},created:function(){},mounted:function(){this.checkTreeid(),this.serverData=this.getServerData(),this.isTrueTreeLevel(),this.checkBTabs(),this.getTreeData(),this.getPlugins(),this.treeid||(this.treeid="home")}},ta=ea,aa=(0,_.Z)(ta,N,T,!1,null,null,null),oa=aa.exports,ra=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation"},[t("el-tabs",{attrs:{activekey:e.$route.path},on:{"tab-click":e.onTabClick}},[t("el-tab-pane",{attrs:{label:e.$t("deployService.title.deploy"),name:"/operation/deploy"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.undeploy"),name:"/operation/undeploy"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.template"),name:"/operation/templates"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.business"),name:"/operation/business"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.application"),name:"/operation/application"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.node"),name:"/operation/node"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.event"),name:"/operation/event"}}),t("el-tab-pane",{attrs:{label:e.$t("deployService.title.image"),name:"/operation/image"}}),e.isAdmin?t("el-tab-pane",{attrs:{label:e.$t("deployService.title.framework"),name:"/operation/tfc"}}):e._e(),e._l(e.plugins,(function(e){return t("el-tab-pane",{key:e.f_id,attrs:{name:"/operation/plugins"+e.f_path,label:e.f_name}})}))],2),t("router-view",{staticClass:"page_operation_children",attrs:{path:e.name}})],1)},ia=[],sa=a(9540),la=a(22814),na=(0,_.Z)(la.Z,sa.s,sa.x,!1,null,null,null),ca=na.exports,da="/operation/deploy",ua={name:"Operation",components:{plugins:ca},data:function(){return{isAdmin:!1,name:"",plugins:[]}},beforeRouteEnter:function(e,t,a){"/operation"===e.path?a(da):a()},beforeRouteLeave:function(e,t,a){da=t.path,a()},created:function(){this.checkAdmin()},mounted:function(){this.getPlugins()},methods:{checkAdmin:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isAdmin=!1,t.abrupt("return",e.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){})));case 2:case"end":return t.stop()}}),t)})))()},selectTree:function(e){"/operation"===this.$route.path?this.$router.push(da):this.$router.push({params:{treeid:e}})},getPlugins:function(){var e=this;this.$ajax.getJSON("/plugin/api/list",{k8s:!0,type:3}).then((function(t){e.plugins=t,e.plugins.forEach((function(t){"en"==e.$cookie.get("locale")&&(t.f_name=t.f_name_en)}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},onTabClick:function(e){this.name=e.name,this.$router.replace(e.name)}}},pa=ua,ma=(0,_.Z)(pa,ra,ia,!1,null,null,null),ha=ma.exports,fa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_deploy"},[e.deployObj?t("baseInfo",{attrs:{deployObj:e.deployObj},on:{next:e.next}}):e._e(),e.show?t("install",{ref:"install",attrs:{deployObj:e.deployObj},on:{doInstall:e.doInstall}}):e._e()],1)},va=[],ga=function(){var e=this,t=e._self._c;return t("div",[e.deployObj?t("let-form",{ref:"form",attrs:{inline:"","label-position":"top",itemWidth:"30%"},nativeOn:{submit:function(t){return t.preventDefault(),e.next.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.deployObj.app,callback:function(t){e.$set(e.deployObj,"app",t)},expression:"deployObj.app"}},e._l(e.appList,(function(a){return t("let-option",{key:a.ServerApp,attrs:{value:a.ServerApp}},[e._v(e._s(a.ServerApp))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.deployObj.server,callback:function(t){e.$set(e.deployObj,"server",t)},expression:"deployObj.server"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[t("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.deployObj.template,callback:function(t){e.$set(e.deployObj,"template",t)},expression:"deployObj.template"}},e._l(e.templates,(function(a){return t("let-option",{key:a.TemplateId,attrs:{value:a.TemplateId}},[e._v(e._s(a.TemplateId))])})),1)],1),t("let-table",{attrs:{data:e.deployObj.servants}},[t("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",disabled:!e.deployObj.new,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:a.row.name,callback:function(t){e.$set(a.row,"name",t)},expression:"props.row.name"}})]}}],null,!1,3854246402)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.port,callback:function(t){e.$set(a.row,"port",t)},expression:"props.row.port"}})]}}],null,!1,1220625212)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{disabled:!e.deployObj.new,label:!0},model:{value:a.row.isTcp,callback:function(t){e.$set(a.row,"isTcp",t)},expression:"props.row.isTcp"}},[e._v("TCP")]),t("let-radio",{attrs:{disabled:!e.deployObj.new,label:!1},model:{value:a.row.isTcp,callback:function(t){e.$set(a.row,"isTcp",t)},expression:"props.row.isTcp"}},[e._v("UDP")])]}}],null,!1,2191313922)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-radio",{attrs:{disabled:!e.deployObj.new,label:!0},model:{value:a.row.isTars,callback:function(t){e.$set(a.row,"isTars",t)},expression:"props.row.isTars"}},[e._v("TARS")]),t("let-radio",{attrs:{disabled:!e.deployObj.new,label:!1},model:{value:a.row.isTars,callback:function(t){e.$set(a.row,"isTars",t)},expression:"props.row.isTars"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}],null,!1,1987037891)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"60px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.thread,callback:function(t){e.$set(a.row,"thread",t)},expression:"props.row.thread"}})]}}],null,!1,759048193)}),t("let-table-column",{attrs:{title:e.$t("serverList.servant.connections"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.connection,callback:function(t){e.$set(a.row,"connection",t)},expression:"props.row.connection"}})]}}],null,!1,2155341273)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"90px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(a){return[t("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:a.row.capacity,callback:function(t){e.$set(a.row,"capacity",t)},expression:"props.row.capacity"}})]}}],null,!1,1786573115)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-input",{staticStyle:{"padding-right":"20px"},attrs:{size:"small",type:"number",min:0},model:{value:a.row.timeout,callback:function(t){e.$set(a.row,"timeout",t)},expression:"props.row.timeout"}})]}}],null,!1,1790878308)}),e.deployObj.new?t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.$index?t("let-table-operation",{on:{click:function(t){return e.addAdapter(a.row)}}},[e._v(e._s(e.$t("operate.add"))+" ")]):e._e(),a.$index?t("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deployObj.servants.splice(a.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]):e._e()]}}],null,!1,2141953043)}):e._e()],1),t("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("common.submit")))])],1):e._e()],1)},ba=[],$a=function(){var e=this,t=e._self._c;return e.DetailModel.show?t("el-dialog",{attrs:{title:e.$t("operate.k8s"),visible:e.DetailModel.show,width:"1060px","before-close":e.closeDetailModel,top:"10px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.DetailModel,"show",t)}}},[t("el-collapse",{attrs:{accordion:""},on:{change:e.HandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-collapse-item",{attrs:{name:"copyNode"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.copyNode")))])]),t("replicas",{ref:"replicas",attrs:{install:!0,replicas:e.deployObjData.replicas},on:{saveReplicas:e.saveReplicas}})],2),t("el-collapse-item",{attrs:{name:"pull"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.pull")))])]),t("pull",{ref:"pull",attrs:{install:!0,pull:e.deployObjData.imagePullPolicy},on:{savePull:e.savePull}})],2),t("el-collapse-item",{attrs:{name:"stacked"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.stacked")))])]),t("stacked",{ref:"stacked",attrs:{install:!0,notStacked:e.deployObjData.notStacked},on:{saveStacked:e.saveStacked}})],2),t("el-collapse-item",{attrs:{name:"launcherType"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.launcherType")))])]),t("launcher-type",{ref:"launcherType",attrs:{install:!0,launcherType:e.deployObjData.launcherType},on:{saveLauncherType:e.saveLauncherType}})],2),t("el-collapse-item",{attrs:{name:"jobModel"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.jobModel")))])]),e.k8sModel?t("jobModel",{ref:"jobModel",attrs:{install:!0,daemonSet:e.deployObjData.daemonSet},on:{saveJobModel:e.saveJobModel}}):e._e()],2),t("el-collapse-item",{attrs:{name:"nodeSelect"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),t("abilityAffinity",{ref:"affinity",attrs:{install:!0,k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator},on:{saveAffinity:e.saveAffinity}})],2),t("el-collapse-item",{attrs:{name:"network"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.network")))])]),t("network-mapping",{ref:"network",attrs:{install:!0,k8sModel:e.k8sModel},on:{saveNetwork:e.saveNetwork}})],2),t("el-collapse-item",{attrs:{name:"disk"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.disk")))])]),t("disk-manger",{ref:"disk",attrs:{install:!0,k8sModel:e.k8sModel,mounts:e.mounts},on:{saveDisk:e.saveDisk}})],2),t("el-collapse-item",{attrs:{name:"resource"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.resource")))])]),t("resource-manger",{ref:"resource",attrs:{install:!0,sourceModel:e.sourceModel},on:{saveResource:e.saveResource}})],2),t("el-collapse-item",{attrs:{name:"yaml"}},[t("template",{slot:"title"},[t("b",[e._v(e._s(e.$t("operate.yaml")))])]),t("YamlEditor",{ref:"yamlEdit",model:{value:e.yamlContent,callback:function(t){e.yamlContent=t},expression:"yamlContent"}})],2)],1),t("br"),t("el-button",{attrs:{type:"submit",theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("common.submit")))])],1):e._e()},_a=[],ya={name:"installK8S",components:{pull:Q,launcherType:re,stacked:de,jobModel:ve,replicas:R,abilityAffinity:ke,diskManger:Pe,networkMapping:Ne,resourceManger:Ee,YamlEditor:ot,hpaManger:Ye},props:["deployObj"],data:function(){return{DetailModel:{show:!1},activeName:"copyNode",deployObjData:null,k8sModel:{},labelMatchArr:[],LabelMatchOperator:[],sourceModel:{},serverData:{},hpaModel:{minReplicas:"",maxReplicas:"",indicatorData:[]},indicators:[],yamlContent:"",mounts:this.deployObj.mounts||[]}},mounted:function(){this.deployObjData=this.deployObj,this.show()},methods:{HandleClick:function(e){var t=this;"yaml"==e&&this.$nextTick((function(){var e=JSON.parse(JSON.stringify(t.deployObjData));delete e.cloud,t.yamlContent=pt.ZP.dump(e),t.$refs.yamlEdit.refresh()}))},show:function(){var e=this;this.getDefaultValue(),this.deployObjData.repo=this.deployObjData.repo||{},this.deployObjData.repo.id="",this.deployObjData.replicas=this.deployObjData.replicas||1,this.deployObjData.daemonSet=this.deployObjData.daemonSet||!1,this.deployObjData.launcherType=this.deployObjData.launcherType||"background",this.deployObjData.notStacked=this.deployObjData.notStacked||!0,this.deployObjData.imagePullPolicy=this.deployObjData.imagePullPolicy||"Always",this.k8sModel.abilityAffinity=this.deployObjData.abilityAffinity||"AppOrServerPreferred",this.k8sModel.labelMatchArr=this.deployObjData.nodeSelector||[],this.k8sModel.HostIpc=this.deployObjData.hostIPC||!1,this.k8sModel.HostNetwork=this.deployObjData.hostNetwork||!1,this.k8sModel.showHostPort=this.deployObjData.hostPorts.length>0,this.k8sModel.HostPortArr=[],(this.deployObjData.servants||[]).forEach((function(t){var a=e.deployObjData.hostPorts.findIndex((function(e){return e.name==t.name}));e.k8sModel.HostPortArr.push({obj:t.name,HostPort:t.port,open:-1!=a})})),this.DetailModel.show=!0},saveLauncherType:function(e){this.deployObjData.launcherType=e},savePull:function(e){this.deployObjData.imagePullPolicy=e},saveStacked:function(e){this.deployObjData.notStacked=e},saveReplicas:function(e){this.deployObjData.replicas=parseInt(e)},saveJobModel:function(e){this.deployObjData.daemonSet=e},saveAffinity:function(e){this.deployObjData.abilityAffinity=e.abilityAffinity,this.deployObjData.nodeSelector=e.NodeSelector},saveHpa:function(e){},saveDisk:function(e){this.deployObjData.mounts=e},saveResource:function(e){this.deployObjData.resources=e},saveNetwork:function(e){var t=this;if(e.HostNetwork&&e.showHostPort)return this.$message.error("".concat(this.$t("deployService.form.portOrNetWork")));e.showHostPort&&(this.deployObjData.hostPorts=[],e.HostPortArr&&e.HostPortArr.forEach((function(e){e.open&&t.deployObjData.hostPorts.push({nameRef:e.obj,port:Math.floor(e.HostPort)})}))),this.deployObjData.hostIPC=e.HostIpc,this.deployObjData.hostNetwork=e.HostNetwork},submit:function(){for(var e in this.$refs)"yamlEdit"!=e&&this.$refs[e].save();var t=pt.ZP.load(this.yamlContent);this.deployObjData=Object.assign(this.deployObjData,t),this.$emit("doInstall",this.deployObjData)},closeDetailModel:function(){this.DetailModel.show=!1,this.k8sModel={},this.mounts=[],this.labelMatchArr=[],this.sourceModel={},this.serverData={},this.hpaModel={minReplicas:"",maxReplicas:"",indicatorData:[]}},getDefaultValue:function(){var e=this;this.$ajax.getJSON("/k8s/api/default",{}).then((function(t){e.defaultObj=t.ServerServantElem,e.LabelMatchOperator=t.LabelMatchOperator||[],e.indicators=t.indicators||[]}))},getDeployData:function(){for(var e in this.$refs)"yamlEdit"!=e&&this.$refs[e].save();var t=pt.ZP.load(this.yamlContent);return this.deployObjData=Object.assign(this.deployObjData,t),this.deployObjData}}},wa=ya,ka=(0,_.Z)(wa,$a,_a,!1,null,null,null),Sa=ka.exports,Ma={name:"Base",components:{install:Sa},data:function(){return{appList:[],templates:[]}},props:["deployObj"],mounted:function(){this.getServerTemplate(),this.getAppList()},methods:{addAdapter:function(e){e=this.deployObj.servants[this.deployObj.servants.length-1];var t=e.Port+1,a=Object.assign({},e,{Port:t});this.deployObj.servants.push(Object.assign({},a))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.appList=t.Data;var a=e.appList.find((function(t){return t.ServerApp==e.deployObj.app}));-1==a&&e.appList.push({ServerApp:e.deployObj.app})})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerTemplate:function(){var e=this;this.$ajax.getJSON("/k8s/api/template_select",{isAll:!0}).then((function(t){e.templates=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},next:function(){var e=this;this.$ajax.getJSON("/k8s/api/exists",{app:this.deployObj.app,server:this.deployObj.server}).then((function(t){t?e.$message({showClose:!0,message:e.$t("deployService.deploy.existsK8S"),type:"warning"}):e.$emit("next",e.deployObj)})).catch((function(e){}))}}},xa=Ma,Ca=(0,_.Z)(xa,ga,ba,!1,null,null,null),Da=Ca.exports,Na=function(){return{app:"",server:"",template:"",profile:"",servants:[{name:"",port:1e4,isTars:!0,isTcp:!0,thread:2,capacity:1e5,connection:1e4,timeout:3e4}],replicas:2,hostNetwork:!1,hostIPC:!1,hostPorts:[],new:!0}},Ta={name:"OperationDeploy",components:{baseInfo:Da,install:Sa},data:function(){return{templates:[],appList:[],show:!1,deployObj:Na()}},mounted:function(){},methods:{next:function(e){var t=this;console.log(e),this.deployObj=e,this.show=!0,this.$nextTick((function(){t.$refs.install.show()}))},doInstall:function(){var e=this;this.$confirm(this.$t("deployService.form.deployServiceTip"),"Hint",{confirmButtonText:this.$t("common.submit"),cancelButtonText:this.$t("common.cancel"),type:"warning"}).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/install",{deploy:e.deployObj}).then((function(a){t.hide(),e.$message({message:"".concat(e.$t("common.success")),type:"success"}),e.dialogVisible=!1,e.$refs.install.closeDetailModel()})).catch((function(a){t.hide(),201==a.ret_code?e.$message({showClose:!0,message:e.$t("deployService.deploy.existsK8S"),type:"warning"}):e.$message({message:a,type:"error"})}))})).catch((function(){}))}}},La=Ta,Ia=(0,_.Z)(La,fa,va,!1,null,null,null),Aa=Ia.exports,Oa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_history"},[t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestPerson"),prop:"RequestPerson",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalTime"),prop:"ApprovalTime"}}),t("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalResult"),prop:"ApprovalResult"},scopedSlots:e._u([{key:"default",fn:function(a){return["true"==="".concat(a.row.ApprovalResult)?t("span",{staticClass:"success"},[e._v("Approval")]):"false"==="".concat(a.row.ApprovalResult)?t("span",{staticClass:"warn"},[e._v("Reject")]):t("span",[e._v(e._s(a.row.ApprovalResult))])]}}])}),t("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalMark"),prop:"ApprovalMark"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.viewItem(a.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}])})],1),""!=this.Continue?t("let-button",{on:{click:e.fetchData}},[e._v("more")]):e._e(),t("let-modal",{attrs:{title:e.$t("deployService.title.history"),width:"80%"},on:{"on-confirm":e.closeViewModal,"on-cancel":e.closeViewModal},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("let-form",{ref:"viewForm",attrs:{inline:""}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerApp))]),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerName))]),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerMark))]),t("let-table",{attrs:{data:e.viewModal.model.ServerServant}},[t("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Name))]}}],null,!1,1485259994)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.port")},scopedSlots:e._u([{key:"head",fn:function(a){return[t("span",{staticClass:"required"},[e._v(e._s(a.column.title))])]}},{key:"default",fn:function(t){return[e._v(e._s(t.row.Port))]}}],null,!1,1805883483)}),t("let-table-column",{attrs:{title:e.$t("deployService.form.portType")},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.IsTcp?t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("TCP")]):t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTcp,callback:function(t){e.$set(a.row,"IsTcp",t)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol")},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.IsTars?t("let-radio",{attrs:{label:!0},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v("TARS")]):t("let-radio",{attrs:{label:!1},model:{value:a.row.IsTars,callback:function(t){e.$set(a.row,"IsTars",t)},expression:"props.row.IsTars"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}],null,!1,3126702782)}),t("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),t("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),t("let-table-column",{attrs:{width:"10px"}})],1),t("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalResult")}},[e.viewModal.model.ApprovalResult?t("span",{class:e.viewModal.model.ApprovalResult?"success":"warn"},[e._v(e._s(e.viewModal.model.ApprovalResult?"通过":"驳回"))]):e._e()]),t("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalMark"),itemWidth:"100%"}},[e._v(e._s(e.viewModal.model.ApprovalMark))])],1):e._e()],1)],1)},Pa=[],ja={name:"OperationHistory",data:function(){return{items:[],Continue:null,viewModal:{show:!1,model:null},K8SisCheckedAll:!1,K8SNodeList:[]}},mounted:function(){this.getDefaultValue(),this.getNodeList(),this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/approval_select",{Continue:this.Continue}).then((function(a){t.hide(),e.Continue=a.Continue,a.Data&&a.Data.forEach((function(t){var a=[];if(t.ServerServant){for(var o in t.ServerServant)a.push(t.ServerServant[o]);t.ServerServant=a}t.ApprovalTime=(0,xt.p6)(t.ApprovalTime,"YYYY-MM-DD HH:mm:ss"),e.items.push(t)}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_list",{isAll:!0}).then((function(t){e.K8SNodeList=t}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){var t=this.adapterServerK8S(e);this.viewModal.model=t,this.viewModal.show=!0},adapterServerK8S:function(e){return e}}},qa=ja,za=(0,_.Z)(qa,Oa,Pa,!1,null,null,null),Ba=za.exports,Ja=(a(61514),function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_undeploy"},[t("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}})],1),t("let-form-item",[t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.fetchData(!0,1)}}},[e._v(e._s(e.$t("operate.search")))]),t("span",[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData(!0,1)}}})])],1)],1),t("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{width:"60px"},scopedSlots:e._u([{key:"head",fn:function(a){return[t("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(a){return[t("let-checkbox",{on:{change:function(t){return e.checkChange(a.row)}},model:{value:a.row.isChecked,callback:function(t){e.$set(a.row,"isChecked",t)},expression:"scope.row.isChecked"}})]}}])}),t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.source")},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.Source["tars.io/CloudInstall"]?t("el-tag",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.goMarket(a.row)}}},[e._v(" "+e._s(a.row.Source["tars.io/CloudInstall"].group+"/"+a.row.Source["tars.io/CloudInstall"].name+":"+a.row.Source["tars.io/CloudInstall"].version)+" ")]):e._e()]}}])})],1),t("div",{staticStyle:{overflow:"hidden"}},[t("div",{staticClass:"btn_group"},[t("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.undeployServer}},[e._v(e._s(e.$t("operate.undeploy")))])],1),t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1)],1)}),Ea=[],Za={name:"OperationUndeploy",data:function(){return{query:{ServerApp:"",ServerName:""},pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},serverList:[],isCheckedAll:!1,checkedList:[]}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(e,t){var a=this,o=this.$refs.table.$loading.show();return console.log("fetchData",e,t),this.$ajax.getJSON("/k8s/api/server_list",{ServerApp:this.query.ServerApp,ServerName:this.query.ServerName,page:t||this.pagination.page,size:this.pagination.size,force:e}).then((function(e){o.hide(),a.serverList=[],e.hasOwnProperty("Data")&&(e.Data.forEach((function(e){e.isChecked=!1,e.Source=e.Source||"{}",e.Source=JSON.parse(e.Source)})),a.serverList=e.Data),a.pagination.total=Math.ceil(e.Count.AllCount/a.pagination.size)})).catch((function(e){o.hide(),a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.message||e.err_msg))}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},checkChange:function(e){var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.ServerId===e.ServerId&&(o=!0)})),o||t.push(e)}else{var r=!1,i=-1;t.forEach((function(t,a){t.ServerId===e.ServerId&&(r=!0,i=a)})),r&&t.splice(i,1)}},undeployServer:function(){var e=this,t=this.checkedList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("dialog.tips.item"));else{var a=t.map((function(e){return e.ServerId}));this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/server_undeploy",{ServerIds:a}).then((function(a){t.hide(),e.fetchData(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}))}},goMarket:function(e){var t;t=e.Source["tars.io/CloudProduct"]?"/static/market/index.html#/market/product/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version):"/static/market/index.html#/market/service/".concat(e.Source["tars.io/CloudInstall"].group,"/").concat(e.Source["tars.io/CloudInstall"].name,"/").concat(e.Source["tars.io/CloudInstall"].version),window.open(t)}}},Va=Za,Ha=(0,_.Z)(Va,Ja,Ea,!1,null,null,null),Fa=Ha.exports,Ra=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_templates"},[t("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.template")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.template_name,callback:function(t){e.$set(e.query,"template_name",t)},expression:"query.template_name"}})],1),t("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.parents_name,callback:function(t){e.$set(e.query,"parents_name",t)},expression:"query.parents_name"}})],1),t("let-form-item",[t("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v("     "),t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addTempate")))]),t("span",[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"TemplateName",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("template.search.parentTemplate"),prop:"TemplateParent",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"UpdateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.viewItem(a.row)}}},[e._v(e._s(e.$t("operate.view")))]),t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("template.add.title"):this.$t("template.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("template.add.templateFormatTips"),required:"","required-tip":e.$t("template.add.templateNameTips"),pattern:"^[a-zA-Z]([.a-zA-Z0-9]+)?$","pattern-tip":e.$t("template.add.templateFormatTips")},model:{value:e.detailModal.model.TemplateName,callback:function(t){e.$set(e.detailModal.model,"TemplateName",t)},expression:"detailModal.model.TemplateName"}})],1),t("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate"),required:""}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateParent,callback:function(t){e.$set(e.detailModal.model,"TemplateParent",t)},expression:"detailModal.model.TemplateParent"}},[t("let-option",{attrs:{value:""}},[e._v(e._s(e.$t("pub.dlg.defaultValue")))]),e._l(e.items,(function(a){return t("let-option",{key:a.id,attrs:{value:a.TemplateName}},[e._v(e._s(a.TemplateName))])}))],2)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.detailModal.model.CreateMark,callback:function(t){e.$set(e.detailModal.model,"CreateMark",t)},expression:"detailModal.model.CreateMark"}})],1),t("let-form-item",{attrs:{label:e.$t("template.form.content"),required:""}},[t("let-input",{attrs:{type:"textarea",rows:10,size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateContent,callback:function(t){e.$set(e.detailModal.model,"TemplateContent",t)},expression:"detailModal.model.TemplateContent"}})],1)],1):e._e()],1)],1)},Ya=[],Wa={name:"OperationTemplates",data:function(){return{query:{template_name:"",parents_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/template_select",{TemplateName:this.query.template_name,ParentName:this.query.parents_name}).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.UpdateTime=z()(e.UpdateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.TemplateId?"/k8s/api/template_update":"/k8s/api/template_create",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/template_delete",{TemplateId:e.TemplateId}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},Ka=Wa,Ua=(0,_.Z)(Ka,Ra,Ya,!1,null,null,null),Ga=Ua.exports,Qa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_operation_approval"},[t("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[t("div",[t("span",[e._v(e._s(e.$t("deployService.title.baseImage")))]),t("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addItem}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),t("let-table",{ref:"table",attrs:{data:e.baseLists,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("imageService.form.SupportedType"),prop:"SupportedTypeShow"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Count"),prop:"Count",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.viewItem(a.row)}}},[e._v(e._s(e.$t("operate.view")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),t("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[t("div",[t("span",[e._v(e._s(e.$t("deployService.title.nodeImage")))]),t("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addNodeImage}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),t("let-table",{ref:"table",attrs:{data:e.tafNodeImages,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:"ID"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[a.row.isDefault?t("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(a.row.Id)+" ")]}}])}),t("let-table-column",{attrs:{title:e.$t("pub.dlg.imageAddress"),prop:"Image"}}),t("let-table-column",{attrs:{title:e.$t("pub.dlg.mark"),prop:"Mark"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editNodeImage(a.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.setDefault(a.row)}}},[e._v(e._s(e.$t("operate.default"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.deleteNodeImage(a.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),t("let-modal",{attrs:{title:e.baseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.baseModal.show,callback:function(t){e.$set(e.baseModal,"show",t)},expression:"baseModal.show"}},[e.baseModal.model?t("let-form",{ref:"detailForm",attrs:{inline:""}},[t("let-form-item",{attrs:{label:e.$t("imageService.form.SupportedType"),itemWidth:"600px",required:""}},e._l(e.SupportedType,(function(a){return t("let-checkbox",{key:a,attrs:{value:e.baseModal.model.SupportedType.indexOf(a)>-1},on:{change:function(t){return e.SupportedTypeChange(a)}}},[e._v(" "+e._s(a)+" ")])})),1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.baseModal.model.Mark,callback:function(t){e.$set(e.baseModal.model,"Mark",t)},expression:"baseModal.model.Mark"}})],1)],1):e._e()],1),t("let-modal",{attrs:{footShow:!1,title:this.$t("imageService.title.view"),width:"80%"},model:{value:e.releaseListsModal.show,callback:function(t){e.$set(e.releaseListsModal,"show",t)},expression:"releaseListsModal.show"}},[t("br"),e.releaseListsModal.model?t("let-table",{ref:"table",attrs:{data:e.releaseListsModal.model,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("imageService.form.Image"),prop:"Image",width:"40%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.CreatePerson"),prop:"CreatePerson",width:"10%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime",width:"15%"}}),t("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editReleaseItem(a.row)}}},[e._v(e._s(e.$t("operate.view"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.removeReleaseItem(a.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,3590708250)})],1):e._e()],1),t("let-modal",{attrs:{title:e.releaseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveReleaseItem,"on-cancel":e.closeReleaseModal},model:{value:e.releaseModal.show,callback:function(t){e.$set(e.releaseModal,"show",t)},expression:"releaseModal.show"}},[e.releaseModal.model?t("let-form",{ref:"releaseForm"},[t("let-form-item",{attrs:{label:e.$t("imageService.form.Image"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.ImageHolder"),required:"","required-tip":e.$t("imageService.form.ImageTips")},model:{value:e.releaseModal.model.Image,callback:function(t){e.$set(e.releaseModal.model,"Image",t)},expression:"releaseModal.model.Image"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Secret")}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.SecretTips"),required:"","required-tip":e.$t("imageService.form.SecretTips")},model:{value:e.releaseModal.model.Secret,callback:function(t){e.$set(e.releaseModal.model,"Secret",t)},expression:"releaseModal.model.Secret"}})],1),t("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.releaseModal.model.Mark,callback:function(t){e.$set(e.releaseModal.model,"Mark",t)},expression:"releaseModal.model.Mark"}})],1)],1):e._e()],1),t("el-dialog",{attrs:{title:e.nodeImageModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),visible:e.nodeImageModal.show,width:"600px","before-close":e.closeNodeModal,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.nodeImageModal,"show",t)}}},[t("el-form",{ref:"nodeForm",attrs:{model:e.nodeImageModal.model,size:"small","label-position":"top",rules:e.rules}},[t("el-form-item",{attrs:{label:"Id",prop:"Id"}},[t("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Id,callback:function(t){e.$set(e.nodeImageModal.model,"Id",t)},expression:"nodeImageModal.model.Id"}})],1),t("el-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),prop:"Image"}},[t("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Image,callback:function(t){e.$set(e.nodeImageModal.model,"Image",t)},expression:"nodeImageModal.model.Image"}})],1),t("el-form-item",{attrs:{label:e.$t("pub.dlg.mark"),prop:"Mark"}},[t("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Mark,callback:function(t){e.$set(e.nodeImageModal.model,"Mark",t)},expression:"nodeImageModal.model.Mark"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeNodeModal}},[e._v(e._s(e.$t("common.cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveNodeModal}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],1)},Xa=[],eo=(a(6203),{name:"OperationImage",data:function(){return{baseLists:[],tafNodeImages:[],SupportedType:["cpp","nodejs","java-war","java-jar","go"],baseModal:{show:!1,model:null,isNew:!1},releaseListsModal:{Name:"",show:!1,model:null,isNew:!1},releaseModal:{Name:"",show:!1,model:null,isNew:!1},nodeImageModal:{show:!1,model:{},isNew:!1},rules:{Id:[{required:!0,message:"".concat(this.$t("imageService.node.idTip")),trigger:"blur"}],Image:[{required:!0,message:"".concat(this.$t("imageService.node.imageAddressTip")),trigger:"blur"}],Mark:[{required:!0,message:"".concat(this.$t("imageService.node.markTip")),trigger:"blur"}]}}},mounted:function(){this.fetchData(),this.getTafNodeList()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_select",{}).then((function(a){t.hide(),e.baseLists=a.Data,e.baseLists.forEach((function(e){e.SupportedTypeShow=e.SupportedType.join(", "),e.CreateTime=z()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},SupportedTypeChange:function(e){this.baseModal.model.SupportedType.indexOf(e)>-1?this.baseModal.model.SupportedType.splice(this.baseModal.model.SupportedType.indexOf(e),1):this.baseModal.model.SupportedType.push(e)},addItem:function(){this.baseModal.model={SupportedType:[]},this.baseModal.show=!0,this.baseModal.isNew=!0},fetchReleaseData:function(e){var t=this,a=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_release_select",{Name:e}).then((function(o){a.hide(),t.releaseListsModal.Name=e,t.releaseListsModal.model=o.Data,t.releaseListsModal.model.forEach((function(t){t.CreateTime=z()(t.CreateTime).format("YYYY-MM-DD HH:mm:ss"),t.Name=e}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewItem:function(e){var t=this;this.fetchReleaseData(e.Name).then((function(){t.releaseListsModal.show=!0}))},editItem:function(e){this.baseModal.model=e,this.baseModal.show=!0,this.baseModal.isNew=!1},removeItem:function(e){var t=this,a=this.$refs.table.$loading.show();this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){return t.$ajax.postJSON("/k8s/api/image_delete",{Name:e.Name}).then((function(e){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.baseModal.show=!1,this.baseModal.model=null},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.baseModal.model,a=this.$Loading.show(),o=t.Name?"/k8s/api/image_update":"/k8s/api/image_create";this.$ajax.postJSON(o,t).then((function(){a.hide(),e.fetchData().then((function(){e.baseModal.show=!1,e.$tip.success(e.$t("common.success"))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},addReleaseItem:function(e){this.releaseModal.model={Name:e},this.releaseModal.show=!0,this.releaseModal.isNew=!0},closeReleaseModal:function(){this.$refs.releaseForm.resetValid(),this.releaseModal.show=!1,this.releaseModal.model=null},editReleaseItem:function(e){this.releaseModal.model=e,this.releaseModal.show=!0,this.releaseModal.isNew=!1},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.fetchReleaseData(e.Name).then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},saveReleaseItem:function(){var e=this;if(this.$refs.releaseForm.validate()){var t=this.releaseModal.model,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/image_release_create",t).then((function(){a.hide(),e.$tip.success(e.$t("common.success")),e.fetchReleaseData(t.Name),e.releaseModal.show=!1})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getTafNodeList:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDefaultNodeImage();case 2:a=t.sent,e.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){t.Data.forEach((function(e){e.Image==a&&(e.isDefault=!0)})),e.tafNodeImages=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}));case 4:case"end":return t.stop()}}),t)})))()},getDefaultNodeImage:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a,o;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:return a=t.sent,o=a.filter((function(e){return"nodeImage.image"===e.column})),t.abrupt("return",1==o.length?o[0].value:"");case 5:case"end":return t.stop()}}),t)})))()},setDefault:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",{column:"nodeImage.image",value:e.Image}).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},addNodeImage:function(){this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!0},editNodeImage:function(e){this.nodeImageModal.model=Object.assign({},e),this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!1},saveNodeModal:function(){var e=this;this.$refs.nodeForm.validate((function(t){if(!t)return!1;e.$ajax.postJSON("/k8s/api/image_node_update",e.nodeImageModal.model).then((function(t){e.closeNodeModal(),e.getTafNodeList(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}))},deleteNodeImage:function(e){var t=this;if(e.isDefault)this.$message.warning("".concat(this.$t("imageService.node.deleteTip")));else{var a=Object.assign({},e);this.$ajax.postJSON("/k8s/api/image_node_delete",a).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},closeNodeModal:function(){this.nodeImageModal.show=!1,this.nodeImageModal.model={},this.$refs.nodeForm.resetFields()}}}),to=eo,ao=(0,_.Z)(to,Qa,Xa,!1,null,"54dfd50a",null),oo=ao.exports,ro=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_base_application"},[t("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),t("let-form-item",[t("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v("     "),t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addApplication")))]),t("span",[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.business"),prop:"BusinessName",width:"25%"}}),t("let-table-column",{attrs:{title:e.$t("deployService.form.appMark"),prop:"AppMark"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),t("let-table-column",{attrs:{title:e.$t("serverList.table.th.createPerson"),prop:"CreatePerson"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("div",{staticStyle:{overflow:"hidden"}},[t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),t("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[t("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}})],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[t("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}},e._l(e.BusinessList,(function(a){return t("let-option",{key:a.BusinessName,attrs:{value:a.BusinessName}},[e._v(e._s(a.BusinessShow))])})),1)],1),t("let-form-item",{attrs:{label:e.$t("deployService.form.appMark")}},[t("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.AppMark,callback:function(t){e.$set(e.detailModal.model,"AppMark",t)},expression:"detailModal.model.AppMark"}})],1)],1):e._e()],1)],1)},io=[],so={name:"BaseApplication",data:function(){return{query:{ServerApp:"",BusinessName:""},items:[],BusinessList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData(),this.getBusinessList()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/application_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.CreateTime=z()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")})),e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/application_create":"/k8s/api/application_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/application_delete",{ServerApp:e.ServerApp}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getBusinessList:function(){var e=this;this.$ajax.getJSON("/k8s/api/business_select",{isAll:!0}).then((function(t){e.BusinessList=[{BusinessMark:"",BusinessName:"",BusinessOrder:0,BusinessShow:"",CreatePerson:"",CreateTime:new Date}].concat(t.Data)}))}}},lo=so,no=(0,_.Z)(lo,ro,io,!1,null,null,null),co=no.exports,uo=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_base_business"},[t("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{attrs:{label:e.$t("filter.title.business")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.name")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessShow,callback:function(t){e.$set(e.query,"BusinessShow",t)},expression:"query.BusinessShow"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[t("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessMark,callback:function(t){e.$set(e.query,"BusinessMark",t)},expression:"query.BusinessMark"}})],1),t("let-form-item",[t("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v("     "),t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("filter.btn.add")))]),t("span",[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.fetchData()}}})])],1)],1),t("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[t("let-table-column",{attrs:{title:e.$t("filter.title.business"),prop:"BusinessName",width:"20%"}}),t("let-table-column",{attrs:{title:e.$t("filter.title.name"),prop:"BusinessShow",width:"20%"}}),t("let-table-column",{attrs:{title:e.$t("filter.title.mark"),prop:"BusinessMark",width:"20%"}}),t("let-table-column",{attrs:{title:e.$t("filter.title.order"),prop:"BusinessOrder"}}),t("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.appListItem(a.row)}}},[e._v(e._s(e.$t("table.btn.appList")))]),t("let-table-operation",{on:{click:function(t){return e.editItem(a.row)}}},[e._v(e._s(e.$t("operate.update")))]),t("let-table-operation",{on:{click:function(t){return e.removeItem(a.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),t("div",{staticStyle:{overflow:"hidden"}},[t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),t("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?t("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),t("div",{attrs:{slot:"foot"},slot:"foot"})]),t("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?t("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[t("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[t("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessShow,callback:function(t){e.$set(e.detailModal.model,"BusinessShow",t)},expression:"detailModal.model.BusinessShow"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.order"),required:""}},[t("let-input",{attrs:{size:"small",type:"number",min:0,max:100,required:""},model:{value:e.detailModal.model.BusinessOrder,callback:function(t){e.$set(e.detailModal.model,"BusinessOrder",t)},expression:"detailModal.model.BusinessOrder"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[t("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.BusinessMark,callback:function(t){e.$set(e.detailModal.model,"BusinessMark",t)},expression:"detailModal.model.BusinessMark"}})],1)],1):e._e()],1),t("let-modal",{attrs:{title:e.AppModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.appListSaveItem,"on-cancel":e.closeAppModal},model:{value:e.AppModal.show,callback:function(t){e.$set(e.AppModal,"show",t)},expression:"AppModal.show"}},[e.AppModal.model?t("let-form",{ref:"AppForm",attrs:{itemWidth:"700px"}},[t("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[t("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessName,callback:function(t){e.$set(e.AppModal.model,"BusinessName",t)},expression:"AppModal.model.BusinessName"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[t("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessShow,callback:function(t){e.$set(e.AppModal.model,"BusinessShow",t)},expression:"AppModal.model.BusinessShow"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[t("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}},[e._v("全选")]),t("div",{staticClass:"checkbox_list"},e._l(e.AppList,(function(a){return t("let-checkbox",{key:a.ServerApp,staticClass:"checkbox_item",attrs:{value:e.checkBoxAddList.indexOf(a.ServerApp)>-1},on:{change:function(t){return e.checkedChange(a.ServerApp)}}},[e._v(e._s(a.ServerApp))])})),1)],1)],1):e._e()],1)],1)},po=[],mo={name:"BaseBusiness",data:function(){return{isCheckedAll:!1,checkBoxAddList:[],checkBoxDelList:[],query:{BusinessName:"",BusinessShow:"",BusinessMark:""},items:[],AppList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1},AppServerArr:[],AppServerStr:"",AppServerDeleteArr:[],AppModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},watch:{isCheckedAll:function(){var e=this,t=this.isCheckedAll;t?this.AppList.forEach((function(t){-1===e.checkBoxAddList.indexOf(t.ServerApp)&&e.checkBoxAddList.push(t.ServerApp),e.checkBoxDelList=[]})):this.AppList.forEach((function(t){-1===e.checkBoxDelList.indexOf(t.ServerApp)&&e.checkBoxDelList.push(t.ServerApp),e.checkBoxAddList=[]}))}},methods:{checkedChange:function(e){-1===this.checkBoxAddList.indexOf(e)?(this.checkBoxAddList.push(e),this.checkBoxDelList.splice(this.checkBoxDelList.indexOf(e),1)):(this.checkBoxDelList.push(e),this.checkBoxAddList.splice(this.checkBoxAddList.indexOf(e),1)),0===this.checkBoxAddList.length&&(this.isCheckedAll=!1)},gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/business_select",Object.assign(this.query,{isAll:!1,page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},closeAppModal:function(){this.$refs.AppForm.resetValid(),this.AppModal.show=!1,this.AppModal.model=null},addItem:function(){this.checkBoxAddList=[],this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.checkBoxAddList=e.AppServer||[],this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/business_create":"/k8s/api/business_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/business_delete",{BusinessName:e.BusinessName}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.AppList=t.Data}))},appListItem:function(e){var t=this;this.getAppList();var a=this.$refs.table.$loading.show();return this.$ajax.postJSON("/k8s/api/business_list_app",{BusinessNames:[e.BusinessName]}).then((function(e){a.hide(),t.appListEditItem(e[0])})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},appListEditItem:function(e){this.checkBoxAddList=e.App||[],this.AppModal.model=e,this.AppModal.show=!0,this.AppModal.isNew=!1},appListSaveItem:function(){var e=this;if(this.$refs.AppForm.validate()){var t=this.AppModal.model,a=(this.AppModal.isNew,"/k8s/api/business_add_app"),o=this.$Loading.show();this.checkBoxAddList&&this.checkBoxAddList.length>0?this.$ajax.postJSON(a,{BusinessName:t.BusinessName,AppNames:this.checkBoxAddList}).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeAppModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})):(o.hide(),this.closeAppModal())}}}},ho=mo,fo=(0,_.Z)(ho,uo,po,!1,null,null,null),vo=fo.exports,go=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_base_node"},[e.showDetail?e._e():[t("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{attrs:{itemWidth:"600px"}},[t("el-tag",{staticStyle:{"margin-top":"30px","margin-right":"10px",cursor:"pointer"},attrs:{effect:e.hold?"dark":"plain",type:"warning"},on:{click:e.chooseHold}},[e._v(" Hold ")]),t("el-tag",{staticStyle:{"margin-top":"30px","margin-right":"10px",cursor:"pointer"},attrs:{effect:e.localPV?"dark":"plain",type:"warning"},on:{click:e.chooseLocalPV}},[e._v(" LocalPV ")])],1),t("let-form-item",{staticStyle:{float:"right"},attrs:{itemWidth:"600px"}},[t("span",{staticStyle:{float:"right","margin-top":"30px"}},[t("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain"}},[e._v(" "+e._s(e.$t("filter.title.CommonTag"))+" ")]),t("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain",type:"warning"}},[e._v(" "+e._s(e.$t("filter.title.FrameWorkTag"))+" ")]),t("let-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditCommon}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),t("let-button",{attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditAffinity}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])],1)])],1),t("el-table",{ref:"table",attrs:{data:e.items,width:"100%",border:"",stripe:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:e.$t("filter.title.nodeName"),prop:"NodeName",width:"150"}}),t("el-table-column",{attrs:{label:e.$t("common.status"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return["Active"==a.row.status?t("el-tag",{attrs:{size:"small",effect:"plain",type:"success"}},[e._v(" "+e._s(a.row.status)+" ")]):e._e(),"Unavailable"==a.row.status?t("el-tag",{attrs:{size:"small",effect:"plain",type:"danger"}},[e._v(" "+e._s(a.row.status)+" ")]):e._e()]}}],null,!1,3672167682)}),t("el-table-column",{attrs:{label:"Version",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.NodInfo.kubeletVersion)+" ")]}}],null,!1,2972685414)}),t("el-table-column",{attrs:{label:e.$t("filter.title.nodeFramework"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-switch",{on:{change:function(t){return e.changeStatus(a.row)}},model:{value:a.row.NodePublic,callback:function(t){e.$set(a.row,"NodePublic",t)},expression:"scope.row.NodePublic"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("开")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("关")])])]}}],null,!1,1705370074)}),t("el-table-column",{attrs:{label:e.$t("filter.title.nodeLabels")},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.commonLabels,(function(a,o){return t("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+a)+" ")])}))}}],null,!1,2926056322)}),t("el-table-column",{attrs:{label:e.$t("filter.title.AbilityTag"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.NodeAbility,(function(a){return t("el-tag",{key:a,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("abilityType")(a)}},[e._v(" "+e._s(a)+" ")])}))}}],null,!1,3467388542)}),t("el-table-column",{attrs:{label:e.$t("filter.title.nodeAddress"),width:"210"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.NodeAddress,(function(a){return t("div",{key:a.NodeName,staticStyle:{margin:"2px 2px"}},[t("el-tag",{attrs:{effect:"plain",type:"info"}},[e._v(e._s(a.type+":"+a.address)+" ")])],1)}))}}],null,!1,402632902)}),t("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{staticStyle:{"padding-left":"10px"},on:{click:function(t){return e.viewItem(a.row)}}},[e._v(" "+e._s(e.$t("operate.view"))+" ")]),t("br"),t("let-table-operation",{on:{click:function(t){return e.editCommonTag(a.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),t("br"),t("let-table-operation",{on:{click:function(t){return e.editAbilityTag(a.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])]}}],null,!1,3380904561)})],1),t("br"),t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}}),t("el-dialog",{attrs:{title:e.$t("filter.dialog.editCommonTag"),visible:e.commonTagDialog.show,width:"40%","before-close":e.closeCommonTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.commonTagDialog,"show",t)}}},[t("el-form",{ref:"commonForm",attrs:{model:e.commonTagDialog.model,"inline-message":""}},[t("el-table",{attrs:{data:e.commonTagDialog.model.commonArr,border:""}},[t("template",{slot:"empty"},[t("let-table-operation",{on:{click:function(t){return e.addCommonTag(0,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1),t("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{attrs:{prop:"commonArr."+a.$index+".name",rules:[{validator:function(t,o,r){e.validateTagName(t,o,r,a.row.name)},trigger:"blur"}]}},[t("el-input",{model:{value:a.row.name,callback:function(t){e.$set(a.row,"name",t)},expression:"scope.row.name"}})],1)]}}],null,!1,1739047982)}),t("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}})]}}],null,!1,4065949250)}),t("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.addCommonTag(a.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.delCommonTag(a.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2871227552)})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeCommonTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveCommonTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1),t("el-dialog",{attrs:{title:e.$t("filter.dialog.editAbilityTag"),visible:e.abilityTagDialog.show,width:"40%","before-close":e.closeAbilityTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.abilityTagDialog,"show",t)}}},[t("el-form",{ref:"abilityForm",attrs:{model:e.abilityTagDialog.model,"inline-message":""}},[t("el-table",{attrs:{data:e.abilityTagDialog.model.abilityArr,border:""}},[t("template",{slot:"empty"},[t("let-table-operation",{on:{click:function(t){return e.addAbilityTag(0,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("filter.tip.addAffinityGroup"))+" ")])],1),t("el-table-column",{attrs:{label:e.$t("filter.title.app")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{attrs:{prop:"abilityArr."+a.$index+".application",rules:[{validator:function(t,o,r){e.validateAppName(t,o,r,a.row.application)},trigger:"change"}]}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),filterable:""},on:{change:function(t){return e.changeApp(a.$index,a.row.application)}},model:{value:a.row.application,callback:function(t){e.$set(a.row,"application",t)},expression:"scope.row.application"}},e._l(e.appList,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)]}}],null,!1,3541109157)}),t("el-table-column",{attrs:{label:e.$t("filter.title.serverName")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",filterable:""},model:{value:a.row.serverName,callback:function(t){e.$set(a.row,"serverName",t)},expression:"scope.row.serverName"}},e._l(a.row.serverNames,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}],null,!1,695734775)}),t("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.addAbilityTag(a.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),t("let-table-operation",{on:{click:function(t){return e.delAbilityTag(a.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2609683168)})],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeAbilityTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveAbilityTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],e.showDetail?t("node-detail",{attrs:{nodeDetail:e.nodeDetail},on:{closeDetail:e.closeDetail}}):e._e()],2)},bo=[],$o=(a(268),a(96486)),_o=a.n($o),yo=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("span",{staticClass:"title"},[e._v(e._s(e.nodeDetail.NodeName))]),t("span",{staticStyle:{"margin-left":"10px"}},["Active"==e.nodeDetail.status?t("el-tag",{attrs:{effect:"plain",type:"success"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e(),"Unavailable"==e.nodeDetail.status?t("el-tag",{attrs:{effect:"plain",type:"danger"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e()],1),t("span",{staticStyle:{float:"right"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-back",size:"small"},on:{click:e.closeDetail}})],1)]),t("div",{staticStyle:{"margin-top":"10px"}},[t("span",[e._v("Age:"+e._s(e.getAge(e.nodeDetail.CreationTimestamp)))])]),t("el-divider"),t("div",[e._l(e.nodeDetail.NodeAddress,(function(a){return t("span",{staticClass:"item"},[e._v(e._s("".concat(a.type,":").concat(a.address)))])})),t("span",{staticClass:"item"},[e._v("Version:"+e._s(e.nodeDetail.NodInfo.kernelVersion))]),t("span",{staticClass:"item"},[e._v("OS:"+e._s(e.nodeDetail.NodInfo.osImage))]),t("span",{staticClass:"item"},[e._v("containerRuntimeVersion:"+e._s(e.nodeDetail.NodInfo.containerRuntimeVersion))])],2),t("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Labels: "),e._l(e.nodeDetail.Labels,(function(a,o){return t("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+a)+" ")])}))],2),t("el-divider"),t("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Conditions: "),e._l(e.nodeDetail.Conditions,(function(a){return t("el-tooltip",{key:a.type,attrs:{placement:"top"}},[t("div",{attrs:{slot:"content"},slot:"content"},e._l(a,(function(a,o){return t("p",{key:o,staticStyle:{margin:"4px 0","font-size":"12px"}},[e._v(" "+e._s("".concat(o,":").concat(a))+" ")])})),0),t("el-tag",{staticStyle:{margin:"2px 15px"},attrs:{effect:"dark",type:e._f("conditionsStatus")(a)}},[e._v(" "+e._s(a.type)+" ")])],1)})),t("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("CPU")]),t("span",{staticStyle:{float:"right"}},[e._v("0 of 4")])]),t("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("MEMORY")]),t("span",{staticStyle:{float:"right"}},[e._v("0 of 7.78 GiB ")])]),t("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("PODS")]),t("span",{staticStyle:{float:"right"}},[e._v("8 of 110")])]),t("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:7.3}})],1)],1)],1)],2),t("el-divider"),t("el-tabs",{attrs:{type:"border-card"}},[t("el-tab-pane",{attrs:{label:"Info"}},[t("el-form",{attrs:{"label-width":"300px","label-position":"left"}},e._l(e.nodeDetail.NodInfo,(function(a,o){return t("div",{key:o},[t("el-form-item",{attrs:{label:o}},[e._v(" "+e._s(a)+" ")])],1)})),0)],1),t("el-tab-pane",{attrs:{label:"Images"}},[t("el-table",{ref:"table",attrs:{data:e.nodeDetail.Images,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[t("el-table-column",{attrs:{label:"names"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.names,(function(a){return t("p",{key:a},[e._v(" "+e._s(a)+" ")])}))}}])}),t("el-table-column",{attrs:{label:"size",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("".concat(Math.ceil(t.row.sizeBytes/1024/1024),"M"))+" ")]}}])})],1)],1),t("el-tab-pane",{attrs:{label:"Taints"}},[t("el-table",{ref:"table",attrs:{data:e.nodeDetail.Taints,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[t("el-table-column",{attrs:{label:"effect",prop:"effect",width:"300"}}),t("el-table-column",{attrs:{label:"key",prop:"key"}})],1)],1),t("el-tab-pane",{attrs:{label:"Conditions"}},[t("el-table",{ref:"table",attrs:{data:e.nodeDetail.Conditions,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[t("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),t("el-table-column",{attrs:{label:"status",prop:"status",width:"80"}}),t("el-table-column",{attrs:{label:"message",prop:"message"}}),t("el-table-column",{attrs:{label:"reason",prop:"reason"}}),t("el-table-column",{attrs:{label:"lastTransitionTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTransitionTime)))]}}])}),t("el-table-column",{attrs:{label:"lastHeartbeatTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastHeartbeatTime)))]}}])})],1)],1)],1)],1)},wo=[],ko={name:"node-detail",props:["nodeDetail"],filters:{tagType:function(e){return e.startsWith("tars.io/node")?"warning":e.startsWith("tars.io/ability")?"success":""},conditionsStatus:function(e){return"False"==e.status?"danger":"success"},timeFormat:function(e){return z()(e).format("YYYY-MM-DD HH:mm:ss")}},methods:{closeDetail:function(){this.$emit("closeDetail")},getAge:function(e){var t=Math.ceil((new Date-new Date(e))/36e5),a=0,o=0;return t>=24&&(a=Math.ceil(t/24),o=t%24),"".concat(a,"d").concat(o>0?o+"h":"")}}},So=ko,Mo=(0,_.Z)(So,yo,wo,!1,null,"38a1db4e",null),xo=Mo.exports,Co={name:"BaseBusiness",components:{nodeDetail:xo},data:function(){return{multipleSelection:[],query:{NodeName:""},items:[],pagination:{page:1,size:10,total:1},commonTagDialog:{flag:"one",show:!1,model:{}},abilityTagDialog:{flag:"one",show:!1,model:{}},appList:[],serList:[],showDetail:!1,localPV:!1,hold:!1,nodeDetail:{}}},filters:{tagType:function(e){return e.startsWith("tars.io")?"warning":""},abilityType:function(e){return-1!=e.indexOf(".")?"success":""}},computed:{batchEnabled:function(){return this.multipleSelection.length>0}},mounted:function(){this.fetchData(),this.getAppList()},methods:{handleSelectionChange:function(e){this.multipleSelection=e},gotoPage:function(e){this.pagination.page=e,this.fetchData()},chooseHold:function(){this.hold=!this.hold,this.fetchData()},chooseLocalPV:function(){this.localPV=!this.localPV,this.fetchData()},fetchData:function(){var e=this;return this.$ajax.getJSON("/k8s/api/node_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size,localPV:this.localPV,hold:this.hold})).then((function(t){t.Data.forEach((function(e){var t="";e.Conditions.forEach((function(e){"Ready"==e.Type&&(t=e.status)})),e.status="False"==t?"Unavailable":"Active"})),e.items=t.Data,e.pagination.total=Math.ceil(t.Count.AllCount/e.pagination.size)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},editCommonTag:function(e){for(var t in this.commonTagDialog.show=!0,this.commonTagDialog.flag="one",this.commonTagDialog.model=_o().cloneDeep(e),this.commonTagDialog.model.commonArr=[],e.Labels)t.startsWith("tars.io/node")||t.startsWith("tars.io/ability")||this.commonTagDialog.model.commonArr.push({name:t,value:e.Labels[t]})},batchEditCommon:function(){1==this.multipleSelection.length?this.editCommonTag(this.multipleSelection[0]):(this.commonTagDialog.show=!0,this.commonTagDialog.flag="batch",this.commonTagDialog.model.nodes=this.multipleSelection,this.commonTagDialog.model.commonArr=[{name:"",value:""}])},saveCommonTag:function(){var e=this;if(this.validate(this.$refs.commonForm)){var t=[];this.commonTagDialog.model.nodes&&(t=this.commonTagDialog.model.nodes.map((function(e){return e.NodeName})));var a="",o={};"one"==this.commonTagDialog.flag?(a="/k8s/api/edit_common_tag",o={nodeName:this.commonTagDialog.model.NodeName,tags:this.commonTagDialog.model.commonArr}):(a="/k8s/api/batch_edit_common_tag",o={nodeNames:t,tags:this.commonTagDialog.model.commonArr}),this.$ajax.postJSON(a,o).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeCommonTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeCommonTagDialog:function(){this.commonTagDialog={flag:"one",show:!1,model:{}}},editAbilityTag:function(e){var t=this;return(0,O.Z)((0,A.Z)().mark((function a(){var o,r,i;return(0,A.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.abilityTagDialog.show=!0,t.abilityTagDialog.flag="one",t.abilityTagDialog.model=_o().cloneDeep(e),t.abilityTagDialog.model.abilityArr=[],o=(0,$e.Z)(e.NodeAbility),a.prev=5,o.s();case 7:if((r=o.n()).done){a.next=19;break}return i=r.value,a.t0=t.abilityTagDialog.model.abilityArr,a.t1=i.split(".")[0],a.t2=i.split(".")[1]||"",a.next=14,t.getServerList(i.split(".")[0]);case 14:a.t3=a.sent,a.t4={application:a.t1,serverName:a.t2,serverNames:a.t3},a.t0.push.call(a.t0,a.t4);case 17:a.next=7;break;case 19:a.next=24;break;case 21:a.prev=21,a.t5=a["catch"](5),o.e(a.t5);case 24:return a.prev=24,o.f(),a.finish(24);case 27:case"end":return a.stop()}}),a,null,[[5,21,24,27]])})))()},batchEditAffinity:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!=e.multipleSelection.length){t.next=5;break}return t.next=3,e.editCommonTag(e.multipleSelection[0]);case 3:t.next=9;break;case 5:e.abilityTagDialog.show=!0,e.abilityTagDialog.flag="batch",e.abilityTagDialog.model.nodes=e.multipleSelection,e.abilityTagDialog.model.abilityArr=[{application:"",serverName:"",serverNames:""}];case 9:case"end":return t.stop()}}),t)})))()},saveAbilityTag:function(){var e=this;if(this.validate(this.$refs.abilityForm)){var t=[];this.abilityTagDialog.model.nodes&&(t=this.abilityTagDialog.model.nodes.map((function(e){return e.NodeName})));var a=this.abilityTagDialog.model.abilityArr.map((function(e){return{application:e.application,serverName:e.serverName}})),o="",r={};"one"==this.abilityTagDialog.flag?(o="/k8s/api/edit_ability_tag",r={nodeName:this.abilityTagDialog.model.NodeName,tags:a}):(o="/k8s/api/batch_edit_ability_tag",r={nodeNames:t,tags:a}),this.$ajax.postJSON(o,r).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeAbilityTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeAbilityTagDialog:function(){this.abilityTagDialog={flag:"one",show:!1,model:{}}},validate:function(e){var t=!0;return e.validate((function(e){e||(t=!1)})),t},viewItem:function(e){this.showDetail=!0,this.nodeDetail=_o().cloneDeep(e)},closeDetail:function(){this.showDetail=!1,this.fetchData()},changeStatus:function(e){if(e.NodePublic){if(e.Labels.hasOwnProperty("node-role.kubernetes.io/master"))return void this.fetchData();this.addTag(e.NodeName)}else this.delTag(e.NodeName)},addTag:function(e){var t=this;this.$confirm(this.$t("cloud.deploy.install"),"Hint",{confirmButtonText:this.$t("cloud.deploy.confirm"),cancelButtonText:this.$t("cloud.deploy.cancel"),type:"warning"}).then((function(){t.$ajax.postJSON("/k8s/api/ability_open",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch()},delTag:function(e){var t=this;this.$ajax.postJSON("/k8s/api/ability_close",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return(0,O.Z)((0,A.Z)().mark((function a(){var o,r;return(0,A.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 2:return o=a.sent,r=o.Data.map((function(e){return e.ServerName})),a.abrupt("return",r);case 5:case"end":return a.stop()}}),a)})))()},changeApp:function(e,t){var a=this;return(0,O.Z)((0,A.Z)().mark((function o(){var r;return(0,A.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,a.getServerList(t);case 2:r=o.sent,a.$set(a.abilityTagDialog.model.abilityArr[e],"serverNames",r);case 4:case"end":return o.stop()}}),o)})))()},queryAppChange:function(){var e=this;return(0,O.Z)((0,A.Z)().mark((function t(){var a;return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getServerList(e.query.ServerApp);case 2:a=t.sent,e.$set(e.query,"ServerName",""),e.serList=a;case 5:case"end":return t.stop()}}),t)})))()},addCommonTag:function(e,t){t.splice(e+1,0,{name:"",value:""}),this.$forceUpdate()},delCommonTag:function(e,t){t.splice(e,1),this.$forceUpdate()},addAbilityTag:function(e,t){t.splice(e+1,0,{application:"",serverName:"",serverNames:[]}),this.$forceUpdate()},delAbilityTag:function(e,t){t.splice(e,1),this.$forceUpdate()},validateTagName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.notNull")))):o.toLowerCase().startsWith("tars.io")?a(new Error("".concat(this.$t("filter.tip.notTaf")))):a()},validateAppName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.application")))):a()}}},Do=Co,No=(0,_.Z)(Do,go,bo,!1,null,"4f953089",null),To=No.exports,Lo=function(){var e=this,t=e._self._c;return t("div",[t("let-form",{attrs:{inline:"",itemWidth:"180px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search.apply(null,arguments)}}},[t("let-form-item",{staticStyle:{width:"400px"},attrs:{label:e.$t("callChain.date")}},[t("el-date-picker",{attrs:{size:"small",type:"datetimerange","range-separator":"~","start-placeholder":e.$t("board.alarm.form.startDate"),"end-placeholder":e.$t("board.alarm.form.endDate"),"value-format":"timestamp"},model:{value:e.eventDate,callback:function(t){e.eventDate=t},expression:"eventDate"}})],1),t("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),size:"small",disabled:!e.serverEnable,clearable:""},on:{change:function(t){return e.getServerList(e.query.application)}},model:{value:e.query.application,callback:function(t){e.$set(e.query,"application",t)},expression:"query.application"}},e._l(e.appList,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("let-form-item",{attrs:{label:e.$t("filter.title.serverName")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.getPods},model:{value:e.query.serverName,callback:function(t){e.$set(e.query,"serverName",t)},expression:"query.serverName"}},e._l(e.serverNames,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("let-form-item",{attrs:{label:e.$t("serverList.table.th.podName")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.search},model:{value:e.query.pod,callback:function(t){e.$set(e.query,"pod",t)},expression:"query.pod"}},e._l(e.pods,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("let-form-item",{attrs:{label:e.$t("event.eventLevel")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",size:"small"},on:{change:e.search},model:{value:e.query.level,callback:function(t){e.$set(e.query,"level",t)},expression:"query.level"}},e._l(e.levels,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("let-form-item",{staticStyle:{width:"240px"}},[t("el-radio-group",{attrs:{size:"small"},on:{change:e.checkedChange},model:{value:e.query.check,callback:function(t){e.$set(e.query,"check",t)},expression:"query.check"}},[t("el-radio-button",{attrs:{label:"Server"}},[e._v(e._s(e.$t("event.type.server")))]),t("el-radio-button",{attrs:{label:"Cluster"}},[e._v(e._s(e.$t("event.type.cluster")))]),t("el-radio-button",{attrs:{label:"Downtime"}},[e._v(e._s(e.$t("event.type.downtime")))])],1)],1),t("let-form-item",[t("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.events,border:"",stripe:"","highlight-current-row":""}},[t("el-table-column",{attrs:{label:"kind",width:"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.kind||""))]}}])}),t("el-table-column",{attrs:{label:"namespace",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.namespace||""))]}}])}),t("el-table-column",{attrs:{label:"name",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.name||""))]}}])}),t("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),t("el-table-column",{attrs:{label:"reason",prop:"reason",width:"150"}}),t("el-table-column",{attrs:{label:"message",prop:"message","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"firstTime",width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.firstTimestamp)))]}}])}),t("el-table-column",{attrs:{label:"lastTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTimestamp)))]}}])})],1),t("br"),t("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.handleCurrentChange}})],1)},Io=[],Ao={name:"event",data:function(){return{query:{application:"",serverName:"",check:"Server"},eventDate:[new Date((new Date).getTime()-72e5).getTime(),(new Date).getTime()],appList:[],serverNames:[],pods:[],levels:["Normal","Warning"],loading:!1,pagination:{page:1,size:20,total:1},events:[]}},filters:{timeFormat:function(e){return z()(e).format("YYYY-MM-DD HH:mm:ss")}},watch:{$route:function(e,t){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.search()}},mounted:function(){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.getAppList(),this.search()},computed:{serverEnable:function(){return"Server"==this.query.check}},methods:{checkedChange:function(){this.pagination.page=1,this.loadData(1)},handleCurrentChange:function(e){this.loadData(e)},search:function(){this.loadData(1)},loadData:function(e){var t=this;e||(e=1);var a="",o="";this.eventDate&&(a=this.eventDate[0],o=this.eventDate[1]);var r=Object.assign({},this.query,{currPage:e,pageSize:this.pagination.size},{startDate:a,endDate:o});this.loading=!0,this.$ajax.getJSON("/k8s/api/get_events",r).then((function(e){t.events=e.rows,t.pagination.total=e.total,t.loading=!1})).catch((function(e){t.loading=!1,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return(0,O.Z)((0,A.Z)().mark((function a(){var o;return(0,A.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$set(t.query,"serverName",""),a.next=3,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 3:o=a.sent,t.serverNames=o.Data.map((function(e){return e.ServerName})),t.search();case 6:case"end":return a.stop()}}),a)})))()},getPods:function(){var e=this;this.$set(this.query,"pod","");var t="",a="";this.eventDate&&(t=this.eventDate[0],a=this.eventDate[1]);var o=Object.assign({},this.query,{startDate:t,endDate:a});this.$ajax.getJSON("/k8s/api/get_pods",o).then((function(t){e.pods=t,e.search()})).catch((function(t){e.$set(e,"pods","")})),this.search()}}},Oo=Ao,Po=(0,_.Z)(Oo,Lo,Io,!1,null,"62e254f2",null),jo=Po.exports,qo=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page_framework_config"},[[t("span",[t("el-button",{staticStyle:{width:"100px",margin:"10px 0 5px 0"},attrs:{size:"mini",type:"primary"},on:{click:e.showYaml}},[e._v(e._s(e.$t("operate.yaml"))+" ")]),t("span",[t("i",{staticClass:"el-icon-refresh-right",staticStyle:{margin:"10px"},on:{click:function(t){return e.getTfc()}}})])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.config,stripe:"",border:""}},[t("el-table-column",{attrs:{prop:"column",label:"key",width:"300"}}),t("el-table-column",{attrs:{prop:"remark",label:"remark",width:"300"}}),t("el-table-column",{attrs:{label:"value"},scopedSlots:e._u([{key:"default",fn:function(a){return["nodeImage.image"==a.row.column?t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}},e._l(e.nodeList,(function(a){return t("el-option",{key:a.Image,attrs:{value:a.Image}},[t("span",[e._v(e._s(a.Image))])])})),1):t("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:8},placeholder:"请输入内容"},model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}})]}}])}),t("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("let-table-operation",{on:{click:function(t){return e.saveTfcItem(a.row)}}},[e._v(" "+e._s(e.$t("operate.save"))+" ")])]}}])})],1),t("el-dialog",{attrs:{title:"Framework config",width:"50%",top:"50px",visible:e.showDialog,"before-close":e.closeDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("k8s-yaml-edit",{ref:"yamlEdit",on:{successFun:e.closeDialog}})],1)]],2)},zo=[],Bo={name:"frameworkConfig",data:function(){return{showDialog:!1,config:[],nodeList:[]}},components:{K8sYamlEdit:lt},mounted:function(){this.getTfc(),this.getTafNodeList()},methods:{getTfc:function(){var e=this;this.$ajax.getJSON("/k8s/api/get_tfc").then((function(t){e.config=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getTafNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){e.nodeList=t.Data}))},saveTfcItem:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},showYaml:function(){var e=this;this.showDialog=!0,this.$nextTick((function(){e.$refs.yamlEdit.show("111","tframeworkconfigs"),e.$refs.yamlEdit.refresh()}))},closeDialog:function(){this.showDialog=!1,this.getTfc()}}},Jo=Bo,Eo=(0,_.Z)(Jo,qo,zo,!1,null,"bee8c302",null),Zo=Eo.exports,Vo=a(61753),Ho=a(30170),Fo=a(39491);o["default"].use(D.ZP);var Ro=D.ZP.prototype.push;D.ZP.prototype.push=function(e){return Ro.call(this,e).catch((function(e){return e}))};var Yo=D.ZP.prototype.replace;D.ZP.prototype.replace=function(e){return Yo.call(this,e).catch((function(e){return e}))};var Wo=function(e){return{default:e,market:Fo.Z}},Ko=new D.ZP({routes:[{path:"/server",name:"Server",components:Wo(oa),children:[{path:":treeid/manage",component:wt},{path:":treeid/history",component:Rt},{path:":treeid/publish",component:Tt},{path:":treeid/config",component:qt},{path:":treeid/server-monitor",component:zt.Z},{path:":treeid/property-monitor",component:Bt.Z},{path:":treeid/user-manage",component:Jt.Z},{path:":treeid/plugins",component:Xt.Z}]},{path:"/operation",name:"Operation",components:Wo(ha),redirect:"/operation/deploy",children:[{path:"deploy",component:Aa},{path:"history",component:Ba},{path:"undeploy",component:Fa},{path:"templates",component:Ga},{path:"image",component:oo},{path:"application",component:co},{path:"business",component:vo},{path:"node",component:To},{path:"event",component:jo},{path:"tfc",component:Zo}]},{path:"/market",name:"Market",components:Wo()},{path:"/plugins/*",name:"Plugin",components:Wo(Ho.Z)},{path:"/plugins-manage",name:"PluginManage",components:Wo(Vo.Z)},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}}),Uo=a(17804),Go=a.n(Uo),Qo=a(94471),Xo=a(64720),er=a.n(Xo),tr=(a(34527),a(51914),a(5273)),ar=a.n(tr);o["default"].config.productionTip=!1,Qo.U4.call(void 0).then((function(){o["default"].use(ar()),o["default"].use(er(),{i18n:function(e,t){return Qo.ag.t(e,t)}}),o["default"].use(Go()),new o["default"]({i18n:Qo.ag,el:"#app",router:Ko,store:r.Z,components:{k8sApp:C},template:"<k8sApp/>"})}))}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=e,function(){a.amdO={}}(),function(){var e=[];a.O=function(t,o,r,i){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],i=e[d][2];for(var l=!0,n=0;n<o.length;n++)(!1&i||s>=i)&&Object.keys(a.O).every((function(e){return a.O[e](o[n])}))?o.splice(n--,1):(l=!1,i<s&&(s=i));if(l){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,r,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.j=218}(),function(){a.p="/"}(),function(){var e={218:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,i,s=o[0],l=o[1],n=o[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(n)var d=n(a)}for(t&&t(o);c<s.length;c++)i=s[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(d)},o=self["webpackChunkclient"]=self["webpackChunkclient"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998,64],(function(){return a(76840)}));o=a.O(o)})();